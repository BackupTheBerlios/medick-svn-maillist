<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Medick-svn] r354 - applications/eltodo/public/javascript trunk/skel/public/javascript trunk/test
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/medick-svn/2006-February/index.html" >
   <LINK REL="made" HREF="mailto:medick-svn%40lists.berlios.de?Subject=Re%3A%20%5BMedick-svn%5D%20r354%20-%20applications/eltodo/public/javascript%20trunk/skel/public/javascript%20trunk/test&In-Reply-To=%3C200602221926.k1MJQaPj013655%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000144.html">
   <LINK REL="Next"  HREF="000146.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Medick-svn] r354 - applications/eltodo/public/javascript trunk/skel/public/javascript trunk/test</H1>
    <B>aurelian at BerliOS</B> 
    <A HREF="mailto:medick-svn%40lists.berlios.de?Subject=Re%3A%20%5BMedick-svn%5D%20r354%20-%20applications/eltodo/public/javascript%20trunk/skel/public/javascript%20trunk/test&In-Reply-To=%3C200602221926.k1MJQaPj013655%40sheep.berlios.de%3E"
       TITLE="[Medick-svn] r354 - applications/eltodo/public/javascript trunk/skel/public/javascript trunk/test">aurelian at berlios.de
       </A><BR>
    <I>Wed Feb 22 20:26:36 CET 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000144.html">[Medick-svn] r353 - in trunk: . libs/configurator libs/logger libs/logger/formatter libs/medick test test/test/action/controller test/test/active/record test/test/active/record/associations test/test/medick
</A></li>
        <LI>Next message: <A HREF="000146.html">[Medick-svn] r355 - applications/eltodo/app/views/layouts applications/eltodo/public applications/eltodo/public/stylesheet trunk trunk/libs/action/controller trunk/libs/action/controller/http trunk/libs/medick trunk/skel/public
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#145">[ date ]</a>
              <a href="thread.html#145">[ thread ]</a>
              <a href="subject.html#145">[ subject ]</a>
              <a href="author.html#145">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: aurelian
Date: 2006-02-22 20:26:26 +0100 (Wed, 22 Feb 2006)
New Revision: 354

Modified:
   applications/eltodo/public/javascript/controls.js
   applications/eltodo/public/javascript/dragdrop.js
   applications/eltodo/public/javascript/effects.js
   applications/eltodo/public/javascript/scriptaculous.js
   applications/eltodo/public/javascript/slider.js
   trunk/skel/public/javascript/controls.js
   trunk/skel/public/javascript/dragdrop.js
   trunk/skel/public/javascript/effects.js
   trunk/skel/public/javascript/scriptaculous.js
   trunk/skel/public/javascript/slider.js
   trunk/test/runner.php
Log:
 -- upgraded script.aculo.us to version 1.5.3

Modified: applications/eltodo/public/javascript/controls.js
===================================================================
--- applications/eltodo/public/javascript/controls.js	2006-02-19 18:07:57 UTC (rev 353)
+++ applications/eltodo/public/javascript/controls.js	2006-02-22 19:26:26 UTC (rev 354)
@@ -152,6 +152,12 @@
         setTimeout(this.onObserverEvent.bind(this), this.options.frequency*1000);
   },
 
+  activate: function() {
+    this.changed = false;
+    this.hasFocus = true;
+    this.getUpdatedChoices();
+  },
+
   onHover: function(event) {
     var element = Event.findElement(event, 'LI');
     if(this.index != element.autocompleteIndex) 
@@ -310,7 +316,7 @@
 Ajax.Autocompleter = Class.create();
 Object.extend(Object.extend(Ajax.Autocompleter.prototype, Autocompleter.Base.prototype), {
   initialize: function(element, update, url, options) {
-	  this.baseInitialize(element, update, options);
+    this.baseInitialize(element, update, options);
     this.options.asynchronous  = true;
     this.options.onComplete    = this.onComplete.bind(this);
     this.options.defaultParams = this.options.parameters || null;
@@ -477,9 +483,10 @@
       formClassName: 'inplaceeditor-form',
       highlightcolor: Ajax.InPlaceEditor.defaultHighlightColor,
       highlightendcolor: &quot;#FFFFFF&quot;,
-      externalControl:	null,
+      externalControl: null,
       submitOnBlur: false,
-      ajaxOptions: {}
+      ajaxOptions: {},
+      evalScripts: false
     }, options || {});
 
     if(!this.options.formId &amp;&amp; this.element.id) {
@@ -548,6 +555,7 @@
       okButton = document.createElement(&quot;input&quot;);
       okButton.type = &quot;submit&quot;;
       okButton.value = this.options.okText;
+      okButton.className = 'editor_ok_button';
       this.form.appendChild(okButton);
     }
 
@@ -556,6 +564,7 @@
       cancelLink.href = &quot;#&quot;;
       cancelLink.appendChild(document.createTextNode(this.options.cancelText));
       cancelLink.onclick = this.onclickCancel.bind(this);
+      cancelLink.className = 'editor_cancel';      
       this.form.appendChild(cancelLink);
     }
   },
@@ -584,6 +593,7 @@
       textField.name = &quot;value&quot;;
       textField.value = text;
       textField.style.backgroundColor = this.options.highlightcolor;
+      textField.className = 'editor_field';
       var size = this.options.size || this.options.cols || 0;
       if (size != 0) textField.size = size;
       if (this.options.submitOnBlur)
@@ -597,6 +607,7 @@
       textArea.value = this.convertHTMLLineBreaks(text);
       textArea.rows = this.options.rows;
       textArea.cols = this.options.cols || 40;
+      textArea.className = 'editor_field';      
       if (this.options.submitOnBlur)
         textArea.onblur = this.onSubmit.bind(this);
       this.editField = textArea;
@@ -649,19 +660,26 @@
     // to be displayed indefinitely
     this.onLoading();
     
-    new Ajax.Updater(
-      { 
-        success: this.element,
-         // don't update on failure (this could be an option)
-        failure: null
-      },
-      this.url,
-      Object.extend({
-        parameters: this.options.callback(form, value),
-        onComplete: this.onComplete.bind(this),
-        onFailure: this.onFailure.bind(this)
-      }, this.options.ajaxOptions)
-    );
+    if (this.options.evalScripts) {
+      new Ajax.Request(
+        this.url, Object.extend({
+          parameters: this.options.callback(form, value),
+          onComplete: this.onComplete.bind(this),
+          onFailure: this.onFailure.bind(this),
+          asynchronous:true, 
+          evalScripts:true
+        }, this.options.ajaxOptions));
+    } else  {
+      new Ajax.Updater(
+        { success: this.element,
+          // don't update on failure (this could be an option)
+          failure: null }, 
+        this.url, Object.extend({
+          parameters: this.options.callback(form, value),
+          onComplete: this.onComplete.bind(this),
+          onFailure: this.onFailure.bind(this)
+        }, this.options.ajaxOptions));
+    }
     // stop the event to avoid a page refresh in Safari
     if (arguments.length &gt; 1) {
       Event.stop(arguments[0]);
@@ -743,6 +761,33 @@
   }
 };
 
+Ajax.InPlaceCollectionEditor = Class.create();
+Object.extend(Ajax.InPlaceCollectionEditor.prototype, Ajax.InPlaceEditor.prototype);
+Object.extend(Ajax.InPlaceCollectionEditor.prototype, {
+  createEditField: function() {
+    if (!this.cached_selectTag) {
+      var selectTag = document.createElement(&quot;select&quot;);
+      var collection = this.options.collection || [];
+      var optionTag;
+      collection.each(function(e,i) {
+        optionTag = document.createElement(&quot;option&quot;);
+        optionTag.value = (e instanceof Array) ? e[0] : e;
+        if(this.options.value==optionTag.value) optionTag.selected = true;
+        optionTag.appendChild(document.createTextNode((e instanceof Array) ? e[1] : e));
+        selectTag.appendChild(optionTag);
+      }.bind(this));
+      this.cached_selectTag = selectTag;
+    }
+
+    this.editField = this.cached_selectTag;
+    if(this.options.loadTextURL) this.loadExternalText();
+    this.form.appendChild(this.editField);
+    this.options.callback = function(form, value) {
+      return &quot;value=&quot; + encodeURIComponent(value);
+    }
+  }
+});
+
 // Delayed observer, like Form.Element.Observer, 
 // but waits for delay after last key input
 // Ideal for live-search fields

Modified: applications/eltodo/public/javascript/dragdrop.js
===================================================================
--- applications/eltodo/public/javascript/dragdrop.js	2006-02-19 18:07:57 UTC (rev 353)
+++ applications/eltodo/public/javascript/dragdrop.js	2006-02-22 19:26:26 UTC (rev 354)
@@ -128,7 +128,7 @@
     this.activeDraggable = draggable;
   },
   
-  deactivate: function(draggbale) {
+  deactivate: function() {
     this.activeDraggable = null;
   },
   
@@ -199,6 +199,9 @@
       },
       zindex: 1000,
       revert: false,
+      scroll: false,
+      scrollSensitivity: 20,
+      scrollSpeed: 15,
       snap: false   // false, or xy or [x,y] or function(x,y){ return [x,y] }
     }, arguments[1] || {});
 
@@ -208,6 +211,8 @@
       this.handle = Element.childrenWithClassName(this.element, options.handle)[0];  
     if(!this.handle) this.handle = $(options.handle);
     if(!this.handle) this.handle = this.element;
+    
+    if(options.scroll) options.scroll = $(options.scroll);
 
     Element.makePositioned(this.element); // fix IE    
 
@@ -239,6 +244,7 @@
       if(src.tagName &amp;&amp; (
         src.tagName=='INPUT' ||
         src.tagName=='SELECT' ||
+        src.tagName=='OPTION' ||
         src.tagName=='BUTTON' ||
         src.tagName=='TEXTAREA')) return;
         
@@ -270,6 +276,11 @@
       this.element.parentNode.insertBefore(this._clone, this.element);
     }
     
+    if(this.options.scroll) {
+      this.originalScrollLeft = this.options.scroll.scrollLeft;
+      this.originalScrollTop = this.options.scroll.scrollTop;
+    }
+    
     Draggables.notify('onStart', this, event);
     if(this.options.starteffect) this.options.starteffect(this.element);
   },
@@ -282,8 +293,25 @@
     this.draw(pointer);
     if(this.options.change) this.options.change(this);
     
+    if(this.options.scroll) {
+      //if(this.scrollInterval) this.scroll();
+      this.stopScrolling();
+      var p = Position.page(this.options.scroll);
+      p[0] += this.options.scroll.scrollLeft;
+      p[1] += this.options.scroll.scrollTop;
+      p.push(p[0]+this.options.scroll.offsetWidth);
+      p.push(p[1]+this.options.scroll.offsetHeight);
+      var speed = [0,0];
+      if(pointer[0] &lt; (p[0]+this.options.scrollSensitivity)) speed[0] = pointer[0]-(p[0]+this.options.scrollSensitivity);
+      if(pointer[1] &lt; (p[1]+this.options.scrollSensitivity)) speed[1] = pointer[1]-(p[1]+this.options.scrollSensitivity);
+      if(pointer[0] &gt; (p[2]-this.options.scrollSensitivity)) speed[0] = pointer[0]-(p[2]-this.options.scrollSensitivity);
+      if(pointer[1] &gt; (p[3]-this.options.scrollSensitivity)) speed[1] = pointer[1]-(p[3]-this.options.scrollSensitivity);
+      this.startScrolling(speed);
+    }
+    
     // fix AppleWebKit rendering
     if(navigator.appVersion.indexOf('AppleWebKit')&gt;0) window.scrollBy(0,0);
+    
     Event.stop(event);
   },
   
@@ -321,13 +349,14 @@
   },
   
   keyPress: function(event) {
-    if(!event.keyCode==Event.KEY_ESC) return;
+    if(event.keyCode!=Event.KEY_ESC) return;
     this.finishDrag(event, false);
     Event.stop(event);
   },
   
   endDrag: function(event) {
     if(!this.dragging) return;
+    this.stopScrolling();
     this.finishDrag(event, true);
     Event.stop(event);
   },
@@ -337,8 +366,15 @@
     var d = this.currentDelta();
     pos[0] -= d[0]; pos[1] -= d[1];
     
-    var p = [0,1].map(function(i){ return (point[i]-pos[i]-this.offset[i]) }.bind(this));
+    if(this.options.scroll) {
+      pos[0] -= this.options.scroll.scrollLeft-this.originalScrollLeft;
+      pos[1] -= this.options.scroll.scrollTop-this.originalScrollTop;
+    }
     
+    var p = [0,1].map(function(i){ 
+      return (point[i]-pos[i]-this.offset[i]) 
+    }.bind(this));
+    
     if(this.options.snap) {
       if(typeof this.options.snap == 'function') {
         p = this.options.snap(p[0],p[1]);
@@ -358,6 +394,34 @@
     if((!this.options.constraint) || (this.options.constraint=='vertical'))
       style.top  = p[1] + &quot;px&quot;;
     if(style.visibility==&quot;hidden&quot;) style.visibility = &quot;&quot;; // fix gecko rendering
+  },
+  
+  stopScrolling: function() {
+    if(this.scrollInterval) {
+      clearInterval(this.scrollInterval);
+      this.scrollInterval = null;
+    }
+  },
+  
+  startScrolling: function(speed) {
+    this.scrollSpeed = [speed[0]*this.options.scrollSpeed,speed[1]*this.options.scrollSpeed];
+    this.lastScrolled = new Date();
+    this.scrollInterval = setInterval(this.scroll.bind(this), 10);
+  },
+  
+  scroll: function() {
+    var current = new Date();
+    var delta = current - this.lastScrolled;
+    this.lastScrolled = current;
+    this.options.scroll.scrollLeft += this.scrollSpeed[0] * delta / 1000;
+    this.options.scroll.scrollTop  += this.scrollSpeed[1] * delta / 1000;
+    
+    Position.prepare();
+    Droppables.show(Draggables._lastPointer, this.element);
+    Draggables.notify('onDrag', this);
+    this.draw(Draggables._lastPointer);    
+    
+    if(this.options.change) this.options.change(this);
   }
 }
 
@@ -414,7 +478,8 @@
       only:        false,
       hoverclass:  null,
       ghosting:    false,
-      format:      null,
+      scroll:      false,
+      format:      /^[^_]*_(.*)$/,
       onChange:    Prototype.emptyFunction,
       onUpdate:    Prototype.emptyFunction
     }, arguments[1] || {});
@@ -425,6 +490,7 @@
     // build options for the draggables
     var options_for_draggable = {
       revert:      true,
+      scroll:      options.scroll,
       ghosting:    options.ghosting,
       constraint:  options.constraint,
       handle:      options.handle };
@@ -568,18 +634,41 @@
     Element.show(Sortable._marker);
   },
 
+  sequence: function(element) {
+    element = $(element);
+    var options = Object.extend(this.options(element), arguments[1] || {});
+    
+    return $(this.findElements(element, options) || []).map( function(item) {
+      return item.id.match(options.format) ? item.id.match(options.format)[1] : '';
+    });
+  },
+
+  setSequence: function(element, new_sequence) {
+    element = $(element);
+    var options = Object.extend(this.options(element), arguments[2] || {});
+    
+    var nodeMap = {};
+    this.findElements(element, options).each( function(n) {
+        if (n.id.match(options.format))
+            nodeMap[n.id.match(options.format)[1]] = [n, n.parentNode];
+        n.parentNode.removeChild(n);
+    });
+   
+    new_sequence.each(function(ident) {
+        var n = nodeMap[ident];
+        if (n) {
+            n[1].appendChild(n[0]);
+            delete nodeMap[ident];
+        }
+    });
+  },
+
   serialize: function(element) {
     element = $(element);
-    var sortableOptions = this.options(element);
-    var options = Object.extend({
-      tag:  sortableOptions.tag,
-      only: sortableOptions.only,
-      name: element.id,
-      format: sortableOptions.format || /^[^_]*_(.*)$/
-    }, arguments[1] || {});
-    return $(this.findElements(element, options) || []).map( function(item) {
-      return (encodeURIComponent(options.name) + &quot;[]=&quot; + 
-              encodeURIComponent(item.id.match(options.format) ? item.id.match(options.format)[1] : ''));
-    }).join(&quot;&amp;&quot;);
+    var name = encodeURIComponent(
+      (arguments[1] &amp;&amp; arguments[1].name) ? arguments[1].name : element.id);
+    return Sortable.sequence(element, arguments[1]).map( function(item) {
+      return name + &quot;[]=&quot; + encodeURIComponent(item);
+    }).join('&amp;');
   }
-}
\ No newline at end of file
+}

Modified: applications/eltodo/public/javascript/effects.js
===================================================================
--- applications/eltodo/public/javascript/effects.js	2006-02-19 18:07:57 UTC (rev 353)
+++ applications/eltodo/public/javascript/effects.js	2006-02-22 19:26:26 UTC (rev 354)
@@ -35,7 +35,7 @@
   return $A($(element).childNodes).collect( function(node) {
     return (node.nodeType==3 ? node.nodeValue : 
       ((node.hasChildNodes() &amp;&amp; !Element.hasClassName(node,className)) ? 
-        Element.collectTextNodes(node) : ''));
+        Element.collectTextNodesIgnoreClass(node, className) : ''));
   }).flatten().join('');
 }
 
@@ -137,7 +137,7 @@
     element = $(element);
     effect = (effect || 'appear').toLowerCase();
     var options = Object.extend({
-      queue: { position:'end', scope:(element.id || 'global') }
+      queue: { position:'end', scope:(element.id || 'global'), limit: 1 }
     }, arguments[2] || {});
     Effect[Element.visible(element) ? 
       Effect.PAIRS[effect][1] : Effect.PAIRS[effect][0]](element, options);
@@ -209,7 +209,10 @@
     
     effect.startOn  += timestamp;
     effect.finishOn += timestamp;
-    this.effects.push(effect);
+
+    if(!effect.options.queue.limit || (this.effects.length &lt; effect.options.queue.limit))
+      this.effects.push(effect);
+    
     if(!this.interval) 
       this.interval = setInterval(this.loop.bind(this), 40);
   },
@@ -581,7 +584,6 @@
 
 Effect.BlindDown = function(element) {
   element = $(element);
-  var oldHeight = Element.getStyle(element, 'height');
   var elementDimensions = Element.getDimensions(element);
   return new Effect.Scale(element, 100, 
     Object.extend({ scaleContent: false, 
@@ -594,10 +596,9 @@
         setStyle(effect.element, {height: '0px'});
         show(effect.element); 
       }},  
-      afterFinishInternal: function(effect) { with(Element) {
-        undoClipping(effect.element);
-        setStyle(effect.element, {height: oldHeight});
-      }}
+      afterFinishInternal: function(effect) {
+        Element.undoClipping(effect.element);
+      }
     }, arguments[1] || {})
   );
 }
@@ -690,8 +691,14 @@
         (effect.dims[0] - effect.element.clientHeight) + 'px' }); }},
     afterFinishInternal: function(effect) { with(Element) {
       undoClipping(effect.element); 
-      undoPositioned(effect.element.firstChild);
-      undoPositioned(effect.element);
+      // IE will crash if child is undoPositioned first
+      if(/MSIE/.test(navigator.userAgent)){
+        undoPositioned(effect.element);
+        undoPositioned(effect.element.firstChild);
+      }else{
+        undoPositioned(effect.element.firstChild);
+        undoPositioned(effect.element);
+      }
       setStyle(effect.element.firstChild, {bottom: oldInnerBottom}); }}
     }, arguments[1] || {})
   );
@@ -741,7 +748,7 @@
   element = $(element);
   var options = Object.extend({
     direction: 'center',
-    moveTransistion: Effect.Transitions.sinoidal,
+    moveTransition: Effect.Transitions.sinoidal,
     scaleTransition: Effect.Transitions.sinoidal,
     opacityTransition: Effect.Transitions.full
   }, arguments[1] || {});
@@ -817,7 +824,7 @@
   element = $(element);
   var options = Object.extend({
     direction: 'center',
-    moveTransistion: Effect.Transitions.sinoidal,
+    moveTransition: Effect.Transitions.sinoidal,
     scaleTransition: Effect.Transitions.sinoidal,
     opacityTransition: Effect.Transitions.none
   }, arguments[1] || {});

Modified: applications/eltodo/public/javascript/scriptaculous.js
===================================================================
--- applications/eltodo/public/javascript/scriptaculous.js	2006-02-19 18:07:57 UTC (rev 353)
+++ applications/eltodo/public/javascript/scriptaculous.js	2006-02-22 19:26:26 UTC (rev 354)
@@ -20,7 +20,7 @@
 // WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 
 var Scriptaculous = {
-  Version: '1.5.1',
+  Version: '1.5.3',
   require: function(libraryName) {
     // inserting via DOM fails in Safari 2.0, so brute force approach
     document.write('&lt;script type=&quot;text/javascript&quot; src=&quot;'+libraryName+'&quot;&gt;&lt;/script&gt;');

Modified: applications/eltodo/public/javascript/slider.js
===================================================================
--- applications/eltodo/public/javascript/slider.js	2006-02-19 18:07:57 UTC (rev 353)
+++ applications/eltodo/public/javascript/slider.js	2006-02-22 19:26:26 UTC (rev 354)
@@ -200,10 +200,10 @@
   setSpan: function(span, range) {
     if(this.isVertical()) {
       span.style.top = this.translateToPx(range.start);
-      span.style.height = this.translateToPx(range.end - range.start);
+      span.style.height = this.translateToPx(range.end - range.start + this.range.start);
     } else {
       span.style.left = this.translateToPx(range.start);
-      span.style.width = this.translateToPx(range.end - range.start);
+      span.style.width = this.translateToPx(range.end - range.start + this.range.start);
     }
   },
   updateStyles: function() {

Modified: trunk/skel/public/javascript/controls.js
===================================================================
--- trunk/skel/public/javascript/controls.js	2006-02-19 18:07:57 UTC (rev 353)
+++ trunk/skel/public/javascript/controls.js	2006-02-22 19:26:26 UTC (rev 354)
@@ -152,6 +152,12 @@
         setTimeout(this.onObserverEvent.bind(this), this.options.frequency*1000);
   },
 
+  activate: function() {
+    this.changed = false;
+    this.hasFocus = true;
+    this.getUpdatedChoices();
+  },
+
   onHover: function(event) {
     var element = Event.findElement(event, 'LI');
     if(this.index != element.autocompleteIndex) 
@@ -310,7 +316,7 @@
 Ajax.Autocompleter = Class.create();
 Object.extend(Object.extend(Ajax.Autocompleter.prototype, Autocompleter.Base.prototype), {
   initialize: function(element, update, url, options) {
-	  this.baseInitialize(element, update, options);
+    this.baseInitialize(element, update, options);
     this.options.asynchronous  = true;
     this.options.onComplete    = this.onComplete.bind(this);
     this.options.defaultParams = this.options.parameters || null;
@@ -477,9 +483,10 @@
       formClassName: 'inplaceeditor-form',
       highlightcolor: Ajax.InPlaceEditor.defaultHighlightColor,
       highlightendcolor: &quot;#FFFFFF&quot;,
-      externalControl:	null,
+      externalControl: null,
       submitOnBlur: false,
-      ajaxOptions: {}
+      ajaxOptions: {},
+      evalScripts: false
     }, options || {});
 
     if(!this.options.formId &amp;&amp; this.element.id) {
@@ -548,6 +555,7 @@
       okButton = document.createElement(&quot;input&quot;);
       okButton.type = &quot;submit&quot;;
       okButton.value = this.options.okText;
+      okButton.className = 'editor_ok_button';
       this.form.appendChild(okButton);
     }
 
@@ -556,6 +564,7 @@
       cancelLink.href = &quot;#&quot;;
       cancelLink.appendChild(document.createTextNode(this.options.cancelText));
       cancelLink.onclick = this.onclickCancel.bind(this);
+      cancelLink.className = 'editor_cancel';      
       this.form.appendChild(cancelLink);
     }
   },
@@ -584,6 +593,7 @@
       textField.name = &quot;value&quot;;
       textField.value = text;
       textField.style.backgroundColor = this.options.highlightcolor;
+      textField.className = 'editor_field';
       var size = this.options.size || this.options.cols || 0;
       if (size != 0) textField.size = size;
       if (this.options.submitOnBlur)
@@ -597,6 +607,7 @@
       textArea.value = this.convertHTMLLineBreaks(text);
       textArea.rows = this.options.rows;
       textArea.cols = this.options.cols || 40;
+      textArea.className = 'editor_field';      
       if (this.options.submitOnBlur)
         textArea.onblur = this.onSubmit.bind(this);
       this.editField = textArea;
@@ -649,19 +660,26 @@
     // to be displayed indefinitely
     this.onLoading();
     
-    new Ajax.Updater(
-      { 
-        success: this.element,
-         // don't update on failure (this could be an option)
-        failure: null
-      },
-      this.url,
-      Object.extend({
-        parameters: this.options.callback(form, value),
-        onComplete: this.onComplete.bind(this),
-        onFailure: this.onFailure.bind(this)
-      }, this.options.ajaxOptions)
-    );
+    if (this.options.evalScripts) {
+      new Ajax.Request(
+        this.url, Object.extend({
+          parameters: this.options.callback(form, value),
+          onComplete: this.onComplete.bind(this),
+          onFailure: this.onFailure.bind(this),
+          asynchronous:true, 
+          evalScripts:true
+        }, this.options.ajaxOptions));
+    } else  {
+      new Ajax.Updater(
+        { success: this.element,
+          // don't update on failure (this could be an option)
+          failure: null }, 
+        this.url, Object.extend({
+          parameters: this.options.callback(form, value),
+          onComplete: this.onComplete.bind(this),
+          onFailure: this.onFailure.bind(this)
+        }, this.options.ajaxOptions));
+    }
     // stop the event to avoid a page refresh in Safari
     if (arguments.length &gt; 1) {
       Event.stop(arguments[0]);
@@ -743,6 +761,33 @@
   }
 };
 
+Ajax.InPlaceCollectionEditor = Class.create();
+Object.extend(Ajax.InPlaceCollectionEditor.prototype, Ajax.InPlaceEditor.prototype);
+Object.extend(Ajax.InPlaceCollectionEditor.prototype, {
+  createEditField: function() {
+    if (!this.cached_selectTag) {
+      var selectTag = document.createElement(&quot;select&quot;);
+      var collection = this.options.collection || [];
+      var optionTag;
+      collection.each(function(e,i) {
+        optionTag = document.createElement(&quot;option&quot;);
+        optionTag.value = (e instanceof Array) ? e[0] : e;
+        if(this.options.value==optionTag.value) optionTag.selected = true;
+        optionTag.appendChild(document.createTextNode((e instanceof Array) ? e[1] : e));
+        selectTag.appendChild(optionTag);
+      }.bind(this));
+      this.cached_selectTag = selectTag;
+    }
+
+    this.editField = this.cached_selectTag;
+    if(this.options.loadTextURL) this.loadExternalText();
+    this.form.appendChild(this.editField);
+    this.options.callback = function(form, value) {
+      return &quot;value=&quot; + encodeURIComponent(value);
+    }
+  }
+});
+
 // Delayed observer, like Form.Element.Observer, 
 // but waits for delay after last key input
 // Ideal for live-search fields

Modified: trunk/skel/public/javascript/dragdrop.js
===================================================================
--- trunk/skel/public/javascript/dragdrop.js	2006-02-19 18:07:57 UTC (rev 353)
+++ trunk/skel/public/javascript/dragdrop.js	2006-02-22 19:26:26 UTC (rev 354)
@@ -128,7 +128,7 @@
     this.activeDraggable = draggable;
   },
   
-  deactivate: function(draggbale) {
+  deactivate: function() {
     this.activeDraggable = null;
   },
   
@@ -199,6 +199,9 @@
       },
       zindex: 1000,
       revert: false,
+      scroll: false,
+      scrollSensitivity: 20,
+      scrollSpeed: 15,
       snap: false   // false, or xy or [x,y] or function(x,y){ return [x,y] }
     }, arguments[1] || {});
 
@@ -208,6 +211,8 @@
       this.handle = Element.childrenWithClassName(this.element, options.handle)[0];  
     if(!this.handle) this.handle = $(options.handle);
     if(!this.handle) this.handle = this.element;
+    
+    if(options.scroll) options.scroll = $(options.scroll);
 
     Element.makePositioned(this.element); // fix IE    
 
@@ -239,6 +244,7 @@
       if(src.tagName &amp;&amp; (
         src.tagName=='INPUT' ||
         src.tagName=='SELECT' ||
+        src.tagName=='OPTION' ||
         src.tagName=='BUTTON' ||
         src.tagName=='TEXTAREA')) return;
         
@@ -270,6 +276,11 @@
       this.element.parentNode.insertBefore(this._clone, this.element);
     }
     
+    if(this.options.scroll) {
+      this.originalScrollLeft = this.options.scroll.scrollLeft;
+      this.originalScrollTop = this.options.scroll.scrollTop;
+    }
+    
     Draggables.notify('onStart', this, event);
     if(this.options.starteffect) this.options.starteffect(this.element);
   },
@@ -282,8 +293,25 @@
     this.draw(pointer);
     if(this.options.change) this.options.change(this);
     
+    if(this.options.scroll) {
+      //if(this.scrollInterval) this.scroll();
+      this.stopScrolling();
+      var p = Position.page(this.options.scroll);
+      p[0] += this.options.scroll.scrollLeft;
+      p[1] += this.options.scroll.scrollTop;
+      p.push(p[0]+this.options.scroll.offsetWidth);
+      p.push(p[1]+this.options.scroll.offsetHeight);
+      var speed = [0,0];
+      if(pointer[0] &lt; (p[0]+this.options.scrollSensitivity)) speed[0] = pointer[0]-(p[0]+this.options.scrollSensitivity);
+      if(pointer[1] &lt; (p[1]+this.options.scrollSensitivity)) speed[1] = pointer[1]-(p[1]+this.options.scrollSensitivity);
+      if(pointer[0] &gt; (p[2]-this.options.scrollSensitivity)) speed[0] = pointer[0]-(p[2]-this.options.scrollSensitivity);
+      if(pointer[1] &gt; (p[3]-this.options.scrollSensitivity)) speed[1] = pointer[1]-(p[3]-this.options.scrollSensitivity);
+      this.startScrolling(speed);
+    }
+    
     // fix AppleWebKit rendering
     if(navigator.appVersion.indexOf('AppleWebKit')&gt;0) window.scrollBy(0,0);
+    
     Event.stop(event);
   },
   
@@ -321,13 +349,14 @@
   },
   
   keyPress: function(event) {
-    if(!event.keyCode==Event.KEY_ESC) return;
+    if(event.keyCode!=Event.KEY_ESC) return;
     this.finishDrag(event, false);
     Event.stop(event);
   },
   
   endDrag: function(event) {
     if(!this.dragging) return;
+    this.stopScrolling();
     this.finishDrag(event, true);
     Event.stop(event);
   },
@@ -337,8 +366,15 @@
     var d = this.currentDelta();
     pos[0] -= d[0]; pos[1] -= d[1];
     
-    var p = [0,1].map(function(i){ return (point[i]-pos[i]-this.offset[i]) }.bind(this));
+    if(this.options.scroll) {
+      pos[0] -= this.options.scroll.scrollLeft-this.originalScrollLeft;
+      pos[1] -= this.options.scroll.scrollTop-this.originalScrollTop;
+    }
     
+    var p = [0,1].map(function(i){ 
+      return (point[i]-pos[i]-this.offset[i]) 
+    }.bind(this));
+    
     if(this.options.snap) {
       if(typeof this.options.snap == 'function') {
         p = this.options.snap(p[0],p[1]);
@@ -358,6 +394,34 @@
     if((!this.options.constraint) || (this.options.constraint=='vertical'))
       style.top  = p[1] + &quot;px&quot;;
     if(style.visibility==&quot;hidden&quot;) style.visibility = &quot;&quot;; // fix gecko rendering
+  },
+  
+  stopScrolling: function() {
+    if(this.scrollInterval) {
+      clearInterval(this.scrollInterval);
+      this.scrollInterval = null;
+    }
+  },
+  
+  startScrolling: function(speed) {
+    this.scrollSpeed = [speed[0]*this.options.scrollSpeed,speed[1]*this.options.scrollSpeed];
+    this.lastScrolled = new Date();
+    this.scrollInterval = setInterval(this.scroll.bind(this), 10);
+  },
+  
+  scroll: function() {
+    var current = new Date();
+    var delta = current - this.lastScrolled;
+    this.lastScrolled = current;
+    this.options.scroll.scrollLeft += this.scrollSpeed[0] * delta / 1000;
+    this.options.scroll.scrollTop  += this.scrollSpeed[1] * delta / 1000;
+    
+    Position.prepare();
+    Droppables.show(Draggables._lastPointer, this.element);
+    Draggables.notify('onDrag', this);
+    this.draw(Draggables._lastPointer);    
+    
+    if(this.options.change) this.options.change(this);
   }
 }
 
@@ -414,7 +478,8 @@
       only:        false,
       hoverclass:  null,
       ghosting:    false,
-      format:      null,
+      scroll:      false,
+      format:      /^[^_]*_(.*)$/,
       onChange:    Prototype.emptyFunction,
       onUpdate:    Prototype.emptyFunction
     }, arguments[1] || {});
@@ -425,6 +490,7 @@
     // build options for the draggables
     var options_for_draggable = {
       revert:      true,
+      scroll:      options.scroll,
       ghosting:    options.ghosting,
       constraint:  options.constraint,
       handle:      options.handle };
@@ -568,18 +634,41 @@
     Element.show(Sortable._marker);
   },
 
+  sequence: function(element) {
+    element = $(element);
+    var options = Object.extend(this.options(element), arguments[1] || {});
+    
+    return $(this.findElements(element, options) || []).map( function(item) {
+      return item.id.match(options.format) ? item.id.match(options.format)[1] : '';
+    });
+  },
+
+  setSequence: function(element, new_sequence) {
+    element = $(element);
+    var options = Object.extend(this.options(element), arguments[2] || {});
+    
+    var nodeMap = {};
+    this.findElements(element, options).each( function(n) {
+        if (n.id.match(options.format))
+            nodeMap[n.id.match(options.format)[1]] = [n, n.parentNode];
+        n.parentNode.removeChild(n);
+    });
+   
+    new_sequence.each(function(ident) {
+        var n = nodeMap[ident];
+        if (n) {
+            n[1].appendChild(n[0]);
+            delete nodeMap[ident];
+        }
+    });
+  },
+
   serialize: function(element) {
     element = $(element);
-    var sortableOptions = this.options(element);
-    var options = Object.extend({
-      tag:  sortableOptions.tag,
-      only: sortableOptions.only,
-      name: element.id,
-      format: sortableOptions.format || /^[^_]*_(.*)$/
-    }, arguments[1] || {});
-    return $(this.findElements(element, options) || []).map( function(item) {
-      return (encodeURIComponent(options.name) + &quot;[]=&quot; + 
-              encodeURIComponent(item.id.match(options.format) ? item.id.match(options.format)[1] : ''));
-    }).join(&quot;&amp;&quot;);
+    var name = encodeURIComponent(
+      (arguments[1] &amp;&amp; arguments[1].name) ? arguments[1].name : element.id);
+    return Sortable.sequence(element, arguments[1]).map( function(item) {
+      return name + &quot;[]=&quot; + encodeURIComponent(item);
+    }).join('&amp;');
   }
-}
\ No newline at end of file
+}

Modified: trunk/skel/public/javascript/effects.js
===================================================================
--- trunk/skel/public/javascript/effects.js	2006-02-19 18:07:57 UTC (rev 353)
+++ trunk/skel/public/javascript/effects.js	2006-02-22 19:26:26 UTC (rev 354)
@@ -35,7 +35,7 @@
   return $A($(element).childNodes).collect( function(node) {
     return (node.nodeType==3 ? node.nodeValue : 
       ((node.hasChildNodes() &amp;&amp; !Element.hasClassName(node,className)) ? 
-        Element.collectTextNodes(node) : ''));
+        Element.collectTextNodesIgnoreClass(node, className) : ''));
   }).flatten().join('');
 }
 
@@ -137,7 +137,7 @@
     element = $(element);
     effect = (effect || 'appear').toLowerCase();
     var options = Object.extend({
-      queue: { position:'end', scope:(element.id || 'global') }
+      queue: { position:'end', scope:(element.id || 'global'), limit: 1 }
     }, arguments[2] || {});
     Effect[Element.visible(element) ? 
       Effect.PAIRS[effect][1] : Effect.PAIRS[effect][0]](element, options);
@@ -209,7 +209,10 @@
     
     effect.startOn  += timestamp;
     effect.finishOn += timestamp;
-    this.effects.push(effect);
+
+    if(!effect.options.queue.limit || (this.effects.length &lt; effect.options.queue.limit))
+      this.effects.push(effect);
+    
     if(!this.interval) 
       this.interval = setInterval(this.loop.bind(this), 40);
   },
@@ -581,7 +584,6 @@
 
 Effect.BlindDown = function(element) {
   element = $(element);
-  var oldHeight = Element.getStyle(element, 'height');
   var elementDimensions = Element.getDimensions(element);
   return new Effect.Scale(element, 100, 
     Object.extend({ scaleContent: false, 
@@ -594,10 +596,9 @@
         setStyle(effect.element, {height: '0px'});
         show(effect.element); 
       }},  
-      afterFinishInternal: function(effect) { with(Element) {
-        undoClipping(effect.element);
-        setStyle(effect.element, {height: oldHeight});
-      }}
+      afterFinishInternal: function(effect) {
+        Element.undoClipping(effect.element);
+      }
     }, arguments[1] || {})
   );
 }
@@ -690,8 +691,14 @@
         (effect.dims[0] - effect.element.clientHeight) + 'px' }); }},
     afterFinishInternal: function(effect) { with(Element) {
       undoClipping(effect.element); 
-      undoPositioned(effect.element.firstChild);
-      undoPositioned(effect.element);
+      // IE will crash if child is undoPositioned first
+      if(/MSIE/.test(navigator.userAgent)){
+        undoPositioned(effect.element);
+        undoPositioned(effect.element.firstChild);
+      }else{
+        undoPositioned(effect.element.firstChild);
+        undoPositioned(effect.element);
+      }
       setStyle(effect.element.firstChild, {bottom: oldInnerBottom}); }}
     }, arguments[1] || {})
   );
@@ -741,7 +748,7 @@
   element = $(element);
   var options = Object.extend({
     direction: 'center',
-    moveTransistion: Effect.Transitions.sinoidal,
+    moveTransition: Effect.Transitions.sinoidal,
     scaleTransition: Effect.Transitions.sinoidal,
     opacityTransition: Effect.Transitions.full
   }, arguments[1] || {});
@@ -817,7 +824,7 @@
   element = $(element);
   var options = Object.extend({
     direction: 'center',
-    moveTransistion: Effect.Transitions.sinoidal,
+    moveTransition: Effect.Transitions.sinoidal,
     scaleTransition: Effect.Transitions.sinoidal,
     opacityTransition: Effect.Transitions.none
   }, arguments[1] || {});

Modified: trunk/skel/public/javascript/scriptaculous.js
===================================================================
--- trunk/skel/public/javascript/scriptaculous.js	2006-02-19 18:07:57 UTC (rev 353)
+++ trunk/skel/public/javascript/scriptaculous.js	2006-02-22 19:26:26 UTC (rev 354)
@@ -20,7 +20,7 @@
 // WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 
 var Scriptaculous = {
-  Version: '1.5.1',
+  Version: '1.5.3',
   require: function(libraryName) {
     // inserting via DOM fails in Safari 2.0, so brute force approach
     document.write('&lt;script type=&quot;text/javascript&quot; src=&quot;'+libraryName+'&quot;&gt;&lt;/script&gt;');

Modified: trunk/skel/public/javascript/slider.js
===================================================================
--- trunk/skel/public/javascript/slider.js	2006-02-19 18:07:57 UTC (rev 353)
+++ trunk/skel/public/javascript/slider.js	2006-02-22 19:26:26 UTC (rev 354)
@@ -200,10 +200,10 @@
   setSpan: function(span, range) {
     if(this.isVertical()) {
       span.style.top = this.translateToPx(range.start);
-      span.style.height = this.translateToPx(range.end - range.start);
+      span.style.height = this.translateToPx(range.end - range.start + this.range.start);
     } else {
       span.style.left = this.translateToPx(range.start);
-      span.style.width = this.translateToPx(range.end - range.start);
+      span.style.width = this.translateToPx(range.end - range.start + this.range.start);
     }
   },
   updateStyles: function() {

Modified: trunk/test/runner.php
===================================================================
--- trunk/test/runner.php	2006-02-19 18:07:57 UTC (rev 353)
+++ trunk/test/runner.php	2006-02-22 19:26:26 UTC (rev 354)
@@ -3,9 +3,11 @@
 // $Id$
 
 // Script that runs all the *Test.php* files from the test folder.
+// Read README.tests for details on running tests.
 
 $time_start = microtime(true);
 
+// {{{ settings
 define('TOP_LOCATION', dirname(__FILE__) . DIRECTORY_SEPARATOR . '..' . DIRECTORY_SEPARATOR);
 define('TMP', 'tmp' . DIRECTORY_SEPARATOR);
 
@@ -16,31 +18,34 @@
 error_reporting(E_ALL);
 set_time_limit(0);
 ini_set('display_errors', 1);
+// }}}
 
+// {{{ paths
 include_once('medick/Object.php');
 include_once('medick/Exception.php');
 include_once('medick/Registry.php');
 include_once('medick/util.php');
 include_once('medick/io/Folder.php');
 include_once('medick/ConsoleOptions.php');
-
 // include_once('simpletest/web_tester.php');
-
 include_once('simpletest/unit_tester.php');
 include_once('simpletest/reporter.php');
+include_once('configurator/LoggerConfigurator.php');
+include_once('logger/Logger.php');
+// }}}
 
+// {{{ configure console
 $options= new ConsoleOptions();
 $options-&gt;setNoValueFor('debug', '-d', '--debug');
 $options-&gt;load(isset($argv)?$argv:$_SERVER['argv']);
 $options-&gt;alias('debug', '-d, --debug');
+// }}}
 
-include_once('configurator/LoggerConfigurator.php');
-include_once('logger/Logger.php');
-
+// {{{ logger.
 $logger= new Logger(new LoggerConfigurator());
+// }}}
 
 $test= new GroupTest(&quot;=== Medick Framework Unit Tests ===&quot;);
-
 $test_files = Folder::recursiveFindRelative('.', 'test', 'Test.php');
 foreach($test_files as $file) {
     if ($options-&gt;has('debug')) {
@@ -56,5 +61,6 @@
     $logger-&gt;debug('Done in ' . round($time_end - $time_start,4) . ' seconds');
 }
 
+// {{{ clean-up
 @unlink(TMP . 'test.db');
-
+// }}}


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000144.html">[Medick-svn] r353 - in trunk: . libs/configurator libs/logger libs/logger/formatter libs/medick test test/test/action/controller test/test/active/record test/test/active/record/associations test/test/medick
</A></li>
	<LI>Next message: <A HREF="000146.html">[Medick-svn] r355 - applications/eltodo/app/views/layouts applications/eltodo/public applications/eltodo/public/stylesheet trunk trunk/libs/action/controller trunk/libs/action/controller/http trunk/libs/medick trunk/skel/public
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#145">[ date ]</a>
              <a href="thread.html#145">[ thread ]</a>
              <a href="subject.html#145">[ subject ]</a>
              <a href="author.html#145">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/medick-svn">More information about the Medick-svn
mailing list</a><br>
</body></html>
