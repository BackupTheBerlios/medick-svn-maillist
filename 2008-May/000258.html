<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Medick-svn] r477 - in exp/medick2/vendor/medick: . lib lib/action	lib/action/controller lib/action/controller/cli	lib/action/controller/http lib/action/view lib/context	lib/eltest lib/medick lib/plugin test test/context
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/medick-svn/2008-May/index.html" >
   <LINK REL="made" HREF="mailto:medick-svn%40lists.berlios.de?Subject=Re%3A%20%5BMedick-svn%5D%20r477%20-%20in%20exp/medick2/vendor/medick%3A%20.%20lib%20lib/action%0A%09lib/action/controller%20lib/action/controller/cli%0A%09lib/action/controller/http%20lib/action/view%20lib/context%0A%09lib/eltest%20lib/medick%20lib/plugin%20test%20test/context&In-Reply-To=%3C200805190810.m4J8AWJf028081%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000256.html">
   <LINK REL="Next"  HREF="000257.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Medick-svn] r477 - in exp/medick2/vendor/medick: . lib lib/action	lib/action/controller lib/action/controller/cli	lib/action/controller/http lib/action/view lib/context	lib/eltest lib/medick lib/plugin test test/context</H1>
    <B>aurelian at BerliOS</B> 
    <A HREF="mailto:medick-svn%40lists.berlios.de?Subject=Re%3A%20%5BMedick-svn%5D%20r477%20-%20in%20exp/medick2/vendor/medick%3A%20.%20lib%20lib/action%0A%09lib/action/controller%20lib/action/controller/cli%0A%09lib/action/controller/http%20lib/action/view%20lib/context%0A%09lib/eltest%20lib/medick%20lib/plugin%20test%20test/context&In-Reply-To=%3C200805190810.m4J8AWJf028081%40sheep.berlios.de%3E"
       TITLE="[Medick-svn] r477 - in exp/medick2/vendor/medick: . lib lib/action	lib/action/controller lib/action/controller/cli	lib/action/controller/http lib/action/view lib/context	lib/eltest lib/medick lib/plugin test test/context">aurelian at mail.berlios.de
       </A><BR>
    <I>Mon May 19 10:10:32 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000256.html">[Medick-svn] r476 - in exp/medick2/app: . controllers views	views/foo views/layouts
</A></li>
        <LI>Next message: <A HREF="000257.html">[Medick-svn] r478 - exp/medick2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#258">[ date ]</a>
              <a href="thread.html#258">[ thread ]</a>
              <a href="subject.html#258">[ subject ]</a>
              <a href="author.html#258">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: aurelian
Date: 2008-05-19 10:10:31 +0200 (Mon, 19 May 2008)
New Revision: 477

Added:
   exp/medick2/vendor/medick/lib/action/controller/ExecutionChain.php
   exp/medick2/vendor/medick/lib/action/view/
   exp/medick2/vendor/medick/lib/action/view/AbstractTemplateEngine.php
   exp/medick2/vendor/medick/lib/action/view/Base.php
   exp/medick2/vendor/medick/lib/action/view/ITemplateEngine.php
   exp/medick2/vendor/medick/lib/action/view/PHPTemplateEngine.php
   exp/medick2/vendor/medick/lib/action/view/init.php
   exp/medick2/vendor/medick/lib/eltest/
   exp/medick2/vendor/medick/lib/eltest/TestRunner.php
   exp/medick2/vendor/medick/lib/eltest/UnitTest.php
   exp/medick2/vendor/medick/lib/eltest/init.php
   exp/medick2/vendor/medick/test/
   exp/medick2/vendor/medick/test/context/
   exp/medick2/vendor/medick/test/context/ContextManagerTest.php
   exp/medick2/vendor/medick/test/context/XMLConfiguratorTest.php
   exp/medick2/vendor/medick/test/mock_object.php
   exp/medick2/vendor/medick/test/runner.php
   exp/medick2/vendor/medick/test/unit_test.php
Modified:
   exp/medick2/vendor/medick/lib/action/controller/Base.php
   exp/medick2/vendor/medick/lib/action/controller/Dispatcher.php
   exp/medick2/vendor/medick/lib/action/controller/Response.php
   exp/medick2/vendor/medick/lib/action/controller/Router.php
   exp/medick2/vendor/medick/lib/action/controller/cli/CLIRequest.php
   exp/medick2/vendor/medick/lib/action/controller/http/HTTPCookie.php
   exp/medick2/vendor/medick/lib/action/controller/http/HTTPRequest.php
   exp/medick2/vendor/medick/lib/action/controller/http/HTTPResponse.php
   exp/medick2/vendor/medick/lib/action/controller/http/HTTPSession.php
   exp/medick2/vendor/medick/lib/context/ContextManager.php
   exp/medick2/vendor/medick/lib/context/XMLConfigurator.php
   exp/medick2/vendor/medick/lib/medick/Medick.php
   exp/medick2/vendor/medick/lib/plugin/Plugins.php
Log:
 -- more on medick2 exp.

Modified: exp/medick2/vendor/medick/lib/action/controller/Base.php
===================================================================
--- exp/medick2/vendor/medick/lib/action/controller/Base.php	2008-05-19 08:10:10 UTC (rev 476)
+++ exp/medick2/vendor/medick/lib/action/controller/Base.php	2008-05-19 08:10:31 UTC (rev 477)
@@ -1,108 +1,184 @@
 &lt;?php
 
-class ActionChain implements ArrayAccess, Iterator, Countable {
+// $Id: $
 
-  private $chain;
+class ChainError extends Exception {  }
 
-  private $index;
+class ActionController extends Object {
 
-  public function __construct(/*ActionController $action_controller*/) {
-    $this-&gt;chain= array();
-    $this-&gt;index= 0;
-  }
+  public $action;
 
-  public function push( $value ) {
-    $this[sizeof($this)]= $value;
-  }
+  public $controller;
 
-  public function prepend( $value ) {
-    array_unshift($this-&gt;chain, $value);
-  }
+  protected $logger;
 
-  public function offsetExists($offset) {
-    return isset( $this-&gt;chain[$offset] );
-  }
+  protected $config;
 
-  public function offsetGet($offset) {
-    return $this-&gt;chain[$offset];
-  }
+  protected $request;
 
-  public function offsetSet($offset, $value) {
-    // if(false === is_int($offset)) throw new Exception('use only numrical values!');
-    $this-&gt;chain[$offset]= $value;
-  }
+  protected $response;
 
-  public function offsetUnset($offset) {
-    unset($this-&gt;chain[$offset]);
-  }
+  protected $session = null;
 
-  public function current() {
-    // return $this-&gt;chain[$this-&gt;index];
-    return $this[$this-&gt;index];
-  }
+  protected $before_filters= '';
 
-  public function next() {
-    $this-&gt;index++;
-    // return $this-&gt;chain[$this-&gt;index];
-    // return $this-&gt;current();
-  }
+  protected $after_filters = '';
 
-  public function key() {
-    return $this-&gt;index;
-  }
+  protected $use_session = true;
 
-  public function valid() {
-    return $this[$this-&gt;index];
-  }
+  protected $use_layout  = true;
 
-  public function rewind() {
-    $this-&gt;index--;
+  // protected $use_etag    = false;
+
+  protected $template = null;
+
+  private $execution_chain = null;
+
+  private $context;
+
+  // XXX: throw an error if multiple render/redirects where called / execution_chain
+  private $action_performed = false;
+
+  // ---
+  // final
+  // ---
+
+  final public function __construct( ContextManager $context ) {
+    $this-&gt;context= $context;
+    $this-&gt;logger= $context-&gt;logger();
+    $this-&gt;config= $context-&gt;config();
   }
 
-  public function count() {
-    return sizeof($this-&gt;chain);
+  // should return ActionView
+  final public function process(Request $request, Response $response) {
+    // create instance variables needed
+    $this-&gt;__initialize($request, $response);
+
+    // validate the action
+    $this-&gt;__validate_action();
+
+    // collect before filters now
+
+    // execute those filters
+
+    // execute the action
+    $this-&gt;__execute_action();
+
+    // render if we didn't do it yet
+    if(false === $this-&gt;action_performed)
+      $this-&gt;render();
+
+    // collect after filters
+
+    // execute after filters
+
+    // Medick::dump( $request );
+    return $response;
   }
 
-}
+  // ---
+  // magick
+  // ---
 
-class ActionController extends Object {
+  // public function __set($name, $value) {
+  //   $this-&gt;template-&gt;assign($name, $value);
+  // }
 
-  // protected $logger;
-  // protected $config;
+  // ---
+  // protected --&gt; renders
+  // ---
 
-  protected $request;
+  protected function render($template_location= null, $status= null) {
+    if(null === $template_location) {
+      $template_location= $this-&gt;request-&gt;parameter('controller') . DIRECTORY_SEPARATOR . $this-&gt;request-&gt;parameter('action') . '.phtml';
+    }
+    return $this-&gt;render_file( $template_location, $status );
+  }
 
-  protected $response;
+  protected function render_file( $template_file, $status= null ) {
+    
+    // XXX: register flash
 
-  protected $context;
+    if($this-&gt;use_layout) {
+      // XXX: check view paths
+      $layout= APP_PATH . 'app/views/layouts/' . $this-&gt;request-&gt;parameter('controller') . '.phtml';
+      if(false === file_exists($layout)) {
+        $this-&gt;logger-&gt;debug('will render without layout since cannot load `'.$layout.'`, no such file!');
+        return $this-&gt;render_without_layout($template_file, $status);
+      } else {
+        // parse the template file first and create content_for_layout variable
+        $this-&gt;template-&gt;assign('content_for_layout', $this-&gt;template-&gt;render( APP_PATH . 'app/views/' . $template_file));
+        // continue to render the layout
+        return $this-&gt;render_text($this-&gt;template-&gt;render($layout), $status);
+      }
+    } else {
+      $this-&gt;logger-&gt;debug('rendering without layout.');
+      return $this-&gt;render_without_layout($template_file, $status);
+    }
+  }
 
-  private $chain;
+  protected function render_without_layout($file, $status) {
+    return $this-&gt;render_text( $this-&gt;template-&gt;render( APP_PATH . 'app/views/' . $file), $status);
+  }
 
-  final public function __construct(ContextManager $context) {
-    $this-&gt;context= $context;
-    // $this-&gt;logger= $context-&gt;logger();
-    // $this-&gt;config= $context-&gt;config();
-    $this-&gt;chain= new ActionChain();
+  protected function render_text( $text, $status= null) {
+    if( $this-&gt;action_performed ) 
+      throw new Exception('Cannot render, action already performed.');
+    
+    // XXX: etag
+
+    $this-&gt;response-&gt;content= $text;
+    $this-&gt;response-&gt;setStatus($status);
+    $this-&gt;action_performed= true;
+
+    // XXX: remove flash
   }
 
-  // should return ActionView
-  final public function process(Request $request, Response $response) {
-    $this-&gt;request= $request;
+  // ---
+  // private
+  // ---
+
+  /* make assignments */
+  private function __initialize(Request $request, Response $response) {
+    // instance variables
+    $this-&gt;request = $request;
     $this-&gt;response= $response;
 
-    $this-&gt;chain-&gt;push( 'foo' );
-    $this-&gt;chain-&gt;push( 'bar' );
+    $this-&gt;execution_chain= new ExecutionChain( $this, $this-&gt;context );
 
-    $this-&gt;chain-&gt;prepend( 'baz' );
+    // do we need to register and start a session?
+    $this-&gt;__register_session();
 
-    Medick::dump( $this-&gt;chain );
+    // create the template now.
+    $this-&gt;template= ActionView::load( $this-&gt;context, $this );
 
-    // xxx: before.
+    // assign basic template variables.
+    $this-&gt;template-&gt;assign('__controller', $this-&gt;request-&gt;parameter('controller'));
+    $this-&gt;template-&gt;assign('__action', $this-&gt;request-&gt;parameter('action'));
+    return true;
+  }
 
-    // xxx: after.
+  private function __register_session() {
+    if($this-&gt;use_session === false || $this-&gt;config-&gt;property('web.session') === false) 
+      return;
+    // XXX: session container code should be written here
+    if($session_container_class= $this-&gt;config-&gt;property('web.session.container')) {  }
+    // then start the session
+    $this-&gt;session= $this-&gt;request-&gt;session()-&gt;start();
+  }
 
-    Medick::dump($request);
+  private function __validate_action() {
+    try {
+      $this-&gt;execution_chain-&gt;validate_action( $this-&gt;request );
+      return true;
+    } catch(ChainError $err) {
+      throw $err;
+    }
   }
 
+  private function __execute_action() {
+    $this-&gt;execution_chain-&gt;exec_action();
+  }
+
 }
 

Modified: exp/medick2/vendor/medick/lib/action/controller/Dispatcher.php
===================================================================
--- exp/medick2/vendor/medick/lib/action/controller/Dispatcher.php	2008-05-19 08:10:10 UTC (rev 476)
+++ exp/medick2/vendor/medick/lib/action/controller/Dispatcher.php	2008-05-19 08:10:31 UTC (rev 477)
@@ -1,15 +1,11 @@
 &lt;?php
 
-//
 // $Id: $
-//
 
 class Dispatcher extends Object {
 
   private $context;
 
-  private $logger;
-
   private $plugins;
 
   public function __construct(ContextManager $context) {
@@ -29,10 +25,15 @@
       sprintf('medick v.$%s ready to dispatch (took %.3f sec. to boot)', Medick::version(), $this-&gt;context-&gt;timer()-&gt;tick()));
 
     try {
-      Router::recognize( $request, $this-&gt;context )-&gt;process( $request, $response );
-      // -&gt;dump();
+      Router::recognize( $request, $this-&gt;context )-&gt;process( $request, $response )-&gt;dump();
+      $this-&gt;context-&gt;logger()-&gt;debug(sprintf( &quot;\t[%s] done in %.3f sec.&quot;, time(), $this-&gt;context-&gt;timer()-&gt;tick(true)));
     } catch(Exception $ex) {
-      echo sprintf('Exception: %s with message: %s', get_class($ex), $ex-&gt;getMessage());
+      $message= sprintf( '[%s] --&gt; %s in %s line %s', get_class($ex), $ex-&gt;getMessage(), $ex-&gt;getFile(), $ex-&gt;getLine() );
+      $this-&gt;context-&gt;logger()-&gt;warn( sprintf('Request processing failed after %.3f seconds', $this-&gt;context-&gt;timer()-&gt;tick()) );
+      $this-&gt;context-&gt;logger()-&gt;warn( $message );
+      // try to process with exception
+      echo php_sapi_name()=='cli'? $message : '&lt;pre&gt;'.$message.'&lt;/pre&gt;';
+      echo php_sapi_name()=='cli'? $ex-&gt;getTraceAsString(): '&lt;pre style=&quot;font-size:85%&quot;&gt;' . $ex-&gt;getTraceAsString() . '&lt;/pre&gt;';
     }
   }
 

Added: exp/medick2/vendor/medick/lib/action/controller/ExecutionChain.php
===================================================================
--- exp/medick2/vendor/medick/lib/action/controller/ExecutionChain.php	2008-05-19 08:10:10 UTC (rev 476)
+++ exp/medick2/vendor/medick/lib/action/controller/ExecutionChain.php	2008-05-19 08:10:31 UTC (rev 477)
@@ -0,0 +1,114 @@
+&lt;?php
+
+// $Id$
+
+class ExecutionChain extends Object {
+
+  private $chain;
+
+  private $controller = null;
+
+  private $context;
+
+  public function __construct( ActionController $controller, ContextManager $context ) {
+    // create the basic structure
+    $this-&gt;chain = array(
+      'before' =&gt; array(),
+      'action' =&gt; array(), /* [0]-&gt; ReflectionMethod, [1]-&gt; array(Method Arguments) */
+      'after'  =&gt; array()
+    );
+
+    $this-&gt;controller= $controller;
+    $this-&gt;context= $context;
+  }
+
+  // adds something to this chain, to be used in plugins?
+  // XXX: maybe add at position should also help?
+  public function add($type, $value) {
+    if( false === ($type == 'before' || $type == 'after'))
+      throw new ChainError('Cannot add ' . $type . ' to ExecutionChain, only `before` or `after` are allowed');
+    $this-&gt;chain[$type][]= $value;
+  }
+
+  /*
+   * 1. figure-out the action
+   * 2. collect parameters and assign
+   * 3. invoke the action
+   */ 
+  public function validate_action(Request $request) {
+    try {
+      $rmethod= new ReflectionMethod( $this-&gt;controller, $request-&gt;parameter('action') );
+    } catch(ReflectionException $rfEx) {
+      throw new ChainError($rfEx-&gt;getMessage());
+    }
+
+    if( !$rmethod-&gt;isPublic() || $rmethod-&gt;isStatic() ) {
+      throw new ChainError( 
+        'Method `'.$rmethod-&gt;getName().'` should be declared as public on class instance `'.get_class($this-&gt;controller).'`' );
+    }
+
+    $rparams= $rmethod-&gt;getParameters();
+    $action_args= array();
+
+    foreach($rparams as $arg) {
+      $arg_name = $arg-&gt;getName();
+      $arg_value= $request-&gt;parameter( $arg_name );
+
+      // XXX: detect behavior on Merb / Django
+      if(null === $arg_value) {
+        if($arg-&gt;isOptional())
+          continue;
+        else
+          throw new ChainError('Mandatory agrument `' . $arg_name . '` for action `'.$rmethod-&gt;getName().'` not in request!');
+      }
+      $action_args[$arg_name]= $arg_value;
+    }
+
+    // ready to fire this action later
+    $this-&gt;chain['action']= array($rmethod, $action_args);
+    // return true for now
+    return true;
+
+  }
+
+  private function debug_action_parameters($args) {
+    $buff = array();
+    foreach($args as $name=&gt;$value) {
+      $buff[]= sprintf( '%s: &quot;%s&quot;', $name, $value );
+    }
+    return '{'.join(',', $buff) . '}';
+  }
+
+  public function exec_before() {
+    foreach($this-&gt;chain['before'] as $filter) {
+      // 1. try to execute filter as a method
+
+      // 2. try to create a class instance and call execute on it
+
+      // 3. if the filter render an action or redirected, halt the execution chain
+      // if($this-&gt;controller-&gt;action_performed === true) {
+      //   $this-&gt;context-&gt;logger()-&gt;info( 'Execution chain halted by `' . $filter . '`' );
+      // }
+    }
+  }
+
+  public function exec_action() {
+    
+    $this-&gt;context-&gt;logger()-&gt;debug(sprintf('ready to invoke action `%s` with arguments `%s` (+ %.3f sec.)',
+      $this-&gt;chain['action'][0]-&gt;getName(), $this-&gt;debug_action_parameters($this-&gt;chain['action'][1]), $this-&gt;context-&gt;timer()-&gt;tick()
+    ));
+
+    return $this-&gt;chain['action'][0]-&gt;invokeArgs( $this-&gt;controller, $this-&gt;chain['action'][1] );
+  }
+
+  public function exec_after() {
+    foreach($this-&gt;chain['after'] as $filter) {
+      // 1. try to execute filter as a method
+
+      // 2. try to create a class instance and call execute on it
+
+      // 3. the return value is not important, go to the next one
+    }
+  }
+
+}


Property changes on: exp/medick2/vendor/medick/lib/action/controller/ExecutionChain.php
___________________________________________________________________
Name: svn:keywords
   + Id

Modified: exp/medick2/vendor/medick/lib/action/controller/Response.php
===================================================================
--- exp/medick2/vendor/medick/lib/action/controller/Response.php	2008-05-19 08:10:10 UTC (rev 476)
+++ exp/medick2/vendor/medick/lib/action/controller/Response.php	2008-05-19 08:10:31 UTC (rev 477)
@@ -1,37 +1,7 @@
 &lt;?php
-// {{{ License
-// ///////////////////////////////////////////////////////////////////////////////
-//
-// Copyright (c) 2005 - 2007 Aurelian Oancea &lt; aurelian [ at ] locknet [ dot ] ro &gt;
-//
-// Redistribution and use in source and binary forms, with or without
-// modification, are permitted provided that the following conditions are met:
-//
-//   * Redistributions of source code must retain the above copyright notice,
-//   this list of conditions and the following disclaimer.
-//   * Redistributions in binary form must reproduce the above copyright notice,
-//   this list of conditions and the following disclaimer in the documentation
-//   and/or other materials provided with the distribution.
-//   * Neither the name of Aurelian Oancea nor the names of his contributors may
-//   be used to endorse or promote products derived from this software without
-//   specific prior written permission.
-//
-// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;
-// AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
-// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
-// DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE
-// FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
-// DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
-// SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
-// CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
-// OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
-// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-//
-// $Id: Response.php 447 2007-07-23 17:44:43Z aurelian $
-//
-// ///////////////////////////////////////////////////////////////////////////////
-// }}}
 
+// $Id: $
+
 /**
  * It is a Response that a medick application will always try to build.
  * 
@@ -41,53 +11,17 @@
  * @author Aurelian Oancea
  */
 class Response extends Object {
-    
-    /** @var string
-        response content */
-    protected $content;
+  
+  /** @var string
+    response content */
+  public $content;
 
-    /**
-     * Hidden Constructor
-     *
-     * This class is not meant to be instanciated,
-     * insteard use inheritance to extend and build more specialized Responses
-     *
-     * @see HTTPResponse
-     */
-    protected function Response(){  }
+  /** 
+   * Echos the content (buffer)
+   */
+  public function dump() {
+    echo $this-&gt;content;
+  }
 
-    /**
-     * Set the content
-     * Will discard all the changes made on the buffer so far
-     * 
-     * @param mixed content, the content
-     */
-    public function setContent($content) {
-        $this-&gt;content = $content;
-    }
-
-    /** 
-     * Add content on the buffer
-     *
-     * @param mixed content
-     */
-    public function append($content) {
-        $this-&gt;content .= $content;
-    }
-
-    /** 
-     * It gets the content
-     * @return string the content that we push so far on to this Response
-     */
-    public function getContent() {
-        return $this-&gt;content;
-    }
-
-    /** 
-     * Echos the content (buffer)
-     */
-    public function dump() {
-        echo $this-&gt;content;
-    }
-
 }
+

Modified: exp/medick2/vendor/medick/lib/action/controller/Router.php
===================================================================
--- exp/medick2/vendor/medick/lib/action/controller/Router.php	2008-05-19 08:10:10 UTC (rev 476)
+++ exp/medick2/vendor/medick/lib/action/controller/Router.php	2008-05-19 08:10:31 UTC (rev 477)
@@ -1,6 +1,6 @@
 &lt;?php
 
-// $Id: $
+// $Id$
 
 class Router extends Object {
 
@@ -20,30 +20,28 @@
 
     // xxx: should call plugins special __before_controller methods?
 
-    // XXX: should load additional paths from plugins?
-
     // 1. class name -&gt; request-&gt;parameter('controller') . 'Controller'
     // 2. file name  -&gt; request-&gt;parameter('controller') . '_controller.php'
 
     $path= APP_PATH; // -&gt; this is going to be a list of paths
 
-    $controller_file = $path . '/app/controllers/' . $request-&gt;parameter('controller') . '_controller.php';
+    $controller_file = $path . 'app/controllers/' . $request-&gt;parameter('controller') . '_controller.php';
     $controller_class= ucfirst($request-&gt;parameter('controller')) . 'Controller';
 
     if( false === file_exists($controller_file) ) {
-      throw new Exception('Cannot load `'.$controller_file.'`, no such file or directory!'); // -&gt; this is going to be replaced with continue in loop
+      throw new Exception('Cannot load `' . $controller_file . '`, no such file or directory!'); // -&gt; this is going to be replaced with continue in loop
     }
 
     require( $controller_file );
 
     if( false === class_exists($controller_class) ) {
-      throw new Exception('Cannot use `'.$controller_class.'`, no such class!'); // -&gt; this is going to be replaced with continue in loop
+      throw new Exception('Expected `' . $controller_file . '` to define `'.$controller_class.'`'); // -&gt; this is going to be replaced with continue in loop
     }
 
     $rclass= new ReflectionClass($controller_class);
 
     if( false === ($rclass-&gt;getParentClass() || $rclass-&gt;getParentClass() == 'ApplicationController' || $rclass-&gt;getParentClass() == 'ActionController')) {
-      throw new Exception('Wrong defintion of class: ' . $controller_class);
+      throw new Exception('Expected `' . $controller_class . '` to extend ApplicationController(recommended) or ActionControler');
     }
 
     $this-&gt;context-&gt;logger()-&gt;debug(str_replace(APP_PATH, '${'.$this-&gt;context-&gt;config()-&gt;application_name().'}', $controller_file) . ' --&gt; ' . $controller_class);
@@ -56,16 +54,12 @@
    * Should return a controller instance
    */ 
   public static function recognize(Request $request, ContextManager $context ) {
-    // create a Map of loaded Routes
-    // $map= new Map( $context );
-    // save it to the current context
-    // $context-&gt;map( $map );
+    // XXX: request URI hack, for medick installation in subfolders (e.g. `medick2` as base)
+    // XXX: test with other servers and other types of PHP installations
+    // $request-&gt;uri= substr($request-&gt;uri, strlen($context-&gt;config()-&gt;property('base', true)));
 
     $router= new Router( $context-&gt;map()-&gt;find_route( $request ), $context);
     return $router-&gt;create_controller( $request );
-    
-    // $route= $map-&gt;find_route( $request );
-    // return $route-&gt;create_controller();
   }
 
 }


Property changes on: exp/medick2/vendor/medick/lib/action/controller/Router.php
___________________________________________________________________
Name: svn:keywords
   + Id

Modified: exp/medick2/vendor/medick/lib/action/controller/cli/CLIRequest.php
===================================================================
--- exp/medick2/vendor/medick/lib/action/controller/cli/CLIRequest.php	2008-05-19 08:10:10 UTC (rev 476)
+++ exp/medick2/vendor/medick/lib/action/controller/cli/CLIRequest.php	2008-05-19 08:10:31 UTC (rev 477)
@@ -1,7 +1,15 @@
 &lt;?php
 
-// $Id: $
+// $Id$
 
+class CLISession extends Object {
+  
+  public function start() {
+
+  }
+
+}
+
 //
 // xxx. should be able to handle:
 //  
@@ -13,10 +21,18 @@
 
   public $uri= &quot;&quot;;
 
+  private $session= null;
+
   public function __construct() {
     $this-&gt;uri= '/' . join('/', array_slice($_SERVER['argv'], 1, $_SERVER['argc']));
+
+    $this-&gt;session= new CLISession();
   }
 
+  public function session() {
+    return $this-&gt;session;
+  }
+
   public function toString() {
     return sprintf('cli: %s', $this-&gt;uri);
   }


Property changes on: exp/medick2/vendor/medick/lib/action/controller/cli/CLIRequest.php
___________________________________________________________________
Name: svn:keywords
   + Id

Modified: exp/medick2/vendor/medick/lib/action/controller/http/HTTPCookie.php
===================================================================
--- exp/medick2/vendor/medick/lib/action/controller/http/HTTPCookie.php	2008-05-19 08:10:10 UTC (rev 476)
+++ exp/medick2/vendor/medick/lib/action/controller/http/HTTPCookie.php	2008-05-19 08:10:31 UTC (rev 477)
@@ -37,78 +37,44 @@
         Cookie secure */ 
     private $secure;
     
-    /**
-     * Creates A new Cookie
-     *
-     * @param string Cookie name
-     * @param string Cookie value
-     * @param int 
-     * @param string Cookie path
-     * @param string Cookie domain
-     * @param bool    
-     */ 
-    public function Cookie($name, $value = '', $expire = 0, $path = '/', $domain = '', $secure = FALSE) {
-        $this-&gt;name   = $name;
-        $this-&gt;value  = $value;
-        $this-&gt;expire = $expire;
-        $this-&gt;path   = $path;
-        $this-&gt;domain = $domain;
-        $this-&gt;secure = $secure;
-    }
+  /**
+   * Creates A new Cookie
+   *
+   * XXX: fix path and domain somehow for eg. Medick installation not in root folder or on subdomains
+   *
+   * @param string Cookie name
+   * @param string Cookie value
+   * @param int 
+   * @param string Cookie path
+   * @param string Cookie domain
+   * @param bool    
+   */ 
+  public function __construct($name, $value = '', $expire = 0, $path = '/', $domain = '', $secure = false) {
+    $this-&gt;name   = $name;
+    $this-&gt;value  = $value;
+    $this-&gt;expire = $expire;
+    $this-&gt;path   = $path;
+    $this-&gt;domain = $domain;
+    $this-&gt;secure = $secure;
+  }
 
-    public function getName() {
-        return $this-&gt;name;
-    }
+  public function name() {
+    return $this-&gt;name;
+  }
 
-    public function getValue() {
-        return $this-&gt;value;
-    }
+  public function value() {
+    return $this-&gt;value;
+  }
 
-    public function setValue($value) {
-        $this-&gt;value= $value;
-    }
-
-    public function getExpire() {
-        return $this-&gt;expire;
-    }
-
-    public function setExpire($expire) {
-        $this-&gt;expire = $expire;
-    }
-    
-    public function getPath() {
-        return $this-&gt;path;
-    }
-
-    public function setPath($path) {
-        $this-&gt;path= $path;
-    }
-    
-    public function getDomain() {
-        return $this-&gt;domain;
-    }
-
-    public function setDomain($domain) {
-        $this-&gt;domain = $domain;
-    }
-    
-    public function getSecure() {
-        return (bool)$this-&gt;secure;
-    }
-
-    public function setSecure($secure) {
-        $this-&gt;secure= (bool)$secure;
-    }
-    
-    public function toString() {
-      return (
-        $this-&gt;name . '=' . 
-        ($this-&gt;value === '' ? 'deleted' : $this-&gt;value).
-        ($this-&gt;expire !== 0 ? '; expires=' . gmdate('D, d-M-Y H:i:s \G\M\T', $this-&gt;expire) : '').
-        ($this-&gt;path !== '' ? '; path=' . $this-&gt;path : '').
-        ($this-&gt;domain !== '' ? '; domain=' . $this-&gt;domain : '').
-        ($this-&gt;secure ? '; secure' : '')
-      );
-    }
+  public function toString() {
+    return (
+      $this-&gt;name . '=' . 
+      ($this-&gt;value === '' ? 'deleted' : $this-&gt;value).
+      ($this-&gt;expire !== 0 ? '; expires=' . gmdate('D, d-M-Y H:i:s \G\M\T', $this-&gt;expire) : '').
+      ($this-&gt;path !== '' ? '; path=' . $this-&gt;path : '').
+      ($this-&gt;domain !== '' ? '; domain=' . $this-&gt;domain : '').
+      ($this-&gt;secure ? '; secure' : '')
+    );
+  }
 }
 

Modified: exp/medick2/vendor/medick/lib/action/controller/http/HTTPRequest.php
===================================================================
--- exp/medick2/vendor/medick/lib/action/controller/http/HTTPRequest.php	2008-05-19 08:10:10 UTC (rev 476)
+++ exp/medick2/vendor/medick/lib/action/controller/http/HTTPRequest.php	2008-05-19 08:10:31 UTC (rev 477)
@@ -50,10 +50,14 @@
     }
     // do the undoable
     unset($_REQUEST); unset($_GET); unset($_POST);
+
     // setup requestUri
     if (array_key_exists('PATH_INFO', $_SERVER) &amp;&amp; $_SERVER['PATH_INFO'] != '' ) {
       $this-&gt;uri= $_SERVER['PATH_INFO'];
+    } else {
+      $this-&gt;uri= '/';
     }
+    /*
     // this is for php as cgi where PATH_INFO is not available
     elseif (array_key_exists('ORIG_PATH_INFO', $_SERVER)) {
       // todo: it should be also tested for non root locations eg:
@@ -64,11 +68,12 @@
     } else {
       // fallback to REQUEST_URI
       $this-&gt;uri= $_SERVER['REQUEST_URI'];
-      // $this-&gt;uri= substr($_SERVER['REQUEST_URI'],7);
+      // $this-&gt;uri= substr($_SERVER['REQUEST_URI'], 8);
     }
+    */
     // setup session and headers
     $this-&gt;session = new HTTPSession();
-    $this-&gt;headers = HTTPRequest::getAllHeaders();
+    $this-&gt;headers = getallheaders();
   }
 
   public function toString() {
@@ -163,8 +168,8 @@
    *
    * @return array
    */
-  protected static function getAllHeaders() {
-    return getallheaders();
-  }
+  // protected static function getAllHeaders() {
+  //   return getallheaders();
+  // }
 }
 

Modified: exp/medick2/vendor/medick/lib/action/controller/http/HTTPResponse.php
===================================================================
--- exp/medick2/vendor/medick/lib/action/controller/http/HTTPResponse.php	2008-05-19 08:10:10 UTC (rev 476)
+++ exp/medick2/vendor/medick/lib/action/controller/http/HTTPResponse.php	2008-05-19 08:10:31 UTC (rev 477)
@@ -1,37 +1,7 @@
 &lt;?php
-// {{{ License
-// ///////////////////////////////////////////////////////////////////////////////
-//
-// Copyright (c) 2005 - 2007 Aurelian Oancea &lt; aurelian [ at ] locknet [ dot ] ro &gt;
-//
-// Redistribution and use in source and binary forms, with or without
-// modification, are permitted provided that the following conditions are met:
-//
-//   * Redistributions of source code must retain the above copyright notice,
-//   this list of conditions and the following disclaimer.
-//   * Redistributions in binary form must reproduce the above copyright notice,
-//   this list of conditions and the following disclaimer in the documentation
-//   and/or other materials provided with the distribution.
-//   * Neither the name of Aurelian Oancea nor the names of his contributors may
-//   be used to endorse or promote products derived from this software without
-//   specific prior written permission.
-//
-// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;
-// AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
-// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
-// DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE
-// FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
-// DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
-// SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
-// CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
-// OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
-// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-//
-// $Id: HTTPResponse.php 451 2007-08-01 14:57:17Z aurelian $
-//
-// ///////////////////////////////////////////////////////////////////////////////
-// }}}
 
+// $Id: $
+
 /**
  * HTTP Response Object 
  *
@@ -49,147 +19,155 @@
  */
 class HTTPResponse extends Response {
 
-    /** Status code (200) indicating the request succeeded normally. */
-    const SC_OK = 200;
+  /** Status code (200) indicating the request succeeded normally. */
+  const SC_OK = 200;
 
-    /** Status code (304) indicating that a conditional GET
-        operation found that the resource was available and not modified. */
-    const SC_NOT_MODIFIED = 304;
+  /** Status code (304) indicating that a conditional GET
+    operation found that the resource was available and not modified. */
+  const SC_NOT_MODIFIED = 304;
 
-    /** Status code (400) indicating the request sent by the
-        client was syntactically incorrect. */
-    const SC_BAD_REQUEST = 400;
+  /** Status code (400) indicating the request sent by the
+    client was syntactically incorrect. */
+  const SC_BAD_REQUEST = 400;
 
-    /** Status code (403) indicating the server
-        understood the request but refused to fulfill it. */
-    const SC_FORBIDDEN = 403;
+  /** Status code (403) indicating the server
+    understood the request but refused to fulfill it. */
+  const SC_FORBIDDEN = 403;
 
-    /** Status code (404) indicating that the requested
-        resource is not available. */
-    const SC_NOT_FOUND = 404;
+  /** Status code (404) indicating that the requested
+    resource is not available. */
+  const SC_NOT_FOUND = 404;
 
-    /** Status code (500) indicating an error inside
-        the HTTP server which prevented it from fulfilling the request. */
-    const SC_INTERNAL_SERVER_ERROR = 500;
+  /** Status code (500) indicating an error inside
+    the HTTP server which prevented it from fulfilling the request. */
+  const SC_INTERNAL_SERVER_ERROR = 500;
 
-    /** Status code (503) indicating that the HTTP server
-        is temporarily overloaded, and unable to handle the request. */
-    const SC_SERVICE_UNAVAILABLE = 503;
+  /** Status code (503) indicating that the HTTP server
+    is temporarily overloaded, and unable to handle the request. */
+  const SC_SERVICE_UNAVAILABLE = 503;
 
-    /** Constructor */
-    public function HTTPResponse() {  }
-    
-    /**
-     * Sets the header $name with $value
-     *
-     * Caution: this method makes use of PHP function header() directly, meaning that 
-     * there is no instance variable to keep a list of all the headers that are build 
-     * during a Response sequence.
-     *
-     * &lt;code&gt;
-     *  $response-&gt;setHeader(&quot;X-Foo&quot;, &quot;Bar&quot;);// &lt;==&gt; header(&quot;X-Foo: Bar&quot;);
-     * &lt;/code&gt;
-     *
-     * @param string the name of the header
-     * @param mixed  the value of this header
-     */
-    public function setHeader($name, $value) {
-        header($name . &quot;: &quot; . $value);
-    }
+  /** Constructor */
+  public function HTTPResponse() {  }
 
-    /**
-     * It gets the Response headers
-     *
-     * It gets only the headers that have been already sent, 
-     * eg. Content-Type header will not be on the list
-     *
-     * Caution: this method is not cachable, meaning that multiple calls on it
-     * will fetch the list of headers each time. There is no $headers instance 
-     * variable to keep a list that will be later sent with the Response.
-     *
-     * Caution: names and values are trimmed!
-     *
-     * &lt;code&gt;
-     * $response-&gt;setHeader(&quot;X-Foo&quot;, &quot;Bar&quot;);
-     * $response-&gt;setHeader(&quot;X-Framework&quot;, &quot;Medick &quot;); // notice the space at the end
-     * $response-&gt;getHeaders(); // array(&quot;X-Foo&quot;=&gt;&quot;Bar&quot;, &quot;X-Framework&quot;=&gt;&quot;Medick&quot;);
-     * &lt;/code&gt;
-     */ 
-    public function getHeaders() {
-      $headers= array();
-      foreach(headers_list() as $header) {
-        list($name, $value) = explode(':', $header);
-        $headers[trim($name)]= trim($value);
-      }
-      return $headers;
-    }
+  // public function dump() {
+    // send headers
+  // }
 
-    public function getHeader( $name ) {
-      $headers= $this-&gt;getHeaders();
-      return isset($headers[trim($name)]) ? trim($headers[trim($name)]) : false;
+  /**
+   * Sets the header $name with $value
+   *
+   * Caution: this method makes use of PHP function header() directly, meaning that 
+   * there is no instance variable to keep a list of all the headers that are build 
+   * during a Response sequence.
+   *
+   * &lt;code&gt;
+   *  $response-&gt;setHeader(&quot;X-Foo&quot;, &quot;Bar&quot;);// &lt;==&gt; header(&quot;X-Foo: Bar&quot;);
+   * &lt;/code&gt;
+   *
+   * @param string the name of the header
+   * @param mixed  the value of this header
+   */
+  public function setHeader($name, $value) {
+    header($name . &quot;: &quot; . $value);
+  }
+
+  /**
+   * It gets the Response headers
+   *
+   * It gets only the headers that have been already sent, 
+   * eg. Content-Type header will not be on the list
+   *
+   * Caution: this method is not cachable, meaning that multiple calls on it
+   * will fetch the list of headers each time. There is no $headers instance 
+   * variable to keep a list that will be later sent with the Response.
+   *
+   * Caution: names and values are trimmed!
+   *
+   * &lt;code&gt;
+   * $response-&gt;setHeader(&quot;X-Foo&quot;, &quot;Bar&quot;);
+   * $response-&gt;setHeader(&quot;X-Framework&quot;, &quot;Medick &quot;); // notice the space at the end
+   * $response-&gt;getHeaders(); // array(&quot;X-Foo&quot;=&gt;&quot;Bar&quot;, &quot;X-Framework&quot;=&gt;&quot;Medick&quot;);
+   * &lt;/code&gt;
+   */ 
+  public function getHeaders() {
+    $headers= array();
+    foreach(headers_list() as $header) {
+    list($name, $value) = explode(':', $header);
+    $headers[trim($name)]= trim($value);
     }
-    
-    // bleah.
-    public function hasHeader( $name ) {
-      return in_array(trim($name), array_keys($this-&gt;getHeaders()));
-    }
+    return $headers;
+  }
 
-    /**
-     * Sets the content-type header
-     *
-     * @param string the content type
-     */
-    public function setContentType($type) {
-        return $this-&gt;setHeader('Content-type', $type);
+  public function getHeader( $name ) {
+    $headers= $this-&gt;getHeaders();
+    return isset($headers[trim($name)]) ? trim($headers[trim($name)]) : false;
+  }
+  
+  // bleah.
+  public function hasHeader( $name ) {
+    return in_array(trim($name), array_keys($this-&gt;getHeaders()));
+  }
+
+  /**
+   * Sets the content-type header
+   *
+   * @param string the content type
+   */
+  public function setContentType($type) {
+    return $this-&gt;setHeader('Content-type', $type);
+  }
+  
+  /**
+   * Sets a Cookie.
+   * 
+   * &lt;code&gt;
+   *  $response-&gt;setCookie(new Cookie(&quot;Foo&quot;, &quot;Bar&quot;));
+   * &lt;/code&gt;
+   *
+   * @param Cookie Cookie
+   * @see Cookie
+   */ 
+  public function setCookie(Cookie $cookie) {
+    $this-&gt;setHeader('Set-Cookie', $cookie-&gt;toString());
+  }
+  
+  /**
+   * Sets the status of this response
+   *
+   * @param HTTPResponse::SC_* the status of this response
+   */
+  public function setStatus( $status ) {
+    if(null === $status) {
+      $status = HTTPResponse::SC_OK;
     }
-    
-    /**
-     * Sets a Cookie.
-     * 
-     * &lt;code&gt;
-     *  $response-&gt;setCookie(new Cookie(&quot;Foo&quot;, &quot;Bar&quot;));
-     * &lt;/code&gt;
-     *
-     * @param Cookie Cookie
-     * @see Cookie
-     */ 
-    public function setCookie(Cookie $cookie) {
-        $this-&gt;setHeader('Set-Cookie', $cookie-&gt;toString());
-    }
-    
-    /**
-     * Sets the status of this response
-     *
-     * @param HTTPResponse::SC_* the status of this response
-     */
-    public function setStatus( $status ) {
-        switch($status){
-            case HTTPResponse::SC_OK: // 200
-                $message = 'OK';
-                break;
-            case HTTPResponse::SC_NOT_MODIFIED: // 304
-                $message = 'Not Modified';
-                break;
-            case HTTPResponse::SC_NOT_FOUND: // 404
-                $message = 'Not Found';
-                break;
-            case HTTPResponse::SC_INTERNAL_SERVER_ERROR: // 500
-                $message = 'Internal Server Error';
-                break;
-            default:
-                return;
-        }
-        header(&quot;HTTP/1.1 &quot; . $status . $message, TRUE, $status);
-    }
 
-    /**
-     * Perform a HTTP redirect
-     *
-     * @param string location, location to redirect to
-     */
-    public function redirect( $location ) {
-        $this-&gt;setHeader('Location', $location);
-        $this-&gt;content = '&lt;html&gt;&lt;body&gt;You are being &lt;a href=&quot;'.$location.'&quot;&gt;redirected&lt;/a&gt;.&lt;/body&gt;&lt;/html&gt;';
+    switch($status){
+      case HTTPResponse::SC_OK: // 200
+        $message = 'OK';
+        break;
+      case HTTPResponse::SC_NOT_MODIFIED: // 304
+        $message = 'Not Modified';
+        break;
+      case HTTPResponse::SC_NOT_FOUND: // 404
+        $message = 'Not Found';
+        break;
+      case HTTPResponse::SC_INTERNAL_SERVER_ERROR: // 500
+        $message = 'Internal Server Error';
+        break;
+      default:
+        return;
     }
+    header(&quot;HTTP/1.1 &quot; . $status . $message, true, $status);
+  }
+
+  /**
+   * Perform a HTTP redirect
+   *
+   * @param string location, location to redirect to
+   */
+  public function redirect( $location ) {
+    $this-&gt;setHeader('Location', $location);
+    $this-&gt;content = '&lt;html&gt;&lt;body&gt;You are being &lt;a href=&quot;'.$location.'&quot;&gt;redirected&lt;/a&gt;.&lt;/body&gt;&lt;/html&gt;';
+  }
 }
 

Modified: exp/medick2/vendor/medick/lib/action/controller/http/HTTPSession.php
===================================================================
--- exp/medick2/vendor/medick/lib/action/controller/http/HTTPSession.php	2008-05-19 08:10:10 UTC (rev 476)
+++ exp/medick2/vendor/medick/lib/action/controller/http/HTTPSession.php	2008-05-19 08:10:31 UTC (rev 477)
@@ -12,171 +12,132 @@
  */
 class HTTPSession extends Object {
 
-    /** @var bool
-        started flag */
-    private $isStarted = FALSE;
+  /** @var bool
+     started flag */
+  private $isStarted = false;
 
-    /** @var ISessionContainer
-        the session container */
-    private $container = NULL;
+  /** @var ISessionContainer
+      the session container */
+  private $container = null;
   
-    /** @var string
-        Session name */
-    private $name = 'MSESSID';
+  /** @var string
+      Session name */
+  public $name = 'msessid';
     
-    /**
-     * Constructor, creates a new session object
-     *
-     * @throws IllegalStateException if the session is started
-     */
-    public function Session () {
-        if ($this-&gt;isStarted) {
-            throw new IllegalStateException('Session already Started!');
-        }
-    }
+  /**
+   * Constructor, creates a new session object
+   *
+   * @throws IllegalStateException if the session is started
+   */
+  public function __construct() {
+    if ($this-&gt;isStarted) throw new IllegalStateException('Session already Started!');
+  }
 
-    /**
-     * Starts a new Session
-     *
-     * Also, it setup our session preferences
-     * @return void
-     * @throws IllegalStateException if the session is already started
-     */
-    public function start() {
-        if ($this-&gt;isStarted) {
-            throw new IllegalStateException('Session already Started!');
-        }
-        
-        // TODO: more settings
-        // session_cache_limiter(&quot;nocache&quot;);
-        session_name($this-&gt;name);
-        if ($this-&gt;container!==NULL) {
-            session_set_save_handler(
-                array($this-&gt;container, 'open'),
-                array($this-&gt;container, 'close'),
-                array($this-&gt;container, 'read'),
-                array($this-&gt;container, 'write'),
-                array($this-&gt;container, 'destroy'),
-                array($this-&gt;container, 'gc'));
-        }
-        session_start();
-        //session_regenerate_id(TRUE);
-        $this-&gt;isStarted= TRUE;
-    }
-
-    /**
-     * It sets the Session Name.
-     * 
-     * Medick uses MSESSID as a session name identifier, overwritting PHPSESSID
-     * @param string the session name
-     */
-    public function setName($name) {
-        $this-&gt;name = $name;
-    }
+  /**
+   * Starts a new Session
+   *
+   * Also, it setup our session preferences
+   * @return Session
+   * @throws IllegalStateException if the session is already started
+   */
+  public function start() {
+    if ($this-&gt;isStarted) throw new IllegalStateException('Session already Started!');
     
-    /**
-     * It gets this Session name
-     *
-     * @return string the Session Name
-     */
-    public function getName() {
-        return $this-&gt;name;
+    // XXX: more settings from xml config file
+    // session_cache_limiter(&quot;nocache&quot;);
+    // XXX: allow name to be passed in xml config file as web.session.name
+    session_name($this-&gt;name);
+    if ($this-&gt;container !== null) {
+      session_set_save_handler(
+        array($this-&gt;container, 'open'),
+        array($this-&gt;container, 'close'),
+        array($this-&gt;container, 'read'),
+        array($this-&gt;container, 'write'),
+        array($this-&gt;container, 'destroy'),
+        array($this-&gt;container, 'gc'));
     }
-    /**
-     * Sets a session variable
-     *
-     * @param string name, the name of the session variable
-     * @param mixed value, the value of the variable to set
-     * @return void
-     */
-    public function putValue($name, $value) {
-        $this-&gt;checkState();
-        $_SESSION[$name] = $value;
-    }
+    session_start();
+    $this-&gt;isStarted= true;
+    return $this;
+  }
 
-    /**
-     * Gets a session variable value
-     *
-     * @param string name, the name of the session variable
-     * @return NULL if the variable is not set, or mixed, the variable value
-     */
-    public function getValue($name) {
-        return $this-&gt;hasValue($name) ? $_SESSION[$name] : NULL;
-    }
+  /**
+   * Sets a session variable
+   *
+   * @param string name, the name of the session variable
+   * @param mixed value, the value of the variable to set
+   * @return void
+   */
+  public function put($name, $value) {
+    $this-&gt;checkState();
+    $_SESSION[$name] = $value;
+  }
 
-    /**
-     * Check if this session has a variable with the given name
-     *
-     * @param string name, the name of the session variable
-     * @return bool, TRUE if it has
-     */
-    public function hasValue($name) {
-        $this-&gt;checkState();
-        return isset($_SESSION[$name]);
-    }
+  /**
+   * Gets a session variable value
+   *
+   * @param string name, the name of the session variable
+   * @return null if the variable is not set, or mixed, the variable value
+   */
+  public function get($name) {
+    $this-&gt;checkState();
+    return isset($_SESSION[$name])? $_SESSION[$name] : null;
+  }
 
-    /**
-     * Remove the session value with the given name
-     *
-     * @param string name, the name of the session variable
-     * @return void
-     */
-    public function removeValue($name) {
-        $this-&gt;checkState();
-        // unset($_SESSION[$name]);
-        session_unregister($name);
-    }
+  /**
+   * Remove the session value with the given name
+   *
+   * @param string name, the name of the session variable
+   * @return void
+   */
+  public function remove($name) {
+    $this-&gt;checkState();
+    // unset($_SESSION[$name]);
+    session_unregister($name);
+  }
 
-    /**
-     * It gets the session id
-     *
-     * @return mixed, the session id
-     */
-    public function getId(){
-        $this-&gt;checkState();
-        return session_id();
-    }
+  /**
+   * It gets the session id
+   *
+   * @return mixed, the session id
+   */
+  public function id(){
+    $this-&gt;checkState();
+    return session_id();
+  }
 
-    /**
-     * It sets the session container
-     *
-     * @param ISessionContainer container to set
-     * @return void
-     */
-    public function setContainer(ISessionContainer $container) {
-        $this-&gt;container= $container;
-    }
+  /**
+   * It sets the session container
+   *
+   * @param ISessionContainer container to set
+   * @return void
+   */
+  public function container(ISessionContainer $container) {
+    $this-&gt;container= $container;
+    return $this;
+  }
 
-    /**
-     * It dumps the session
-     *
-     * @return array
-     */
-    public function dump() {
-        $this-&gt;checkState();
-        return $_SESSION;
-    }
+  /**
+   * It dumps the session
+   *
+   * @return array
+   */
+  public function toArray() {
+    $this-&gt;checkState();
+    return $_SESSION;
+  }
 
-    /**
-     * Alias for Session::dump()
-     *
-     * @see Session::dump
-     */ 
-    public function getValues() {
-        return $this-&gt;dump();
-    }
-    
-    /**
-     * It checks the session state
-     *
-     * This method is called internally to ensure that the session is started before using it.
-     * @return TRUE if the session is started
-     */
-    protected function checkState() {
-        if (!$this-&gt;isStarted) {
-            $this-&gt;start();
-        }
-        return TRUE;
-    }
-      
+  /**
+   * It checks the session state
+   *
+   * This method is called internally to ensure that the session is started before using it.
+   * @return TRUE if the session is started
+   */
+  protected function checkState() {
+    // XXX: review!, I plan to pass a context to start so it will know how to setup it's internal state, then this will throw an exception!
+    // XXX: the session should be started only from the ActionController
+    if ($this-&gt;isStarted === false) $this-&gt;start();
+    return true;
+  }
 }
+

Added: exp/medick2/vendor/medick/lib/action/view/AbstractTemplateEngine.php
===================================================================
--- exp/medick2/vendor/medick/lib/action/view/AbstractTemplateEngine.php	2008-05-19 08:10:10 UTC (rev 476)
+++ exp/medick2/vendor/medick/lib/action/view/AbstractTemplateEngine.php	2008-05-19 08:10:31 UTC (rev 477)
@@ -0,0 +1,24 @@
+&lt;?php
+
+// $Id$
+
+abstract class AbstractTemplateEngine extends Object implements ITemplateEngine {
+
+  protected $vars;
+
+  protected $context;
+
+  protected $controller;
+
+  public function __construct(ContextManager $context, ActionController $controller) {
+    $this-&gt;context= $context;
+    $this-&gt;controller= $controller;
+    $this-&gt;vars= array();
+  }
+
+  public function assign($name, $value) {
+    $this-&gt;vars[$name]= $value;
+  }
+
+}
+


Property changes on: exp/medick2/vendor/medick/lib/action/view/AbstractTemplateEngine.php
___________________________________________________________________
Name: svn:keywords
   + Id

Added: exp/medick2/vendor/medick/lib/action/view/Base.php
===================================================================
--- exp/medick2/vendor/medick/lib/action/view/Base.php	2008-05-19 08:10:10 UTC (rev 476)
+++ exp/medick2/vendor/medick/lib/action/view/Base.php	2008-05-19 08:10:31 UTC (rev 477)
@@ -0,0 +1,13 @@
+&lt;?php
+
+// $Id$
+
+class ActionView extends Object {
+
+  public static function load( ContextManager $context, ActionController $controller ) {
+    // XXX: context will know view paths + the template engine to use
+    return new PHPTemplateEngine( $context, $controller );
+  }
+
+}
+


Property changes on: exp/medick2/vendor/medick/lib/action/view/Base.php
___________________________________________________________________
Name: svn:keywords
   + Id

Added: exp/medick2/vendor/medick/lib/action/view/ITemplateEngine.php
===================================================================
--- exp/medick2/vendor/medick/lib/action/view/ITemplateEngine.php	2008-05-19 08:10:10 UTC (rev 476)
+++ exp/medick2/vendor/medick/lib/action/view/ITemplateEngine.php	2008-05-19 08:10:31 UTC (rev 477)
@@ -0,0 +1,14 @@
+&lt;?php
+
+// $Id$
+
+interface ITemplateEngine {
+
+  public function partial($partial);
+
+  public function render($file);
+
+  public function assign($name, $value);
+
+}
+


Property changes on: exp/medick2/vendor/medick/lib/action/view/ITemplateEngine.php
___________________________________________________________________
Name: svn:keywords
   + Id

Added: exp/medick2/vendor/medick/lib/action/view/PHPTemplateEngine.php
===================================================================
--- exp/medick2/vendor/medick/lib/action/view/PHPTemplateEngine.php	2008-05-19 08:10:10 UTC (rev 476)
+++ exp/medick2/vendor/medick/lib/action/view/PHPTemplateEngine.php	2008-05-19 08:10:31 UTC (rev 477)
@@ -0,0 +1,35 @@
+&lt;?php
+
+// $Id$
+
+class PHPTemplateEngine extends AbstractTemplateEngine {
+
+  public function partial($partial) {
+
+  }
+
+  public function render( $file ) {
+
+    // XXX: loop view paths
+    if (false === file_exists( $file )) {
+      throw new Exception( 'Cannot render template: `' . $file . '`, no such file!' );
+    }
+
+    // XXX: load helper['s]
+
+    if (sizeof($this-&gt;vars) &gt; 0) {
+      extract($this-&gt;vars,EXTR_SKIP);
+    }
+
+    $this-&gt;context-&gt;logger()-&gt;debug(sprintf('ready to render `%s` (+ %.3f sec.)', $file, $this-&gt;context-&gt;timer()-&gt;tick()));
+
+    ob_start();
+    include_once( $file );
+    $c = ob_get_contents();
+    ob_end_clean();
+    $this-&gt;context-&gt;logger()-&gt;debug(sprintf('template parsed (+ %.3f sec.)', $this-&gt;context-&gt;timer()-&gt;tick()));
+    return $c;
+  }
+
+}
+


Property changes on: exp/medick2/vendor/medick/lib/action/view/PHPTemplateEngine.php
___________________________________________________________________
Name: svn:keywords
   + Id

Added: exp/medick2/vendor/medick/lib/action/view/init.php
===================================================================
--- exp/medick2/vendor/medick/lib/action/view/init.php	2008-05-19 08:10:10 UTC (rev 476)
+++ exp/medick2/vendor/medick/lib/action/view/init.php	2008-05-19 08:10:31 UTC (rev 477)
@@ -0,0 +1,32 @@
+&lt;?php
+
+//  ActionView Framework Autoload Definition
+
+function __action_view_autoload($class) {
+
+  // special case
+  if($class == 'ActionView') {
+    return require 'action/view/Base.php';
+  }
+
+  // $base= dirname(__FILE__) . DIRECTORY_SEPARATOR;
+
+  // action/controller/http
+  // if(strpos(strtolower($class), 'http') !== false &amp;&amp; is_file($base.'http'.DIRECTORY_SEPARATOR.$class.'.php') ) {
+  //   return require 'action'.DIRECTORY_SEPARATOR.'controller'.DIRECTORY_SEPARATOR.'http'.DIRECTORY_SEPARATOR.$class.'.php';
+  // }
+
+  // action/controller/cli
+  // if(strpos(strtolower($class), 'cli') !== false &amp;&amp; is_file($base.'cli'.DIRECTORY_SEPARATOR.$class.'.php') ) {
+  //   return require 'action'.DIRECTORY_SEPARATOR.'controller'.DIRECTORY_SEPARATOR.'cli'.DIRECTORY_SEPARATOR.$class.'.php';
+  // }
+
+  // the rest
+  $file= 'action'.DIRECTORY_SEPARATOR.'view'.DIRECTORY_SEPARATOR.$class.'.php';
+  if(is_file( dirname(__FILE__) . DIRECTORY_SEPARATOR . $class . '.php' )) {
+    return require $file;
+  }
+}
+
+spl_autoload_register('__action_view_autoload');
+


Property changes on: exp/medick2/vendor/medick/lib/action/view/init.php
___________________________________________________________________
Name: svn:keywords
   + Id

Modified: exp/medick2/vendor/medick/lib/context/ContextManager.php
===================================================================
--- exp/medick2/vendor/medick/lib/context/ContextManager.php	2008-05-19 08:10:10 UTC (rev 476)
+++ exp/medick2/vendor/medick/lib/context/ContextManager.php	2008-05-19 08:10:31 UTC (rev 477)
@@ -1,18 +1,20 @@
 &lt;?php
 
 class Timer extends Object {
-  
+
+  private $init;
   private $start;
   private $end;
 
-  public function __construct($start) {
+  public function __construct( $start ) {
+    $this-&gt;init = $start;
     $this-&gt;start= $start;
     $this-&gt;end= null;
   }
 
-  public function tick() {
+  public function tick($from_init= false) {
     $this-&gt;end= microtime(true);
-    $r= (float)$this-&gt;end - (float)$this-&gt;start;
+    $r= $from_init? (float)$this-&gt;end-(float)$this-&gt;init : (float)$this-&gt;end - (float)$this-&gt;start;
     $this-&gt;start= $this-&gt;end;
     return $r;
   }
@@ -29,20 +31,22 @@
   // the config parser/loaded, to have access to configuration options
   private $config;
 
-  // a Map, you get access to Routes using this
+  // a Map, you get access to Routes using this!
   private $map;
-
+  
+  // a Timer to benchmark critical points
   private $timer;
 
-  private function __construct( Iconfigurator $config ) {
+  private function __construct( IConfigurator $config ) {
     $this-&gt;config= $config;
     // configure the logger
     $this-&gt;logger= new Logger();
     $this-&gt;logger-&gt;setFormatter( Logger::formatter($this-&gt;config) );
     $this-&gt;logger-&gt;attachOutputters( Logger::outputters($this-&gt;config) );
     // ready?
+    $ip= (array_key_exists('REMOTE_ADDR',$_SERVER))? $_SERVER['REMOTE_ADDR']: '0.0.0.0';
     $this-&gt;logger-&gt;debug(&quot;\t[&quot;.time() . &quot;] `&quot; . $this-&gt;config-&gt;environment() . &quot;` env. from &quot; . 
-      str_replace(APP_PATH, '${'.$this-&gt;config-&gt;application_name().'}/', $this-&gt;config-&gt;file()) . &quot; loaded for \${ip}&quot;);
+      str_replace(APP_PATH, '${'.$this-&gt;config-&gt;application_name().'}/', $this-&gt;config-&gt;file()) . &quot; loaded for `${ip}`&quot;);
     // create a Map for routes.
     $this-&gt;map= new Map( $this );
   }

Modified: exp/medick2/vendor/medick/lib/context/XMLConfigurator.php
===================================================================
--- exp/medick2/vendor/medick/lib/context/XMLConfigurator.php	2008-05-19 08:10:10 UTC (rev 476)
+++ exp/medick2/vendor/medick/lib/context/XMLConfigurator.php	2008-05-19 08:10:31 UTC (rev 477)
@@ -65,6 +65,10 @@
     foreach($this-&gt;sxe-&gt;properties-&gt;property as $prop) {
       $this-&gt;properties['__global_env'][(string)trim($prop['name'])]= $this-&gt;parse_prop_value($prop['value']);
     }
+    if( 0 == sizeof($this-&gt;env-&gt;properties) ) return;
+    foreach($this-&gt;env-&gt;properties-&gt;property as $prop) {
+      $this-&gt;properties[(string)$this-&gt;env['name']][(string)trim($prop['name'])]= $this-&gt;parse_prop_value($prop['value']);
+    }
   }
 
   private function parse_prop_value($val) {

Added: exp/medick2/vendor/medick/lib/eltest/TestRunner.php
===================================================================
--- exp/medick2/vendor/medick/lib/eltest/TestRunner.php	2008-05-19 08:10:10 UTC (rev 476)
+++ exp/medick2/vendor/medick/lib/eltest/TestRunner.php	2008-05-19 08:10:31 UTC (rev 477)
@@ -0,0 +1,69 @@
+&lt;?php
+
+// $Id$
+
+class RunnerError extends Exception { }
+
+class TestRunner extends Object {
+
+  private $folder;
+
+  private $cases;
+
+  private $buffer;
+
+  public function __construct($folder) {
+    $this-&gt;folder= $folder;
+    $this-&gt;cases = array();
+    $this-&gt;buffer= '';
+  }
+
+  public function run() {
+    $this-&gt;load_tests( new RecursiveDirectoryIterator($this-&gt;folder) );
+    
+    shuffle($this-&gt;cases);
+
+    foreach( $this-&gt;cases as $rclass ) {
+      $klass= $rclass-&gt;newInstance();
+      $rclass-&gt;getMethod('setup')-&gt;invoke($klass);
+      $rmethods= $rclass-&gt;getMethods();
+      try {
+        foreach($rmethods as $method) {
+          if($method-&gt;isPublic() &amp;&amp; preg_match(&quot;/^test_/&quot;, $method-&gt;getName())) {
+            try {
+              $method-&gt;invoke($klass);
+            } catch(AssertionError $aErr) {
+              echo sprintf(&quot;[%s::%s] --&gt; %s\n&quot;, $klass-&gt;class_name(), $method-&gt;getName(), $aErr-&gt;getMessage());
+            }
+          }
+        } // foreach
+      } catch(ReflectionException $rfEx) {
+        echo $rfEx-&gt;getMessage() . &quot;\n&quot;;
+      }
+      $rclass-&gt;getMethod('tear_down')-&gt;invoke($klass);
+    } // foreach
+
+  }
+
+  private function load_tests( RecursiveDirectoryIterator $dir ) {
+    while($dir-&gt;valid()) {
+      $current= $dir-&gt;current();
+      if( $dir-&gt;isFile() &amp;&amp; preg_match(&quot;/(.)Test\.php$/&quot;, $current-&gt;getFilename(), $matches) ) {
+        // XXX: handle errors
+        include $current-&gt;getPathname();
+        $x= explode('.', $current-&gt;getFilename());
+        $class = $x[0];
+        $rclass= new ReflectionClass($class);
+        if($rclass-&gt;getParentClass()-&gt;getName() == 'UnitTest') {
+          $this-&gt;cases[]= $rclass;
+        }
+      } elseif( $dir-&gt;hasChildren() &amp;&amp; preg_match(&quot;/^\./&quot;, $current-&gt;getFilename(), $matches) == 0 ) {
+        $this-&gt;load_tests( $dir-&gt;getChildren() );
+      }
+      $dir-&gt;next();
+    }
+
+  }
+
+}
+


Property changes on: exp/medick2/vendor/medick/lib/eltest/TestRunner.php
___________________________________________________________________
Name: svn:keywords
   + Id

Added: exp/medick2/vendor/medick/lib/eltest/UnitTest.php
===================================================================
--- exp/medick2/vendor/medick/lib/eltest/UnitTest.php	2008-05-19 08:10:10 UTC (rev 476)
+++ exp/medick2/vendor/medick/lib/eltest/UnitTest.php	2008-05-19 08:10:31 UTC (rev 477)
@@ -0,0 +1,32 @@
+&lt;?php
+
+// $Id$
+
+class AssertionError extends Exception {  }
+
+class UnitTest extends Object {
+
+  private $__assertions = 0;
+
+  protected function assert( $condition, $expected= 'true', $message= '' ) {
+    $this-&gt;__assertions++;
+    if($condition === false) {
+      throw new AssertionError( $message === ''? 'Assertion failed expected: '.$expected.', got: false': $message );
+    }
+  }
+
+  public function setup() { }
+
+  public function tear_down() {  }
+
+  public function assertions() {
+    return $this-&gt;__assertions;
+  }
+
+  public function toString() {
+    return sprintf( 'Assertions: %d', $this-&gt;__assertions );
+  }
+
+}
+
+


Property changes on: exp/medick2/vendor/medick/lib/eltest/UnitTest.php
___________________________________________________________________
Name: svn:keywords
   + Id

Added: exp/medick2/vendor/medick/lib/eltest/init.php
===================================================================
--- exp/medick2/vendor/medick/lib/eltest/init.php	2008-05-19 08:10:10 UTC (rev 476)
+++ exp/medick2/vendor/medick/lib/eltest/init.php	2008-05-19 08:10:31 UTC (rev 477)
@@ -0,0 +1,18 @@
+&lt;?php
+
+//
+// $Id$
+//
+
+//  elTest, Medick UnitTest Framework
+
+function __eltest_autoload( $class ) {
+  $base= dirname(__FILE__) . DIRECTORY_SEPARATOR;
+  $file= 'eltest'.DIRECTORY_SEPARATOR.$class.'.php';
+  if(is_file( $base . $class . '.php')) {
+    return require $file;
+  }
+}
+
+spl_autoload_register('__eltest_autoload');
+


Property changes on: exp/medick2/vendor/medick/lib/eltest/init.php
___________________________________________________________________
Name: svn:keywords
   + Id

Modified: exp/medick2/vendor/medick/lib/medick/Medick.php
===================================================================
--- exp/medick2/vendor/medick/lib/medick/Medick.php	2008-05-19 08:10:10 UTC (rev 476)
+++ exp/medick2/vendor/medick/lib/medick/Medick.php	2008-05-19 08:10:31 UTC (rev 477)
@@ -1,8 +1,13 @@
 &lt;?php
 
+// $Id: $
+
 require 'medick/Object.php';
 require 'medick/ErrorHandler.php';
 
+//
+// Create a way to unload frameworks?
+//
 class Medick extends Object {
 
   private static $frameworks = array();
@@ -15,29 +20,57 @@
     Medick::load_framework('logger');
     Medick::load_framework('plugin');
     Medick::load_framework('action_controller');
+    Medick::load_framework('action_view');
 
     // Medick::load_framework('active_record');
 
   }
 
+  //
+  // XXX-&gt; define autoload function inline?
+  // XXX-&gt; register autoload function here?
+  // XXX-&gt; check for the existence of autoload function?
+  //
   public static function load_framework( $name ) {
+    // avoid loading the same framework twice
     if(in_array($name, Medick::$frameworks)) return;
-    // XXX: check the path
-    // require la fisierul init din eg. active/record/init.php
-    require str_replace( '_' , DIRECTORY_SEPARATOR, $name ) . DIRECTORY_SEPARATOR . 'init.php';
+
+    // if(function_exists('__'.$name.'_autoload')) {
+    //   spl_autoload_register( '__'.$name.'_autoload' );
+    // } else {
+      // require la fisierul init din eg. active/record/init.php
+      $init_file= MEDICK_PATH . DIRECTORY_SEPARATOR . 'lib' . DIRECTORY_SEPARATOR . 
+        str_replace( '_' , DIRECTORY_SEPARATOR, $name ) . DIRECTORY_SEPARATOR . 'init.php';
+      if(false === file_exists($init_file))
+        throw new Exception('Cannot load framework `'.$name.'` from `'.$init_file.'`, no such file.');
+      require $init_file;
+    //}
+
     Medick::$frameworks[]= $name;
   }
 
+  public static function reload_framework($name) {
+    if(self::framework_loaded($name))
+      spl_autoload_register('__'.$name.'_autoload');
+    else
+      self::load_framework($name);
+  }
+
+  public static function unload_framework($name) {
+    if(self::framework_loaded($name)) 
+      spl_autoload_unregister('__'.$name.'_autoload');
+  }
+
   public static function framework_loaded($name) {
     return isset(Medick::$frameworks[$name]);
   }
 
   public static function version() {
-    return '2.0.5';
+    return '2.0.10';
   }
 
   public static function dump($o) {
-    echo &quot;&lt;pre&gt;&quot;;var_dump($o);echo &quot;&lt;/pre&gt;&quot;;
+    echo &quot;&lt;pre&gt;\n&quot;;var_dump($o);echo &quot;\n&lt;/pre&gt;&quot;;
     die();
   }
 

Modified: exp/medick2/vendor/medick/lib/plugin/Plugins.php
===================================================================
--- exp/medick2/vendor/medick/lib/plugin/Plugins.php	2008-05-19 08:10:10 UTC (rev 476)
+++ exp/medick2/vendor/medick/lib/plugin/Plugins.php	2008-05-19 08:10:31 UTC (rev 477)
@@ -1,6 +1,6 @@
 &lt;?php
 
-// $Id: $
+// $Id$
 
 class Plugins extends Object {
 
@@ -14,29 +14,14 @@
     Plugins::$registry[$plugin-&gt;name()]= $plugin;
   }
 
-  //
-  // XXX: 
-  // -&gt; foo_bar should be FooBar
-  //
-  private static function plugin_class_name(DirectoryIterator $plugin_path) {
-    $plugin_name= $plugin_path-&gt;getFilename();
-    return  ucfirst($plugin_name) . 'Plugin';
-  }
-
   // should return IPlugin[]
   public static function discover( ContextManager $context ) {
-    
+    // XXX: try to load plugins from &lt;plugins&gt; section
     if($context-&gt;config()-&gt;property( 'plugin.autodiscovery' ) === false) return;
 
     $context-&gt;logger()-&gt;debug( strtolower(__METHOD__) . ' [hint: set `plugin.autodiscovery` to false to disable plugins]');
 
-    //
-    // XXX.
-    // -&gt; plugin.path
-    // -&gt; multiple paths?
-    // -&gt; &lt;plugin&gt; section
-    //
-
+    // XXX: plugins.path then fail to default
     foreach(new DirectoryIterator( MEDICK_PATH . '/../../vendor/plugins' ) as $plugin_path) {
       $plugin_load_file = $plugin_path-&gt;getPathname() . DIRECTORY_SEPARATOR . 'init.php';
       if( $plugin_path-&gt;isDir() &amp;&amp; is_file($plugin_load_file) &amp;&amp; require($plugin_load_file)) {
@@ -48,5 +33,11 @@
 
   }
 
+  // XXX: foo_bar should be FooBar
+  private static function plugin_class_name(DirectoryIterator $plugin_path) {
+    $plugin_name= $plugin_path-&gt;getFilename();
+    return ucfirst($plugin_name) . 'Plugin';
+  }
+
 }
 


Property changes on: exp/medick2/vendor/medick/lib/plugin/Plugins.php
___________________________________________________________________
Name: svn:keywords
   + Id

Added: exp/medick2/vendor/medick/test/context/ContextManagerTest.php
===================================================================
--- exp/medick2/vendor/medick/test/context/ContextManagerTest.php	2008-05-19 08:10:10 UTC (rev 476)
+++ exp/medick2/vendor/medick/test/context/ContextManagerTest.php	2008-05-19 08:10:31 UTC (rev 477)
@@ -0,0 +1,6 @@
+&lt;?php
+
+class ContextManagerTest extends UnitTest {
+
+}
+  

Added: exp/medick2/vendor/medick/test/context/XMLConfiguratorTest.php
===================================================================
--- exp/medick2/vendor/medick/test/context/XMLConfiguratorTest.php	2008-05-19 08:10:10 UTC (rev 476)
+++ exp/medick2/vendor/medick/test/context/XMLConfiguratorTest.php	2008-05-19 08:10:31 UTC (rev 477)
@@ -0,0 +1,14 @@
+&lt;?php
+
+class XMLConfiguratorTest extends UnitTest {
+
+  public function setup() {
+    Medick::load_framework('context');
+  }
+
+  public function test_framework_loaded() {
+    $this-&gt;assert( class_exists('XMLConfigurator') );
+  }
+
+}
+

Added: exp/medick2/vendor/medick/test/mock_object.php
===================================================================
--- exp/medick2/vendor/medick/test/mock_object.php	2008-05-19 08:10:10 UTC (rev 476)
+++ exp/medick2/vendor/medick/test/mock_object.php	2008-05-19 08:10:31 UTC (rev 477)
@@ -0,0 +1,63 @@
+&lt;?php
+
+error_reporting(E_ALL);
+
+// Mocking Framework
+
+//
+// Product.expects(:find).with(1).returns(product)
+//
+// $o= new MockObject('Product');
+// $o-&gt;expects('find')-&gt;with(1)-&gt;returns(new Product());
+//
+
+class MockObject {
+
+  private $rclass;
+
+  private $klass;
+
+  private $rmethods;
+
+  private $methods;
+
+  public function __construct( $name, $args= null ) {
+
+    $this-&gt;rclass = new ReflectionClass($name);
+    $this-&gt;klass = $this-&gt;rclass-&gt;newInstance();
+
+    $this-&gt;rmethods= $this-&gt;rclass-&gt;getMethods();
+
+    $this-&gt;methods = array();
+
+    foreach($this-&gt;rmethods as $method) {
+      if($method-&gt;isPublic() &amp;&amp; !$method-&gt;isStatic() &amp;&amp; !$method-&gt;isConstructor()) {
+        $this-&gt;methods[$method-&gt;getName()] = $method;
+      }
+    }
+
+  }
+
+  public function __call($method, $args) {
+
+    if(in_array($method, array_keys($this-&gt;methods))) {
+      return $this-&gt;methods[$method]-&gt;invoke($this-&gt;klass);
+    }
+
+  }
+
+}
+
+class Complex {
+
+  public function behave() {
+    echo &quot;shit!\n&quot;;
+  }
+
+}
+
+$complex= new MockObject('Complex');
+$complex-&gt;behave();
+
+die();
+

Added: exp/medick2/vendor/medick/test/runner.php
===================================================================
--- exp/medick2/vendor/medick/test/runner.php	2008-05-19 08:10:10 UTC (rev 476)
+++ exp/medick2/vendor/medick/test/runner.php	2008-05-19 08:10:31 UTC (rev 477)
@@ -0,0 +1,47 @@
+&lt;?php
+
+// $Id: $
+/*
+$pattern = &quot;/(.)Test.php$/&quot;;
+$str = &quot;FooTest.php&quot;;
+var_dump(preg_match( $pattern, $str, $matches ));
+# var_dump($matches);
+exit;
+*/
+
+define( 'RUNNER_VERSION', '0.1/20080518' );
+
+function usage() {
+  return sprintf(&quot;Usage: %s [folder]\n\nMedick Unit Test Runner, \$v. %s\nReport bugs to <A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">aurelian at locknet.ro</A>\n&quot;,
+    $_SERVER['argv'][0],
+    RUNNER_VERSION
+  );
+}
+
+function main() {
+  if( $_SERVER['argc'] &lt;= 1 || false === is_dir($_SERVER['argv'][1])) {
+    echo usage();
+    exit(-1);
+  } else {
+    setup();
+    init( $_SERVER['argv'][1]);
+  }
+}
+
+function setup() {
+  error_reporting( E_ALL | E_STRICT | E_RECOVERABLE_ERROR );
+  define( 'MEDICK_PATH', realpath(dirname(__FILE__) . DIRECTORY_SEPARATOR . '..'));
+  set_include_path(MEDICK_PATH . DIRECTORY_SEPARATOR . 'lib' . DIRECTORY_SEPARATOR);
+  error_reporting( E_ALL | E_STRICT | E_RECOVERABLE_ERROR );
+  require 'medick/Medick.php';
+  set_error_handler( array(new ErrorHandler(), 'raiseError') );
+  Medick::load_framework('eltest');
+}
+
+function init( $folder ) {
+  $runner= new TestRunner( $folder );
+  $runner-&gt;run();
+}
+
+main();
+

Added: exp/medick2/vendor/medick/test/unit_test.php
===================================================================
--- exp/medick2/vendor/medick/test/unit_test.php	2008-05-19 08:10:10 UTC (rev 476)
+++ exp/medick2/vendor/medick/test/unit_test.php	2008-05-19 08:10:31 UTC (rev 477)
@@ -0,0 +1,82 @@
+&lt;?php
+
+error_reporting(E_ALL);
+
+// UnitTest Framework
+
+class AssertionError extends Exception {  }
+
+class UnitTest {
+
+  private $__assertions = 0;
+
+  private $__failues    = 0;
+
+  protected function assert( $condition, $expected= 'true', $message= '' ) {
+    $this-&gt;__assertions++;
+    if($condition === false) {
+      // $this-&gt;__failures++;
+      throw new AssertionError( $message === ''? 'Assertion failed expected: '.$expected.', got: false': $message );
+    }
+  }
+
+  public function assertions() {
+    return $this-&gt;__assertions;
+  }
+
+  public function report() {
+    return sprintf( 'Assertions: %d, Failures: %d', $this-&gt;__assertions, $this-&gt;__failures );
+  }
+
+}
+
+class TestRunner {
+
+  public static function run(UnitTest $test) {
+
+    $failures = 0;
+    $errors   = 0;
+    $tests    = 0;
+
+    $rclass= new ReflectionClass($test);
+    $rmethods= $rclass-&gt;getMethods();
+    
+    try {
+      foreach($rmethods as $rmethod) {
+        if($rmethod-&gt;isPublic() &amp;&amp; preg_match(&quot;/^test_/&quot;, $rmethod-&gt;getName())) {
+          try {
+            $tests++;
+            $rmethod-&gt;invoke($test);
+          } catch(AssertionError $aerr) {
+            $failures++;
+            echo &quot;--&gt; [&quot; . $rclass-&gt;getName() . &quot;::&quot; . $rmethod-&gt;getName() . &quot;] &quot; . $aerr-&gt;getMessage() . &quot;\n&quot;;
+          }
+        }
+      }
+    } catch(Exception $ex) {
+      $errors++;
+    }
+
+    echo sprintf(&quot;[%s/%d] assertions: %d, failures: %d, errors: %d\n&quot;,
+      $rclass-&gt;getName(), $tests, $test-&gt;assertions(), $failures, $errors);
+
+  }
+
+}
+
+class FooTest extends UnitTest {
+
+  public function test_one() {
+    $this-&gt;assert(false);
+    $this-&gt;assert(true);
+  }
+
+  public function test_two() {
+    $this-&gt;assert(true);
+    $this-&gt;assert(true);
+  }
+
+}
+
+
+TestRunner::run( new FooTest() );


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000256.html">[Medick-svn] r476 - in exp/medick2/app: . controllers views	views/foo views/layouts
</A></li>
	<LI>Next message: <A HREF="000257.html">[Medick-svn] r478 - exp/medick2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#258">[ date ]</a>
              <a href="thread.html#258">[ thread ]</a>
              <a href="subject.html#258">[ subject ]</a>
              <a href="author.html#258">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/medick-svn">More information about the Medick-svn
mailing list</a><br>
</body></html>
