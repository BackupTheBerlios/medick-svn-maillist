<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Medick-svn] r243 - in trunk: . vendor vendor/creole vendor/creole/common vendor/creole/contrib vendor/creole/drivers vendor/creole/drivers/mssql vendor/creole/drivers/mssql/metadata vendor/creole/drivers/mysql vendor/creole/drivers/mysql/metadata vendor/creole/drivers/mysqli vendor/creole/drivers/mysqli/metadata vendor/creole/drivers/odbc vendor/creole/drivers/odbc/adapters vendor/creole/drivers/odbc/metadata vendor/creole/drivers/oracle vendor/creole/drivers/oracle/metadata vendor/creole/drivers/pgsql vendor/creole/drivers/pgsql/metadata vendor/creole/drivers/sqlite vendor/creole/drivers/sqlite/metadata vendor/creole/metadata vendor/creole/util vendor/creole/util/sql
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/medick-svn/2005-October/index.html" >
   <LINK REL="made" HREF="mailto:medick-svn%40lists.berlios.de?Subject=Re%3A%20%5BMedick-svn%5D%20r243%20-%20in%20trunk%3A%20.%20vendor%20vendor/creole%20vendor/creole/common%20vendor/creole/contrib%20vendor/creole/drivers%20vendor/creole/drivers/mssql%20vendor/creole/drivers/mssql/metadata%20vendor/creole/drivers/mysql%20vendor/creole/drivers/mysql/metadata%20vendor/creole/drivers/mysqli%20vendor/creole/drivers/mysqli/metadata%20vendor/creole/drivers/odbc%20vendor/creole/drivers/odbc/adapters%20vendor/creole/drivers/odbc/metadata%20vendor/creole/drivers/oracle%20vendor/creole/drivers/oracle/metadata%20vendor/creole/drivers/pgsql%20vendor/creole/drivers/pgsql/metadata%20vendor/creole/drivers/sqlite%20vendor/creole/drivers/sqlite/metadata%20vendor/creole/metadata%20vendor/creole/util%20vendor/creole/util/sql&In-Reply-To=%3C200510290956.j9T9udSm019936%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000046.html">
   <LINK REL="Next"  HREF="000048.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Medick-svn] r243 - in trunk: . vendor vendor/creole vendor/creole/common vendor/creole/contrib vendor/creole/drivers vendor/creole/drivers/mssql vendor/creole/drivers/mssql/metadata vendor/creole/drivers/mysql vendor/creole/drivers/mysql/metadata vendor/creole/drivers/mysqli vendor/creole/drivers/mysqli/metadata vendor/creole/drivers/odbc vendor/creole/drivers/odbc/adapters vendor/creole/drivers/odbc/metadata vendor/creole/drivers/oracle vendor/creole/drivers/oracle/metadata vendor/creole/drivers/pgsql vendor/creole/drivers/pgsql/metadata vendor/creole/drivers/sqlite vendor/creole/drivers/sqlite/metadata vendor/creole/metadata vendor/creole/util vendor/creole/util/sql</H1>
    <B>oancea aurelian at BerliOS</B> 
    <A HREF="mailto:medick-svn%40lists.berlios.de?Subject=Re%3A%20%5BMedick-svn%5D%20r243%20-%20in%20trunk%3A%20.%20vendor%20vendor/creole%20vendor/creole/common%20vendor/creole/contrib%20vendor/creole/drivers%20vendor/creole/drivers/mssql%20vendor/creole/drivers/mssql/metadata%20vendor/creole/drivers/mysql%20vendor/creole/drivers/mysql/metadata%20vendor/creole/drivers/mysqli%20vendor/creole/drivers/mysqli/metadata%20vendor/creole/drivers/odbc%20vendor/creole/drivers/odbc/adapters%20vendor/creole/drivers/odbc/metadata%20vendor/creole/drivers/oracle%20vendor/creole/drivers/oracle/metadata%20vendor/creole/drivers/pgsql%20vendor/creole/drivers/pgsql/metadata%20vendor/creole/drivers/sqlite%20vendor/creole/drivers/sqlite/metadata%20vendor/creole/metadata%20vendor/creole/util%20vendor/creole/util/sql&In-Reply-To=%3C200510290956.j9T9udSm019936%40sheep.berlios.de%3E"
       TITLE="[Medick-svn] r243 - in trunk: . vendor vendor/creole vendor/creole/common vendor/creole/contrib vendor/creole/drivers vendor/creole/drivers/mssql vendor/creole/drivers/mssql/metadata vendor/creole/drivers/mysql vendor/creole/drivers/mysql/metadata vendor/creole/drivers/mysqli vendor/creole/drivers/mysqli/metadata vendor/creole/drivers/odbc vendor/creole/drivers/odbc/adapters vendor/creole/drivers/odbc/metadata vendor/creole/drivers/oracle vendor/creole/drivers/oracle/metadata vendor/creole/drivers/pgsql vendor/creole/drivers/pgsql/metadata vendor/creole/drivers/sqlite vendor/creole/drivers/sqlite/metadata vendor/creole/metadata vendor/creole/util vendor/creole/util/sql">aurelian at berlios.de
       </A><BR>
    <I>Sat Oct 29 11:56:39 CEST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000046.html">[Medick-svn] r242 - in trunk: libs/action/controller libs/action/controller/templates libs/active/record libs/medick libs/medick/io test test/test/active/record
</A></li>
        <LI>Next message: <A HREF="000048.html">[Medick-svn] r244 - trunk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47">[ date ]</a>
              <a href="thread.html#47">[ thread ]</a>
              <a href="subject.html#47">[ subject ]</a>
              <a href="author.html#47">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: aurelian
Date: 2005-10-29 11:55:23 +0200 (Sat, 29 Oct 2005)
New Revision: 243

Added:
   trunk/vendor/
   trunk/vendor/creole/
   trunk/vendor/creole/CallableStatement.php
   trunk/vendor/creole/Connection.php
   trunk/vendor/creole/Creole.php
   trunk/vendor/creole/CreoleTypes.php
   trunk/vendor/creole/IdGenerator.php
   trunk/vendor/creole/PreparedStatement.php
   trunk/vendor/creole/ResultSet.php
   trunk/vendor/creole/ResultSetIterator.php
   trunk/vendor/creole/SQLException.php
   trunk/vendor/creole/Statement.php
   trunk/vendor/creole/common/
   trunk/vendor/creole/common/ConnectionCommon.php
   trunk/vendor/creole/common/PreparedStatementCommon.php
   trunk/vendor/creole/common/ResultSetCommon.php
   trunk/vendor/creole/common/StatementCommon.php
   trunk/vendor/creole/contrib/
   trunk/vendor/creole/contrib/DebugConnection.php
   trunk/vendor/creole/drivers/
   trunk/vendor/creole/drivers/mssql/
   trunk/vendor/creole/drivers/mssql/MSSQLCallableStatement.php
   trunk/vendor/creole/drivers/mssql/MSSQLConnection.php
   trunk/vendor/creole/drivers/mssql/MSSQLIdGenerator.php
   trunk/vendor/creole/drivers/mssql/MSSQLPreparedStatement.php
   trunk/vendor/creole/drivers/mssql/MSSQLResultSet.php
   trunk/vendor/creole/drivers/mssql/MSSQLStatement.php
   trunk/vendor/creole/drivers/mssql/MSSQLTypes.php
   trunk/vendor/creole/drivers/mssql/metadata/
   trunk/vendor/creole/drivers/mssql/metadata/MSSQLDatabaseInfo.php
   trunk/vendor/creole/drivers/mssql/metadata/MSSQLTableInfo.php
   trunk/vendor/creole/drivers/mysql/
   trunk/vendor/creole/drivers/mysql/MySQLConnection.php
   trunk/vendor/creole/drivers/mysql/MySQLIdGenerator.php
   trunk/vendor/creole/drivers/mysql/MySQLPreparedStatement.php
   trunk/vendor/creole/drivers/mysql/MySQLResultSet.php
   trunk/vendor/creole/drivers/mysql/MySQLStatement.php
   trunk/vendor/creole/drivers/mysql/MySQLTypes.php
   trunk/vendor/creole/drivers/mysql/metadata/
   trunk/vendor/creole/drivers/mysql/metadata/MySQLDatabaseInfo.php
   trunk/vendor/creole/drivers/mysql/metadata/MySQLTableInfo.php
   trunk/vendor/creole/drivers/mysqli/
   trunk/vendor/creole/drivers/mysqli/MySQLiConnection.php
   trunk/vendor/creole/drivers/mysqli/MySQLiIdGenerator.php
   trunk/vendor/creole/drivers/mysqli/MySQLiPreparedStatement.php
   trunk/vendor/creole/drivers/mysqli/MySQLiResultSet.php
   trunk/vendor/creole/drivers/mysqli/MySQLiStatement.php
   trunk/vendor/creole/drivers/mysqli/metadata/
   trunk/vendor/creole/drivers/mysqli/metadata/MySQLiDatabaseInfo.php
   trunk/vendor/creole/drivers/mysqli/metadata/MySQLiTableInfo.php
   trunk/vendor/creole/drivers/odbc/
   trunk/vendor/creole/drivers/odbc/ODBCCachedResultSet.php
   trunk/vendor/creole/drivers/odbc/ODBCConnection.php
   trunk/vendor/creole/drivers/odbc/ODBCIdGenerator.php
   trunk/vendor/creole/drivers/odbc/ODBCPreparedStatement.php
   trunk/vendor/creole/drivers/odbc/ODBCResultSet.php
   trunk/vendor/creole/drivers/odbc/ODBCResultSetCommon.php
   trunk/vendor/creole/drivers/odbc/ODBCStatement.php
   trunk/vendor/creole/drivers/odbc/ODBCTypes.php
   trunk/vendor/creole/drivers/odbc/README
   trunk/vendor/creole/drivers/odbc/adapters/
   trunk/vendor/creole/drivers/odbc/adapters/CodeBaseAdapter.php
   trunk/vendor/creole/drivers/odbc/adapters/MySQLAdapter.php
   trunk/vendor/creole/drivers/odbc/adapters/ODBCAdapter.php
   trunk/vendor/creole/drivers/odbc/metadata/
   trunk/vendor/creole/drivers/odbc/metadata/ODBCDatabaseInfo.php
   trunk/vendor/creole/drivers/odbc/metadata/ODBCTableInfo.php
   trunk/vendor/creole/drivers/oracle/
   trunk/vendor/creole/drivers/oracle/OCI8Connection.php
   trunk/vendor/creole/drivers/oracle/OCI8IdGenerator.php
   trunk/vendor/creole/drivers/oracle/OCI8PreparedStatement.php
   trunk/vendor/creole/drivers/oracle/OCI8ResultSet.php
   trunk/vendor/creole/drivers/oracle/OCI8Statement.php
   trunk/vendor/creole/drivers/oracle/OCI8Types.php
   trunk/vendor/creole/drivers/oracle/metadata/
   trunk/vendor/creole/drivers/oracle/metadata/OCI8DatabaseInfo.php
   trunk/vendor/creole/drivers/oracle/metadata/OCI8TableInfo.php
   trunk/vendor/creole/drivers/pgsql/
   trunk/vendor/creole/drivers/pgsql/PgSQLConnection.php
   trunk/vendor/creole/drivers/pgsql/PgSQLIdGenerator.php
   trunk/vendor/creole/drivers/pgsql/PgSQLPreparedStatement.php
   trunk/vendor/creole/drivers/pgsql/PgSQLResultSet.php
   trunk/vendor/creole/drivers/pgsql/PgSQLResultSetIterator.php
   trunk/vendor/creole/drivers/pgsql/PgSQLStatement.php
   trunk/vendor/creole/drivers/pgsql/PgSQLTypes.php
   trunk/vendor/creole/drivers/pgsql/metadata/
   trunk/vendor/creole/drivers/pgsql/metadata/PgSQLDatabaseInfo.php
   trunk/vendor/creole/drivers/pgsql/metadata/PgSQLTableInfo.php
   trunk/vendor/creole/drivers/sqlite/
   trunk/vendor/creole/drivers/sqlite/SQLiteConnection.php
   trunk/vendor/creole/drivers/sqlite/SQLiteIdGenerator.php
   trunk/vendor/creole/drivers/sqlite/SQLitePreparedStatement.php
   trunk/vendor/creole/drivers/sqlite/SQLiteResultSet.php
   trunk/vendor/creole/drivers/sqlite/SQLiteResultSetIterator.php
   trunk/vendor/creole/drivers/sqlite/SQLiteStatement.php
   trunk/vendor/creole/drivers/sqlite/SQLiteTypes.php
   trunk/vendor/creole/drivers/sqlite/metadata/
   trunk/vendor/creole/drivers/sqlite/metadata/SQLiteDatabaseInfo.php
   trunk/vendor/creole/drivers/sqlite/metadata/SQLiteTableInfo.php
   trunk/vendor/creole/metadata/
   trunk/vendor/creole/metadata/ColumnInfo.php
   trunk/vendor/creole/metadata/DatabaseInfo.php
   trunk/vendor/creole/metadata/ForeignKeyInfo.php
   trunk/vendor/creole/metadata/IndexInfo.php
   trunk/vendor/creole/metadata/PrimaryKeyInfo.php
   trunk/vendor/creole/metadata/TableInfo.php
   trunk/vendor/creole/util/
   trunk/vendor/creole/util/Blob.php
   trunk/vendor/creole/util/Clob.php
   trunk/vendor/creole/util/Lob.php
   trunk/vendor/creole/util/sql/
   trunk/vendor/creole/util/sql/SQLStatementExtractor.php
Log:
 bundled creole

Added: trunk/vendor/creole/CallableStatement.php
===================================================================
--- trunk/vendor/creole/CallableStatement.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/CallableStatement.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,134 @@
+&lt;?php
+/*
+ *  $Id: CallableStatement.php,v 1.7 2004/03/20 04:16:49 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+require_once 'creole/PreparedStatement.php';
+
+/**
+ * Interface for callable statements.
+ *
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.7 $
+ * @package   creole
+ */
+interface CallableStatement extends PreparedStatement {
+                        
+    /**
+     * Register a parameter as an output param.
+     * @param string $paramIndex The stored procedure param name (e.g. @val1).
+     * @param int $sqlType The type of the parameter (e.g. Type::BIT) .
+     */
+    public function registerOutParameter($paramIndex, $sqlType);
+    
+    /**
+     * 
+     * @param mixed $paramIndex Parameter name (e.g. &quot;@var1&quot;).
+     * @return array
+     * @throws SQLException if $paramIndex was not bound as output variable.
+     */
+    public function getArray($paramIndex);
+    
+    /**
+     * 
+     * @param mixed $paramIndex Parameter name (e.g. &quot;@var1&quot;).
+     * @return boolean
+     * @throws SQLException if $paramIndex was not bound as output variable.
+     */
+    public function getBoolean($paramIndex);    
+            
+    /**
+     * 
+     * @param mixed $paramIndex Parameter name (e.g. &quot;@var1&quot;).
+     * @return Blob blob object
+     * @throws SQLException if $paramIndex was not bound as output variable.
+     */
+    public function getBlob($paramIndex);
+        
+    /**
+     * @param mixed $paramIndex Column name (string) or index (int).
+     * @return Clob clob object.
+     */
+    public function getClob($paramIndex);     
+    
+    /**
+     * Return a formatted date.
+     * 
+     * The default format for dates returned is preferred (in your locale, as specified using setlocale()) 
+     * format w/o time (i.e. strftime(&quot;%x&quot;, $val)).  Override this by specifying a format second parameter.  You
+     * can also specify a date()-style formatter; if you do, make sure there are no &quot;%&quot; symbols in your format string.
+     * 
+     * @param mixed $column Column name (string) or index (int) starting with 1 (if ResultSet::FETCHMODE_NUM was used).
+     * @param string $format Date formatter for use w/ strftime() or date() (it will choose based on examination of format string)
+     *                          If format is NULL, then the integer unix timestamp will be returned (no formatting performed).
+     * @return mixed  Formatted date, or integer unix timestamp (using 00:00:00 for time) if $format was null. 
+     * @throws SQLException - If the column specified is not a valid key in current field array.
+     */
+    public function getDate($column, $format = '%x');
+
+    /**
+     * @param mixed $paramIndex Column name (string) or index (int).
+     * @return float
+     */
+    public function getFloat($paramIndex);    
+
+    /**
+     * @param mixed $paramIndex Column name (string) or index (int).
+     * @return int
+     */
+    public function getInt($paramIndex);    
+
+    /**
+     * @param mixed $paramIndex Column name (string) or index (int).
+     * @return string
+     */
+    public function getString($paramIndex);        
+        
+    /**
+     * Return a formatted time.
+     * 
+     * The default format for times returned is preferred (in your locale, as specified using setlocale()) 
+     * format w/o date (i.e. strftime(&quot;%X&quot;, $val)).  Override this by specifying a format second parameter.  You
+     * can also specify a date()-style formatter; if you do, make sure there are no &quot;%&quot; symbols in your format string.
+     * 
+     * @param mixed $column Column name (string) or index (int) starting with 1 (if ResultSet::FETCHMODE_NUM was used).
+     * @param string $format Date formatter for use w/ strftime() or date() (it will choose based on examination of format string)
+     *                          If format is NULL, then the integer unix timestamp will be returned (no formatting performed).
+     * @return mixed  Formatted time, or integer unix timestamp (using today's date) if $format was null. 
+     * @throws SQLException - If the column specified is not a valid key in current field array.
+     */
+    public function getTime($column, $format = '%X');
+
+    /**
+     * Return a formatted timestamp.
+     * 
+     * The default format for timestamp is ISO standard YYYY-MM-DD HH:MM:SS (i.e. date('Y-m-d H:i:s', $val).
+     * Override this by specifying a format second parameter.  You can also specify a strftime()-style formatter.
+     * 
+     * Hint: if you want to get the unix timestamp use the &quot;U&quot; formatter string.
+     * 
+     * @param mixed $column Column name (string) or index (int) starting with 1 (if ResultSet::FETCHMODE_NUM was used).
+     * @param string $format Date formatter for use w/ strftime() or date() (it will choose based on examination of format string)
+     *                          If format is NULL, then the integer unix timestamp will be returned (no formatting performed).
+     * @return mixed Formatted timestamp, or integer unix timestamp (if $format was null)
+     * @throws SQLException - If the column specified is not a valid key in current field array.
+     */
+    public function getTimestamp($column, $format = 'Y-m-d H:i:s');
+
+}

Added: trunk/vendor/creole/Connection.php
===================================================================
--- trunk/vendor/creole/Connection.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/Connection.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,220 @@
+&lt;?php
+/*
+ *  $Id: Connection.php,v 1.29 2005/10/17 19:03:50 dlawson_mi Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+include_once 'creole/ResultSet.php'; // we need this for the fetchmode ResultSet flags (constants) that are passed to executeQuery()
+
+/**
+ * Connection is an abstract base class for DB dialect implementations, and must be
+ * inherited by all such.
+ * 
+ * Developer notes:
+ *  (1) Make sure that your Connection class can be serialized.  See the ConnectionCommon __sleep() and __wakeup() implimentation.
+ * 
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.29 $
+ * @package   creole
+ */
+interface Connection {
+
+    // Constants that define transaction isolation levels.
+    // [We don't have any code using these yet, so there's no need
+    // to initialize these values at this point.]
+    // const TRANSACTION_NONE = 0;
+    // const TRANSACTION_READ_UNCOMMITTED = 1;
+    // const TRANSACTION_READ_COMMITTED = 2;
+    // const TRANSACTION_REPEATABLE_READ = 3;
+    // const TRANSACTION_SERIALIZABLE = 4;
+    
+    /**
+     * Connect to a database and log in as the specified user.
+     *
+     * @param array $dsn The PEAR-style data source hash.
+     * @param int $flags (optional) Flags for connection (e.g. Creole::PERSISTENT).  These flags
+     *                   may apply to any of the driver classes.
+     */
+    public function connect($dsn, $flags = false);    
+    
+    /**
+     * Get the PHP native resource for the database connection/link.
+     * @return resource
+     */
+    public function getResource();
+        
+    /**
+     * Get any flags that were passed to connection.
+     * @return int
+     */
+    public function getFlags();        
+    
+    /**
+     * Get the DSN array used by connect() method to connect to database.
+     * @see connect()
+     * @return array
+     */
+    public function getDSN();      
+    
+    /**
+     * Gets a DatabaseInfo class for the current database.
+     *
+     * This is not modeled on the JDBC MetaData class, but provides a possibly more 
+     * useful metadata system.  All the same, there may eventually be a getMetaData()
+     * which returns a class that behaves like JDBC's DatabaseMetaData.
+     *
+     * @return DatabaseInfo
+     */
+    public function getDatabaseInfo();
+    
+    /**
+     * Loads and returns an IdGenerator object for current RDBMS.
+     * @return IdGenerator
+     */
+    public function getIdGenerator();
+    
+    /**
+     * Prepares a query for multiple execution with execute().
+     *
+     * With some database backends, this is emulated.
+     * prepare() requires a generic query as string like
+     * &quot;INSERT INTO numbers VALUES(?,?,?)&quot;. The ? are placeholders.
+        * 
+     * IMPORTANT:  All occurrences of the placeholder (?) will be assumed
+     * to be a parameter.  Therefore be sure not to have ? anywhere else in
+     * the query.
+     * 
+     * So, ... DO NOT MIX WILDCARDS WITH ALREADY-PREPARED QUERIES
+     *
+     * INCORRECT:
+     *     SELECT * FROM mytable WHERE id = ? AND title = 'Where are you?' and body LIKE ?
+     * 
+     * CORRECT:
+     *    SELECT * FROM mytable WHERE id = ? AND title = ? and body LIKE ?
+     * 
+     * @param string $sql The query to prepare.
+     * @return PreparedStatement
+     * @throws SQLException
+     * @see PreparedStatement::execute()
+     */
+    public function prepareStatement($sql);
+    
+    /**
+     * Creates a new empty Statement.
+     * @return Statement
+     */
+    public function createStatement();
+    
+    /**
+     * If RDBMS supports native LIMIT/OFFSET then query SQL is modified
+     * so that no emulation is performed in ResultSet.
+     * 
+     * @param string &amp;$sql The query that will be modified.
+     * @param int $offset
+     * @param int $limit
+     * @return void
+     * @throws SQLException - if unable to modify query for any reason.
+     */
+    public function applyLimit(&amp;$sql, $offset, $limit);
+    
+    /**
+     * Executes the SQL query in this PreparedStatement object and returns the resultset.
+     * 
+     * @param string $sql The SQL statement.
+     * @param int $fetchmode
+     * @return object ResultSet
+     * @throws SQLException if a database access error occurs.
+     */
+    public function executeQuery($sql, $fetchmode = null);
+
+    /**
+     * Executes the SQL INSERT, UPDATE, or DELETE statement.
+     * 
+     * @param string $sql This method may optionally be called with the SQL statement.
+     * @return int Number of affected rows (or 0 for drivers that return nothing).
+     * @throws SQLException if a database access error occurs.
+     */
+    public function executeUpdate($sql);
+    
+    /**
+     * Creates a CallableStatement object for calling database stored procedures.
+     * 
+     * @param string $sql
+     * @return CallableStatement
+     */
+    public function prepareCall($sql);
+    
+    /**
+     * Free the db resources.
+     * @return void
+     */
+    public function close();
+    
+    /**
+     * Returns false if connection is closed.
+     * @return boolean
+     */
+    public function isConnected();
+    
+    /**
+     * Get auto-commit status.
+     *
+     * @return boolean
+     */
+    public function getAutoCommit();
+    
+    /**
+     * Enable/disable automatic commits.
+     * 
+     * Pushes SQLWarning onto $warnings stack if the autocommit value is being changed mid-transaction. This function
+     * is overridden by driver classes so that they can perform the necessary begin/end transaction SQL.
+     * 
+     * If auto-commit is being set to TRUE, then the current transaction will be committed immediately.
+     * 
+     * @param boolean $bit New value for auto commit.
+     * @return void
+     */
+    public function setAutoCommit($bit);
+    
+    /**
+     * Begins a transaction (if supported).
+     *
+     */
+    public function begin();
+    
+    /**
+     * Commits statements in a transaction.
+     *
+     */
+    public function commit();
+    
+    /**
+     * Rollback changes in a transaction.
+     *
+     */
+    public function rollback();
+    
+    /**
+     * Gets the number of rows affected by the data manipulation
+     * query.
+     *
+     * @return int Number of rows affected by the last query.
+     */
+    public function getUpdateCount();
+
+}
\ No newline at end of file

Added: trunk/vendor/creole/Creole.php
===================================================================
--- trunk/vendor/creole/Creole.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/Creole.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,341 @@
+&lt;?php
+/*
+ *  $Id: Creole.php,v 1.12 2005/10/17 19:03:50 dlawson_mi Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+include_once 'creole/SQLException.php';
+include_once 'creole/Connection.php';
+
+// static:
+// track errors is used by drivers to get better error messages
+// make sure it's set.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">+ at ini_set</A>('track_errors', true);
+
+/**
+ * This is the class that manages the database drivers.
+ *
+ * There are a number of default drivers (at the time of writing this comment: MySQL, MSSQL, SQLite, PgSQL, Oracle)
+ * that are &quot;shipped&quot; with Creole.  You may wish to either add a new driver or swap out one of the existing drivers
+ * for your own custom driver.  To do this you simply need to register your driver using the registerDriver() method.
+ *
+ * Note that you register your Connection class because the Connection class is responsible for calling the other
+ * driver classes (e.g. ResultSet, PreparedStatement, etc.).
+ *
+ *
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.12 $
+ * @package   creole
+ */
+class Creole {
+
+    /**
+     * Constant that indicates a connection object should be used.
+     */
+    const PERSISTENT = 1;
+
+    /**
+     * Flag to pass to the connection to indicate that no case conversions
+     * should be performed by ResultSet on keys of fetched rows.
+     */
+    const NO_ASSOC_LOWER = 16;
+
+    /**
+     * Map of built-in drivers.
+     * Change or add your own using registerDriver()
+     * @see registerDriver()
+     * @var array Hash mapping phptype =&gt; driver class (in dot-path notation, e.g. 'mysql' =&gt; 'creole.drivers.mysql.MySQLConnection').
+     */
+    private static $driverMap = array(  'mysql' =&gt; 'creole.drivers.mysql.MySQLConnection',
+                                        'mysqli' =&gt; 'creole.drivers.mysqli.MySQLiConnection',
+                                        'pgsql' =&gt; 'creole.drivers.pgsql.PgSQLConnection',
+                                        'sqlite' =&gt; 'creole.drivers.sqlite.SQLiteConnection',
+                                        'oracle' =&gt; 'creole.drivers.oracle.OCI8Connection',
+                                        'mssql' =&gt; 'creole.drivers.mssql.MSSQLConnection',
+                                        'odbc' =&gt; 'creole.drivers.odbc.ODBCConnection'
+                                       );
+
+    /**
+     * Map of already established connections
+     * @see getConnection()
+     * @var array Hash mapping connection DSN =&gt; Connection instance
+     */
+    private static $connectionMap = array();
+
+    /**
+     * Register your own RDBMS driver class.
+     *
+     * You can use this to specify your own class that replaces a default driver or
+     * adds support for a new driver.  Register your own class by specifying the
+     * 'phptype' (e.g. mysql) and a dot-path notation to where your Connection class is
+     * relative to any location on the include path.  You can also specify '*' as the phptype
+     * if you want to register a driver that will handle any native type (e.g. if creating
+     * a set of decorator classes that log SQL before calling native driver methods).  YOU CAN
+     * ONLY REGISTER ONE CATCHALL ('*') DRIVER.
+     * &lt;p&gt;
+     * Note: the class you need to register is your Connection class because this is the
+     * class that's responsible for instantiating the other classes that are part of your
+     * driver.  It is possible to mix &amp; match drivers -- i.e. to write a custom driver where
+     * the Connection object just instantiates stock classes for ResultSet and PreparedStatement.
+     * Note that if you wanted to &quot;override&quot; only the ResultSet class you would also have to override
+     * the Connection and PreparedStatement classes so that they would return the correct ResultSet
+     * class.  In the future we may implement a more &quot;packaged&quot; approach to drivers; for now we
+     * want to keep it simple.
+     *
+     * @param string $phptype   The phptype (mysql, mssql, etc.). This is first part of DSN URL (e.g. <A HREF="mysql://localhost/...">mysql://localhost/...</A>).
+     *                          You may also specify '*' to register a driver that will &quot;wrap&quot; the any native drivers.
+     * @param string $dotpath   A dot-path locating your class.  For example 'creole.drivers.mssql.MSSQLConnection'
+     *                          will be included like: include 'creole/drivers/mssql/MSSQLConnection.php' and the
+     *                          classname will be assumed to be 'MSSQLConnection'.
+     * @return void
+     */
+    public static function registerDriver($phptype, $dotpath)
+    {
+        self::$driverMap[$phptype] = $dotpath;
+    }
+
+    /**
+     * Removes the driver for a PHP type.  Note that this will remove user-registered
+     * drivers _and_ the default drivers.
+     * @param string $phptype The PHP type for driver to de-register.
+     * @see registerDriver()
+     */
+    public static function deregisterDriver($phptype)
+    {
+        unset(self::$driverMap[$phptype]);
+    }
+
+    /**
+     * Returns the class path to the driver registered for specified type.
+     * @param string $phptype The phptype handled by driver (e.g. 'mysql', 'mssql', '*').
+     * @return string The driver class in dot-path notation (e.g. creole.drivers.mssql.MSSQLConnection)
+     *                  or NULL if no registered driver found.
+     */
+    public static function getDriver($phptype)
+    {
+        if (isset(self::$driverMap[$phptype])) {
+            return self::$driverMap[$phptype];
+        } else {
+            return null;
+        }
+    }
+
+    /**
+     * Create a new DB connection object and connect to the specified
+     * database
+     *
+     * @param mixed $dsn &quot;data source name&quot;, see the self::parseDSN
+     * method for a description of the dsn format.  Can also be
+     * specified as an array of the format returned by DB::parseDSN().
+
+     * @param int $flags Connection flags (e.g. PERSISTENT).
+     *
+     * @return Connection Newly created DB connection object
+     * @throws SQLException
+     * @see self::parseDSN()
+     */
+    public static function getConnection($dsn, $flags = 0)
+    {
+        if (is_array($dsn)) {
+            $dsninfo = $dsn;
+        } else {
+            $dsninfo = self::parseDSN($dsn);
+        }
+
+        // sort $dsninfo by keys so the serialized result is always the same
+        // for identical connection parameters, no matter what their order is
+        ksort($dsninfo);
+        $connectionMapKey = crc32(serialize($dsninfo + array('no_assoc_lower' =&gt; ($flags &amp; Creole::NO_ASSOC_LOWER) === Creole::NO_ASSOC_LOWER)));
+
+        // see if we already have a connection with these parameters cached
+        if(isset(self::$connectionMap[$connectionMapKey]))
+        {
+            // persistent connections will be used if a non-persistent one was requested and is available
+            // but a persistent connection will be created if a non-persistent one is present
+
+	    // TODO: impliment auto close of non persistent and replacing the
+	    // non persistent with the persistent object so as we dont have
+	    // both links open for no reason
+
+            if( isset(self::$connectionMap[$connectionMapKey][1]) ) { // is persistent
+                // a persistent connection with these parameters is already there,
+                // so we return it, no matter what was specified as persistent flag
+                $con = self::$connectionMap[$connectionMapKey][1];
+            } else {
+                // we don't have a persistent connection, and since the persistent
+                // flag wasn't set either, we just return the non-persistent connection
+                $con = self::$connectionMap[$connectionMapKey][0];
+            }
+
+            // if we're here, a non-persistent connection was already there, but
+            // the user wants a persistent one, so it will be created
+            
+            if ($con-&gt;isConnected())
+                return $con;            
+        }
+
+        // support &quot;catchall&quot; drivers which will themselves handle the details of connecting
+        // using the proper RDBMS driver.
+        if (isset(self::$driverMap['*'])) {
+            $type = '*';
+        } else {
+            $type = $dsninfo['phptype'];
+            if (!isset(self::$driverMap[$type])) {
+                throw new SQLException(&quot;No driver has been registered to handle connection type: $type&quot;);
+            }
+        }
+
+        // may need to make this more complex if we add support
+        // for 'dbsyntax'
+        $clazz = self::import(self::$driverMap[$type]);
+        $obj = new $clazz();
+
+        if (!($obj instanceof Connection)) {
+            throw new SQLException(&quot;Class does not implement creole.Connection interface: $clazz&quot;);
+        }
+
+        try {
+            $obj-&gt;connect($dsninfo, $flags);
+        } catch(SQLException $sqle) {
+            $sqle-&gt;setUserInfo($dsninfo);
+            throw $sqle;
+        }
+	$persistent = ($flags &amp; Creole::PERSISTENT) === Creole::PERSISTENT;
+        return self::$connectionMap[$connectionMapKey][(int)$persistent] = $obj;
+    }
+
+    /**
+     * Parse a data source name.
+     *
+     * This isn't quite as powerful as DB::parseDSN(); it's also a lot simpler, a lot faster,
+     * and many fewer lines of code.
+     *
+     * A array with the following keys will be returned:
+     *  phptype: Database backend used in PHP (mysql, odbc etc.)
+     *  protocol: Communication protocol to use (tcp, unix etc.)
+     *  hostspec: Host specification (hostname[:port])
+     *  database: Database to use on the DBMS server
+     *  username: User name for login
+     *  password: Password for login
+     *
+     * The format of the supplied DSN is in its fullest form:
+     *
+     *  <A HREF="phptype://username:password@protocol+hostspec/database">phptype://username:password@protocol+hostspec/database</A>
+     *
+     * Most variations are allowed:
+     *
+     *  <A HREF="phptype://username:password@protocol+hostspec:110//usr/db_file.db">phptype://username:password@protocol+hostspec:110//usr/db_file.db</A>
+     *  <A HREF="phptype://username:password@hostspec/database_name">phptype://username:password@hostspec/database_name</A>
+     *  <A HREF="phptype://username:password@hostspec">phptype://username:password@hostspec</A>
+     *  <A HREF="phptype://username@hostspec">phptype://username@hostspec</A>
+     *  <A HREF="phptype://hostspec/database">phptype://hostspec/database</A>
+     *  <A HREF="phptype://hostspec">phptype://hostspec</A>
+     *  phptype
+     *
+     * @param string $dsn Data Source Name to be parsed
+     * @return array An associative array
+     */
+    public static function parseDSN($dsn)
+    {
+        if (is_array($dsn)) {
+            return $dsn;
+        }
+
+        $parsed = array(
+            'phptype'  =&gt; null,
+            'username' =&gt; null,
+            'password' =&gt; null,
+            'protocol' =&gt; null,
+            'hostspec' =&gt; null,
+            'port'     =&gt; null,
+            'socket'   =&gt; null,
+            'database' =&gt; null
+        );
+
+        $info = parse_url($dsn);
+
+        if (count($info) === 1) { // if there's only one element in result, then it must be the phptype
+            $parsed['phptype'] = array_pop($info);
+            return $parsed;
+        }
+
+        // some values can be copied directly
+        $parsed['phptype'] = @$info['scheme'];
+        $parsed['username'] = @$info['user'];
+        $parsed['password'] = @$info['pass'];
+        $parsed['port'] = @$info['port'];
+
+        $host = @$info['host'];
+        if (false !== ($pluspos = strpos($host, '+'))) {
+            $parsed['protocol'] = substr($host,0,$pluspos);
+            if ($parsed['protocol'] === 'unix') {
+                $parsed['socket'] = substr($host,$pluspos+1);
+            } else {
+                $parsed['hostspec'] = substr($host,$pluspos+1);
+            }
+        } else {
+            $parsed['hostspec'] = $host;
+        }
+
+        if (isset($info['path'])) {
+            $parsed['database'] = substr($info['path'], 1); // remove first char, which is '/'
+        }
+
+        if (isset($info['query'])) {
+                $opts = explode('&amp;', $info['query']);
+                foreach ($opts as $opt) {
+                    list($key, $value) = explode('=', $opt);
+                    if (!isset($parsed[$key])) { // don't allow params overwrite
+                        $parsed[$key] = urldecode($value);
+                    }
+                }
+        }
+
+        return $parsed;
+    }
+
+    /**
+     * Include once a file specified in DOT notation.
+     * Package notation is expected to be relative to a location
+     * on the PHP include_path.
+     * @param string $class
+     * @return string unqualified classname
+     * @throws SQLException - if class does not exist and cannot load file
+     *                      - if after loading file class still does not exist
+     */
+    public static function import($class) {
+        if (!class_exists($class, false)) {
+            $path = strtr($class, '.', DIRECTORY_SEPARATOR) . '.php';
+            $ret = include_once($path);
+            if ($ret === false) {
+                throw new SQLException(&quot;Unable to load driver class: &quot; . $class);
+            }
+            // get just classname ('path.to.ClassName' -&gt; 'ClassName')
+            $pos = strrpos($class, '.');
+            if ($pos !== false) {
+                $class = substr($class, $pos + 1);
+            }
+            if (!class_exists($class)) {
+                throw new SQLException(&quot;Unable to find loaded class: $class (Hint: make sure classname matches filename)&quot;);
+            }
+        }
+        return $class;
+    }
+
+}

Added: trunk/vendor/creole/CreoleTypes.php
===================================================================
--- trunk/vendor/creole/CreoleTypes.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/CreoleTypes.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,184 @@
+&lt;?php
+/*
+ *  $Id: CreoleTypes.php,v 1.17 2005/09/28 13:18:19 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+/**
+ * Generic Creole types modeled on JDBC types.
+ * 
+ * @author    David Giffin &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">david at giffin.org</A>&gt;
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.17 $
+ * @package   creole
+ */
+abstract class CreoleTypes {
+
+        const BOOLEAN = 1;
+        const BIGINT = 2;
+        const SMALLINT = 3;
+        const TINYINT = 4;
+        const INTEGER = 5;
+        const CHAR = 6;
+        const VARCHAR = 7;
+        const TEXT = 17;
+        const FLOAT = 8;
+        const DOUBLE = 9;
+        const DATE = 10;
+        const TIME = 11;
+        const TIMESTAMP = 12;
+        const VARBINARY = 13;
+        const NUMERIC = 14;
+        const BLOB = 15;
+        const CLOB = 16;
+        const LONGVARCHAR = 17;
+        const DECIMAL = 18;
+        const REAL = 19;
+        const BINARY = 20;
+        const LONGVARBINARY = 21;
+        const YEAR = 22;
+        
+        /** this is &quot;ARRAY&quot; from JDBC types */
+        const ARR = 23;
+        
+        const OTHER = -1;
+        
+        /** Map of Creole type integers to the setter/getter affix. */
+        protected static $affixMap = array(
+                self::BOOLEAN =&gt; 'Boolean',
+                self::BIGINT =&gt; 'String',
+                self::CHAR =&gt; 'String',
+                self::DATE =&gt; 'Date',
+                self::DOUBLE =&gt; 'Float',
+                self::FLOAT =&gt; 'Float',
+                self::INTEGER =&gt; 'Int',
+                self::SMALLINT =&gt; 'Int',
+                self::TINYINT =&gt; 'Int',
+                self::TIME =&gt; 'Time',
+                self::TIMESTAMP =&gt; 'Timestamp',
+                self::VARCHAR =&gt; 'String',                
+                self::VARBINARY =&gt; 'Blob',
+                self::NUMERIC =&gt; 'Float',
+                self::BLOB =&gt; 'Blob',
+                self::CLOB =&gt; 'Clob',
+                self::LONGVARCHAR =&gt; 'String',
+                self::DECIMAL =&gt; 'Float',
+                self::REAL =&gt; 'Float',
+                self::BINARY =&gt; 'Blob',
+                self::LONGVARBINARY =&gt; 'Blob',
+                self::YEAR =&gt; 'Int',
+                self::ARR =&gt; 'Array',
+                self::OTHER =&gt; '', // get() and set() for unknown
+                );
+        
+        /** Map of Creole type integers to their textual name. */
+        protected static $creoleTypeMap = array(
+                self::BOOLEAN =&gt; 'BOOLEAN',
+                self::BIGINT =&gt; 'BIGINT',
+                self::SMALLINT =&gt; 'SMALLINT',
+                self::TINYINT =&gt; 'TINYINT',
+                self::INTEGER =&gt; 'INTEGER',
+                self::NUMERIC =&gt; 'NUMERIC',
+                self::DECIMAL =&gt; 'DECIMAL',
+                self::REAL =&gt; 'REAL',
+                self::FLOAT =&gt; 'FLOAT',
+                self::DOUBLE =&gt; 'DOUBLE',
+                self::CHAR =&gt; 'CHAR',
+                self::VARCHAR =&gt; 'VARCHAR',
+                self::TEXT =&gt; 'TEXT',
+                self::TIME =&gt; 'TIME',
+                self::TIMESTAMP =&gt; 'TIMESTAMP',
+                self::DATE =&gt; 'DATE',
+                self::YEAR =&gt; 'YEAR',
+                self::VARBINARY =&gt; 'VARBINARY',                
+                self::BLOB =&gt; 'BLOB',
+                self::CLOB =&gt; 'CLOB',
+                self::LONGVARCHAR =&gt; 'LONGVARCHAR',
+                self::BINARY =&gt; 'BINARY',
+                self::LONGVARBINARY =&gt; 'LONGVARBINARY',                
+                self::ARR =&gt; 'ARR',
+                self::OTHER =&gt; 'OTHER', // string is &quot;raw&quot; return
+                );
+        
+        /**
+         * This method returns the generic Creole (JDBC-like) type
+         * when given the native db type.
+         * @param string $nativeType DB native type (e.g. 'TEXT', 'byetea', etc.).
+         * @return int Creole native type (e.g. Types::LONGVARCHAR, Types::BINARY, etc.).
+         */
+        abstract static function getType($nativeType);
+        
+        /**
+         * This method will return a native type that corresponds to the specified
+         * Creole (JDBC-like) type.
+         * If there is more than one matching native type, then the LAST defined 
+         * native type will be returned.
+         * @return string Native type string.
+         */
+        abstract static function getNativeType($creoleType);
+        
+        /**
+         * Gets the &quot;affix&quot; to use for ResultSet::get*() and PreparedStatement::set*() methods.
+         * &lt;code&gt;
+         * $setter = 'set' . CreoleTypes::getAffix(CreoleTypes::INTEGER);
+         * $stmt-&gt;$setter(1, $intval);
+         * // or
+         * $getter = 'get' . CreoleTypes::getAffix(CreoleTypes::TIMESTAMP);
+         * $timestamp = $rs-&gt;$getter();
+         * &lt;/code&gt;
+         * @param int $creoleType The Creole types.
+         * @return string The default affix for getting/setting cols of this type.
+         * @throws SQLException if $creoleType does not correspond to an affix
+         */
+        public static function getAffix($creoleType)
+        {
+            if (!isset(self::$affixMap[$creoleType])) {
+                $e = new SQLException(&quot;Unable to return 'affix' for unknown CreoleType: &quot; . $creoleType);
+                print $e;
+                throw $e;
+            }
+            return self::$affixMap[$creoleType];
+        }
+        
+        /**
+         * Given the integer type, this method will return the corresponding type name.
+         * @param int $creoleType the integer Creole type.
+         * @return string The name of the Creole type (e.g. 'VARCHAR').
+         */
+        public static function getCreoleName($creoleType)
+        {
+            if (!isset(self::$creoleTypeMap[$creoleType])) {
+                return null;
+            }
+            return self::$creoleTypeMap[$creoleType];
+        }
+        
+        /**
+         * Given the name of a type (e.g. 'VARCHAR') this method will return the corresponding integer.
+         * @param string $creoleTypeName The case-sensisive (must be uppercase) name of the Creole type (e.g. 'VARCHAR').
+         * @return int the Creole type.
+         */
+        public static function getCreoleCode($creoleTypeName)
+        {
+            $type = array_search($creoleTypeName, self::$creoleTypeMap);
+            if ($type === false) {
+               return null;
+            }
+            return $type;
+        }
+}

Added: trunk/vendor/creole/IdGenerator.php
===================================================================
--- trunk/vendor/creole/IdGenerator.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/IdGenerator.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,57 @@
+&lt;?php
+
+/**
+ * Interface for classes that provide functionality to get SEQUENCE or AUTO-INCREMENT ids from the database.
+ *
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.3 $
+ * @package   creole
+ */
+interface IdGenerator {
+    
+    /** SEQUENCE id generator type */
+    const SEQUENCE = 1;
+    
+    /** AUTO INCREMENT id generator type */
+    const AUTOINCREMENT = 2;                
+    
+    /**
+     * Convenience method that returns TRUE if id is generated
+     * before an INSERT statement.  This is the same as checking
+     * whether the generator type is SEQUENCE.
+     * @return boolean TRUE if gen id method is SEQUENCE
+     * @see getIdMethod()
+     */
+    public function isBeforeInsert();
+    
+    /**
+     * Convenience method that returns TRUE if id is generated
+     * after an INSERT statement.  This is the same as checking
+     * whether the generator type is AUTOINCREMENT.
+     * @return boolean TRUE if gen id method is AUTOINCREMENT
+     * @see getIdMethod()
+     */
+    public function isAfterInsert();
+    
+    /**
+     * Get the preferred type / style for generating ids for RDBMS.
+     * @return int SEQUENCE or AUTOINCREMENT
+     */
+    public function getIdMethod();
+    
+    /**
+     * Get the autoincrement or sequence id given the current connection
+     * and any additional needed info (e.g. sequence name for sequences).
+     * &lt;p&gt;
+     * Note: if you take advantage of the fact that $keyInfo may not be specified
+     * you should make sure that your code is setup in such a way that it will
+     * be portable if you change from an RDBMS that uses AUTOINCREMENT to one that
+     * uses SEQUENCE (i.e. in which case you would need to specify sequence name).
+     * 
+     * @param mixed $keyInfo Any additional information (e.g. sequence name) needed to fetch the id.
+     * @return int The last id / next id.
+     */
+    public function getId($keyInfo = null);
+    
+}
+

Added: trunk/vendor/creole/PreparedStatement.php
===================================================================
--- trunk/vendor/creole/PreparedStatement.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/PreparedStatement.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,253 @@
+&lt;?php
+/*
+ *  $Id: PreparedStatement.php,v 1.21 2005/03/29 16:56:09 gamr Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+/**
+ * Interface for a pre-compiled SQL statement.
+ * 
+ * Many drivers do not take advantage of pre-compiling SQL statements; for these
+ * cases the precompilation is emulated.  This emulation comes with slight penalty involved
+ * in parsing the queries, but provides other benefits such as a cleaner object model and ability
+ * to work with BLOB and CLOB values w/o needing special LOB-specific routines.
+ * 
+ * This class is abstract because there are driver-specific implementations in [clearly] how queries
+ * are executed, and how parameters are bound.
+ * 
+ * This class is not as abstract as the JDBC version.  For exmple, if you are using a driver
+ * that uses name-based query param substitution, then you'd better bind your variables to
+ * names rather than index numbers.  e.g. in Oracle
+ * &lt;code&gt;
+ *            $stmt = $conn-&gt;prepareStatement(&quot;INSERT INTO users (name, passwd) VALUES (:name, :pass)&quot;);
+ *            $stmt-&gt;setString(&quot;:name&quot;, $name);
+ *            $stmt-&gt;executeUpdate();            
+ * &lt;/code&gt;
+ * 
+ * Developer note:  In many ways this interface is an extension of the Statement interface.  However, due 
+ * to limitations in PHP5's interface extension model (specifically that you cannot change signatures on
+ * methods defined in parent interface), we cannot extend the Statement interface.
+ *
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.21 $
+ * @package   creole
+ */
+interface PreparedStatement {
+     
+    /**
+     * Gets the db Connection that created this statement.
+     * @return Connection
+     */
+    public function getConnection();    
+
+    /**
+     * Get the PHP native resource for the statement (if supported).
+     * @return resource
+     */
+    public function getResource();
+        
+    /**
+     * Free resources associated with this statement.
+     * Some drivers will need to implement this method to free
+     * database result resources. 
+     * 
+     * @return void
+     */
+    public function close();
+    
+    /**
+     * Get result set.
+     * This assumes that the last thing done was an executeQuery() or an execute()
+     * with SELECT-type query.
+     *
+     * @return RestultSet Last ResultSet or &lt;code&gt;null&lt;/code&gt; if not applicable.
+     */
+    public function getResultSet();
+    
+    /**
+     * Gets next result set (if this behavior is supported by driver).
+     * Some drivers (e.g. MSSQL) support returning multiple result sets -- e.g.
+     * from stored procedures.
+     *
+     * This function also closes any current restult set.
+     *
+     * Default behavior is for this function to return false.  Driver-specific
+     * implementations of this class can override this method if they actually
+     * support multiple result sets.
+     * 
+     * @return boolean True if there is another result set, otherwise false.
+     */
+    public function getMoreResults();
+    
+    /**
+     * Get update count.
+     *
+     * @return int Number of records affected, or &lt;code&gt;null&lt;/code&gt; if not applicable.
+     */
+    public function getUpdateCount();
+
+    /**
+     * Sets the maximum number of rows to return from db.
+     * This will affect the SQL if the RDBMS supports native LIMIT; if not,
+     * it will be emulated.  Limit only applies to queries (not update sql).
+     * @param int $v Maximum number of rows or 0 for all rows.
+     * @return void
+     */
+    public function setLimit($v);
+    
+    /**
+     * Returns the maximum number of rows to return or 0 for all.
+     * @return int
+     */
+    public function getLimit();
+    
+    /**
+     * Sets the start row.
+     * This will affect the SQL if the RDBMS supports native OFFSET; if not,
+     * it will be emulated. Offset only applies to queries (not update) and 
+     * only is evaluated when LIMIT is set!
+     * @param int $v
+     * @return void
+     */ 
+    public function setOffset($v);
+    
+    /**
+     * Returns the start row.
+     * Offset only applies when Limit is set!
+     * @return int
+     */
+    public function getOffset();
+    
+    /**
+     * Executes the SQL query in this PreparedStatement object and returns the resultset generated by the query.
+     * We support two signatures for this method:
+     * - $stmt-&gt;executeQuery(ResultSet::FETCHMODE_NUM);
+     * - $stmt-&gt;executeQuery(array($param1, $param2), ResultSet::FETCHMODE_NUM);
+     * @param mixed $p1 Either (array) Parameters that will be set using PreparedStatement::set() before query is executed or (int) fetchmode.
+     * @param int $fetchmode The mode to use when fetching the results (e.g. ResultSet::FETCHMODE_NUM, ResultSet::FETCHMODE_ASSOC).
+     * @return ResultSet
+     * @throws SQLException if a database access error occurs.
+     */
+    public function executeQuery();
+    
+    /**
+     * Executes the SQL INSERT, UPDATE, or DELETE statement in this PreparedStatement object.
+     * 
+     * @param array $params Parameters that will be set using PreparedStatement::set() before query is executed.
+     * @return int Number of affected rows (or 0 for drivers that return nothing).
+     * @throws SQLException if a database access error occurs.
+     */
+    public function executeUpdate($params = null);
+
+    /**
+     * A generic set method.
+     * 
+     * You can use this if you don't want to concern yourself with the details.  It involves
+     * slightly more overhead than the specific settesr, since it grabs the PHP type to determine
+     * which method makes most sense.
+     * 
+     * @param int $paramIndex
+     * @param mixed $value
+     * @return void
+     * @throws SQLException
+     */
+    public function set($paramIndex, $value);
+    
+    /**
+     * Sets an array.
+     * Unless a driver-specific method is used, this means simply serializing
+     * the passed parameter and storing it as a string.
+     * @param int $paramIndex
+     * @param array $value
+     * @return void
+     */
+    public function setArray($paramIndex, $value);
+
+    /**
+     * Sets a boolean value.
+     * Default behavior is true = 1, false = 0.
+     * @param int $paramIndex
+     * @param boolean $value
+     * @return void
+     */
+    public function setBoolean($paramIndex, $value);
+    
+
+    /**
+     * @param int $paramIndex
+     * @param mixed $blob Blob object or string containing data.
+     * @return void
+     */
+    public function setBlob($paramIndex, $blob);
+
+    /**
+     * @param int $paramIndex
+     * @param mixed $clob Clob object  or string containing data.
+     * @return void
+     */
+    public function setClob($paramIndex, $clob);
+
+    /**
+     * @param int $paramIndex
+     * @param string $value
+     * @return void
+     */
+    public function setDate($paramIndex, $value);
+        
+    /**
+     * @param int $paramIndex
+     * @param float $value
+     * @return void
+     */
+    public function setFloat($paramIndex, $value);
+
+    /**
+     * @param int $paramIndex
+     * @param int $value
+     * @return void
+     */
+    public function setInt($paramIndex, $value);
+
+    /**
+     * @param int $paramIndex
+     * @return void
+     */
+    public function setNull($paramIndex);
+
+    /**
+     * @param int $paramIndex
+     * @param string $value
+     * @return void
+     */
+    public function setString($paramIndex, $value);
+    
+    /**
+     * @param int $paramIndex
+     * @param string $value
+     * @return void
+     */
+    public function setTime($paramIndex, $value);
+    
+    /**
+     * @param int $paramIndex
+     * @param string $value
+     * @return void
+     */
+    public function setTimestamp($paramIndex, $value);
+            
+}

Added: trunk/vendor/creole/ResultSet.php
===================================================================
--- trunk/vendor/creole/ResultSet.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/ResultSet.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,381 @@
+&lt;?php
+/*
+ *  $Id: ResultSet.php,v 1.27 2004/03/11 15:38:38 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+/**
+ * This is the interface for classes the wrap db results.
+ * 
+ * The get*() methods in this interface will format values before returning them. Note
+ * that if they will return null if the database returned NULL.  If the requested column does
+ * not exist than an exception (SQLException) will be thrown.
+ * 
+ * &lt;code&gt;
+ * $rs = $conn-&gt;executeQuery(&quot;SELECT MAX(stamp) FROM event&quot;, ResultSet::FETCHMODE_NUM);
+ * $rs-&gt;next();
+ * 
+ * $max_stamp = $rs-&gt;getTimestamp(1, &quot;d/m/Y H:i:s&quot;);
+ * // $max_stamp will be date string or null if no MAX(stamp) was found
+ * 
+ * $max_stamp = $rs-&gt;getTimestamp(&quot;max(stamp)&quot;, &quot;d/m/Y H:i:s&quot;);
+ * // will THROW EXCEPTION, because the resultset was fetched using numeric indexing
+ * // SQLException: Invalid resultset column: max(stamp)
+ * &lt;/code&gt;
+ * 
+ * This class implements SPL IteratorAggregate, so you may iterate over the database results
+ * using foreach():
+ * &lt;code&gt;
+ * foreach($rs as $row) {
+ *   print_r($row); // row is assoc array returned by getRow()
+ * }
+ * &lt;/code&gt;
+ * 
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.27 $
+ * @package   creole
+ */
+interface ResultSet extends IteratorAggregate {
+        
+    /**
+     * Index result set by field name.
+     */
+    const FETCHMODE_ASSOC = 1;
+
+    /**
+     * Index result set numerically.
+     */
+    const FETCHMODE_NUM = 2;
+    
+    /**
+     * Get the PHP native resource for the result.
+     * Arguably this should not be part of the interface: i.e. every driver should implement
+     * it if they have a result resource, but conceivably drivers could be created that do
+     * not.  For now every single driver does have a &quot;dblink&quot; resource property, and other
+     * classes (e.g. ResultSet) need this info in order to get correct native errors.  We'll
+     * leave it in for now, as it helps with driver development, with the caveat that it 
+     * could be removed from the interface at a later point.
+     * @return resource Query result or NULL if not not applicable.
+     */
+    public function getResource();
+        
+    /**
+     * Sets the fetchmode used to retrieve results.
+     * Changing fetchmodes mid-result retrieval is supported (haven't encountered any drivers 
+     * that don't support that yet).
+     * @param int $mode ResultSet::FETCHMODE_NUM or  ResultSet::FETCHMODE_ASSOC (default).
+     * @return void
+     */
+    public function setFetchmode($mode);
+    
+    /**
+     * Gets the fetchmode used to retrieve results.
+     * @return int ResultSet::FETCHMODE_NUM or ResultSet::FETCHMODE_ASSOC (default).
+     */
+    public function getFetchmode();       
+    
+    /**
+     * Whether assoc result keys get left alone -- as opposed to converted to lowercase.
+     * If the case change stuff goes back to being more complicated (allowing conver to upper,
+     * e.g.) then we'll add new methods but this method will always indicate whether any
+     * case conversions should be (or have been) performed at all.
+     * This defaults to true unless Creole::NO_ASSOC_LOWER flag has been passed to connection.
+     * This property is read-only since it must be set when connection is created.  The
+     * reason for this behavior is some drivers (e.g. SQLite) do the case conversions internally
+     * based on a PHP ini value; it would not be possible to change the behavior from the ResultSet
+     * (since query has already been executed).
+     * @return boolean
+     */
+    public function isIgnoreAssocCase();
+        
+    /**
+     * Moves the internal cursor to the next position and fetches the row at that position.
+     * 
+     * @return boolean &lt;tt&gt;true&lt;/tt&gt; if success, &lt;tt&gt;false&lt;/tt&gt; if no next record.
+     * @throws SQLException on any driver-level errors.
+     */
+    public function next();
+
+    /**
+     * Moves the internal cursor to the previous position and fetches the
+     * row at that position.
+     * 
+     * @return boolean &lt;tt&gt;true&lt;/tt&gt; if success, &lt;tt&gt;false&lt;/tt&gt; if no previous record.
+     * @throws SQLException - if unable to move to previous position
+     *                      - if ResultSet doesn't support reverse scrolling
+     */
+    public function previous();
+
+    /**
+     * Moves the cursor a relative number of rows, either positive or negative and fetches
+     * the row at that position.
+     * 
+     * Attempting to move beyond the first/last row in the result set positions the cursor before/after 
+     * the first/last row and issues a Warning. Calling relative(0) is valid, but does not change the cursor 
+     * position. 
+     * 
+     * @param integer $offset
+     * @return boolean &lt;tt&gt;true&lt;/tt&gt; if cursor is on a row, &lt;tt&gt;false&lt;/tt&gt; otherwise.
+     * @throws SQLException - if unable to move to relative position
+     *                      - if rel pos is negative &amp; ResultSet doesn't support reverse scrolling
+     */
+    public function relative($offset);
+
+
+    /**
+     * Moves the cursor to an absolute cursor position and fetches the row at that position.
+     * 
+     * Attempting to move beyond the first/last row in the result set positions the cursor before/after 
+     * the first/last row and issues a Warning.
+     * 
+     * @param integer $pos cursor position, first position is 1.
+     * @return boolean &lt;tt&gt;true&lt;/tt&gt; if cursor is on a row, &lt;tt&gt;false&lt;/tt&gt; otherwise.
+     * @throws SQLException - if unable to move to absolute position
+     *                      - if position is before current pos &amp; ResultSet doesn't support reverse scrolling
+     */
+    public function absolute($pos);
+
+    /**
+     * Moves cursor position WITHOUT FETCHING ROW AT THAT POSITION.
+     * 
+     * Generally this method is for internal driver stuff (e.g. other methods like
+     * absolute() or relative() might call this and then call next() to get the row).
+     * This method is public to facilitate more advanced ResultSet scrolling tools
+     * -- e.g. cleaner implimentation of ResultSetIterator.
+     * 
+     * Some drivers will emulate seek() and not allow reverse seek (Oracle).
+     * 
+     * Seek is 0-based, but seek() is only for moving to the space _before_ the record
+     * that you want to read.  I.e. if you seek(0) and then call next() you will have the 
+     * first row (i.e. same as calling first() or absolute(1)).
+     * 
+     * &lt;strong&gt;IMPORTANT:  You cannot rely on the return value of this method to know whether a given
+     * record exists for reading.  In some cases seek() will correctly return &lt;code&gt;false&lt;/code&gt; if
+     * the position doesn't exist, but in other drivers the seek is not performed until the
+     * record is fetched. You can check the return value of absolute() if you need to know
+     * whether a specific rec position is valid.&lt;/strong&gt;
+     * 
+     * @param int $rownum The cursor pos to seek to.
+     * @return boolean true on success, false if unable to seek to specified record.
+     * @throws SQLException if trying to seek backwards with a driver that doesn't
+     *                      support reverse-scrolling
+     */
+    public function seek($rownum);    
+    
+    /**
+     * Move cursor to beginning of recordset.
+     * @return boolean &lt;tt&gt;true&lt;/tt&gt; on success or &lt;tt&gt;false&lt;/tt&gt; if not found.
+     * @throws SQLException - if unable to move to first position
+     *                      - if not at first pos &amp; ResultSet doesn't support reverse scrolling
+     */
+    public function first();
+
+    /**
+     * Move cursor to end of recordset.
+     * @return boolean &lt;tt&gt;true&lt;/tt&gt; on success or &lt;tt&gt;false&lt;/tt&gt; if not found.
+     * @throws SQLException - if unable to move to last position
+     *                      - if unable to get num rows
+     */
+    public function last();
+    
+    /**
+     * Sets cursort to before first record. This does not actually seek(), but
+     * simply sets cursor pos to 0.
+     * This is useful for inserting a record before the first in the set, etc.
+     * @return void
+     */
+    public function beforeFirst();
+
+
+    /**
+     * Sets cursort to after the last record. This does not actually seek(), but
+     * simply sets the cursor pos  to last + 1.
+     * This [will be] useful for inserting a record after the last in the set,
+     * when/if Creole supports updateable ResultSets.
+     * @return void
+     */
+    public function afterLast();
+
+
+    /**
+     * Checks whether cursor is after the last record.
+     * @return boolean
+     * @throws SQLException on any driver-level error.
+     */
+    public function isAfterLast();
+
+    /**
+     * Checks whether cursor is before the first record.
+     * @return boolean
+     * @throws SQLException on any driver-level error.
+     */
+    public function isBeforeFirst();
+
+    /**
+     * Returns the current cursor position.
+     * Cursor positions start at 0, but as soon as first row is fetched
+     * cursor position is 1. (so first row is 1)
+     * @return int
+     */
+    public function getCursorPos();
+
+    /**
+     * Gets current fields (assoc array).
+     * @return array
+     */
+    public function getRow();
+
+    /**
+     * Get the number of rows in a result set.
+     * @return int the number of rows
+     * @throws SQLException - if unable to get a rowcount.
+     */
+    public function getRecordCount();
+            
+    /**
+     * Frees the resources allocated for this result set.
+     * Also empties any internal field array so that any calls to
+     * get() method on closed ResultSet will result in &quot;Invalid column&quot; SQLException.
+     * @return void
+     */
+    public function close();
+    
+    /**
+     * A generic get method returns unformatted (=string) value.
+     * This returns the raw results from the database.  Usually this will be a string, but some drivers
+     * also can return objects (lob descriptors, etc) in certain cases.
+     * @param mixed $column Column name (string) or index (int) starting with 1 (if ResultSet::FETCHMODE_NUM was used) (if ResultSet::FETCHMODE_NUM was used).
+     * @return mixed Usually expect a string.
+     * @throws SQLException - If the column specified is not a valid key in current field array.
+     */
+    public function get($column);
+    
+    /**
+     * Reads a column as an array.
+     * The value of the column is unserialized &amp; returned as an array.  The generic case of this function is 
+     * very PHP-specific.  Other drivers (e.g. Postgres) will format values into their native array format.
+     * @param mixed $column Column name (string) or index (int) starting with 1 (if ResultSet::FETCHMODE_NUM was used).
+     * @return array value or null if database returned null.
+     * @throws SQLException - If the column specified is not a valid key in current field array.
+     */
+    public function getArray($column);
+
+    /**
+     * Returns value translated to boolean.
+     * Default is to map 0 =&gt; false, 1 =&gt; true, but some database drivers may override this behavior.
+     * @param mixed $column Column name (string) or index (int) starting with 1 (if ResultSet::FETCHMODE_NUM was used).
+     * @return boolean value or null if database returned null.
+     * @throws SQLException - If the column specified is not a valid key in current field array.
+     */
+    public function getBoolean($column);
+            
+    /**
+     * Returns Blob with contents of column value.
+     * 
+     * @param mixed $column Column name (string) or index (int) starting with 1 (if ResultSet::FETCHMODE_NUM was used).
+     * @return Blob New Blob with data from column or null if database returned null.
+     * @throws SQLException - If the column specified is not a valid key in current field array.
+     */
+    public function getBlob($column);
+
+    /**
+     * Returns Clob with contents of column value.
+     * 
+     * @param mixed $column Column name (string) or index (int) starting with 1 (if ResultSet::FETCHMODE_NUM was used).
+     * @return Clob New Clob object with data from column or null if database returned null.
+     * @throws SQLException - If the column specified is not a valid key in current field array.
+     */
+    public function getClob($column);
+
+    /**
+     * Return a formatted date.
+     * 
+     * The default format for dates returned is preferred (in your locale, as specified using setlocale()) 
+     * format w/o time (i.e. strftime(&quot;%x&quot;, $val)).  Override this by specifying a format second parameter.  You
+     * can also specify a date()-style formatter; if you do, make sure there are no &quot;%&quot; symbols in your format string.
+     * 
+     * @param mixed $column Column name (string) or index (int) starting with 1 (if ResultSet::FETCHMODE_NUM was used).
+     * @param string $format Date formatter for use w/ strftime() or date() (it will choose based on examination of format string)
+     *                          If format is NULL, then the integer unix timestamp will be returned (no formatting performed).
+     * @return mixed  Formatted date, or integer unix timestamp (using 00:00:00 for time) if $format was null. 
+     * @throws SQLException - If the column specified is not a valid key in current field array.
+     */
+    public function getDate($column, $format = '%x');   
+
+    /**
+     * Returns value cast as a float (in PHP this is same as double).
+     * 
+     * @param mixed $column Column name (string) or index (int) starting with 1 (if ResultSet::FETCHMODE_NUM was used).
+     * @return float value or null if database returned null
+     * @throws SQLException - If the column specified is not a valid key in current field array.
+     */
+    public function getFloat($column);
+
+    /**
+     * Returns value cast as integer.
+     * 
+     * @param mixed $column Column name (string) or index (int) starting with 1 (if ResultSet::FETCHMODE_NUM was used).
+     * @return int value or null if database returned null
+     * @see getInteger()
+     * @throws SQLException - If the column specified is not a valid key in current field array.
+     */
+    public function getInt($column);      
+
+    /**
+     * Returns value cast as string.
+     * 
+     * @param mixed $column Column name (string) or index (int) starting with 1 (if ResultSet::FETCHMODE_NUM was used).
+     * @return string value or null if database returned null
+     * @see get()
+     * @throws SQLException - If the column specified is not a valid key in current field array.
+     */
+    public function getString($column);
+    
+    /**
+     * Return a formatted time.
+     * 
+     * The default format for times returned is preferred (in your locale, as specified using setlocale()) 
+     * format w/o date (i.e. strftime(&quot;%X&quot;, $val)).  Override this by specifying a format second parameter.  You
+     * can also specify a date()-style formatter; if you do, make sure there are no &quot;%&quot; symbols in your format string.
+     * 
+     * @param mixed $column Column name (string) or index (int) starting with 1 (if ResultSet::FETCHMODE_NUM was used).
+     * @param string $format Date formatter for use w/ strftime() or date() (it will choose based on examination of format string)
+     *                          If format is NULL, then the integer unix timestamp will be returned (no formatting performed).
+     * @return mixed  Formatted time, or integer unix timestamp (using today's date) if $format was null. 
+     * @throws SQLException - If the column specified is not a valid key in current field array.
+     */
+    public function getTime($column, $format = '%X');
+
+    /**
+     * Return a formatted timestamp.
+     * 
+     * The default format for timestamp is ISO standard YYYY-MM-DD HH:MM:SS (i.e. date('Y-m-d H:i:s', $val).
+     * Override this by specifying a format second parameter.  You can also specify a strftime()-style formatter.
+     * 
+     * Hint: if you want to get the unix timestamp use the &quot;U&quot; formatter string.
+     * 
+     * @param mixed $column Column name (string) or index (int) starting with 1 (if ResultSet::FETCHMODE_NUM was used).
+     * @param string $format Date formatter for use w/ strftime() or date() (it will choose based on examination of format string)
+     *                          If format is NULL, then the integer unix timestamp will be returned (no formatting performed).
+     * @return mixed Formatted timestamp, or integer unix timestamp (if $format was null)
+     * @throws SQLException - If the column specified is not a valid key in current field array.
+     */
+    public function getTimestamp($column, $format = 'Y-m-d H:i:s');
+    
+}
+

Added: trunk/vendor/creole/ResultSetIterator.php
===================================================================
--- trunk/vendor/creole/ResultSetIterator.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/ResultSetIterator.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,113 @@
+&lt;?php
+/*
+ *  $Id: ResultSetIterator.php,v 1.3 2004/03/15 17:47:45 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+/**
+ * Basic ResultSet Iterator.
+ * 
+ * This can be returned by your class's getIterator() method, but of course
+ * you can also implement your own (e.g. to get better performance, by using direct
+ * driver calls and avoiding other side-effects inherent in ResultSet scrolling
+ * functions -- e.g. beforeFirst() / afterLast(), etc.).
+ *
+ * Important: ResultSet iteration does rewind the resultset if it is not at the
+ * start.  Not all drivers support reverse scrolling, so this may result in an
+ * exception in some cases (Oracle).
+ * 
+ * Developer note:
+ * The implementation of this class is a little weird because it fetches the
+ * array _early_ in order to answer valid() w/o needing to know total num
+ * of fields.  Remember the way iterators work:
+ * &lt;code&gt;
+ * $it = $obj-&gt;getIterator();
+ * for($it-&gt;rewind(); $it-&gt;valid(); $it-&gt;next()) {
+ *  $key = $it-&gt;current();
+ *  $val = $it-&gt;key();
+ *  echo &quot;$key = $val\n&quot;;
+ * }
+ * unset($it);
+ * &lt;/code&gt;
+ * 
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.3 $
+ * @package   creole
+ */
+class ResultSetIterator implements Iterator {
+
+    private $rs;    
+    
+    /**
+     * Construct the iterator.
+     * @param ResultSet $rs
+     */
+    public function __construct(ResultSet $rs)
+    {
+        $this-&gt;rs = $rs;
+    }
+    
+    /**
+     * If not at start of resultset, this method will call seek(0).
+     * @see ResultSet::seek()
+     */
+    function rewind()
+    {
+        if (!$this-&gt;rs-&gt;isBeforeFirst()) {
+            $this-&gt;rs-&gt;seek(0);
+        }
+    }
+    
+    /**
+     * This method checks to see whether there are more results
+     * by advancing the cursor position.
+     * @see ResultSet::next()
+     */
+    function valid()
+    {
+        return $this-&gt;rs-&gt;next();
+    }
+    
+    /**
+     * Returns the cursor position.
+     * @return int
+     */
+    function key()
+    {
+        return $this-&gt;rs-&gt;getCursorPos();
+    }
+    
+    /**
+     * Returns the row (assoc array) at current cursor pos.
+     * @return array
+     */
+    function current()
+    {
+       return $this-&gt;rs-&gt;getRow();
+    }
+    
+    /**
+     * This method does not actually do anything since we have already advanced
+     * the cursor pos in valid().
+     * @see valid()
+     */
+    function next()
+    {
+    }
+
+}
\ No newline at end of file

Added: trunk/vendor/creole/SQLException.php
===================================================================
--- trunk/vendor/creole/SQLException.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/SQLException.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,105 @@
+&lt;?php
+/*
+ *  $Id: SQLException.php,v 1.10 2004/03/20 04:16:49 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+/**
+ * A class for handling database-related errors.
+ *
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.10 $
+ * @package   creole
+ */
+class SQLException extends Exception {
+    
+    /** Information that provides additional information for context of Exception (e.g. SQL statement or DSN). */
+    protected $userInfo;
+    
+    /** Native RDBMS error string */
+    protected $nativeError;
+    
+    /**
+     * Constructs a SQLException.
+     * @param string $msg Error message
+     * @param string $native Native DB error message.
+     * @param string $userinfo More info, e.g. the SQL statement or the connection string that caused the error.
+     */
+    public function __construct($msg, $native = null, $userinfo = null)
+    {
+        parent::__construct($msg);
+        if ($native !== null) {
+            $this-&gt;setNativeError($native);
+        }
+        if ($userinfo !== null) {
+            $this-&gt;setUserInfo($userinfo);
+        }
+    }
+    
+    /**
+     * Sets additional user / debug information for this error.
+     *  
+     * @param array $info
+     * @return void
+     */ 
+    public function setUserInfo($info)
+    {
+        $this-&gt;userInfo = $info;
+        $this-&gt;message .= &quot; [User Info: &quot; .$this-&gt;userInfo . &quot;]&quot;;
+    }
+    
+    /**
+     * Returns the additional / debug information for this error. 
+     * 
+     * @return array hash of user info properties.
+     */
+    public function getUserInfo()
+    {
+        return $this-&gt;userInfo;
+    }
+    
+    /**
+     * Sets driver native error message.
+     *  
+     * @param string $info
+     * @return void
+     */ 
+    public function setNativeError($msg)
+    {
+        $this-&gt;nativeError = $msg;
+        $this-&gt;message .= &quot; [Native Error: &quot; .$this-&gt;nativeError . &quot;]&quot;;
+    }
+    
+    /**
+     * Gets driver native error message.
+     * 
+     * @return string
+     */
+    public function getNativeError()
+    {
+        return $this-&gt;nativeError;
+    }        
+    
+    /**
+     * @deprecated This method only exists right now for easier compatibility w/ PHPUnit!
+     */
+    public function toString()
+    {
+        return $this-&gt;getMessage();
+    }
+}
\ No newline at end of file

Added: trunk/vendor/creole/Statement.php
===================================================================
--- trunk/vendor/creole/Statement.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/Statement.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,147 @@
+&lt;?php
+/*
+ *  $Id: Statement.php,v 1.17 2004/03/20 04:16:49 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+/**
+ * Class that represents a SQL statement.
+ * 
+ * This class is very generic and has no driver-specific implementations.  In fact,
+ * it wouldn't be possible to have driver-specific classes, since PHP doesn't support
+ * multiple inheritance.  I.e. you couldn't have MySQLPreparedStatement that extended
+ * both the abstract PreparedStatement class and the MySQLStatement class.  In Java
+ * this isn't a concern since PreparedStatement is an interface, not a class.
+ *
+ * 
+ * @author   Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version  $Revision: 1.17 $
+ * @package  creole
+ */
+interface Statement {    
+    
+    /**
+     * Sets the maximum number of rows to return from db.
+     * This will affect the SQL if the RDBMS supports native LIMIT; if not,
+     * it will be emulated.  Limit only applies to queries (not update sql).
+     * @param int $v Maximum number of rows or 0 for all rows.
+     * @return void
+     */
+    public function setLimit($v);
+    
+    /**
+     * Returns the maximum number of rows to return or 0 for all.
+     * @return int
+     */
+    public function getLimit();
+    
+    /**
+     * Sets the start row.
+     * This will affect the SQL if the RDBMS supports native OFFSET; if not,
+     * it will be emulated. Offset only applies to queries (not update) and 
+     * only is evaluated when LIMIT is set!
+     * @param int $v
+     * @return void
+     */ 
+    public function setOffset($v);
+    
+    /**
+     * Returns the start row.
+     * Offset only applies when Limit is set!
+     * @return int
+     */
+    public function getOffset();
+    
+    /**
+     * Free resources associated with this statement.
+     * Some drivers will need to implement this method to free
+     * database result resources. 
+     * 
+     * @return void
+     */
+    public function close();
+    
+    /**
+     * Generic execute() function has to check to see whether SQL is an update or select query.
+     * 
+     * If you already know whether it's a SELECT or an update (manipulating) SQL, then use
+     * the appropriate method, as this one will incurr overhead to check the SQL.
+     * 
+     * @param int $fetchmode Fetchmode (only applies to queries).
+     * @return boolean True if it is a result set, false if not or if no more results (this is identical to JDBC return val).
+     * @throws SQLException
+     */
+    public function execute($sql, $fetchmode = null);
+
+    /**
+     * Get result set.
+     * This assumes that the last thing done was an executeQuery() or an execute()
+     * with SELECT-type query.
+     *
+     * @return RestultSet (or null if none)
+     */
+    public function getResultSet();
+
+    /**
+     * Get update count.
+     *
+     * @return int Number of records affected, or &lt;code&gt;null&lt;/code&gt; if not applicable.
+     */
+    public function getUpdateCount();        
+
+    /**
+     * Executes the SQL query in this PreparedStatement object and returns the resultset generated by the query.
+     * 
+     * @param string $sql This method may optionally be called with the SQL statement.
+     * @param int $fetchmode The mode to use when fetching the results (e.g. ResultSet::FETCHMODE_NUM, ResultSet::FETCHMODE_ASSOC).
+     * @return object Creole::ResultSet
+     * @throws SQLException if a database access error occurs.
+     */
+    public function executeQuery($sql, $fetchmode = null);
+    
+    /**
+     * Executes the SQL INSERT, UPDATE, or DELETE statement in this PreparedStatement object.
+     * 
+     * @param string $sql This method may optionally be called with the SQL statement.
+     * @return int Number of affected rows (or 0 for drivers that return nothing).
+     * @throws SQLException if a database access error occurs.
+     */
+    public function executeUpdate($sql);
+    
+    /**
+     * Gets next result set (if this behavior is supported by driver).
+     * Some drivers (e.g. MSSQL) support returning multiple result sets -- e.g.
+     * from stored procedures.
+     *
+     * This function also closes any current restult set.
+     *
+     * Default behavior is for this function to return false.  Driver-specific
+     * implementations of this class can override this method if they actually
+     * support multiple result sets.
+     * 
+     * @return boolean True if there is another result set, otherwise false.
+     */
+    public function getMoreResults();
+     
+    /**
+     * Gets the db Connection that created this statement.
+     * @return Connection
+     */
+    public function getConnection();
+    
+}

Added: trunk/vendor/creole/common/ConnectionCommon.php
===================================================================
--- trunk/vendor/creole/common/ConnectionCommon.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/common/ConnectionCommon.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,258 @@
+&lt;?php
+/*
+ *  $Id: ConnectionCommon.php,v 1.5 2005/10/17 19:03:51 dlawson_mi Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+/**
+ * Class that contains some shared/default information for connections.  Classes may wish to extend this so
+ * as not to worry about the sleep/wakeup methods, etc.
+ * 
+ * In reality this class is not very useful yet, so there's not much incentive for drivers to extend this.
+ * 
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.5 $
+ * @package   creole.common
+ */
+abstract class ConnectionCommon {
+
+    // Constants that define transaction isolation levels.
+    // [We don't have any code using these yet, so there's no need
+    // to initialize these values at this point.]
+    // const TRANSACTION_NONE = 0;
+    // const TRANSACTION_READ_UNCOMMITTED = 1;
+    // const TRANSACTION_READ_COMMITTED = 2;
+    // const TRANSACTION_REPEATABLE_READ = 3;
+    // const TRANSACTION_SERIALIZABLE = 4;
+    
+       /**
+     * The depth level of current transaction.
+     * @var int
+     */ 
+    protected $transactionOpcount = 0;
+    
+    /**
+     * DB connection resource id.     
+     * @var resource
+     */ 
+    protected $dblink;
+    
+    /**
+     * Array hash of connection properties.
+     * @var array
+     */
+    protected $dsn;
+
+    /**
+     * Flags (e.g. Connection::PERSISTENT) for current connection.
+     * @var int
+     */
+    protected $flags = 0;
+        
+    /**
+     * This &quot;magic&quot; method is invoked upon serialize() and works in tandem with the __wakeup()
+     * method to ensure that your database connection is serializable.
+     * 
+     * This method returns an array containing the names of any members of your class
+     * which need to be serialized in order to allow the class to re-connect to the database
+     * when it is unserialized.
+     * 
+     * &lt;p&gt;
+     * Developers:
+     * 
+     * Note that you cannot serialize resources (connection links) and expect them to 
+     * be valid when you unserialize.  For this reason, you must re-connect to the database in the
+     * __wakeup() method.
+     * 
+     * It's up to your class implimentation to ensure that the necessary data is serialized. 
+     * You probably at least need to serialize:
+     * 
+     *  (1) the DSN array used by connect() method
+     *  (2) Any flags that were passed to the connection
+     *  (3) Possibly the autocommit state
+     * 
+     * @return array The class variable names that should be serialized.
+     * @see __wakeup()
+     * @see DriverManager::getConnection()
+     * @see DatabaseInfo::__sleep()
+     */
+    public function __sleep()
+    {
+        return array('dsn', 'flags');
+    }
+    
+    /**
+     * This &quot;magic&quot; method is invoked upon unserialize().
+     * This method will re-connects to the database using the information that was
+     * stored using the __sleep() method.
+     * @see __sleep()
+     */
+    public function __wakeup() 
+    {
+        $this-&gt;connect($this-&gt;dsn, $this-&gt;flags);
+    }
+   
+    /**
+     * @see Connection::getResource()
+     */
+    public function getResource()
+    {
+        return $this-&gt;dblink;
+    }
+    
+    /**
+     * @see Connection::getDSN()
+     */
+    public function getDSN() {
+        return $this-&gt;dsn;
+    }
+       
+    /**
+     * @see Connection::getFlags()
+     */
+    public function getFlags()
+    {
+        return $this-&gt;flags;
+    }    
+
+    /**
+     * Creates a CallableStatement object for calling database stored procedures.
+     * 
+     * @param string $sql
+     * @return CallableStatement
+     */
+    public function prepareCall($sql) 
+    {
+        throw new SQLException(&quot;Current driver does not support stored procedures using CallableStatement.&quot;);
+    }    
+    
+    /**
+     * Driver classes should override this if they support transactions.
+     * 
+     * @return boolean
+     */
+    public function supportsNestedTrans() 
+    {
+        return false;
+    }
+    
+    /**
+     * Begins a transaction (if supported).
+     */
+    public function begin() 
+    {
+        if ($this-&gt;transactionOpcount === 0 || $this-&gt;supportsNestedTrans()) {
+            $this-&gt;beginTrans();
+        }
+        $this-&gt;transactionOpcount++;
+    }
+
+    /**
+     * Commits statements in a transaction.
+     */
+    public function commit() 
+    {
+        if ($this-&gt;transactionOpcount &gt; 0) {
+            if ($this-&gt;transactionOpcount == 1 || $this-&gt;supportsNestedTrans()) {
+                $this-&gt;commitTrans();
+            }
+            $this-&gt;transactionOpcount--;       
+        }
+    }
+    
+    /**
+     * Rollback changes in a transaction.
+     */
+    public function rollback() 
+    {
+        if ($this-&gt;transactionOpcount &gt; 0) {
+            if ($this-&gt;transactionOpcount == 1 || $this-&gt;supportsNestedTrans()) {
+                $this-&gt;rollbackTrans();
+            }
+            $this-&gt;transactionOpcount--;       
+        }
+    }
+
+    /**
+     * Enable/disable automatic commits.
+     * 
+     * Pushes SQLWarning onto $warnings stack if the autocommit value is being changed mid-transaction. This function
+     * is overridden by driver classes so that they can perform the necessary begin/end transaction SQL.
+     * 
+     * If auto-commit is being set to TRUE, then the current transaction will be committed immediately.
+     * 
+     * @param boolean $bit New value for auto commit.
+     * @return void
+     */
+    public function setAutoCommit($bit) 
+    {
+        if ($this-&gt;transactionOpcount &gt; 0) {
+            trigger_error(&quot;Changing autocommit in mid-transaction; committing &quot; . $this-&gt;transactionOpcount . &quot; uncommitted statements.&quot;, E_USER_WARNING);
+        }
+
+        if (!$bit) {
+            $this-&gt;begin();
+        }
+        else {
+            $this-&gt;commit();
+        }
+    }
+
+    /**
+     * Get auto-commit status.
+     *
+     * @return boolean
+     */
+    public function getAutoCommit() 
+    {
+        return ($this-&gt;transactionOpcount == 0);
+    }
+    
+    /**
+     * Begin new transaction.
+     * Driver classes should override this method if they support transactions.
+     */
+    protected function beginTrans()
+    {
+    }
+    
+    /**
+     * Commit the current transaction.
+     * Driver classes should override this method if they support transactions.
+     */
+    protected function commitTrans() 
+    {
+    }
+    
+    /**
+     * Roll back (undo) the current transaction.
+     * Driver classes should override this method if they support transactions.
+     */
+    protected function rollbackTrans() 
+    {
+    }
+ 
+    /**
+     * Returns false if connection is closed.
+     * @return boolean
+     */
+    public function isConnected()
+    {
+        return !empty($this-&gt;dblink);
+    }
+}
\ No newline at end of file

Added: trunk/vendor/creole/common/PreparedStatementCommon.php
===================================================================
--- trunk/vendor/creole/common/PreparedStatementCommon.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/common/PreparedStatementCommon.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,598 @@
+&lt;?php
+/*
+ *  $Id: PreparedStatementCommon.php,v 1.14 2005/04/16 18:55:28 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+/**
+ * Class that represents a shared code for handling emulated pre-compiled statements.
+ * 
+ * Many drivers do not take advantage of pre-compiling SQL statements; for these
+ * cases the precompilation is emulated.  This emulation comes with slight penalty involved
+ * in parsing the queries, but provides other benefits such as a cleaner object model and ability
+ * to work with BLOB and CLOB values w/o needing special LOB-specific routines.
+ *
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.14 $
+ * @package   creole.common
+ */
+abstract class PreparedStatementCommon {
+
+    /**
+     * The database connection.
+     * @var Connection
+     */ 
+    protected $conn;
+    
+    /**
+     * Max rows to retrieve from DB.
+     * @var int
+     */
+    protected $limit = 0;
+    
+    /**
+     * Offset at which to start processing DB rows.
+     * &quot;Skip X rows&quot;
+     * @var int
+     */
+    protected $offset = 0;
+    
+    /**
+     * The SQL this class operates on.
+     * @var string
+     */
+    protected $sql;
+
+    /**
+     * The string positions of the parameters in the SQL.
+     * @var array
+     */
+    protected $positions;
+
+
+    /**
+     * Number of positions (simply to save processing).
+     * @var int
+     */
+    protected $positionsCount;
+
+    /**
+     * Map of index =&gt; value for bound params.
+     * @var array string[]
+     */
+    protected $boundInVars = array();    
+    
+    /**
+     * Temporarily hold a ResultSet object after an execute() query.
+     * @var ResultSet
+     */
+    protected $resultSet;
+
+    /**
+     * Temporary hold the affected row cound after an execute() query.
+     * @var int
+     */
+    protected $updateCount;
+    
+    /**
+     * Create new prepared statement instance.
+     * 
+     * @param object $conn Connection object
+     * @param string $sql The SQL to work with.
+     * @param array $positions The positions in SQL of ?'s.
+     * @param restult $stmt If the driver supports prepared queries, then $stmt will contain the statement to use.
+     */ 
+    public function __construct(Connection $conn, $sql)
+    {
+        $this-&gt;conn = $conn;
+        $this-&gt;sql = $sql;
+    
+	$this-&gt;positions = $this-&gt;parseQuery ( $sql );
+        // save processing later in cases where we may repeatedly exec statement
+	$this-&gt;positionsCount = count ( $this-&gt;positions );
+    }
+
+    /**
+     * Parse the SQL query for ? positions
+     *
+     * @param string $sql The query to process
+     * @return array Positions from the start of the string that ?'s appear at
+    */
+    protected function parseQuery ( $sql )
+    {
+
+        $positions = array();
+	// match anything ? ' &quot; or \ in $sql with an early out if we find nothing
+        if ( preg_match_all ( '([\?]|[\']|[\&quot;]|[\\\])', $sql, $matches, PREG_OFFSET_CAPTURE ) !== 0 ) {
+                $matches = $matches['0'];
+                $open = NULL;
+		// go thru all our matches and see what we can find
+                for ( $i = 0, $j = count ( $matches ); $i &lt; $j; $i++ ) {
+                        switch ( $matches[$i]['0'] ) {
+				// if we already have an open &quot; or ' then check if this is the end
+				// to close it or not
+                                case $open:
+                                        $open = NULL;
+                                        break;
+				// we have a quote, set ourselves open
+                                case '&quot;':
+                                case &quot;'&quot;:
+                                        $open = $matches[$i]['0'];
+                                        break;
+				// check if it is an escaped quote and skip if it is
+                                case '\\':
+                                        $next_match = $matches[$i+1]['0'];
+                                        if ( $next_match === '&quot;' || $next_match === &quot;'&quot; ) {
+                                                $i++;
+                                        }
+                                        unset ( $next_match );
+                                        break;
+				// we found a ?, check we arent in an open &quot;/' first and
+				// add it to the position list if we arent
+                                default:
+                                        if ( $open === NULL ) {
+                                                $positions[] = $matches[$i]['1'];
+                                        }
+                        }
+                        unset ( $matches[$i] );
+                }
+                unset ( $open, $matches, $i, $j );
+        }
+
+	return $positions;
+
+    }
+
+    /**
+     * @see PreparedStatement::setLimit()
+     */
+    public function setLimit($v)
+    {
+        $this-&gt;limit = (int) $v;
+    }
+    
+    /**
+     * @see PreparedStatement::getLimit()
+     */
+    public function getLimit()
+    {
+        return $this-&gt;limit;
+    }
+    
+    /**
+     * @see PreparedStatement::setOffset()
+     */ 
+    public function setOffset($v)
+    {
+        $this-&gt;offset = (int) $v;
+    }
+    
+    /**
+     * @see PreparedStatement::getOffset()
+     */
+    public function getOffset()
+    {
+        return $this-&gt;offset;
+    }
+    
+    /**
+     * @see PreparedStatement::getResultSet()
+     */
+    public function getResultSet()
+    {
+        return $this-&gt;resultSet;
+    }
+
+    /**
+     * @see PreparedStatement::getUpdateCount()
+     */
+    public function getUpdateCount()
+    {
+        return $this-&gt;updateCount;
+    }
+    
+    /**
+     * @see PreparedStatement::getMoreResults()
+     */
+    public function getMoreResults()
+    {
+        if ($this-&gt;resultSet) $this-&gt;resultSet-&gt;close();
+        $this-&gt;resultSet = null;
+        return false;
+    }
+     
+    /**
+     * @see PreparedStatement::getConnection()
+     */
+    public function getConnection()
+    {
+        return $this-&gt;conn;
+    }
+    
+    /**
+     * Statement resources do not exist for emulated prepared statements,
+     * so this just returns &lt;code&gt;null&lt;/code&gt;.
+     * @return null
+     */
+    public function getResource()
+    {
+        return null;
+    }
+    
+    /**
+     * Nothing to close for emulated prepared statements.
+     */
+    public function close()
+    {       
+    }
+    
+    /**
+     * Replaces placeholders with the specified parameter values in the SQL.
+     * 
+     * This is for emulated prepared statements.
+     * 
+     * @return string New SQL statement with parameters replaced.
+     * @throws SQLException - if param not bound.
+     */
+    protected function replaceParams()
+    {
+        // Default behavior for this function is to behave in 'emulated' mode.    
+        $sql = '';    
+        $last_position = 0;
+
+        for ($position = 0; $position &lt; $this-&gt;positionsCount; $position++) {
+            if (!isset($this-&gt;boundInVars[$position + 1])) {
+              throw new SQLException(
+                'Replace params: undefined query param @postion: ' . ($position + 1) .'||' . 'Trying to execute: ' . $this-&gt;sql);
+            }
+            $current_position = $this-&gt;positions[$position];            
+            $sql .= substr($this-&gt;sql, $last_position, $current_position - $last_position);
+            $sql .= $this-&gt;boundInVars[$position + 1];                    
+            $last_position = $current_position + 1;            
+        }
+        // append the rest of the query
+        $sql .= substr($this-&gt;sql, $last_position);
+        
+        return $sql;
+    }
+
+    /**
+     * Executes the SQL query in this PreparedStatement object and returns the resultset generated by the query.
+     * We support two signatures for this method:
+     * - $stmt-&gt;executeQuery(ResultSet::FETCHMODE_NUM);
+     * - $stmt-&gt;executeQuery(array($param1, $param2), ResultSet::FETCHMODE_NUM);
+     * @param mixed $p1 Either (array) Parameters that will be set using PreparedStatement::set() before query is executed or (int) fetchmode.
+     * @param int $fetchmode The mode to use when fetching the results (e.g. ResultSet::FETCHMODE_NUM, ResultSet::FETCHMODE_ASSOC).
+     * @return ResultSet
+     * @throws SQLException if a database access error occurs.
+     */
+	public function executeQuery($p1 = null, $fetchmode = null)
+	{    
+	    $params = null;
+		if ($fetchmode !== null) {
+			$params = $p1;
+		} elseif ($p1 !== null) {
+			if (is_array($p1)) $params = $p1;
+			else $fetchmode = $p1;
+		}
+	    
+		if ($params) {
+			for($i=0,$cnt=count($params); $i &lt; $cnt; $i++) {
+				$this-&gt;set($i+1, $params[$i]);
+			}
+	    }
+        
+        $this-&gt;updateCount = null; // reset
+        $sql = $this-&gt;replaceParams();        
+        
+        if ($this-&gt;limit &gt; 0 || $this-&gt;offset &gt; 0) {
+            $this-&gt;conn-&gt;applyLimit($sql, $this-&gt;offset, $this-&gt;limit);
+        }
+        
+        $this-&gt;resultSet = $this-&gt;conn-&gt;executeQuery($sql, $fetchmode);
+        return $this-&gt;resultSet;
+    }
+
+    /**
+     * Executes the SQL INSERT, UPDATE, or DELETE statement in this PreparedStatement object.
+     * 
+     * @param array $params Parameters that will be set using PreparedStatement::set() before query is executed.
+     * @return int Number of affected rows (or 0 for drivers that return nothing).
+     * @throws SQLException if a database access error occurs.
+     */
+    public function executeUpdate($params = null) 
+    {
+        if ($params) {
+            for($i=0,$cnt=count($params); $i &lt; $cnt; $i++) {
+                $this-&gt;set($i+1, $params[$i]);
+            }
+        }
+
+        if($this-&gt;resultSet) $this-&gt;resultSet-&gt;close();
+        $this-&gt;resultSet = null; // reset                
+        $sql = $this-&gt;replaceParams();        
+        $this-&gt;updateCount = $this-&gt;conn-&gt;executeUpdate($sql);
+        return $this-&gt;updateCount;
+    }    
+
+    /**
+     * Escapes special characters (usu. quotes) using native driver function.
+     * @param string $str The input string.
+     * @return string The escaped string.
+     */
+    abstract protected function escape($str);
+    
+    /**
+     * A generic set method.
+     * 
+     * You can use this if you don't want to concern yourself with the details.  It involves
+     * slightly more overhead than the specific settesr, since it grabs the PHP type to determine
+     * which method makes most sense.
+     * 
+     * @param int $paramIndex
+     * @param mixed $value
+     * @return void
+     * @throws SQLException
+     */
+    function set($paramIndex, $value)
+    {
+        $type = gettype($value);
+        if ($type == &quot;object&quot;) {
+            if (is_a($value, 'Blob')) {
+                $this-&gt;setBlob($paramIndex, $value);
+            } elseif (is_a($value, 'Clob')) {
+                $this-&gt;setClob($paramIndex, $value);
+            } elseif (is_a($value, 'Date')) {
+                 // can't be sure if the column type is a DATE, TIME, or TIMESTAMP column
+                 // we'll just use TIMESTAMP by default; hopefully DB won't complain (if
+                 // it does, then this method just shouldn't be used).
+                 $this-&gt;setTimestamp($paramIndex, $value);
+            } else {
+                throw new SQLException(&quot;Unsupported object type passed to set(): &quot; . get_class($value));
+            }
+        } else {
+	    switch ( $type ) {
+	    	case 'integer':
+			$type = 'int';
+			break;
+		case 'double':
+			$type = 'float';
+			break;
+		// nice at a later date for large int handling?
+		//case 'gmp':
+	    }
+            $setter = 'set' . ucfirst($type); // PHP types are case-insensitive, but we'll do this in case that changes
+            $this-&gt;$setter($paramIndex, $value);
+        }        
+    }
+    
+    /**
+     * Sets an array.
+     * Unless a driver-specific method is used, this means simply serializing
+     * the passed parameter and storing it as a string.
+     * @param int $paramIndex
+     * @param array $value
+     * @return void
+     */
+    function setArray($paramIndex, $value) 
+    {        
+        if ($value === null) {
+            $this-&gt;setNull($paramIndex);
+        } else {
+            $this-&gt;boundInVars[$paramIndex] = &quot;'&quot; . $this-&gt;escape(serialize($value)) . &quot;'&quot;;
+        }
+    }
+
+    /**
+     * Sets a boolean value.
+     * Default behavior is true = 1, false = 0.
+     * @param int $paramIndex
+     * @param boolean $value
+     * @return void
+     */
+    function setBoolean($paramIndex, $value) 
+    {                
+        if ($value === null) {
+            $this-&gt;setNull($paramIndex);
+        } else {
+            $this-&gt;boundInVars[$paramIndex] = (int) $value;
+        }
+    }
+    
+
+    /**
+     * @see PreparedStatement::setBlob()
+     */
+    function setBlob($paramIndex, $blob) 
+    {        
+        if ($blob === null) {
+            $this-&gt;setNull($paramIndex);
+        } else {
+            // they took magic __toString() out of PHP5.0.0; this sucks
+            if (is_object($blob)) {
+            	$this-&gt;boundInVars[$paramIndex] = &quot;'&quot; . $this-&gt;escape($blob-&gt;__toString()) . &quot;'&quot;;
+            } else {
+            	$this-&gt;boundInVars[$paramIndex] = &quot;'&quot; . $this-&gt;escape($blob) . &quot;'&quot;;
+	    }
+        }
+    } 
+
+    /**
+     * @see PreparedStatement::setClob()
+     */
+    function setClob($paramIndex, $clob) 
+    {
+        if ($clob === null) {
+            $this-&gt;setNull($paramIndex);
+        } else {      
+            // they took magic __toString() out of PHP5.0.0; this sucks
+            if (is_object($clob)) {
+            	$this-&gt;boundInVars[$paramIndex] = &quot;'&quot; . $this-&gt;escape($clob-&gt;__toString()) . &quot;'&quot;;
+            } else {
+            	$this-&gt;boundInVars[$paramIndex] = &quot;'&quot; . $this-&gt;escape($clob) . &quot;'&quot;;
+	    }
+        }
+    }     
+
+    /**
+     * @param int $paramIndex
+     * @param string $value
+     * @return void
+     */
+    function setDate($paramIndex, $value) 
+    {
+        if ($value === null) {
+            $this-&gt;setNull($paramIndex);
+        } else {
+            if (is_numeric($value)) $value = date(&quot;Y-m-d&quot;, $value);
+            elseif (is_object($value)) $value = date(&quot;Y-m-d&quot;, $value-&gt;getTime());        
+            $this-&gt;boundInVars[$paramIndex] = &quot;'&quot; . $this-&gt;escape($value) . &quot;'&quot;;
+        }
+    } 
+    
+    /**
+     * @param int $paramIndex
+     * @param double $value
+     * @return void
+     */
+    function setDecimal($paramIndex, $value) 
+    {
+        if ($value === null) {
+            $this-&gt;setNull($paramIndex);
+        } else {
+            $this-&gt;boundInVars[$paramIndex] = (float) $value;
+        }
+    }             
+
+    /**
+     * @param int $paramIndex
+     * @param double $value
+     * @return void
+     */
+    function setDouble($paramIndex, $value) 
+    {
+        if ($value === null) {
+            $this-&gt;setNull($paramIndex);
+        } else {
+            $this-&gt;boundInVars[$paramIndex] = (double) $value;
+        }
+    } 
+        
+    /**
+     * @param int $paramIndex
+     * @param float $value
+     * @return void
+     */
+    function setFloat($paramIndex, $value) 
+    {
+        if ($value === null) {
+            $this-&gt;setNull($paramIndex);
+        } else {
+            $this-&gt;boundInVars[$paramIndex] = (float) $value;
+        }
+    } 
+
+    /**
+     * @param int $paramIndex
+     * @param int $value
+     * @return void
+     */
+    function setInt($paramIndex, $value) 
+    {
+        if ($value === null) {
+            $this-&gt;setNull($paramIndex);
+        } else {
+            $this-&gt;boundInVars[$paramIndex] = (int) $value;
+        }
+    } 
+    
+    /**
+     * Alias for setInt()
+     * @param int $paramIndex
+     * @param int $value
+     */
+    function setInteger($paramIndex, $value)
+    {
+        $this-&gt;setInt($paramIndex, $value);
+    }
+
+    /**
+     * @param int $paramIndex
+     * @return void
+     */
+    function setNull($paramIndex) 
+    {
+        $this-&gt;boundInVars[$paramIndex] = 'NULL';
+    }
+
+    /**
+     * @param int $paramIndex
+     * @param string $value
+     * @return void
+     */
+    function setString($paramIndex, $value) 
+    {
+        if ($value === null) {
+            $this-&gt;setNull($paramIndex);
+        } else {
+            // it's ok to have a fatal error here, IMO, if object doesn't have
+            // __toString() and is being passed to this method.
+	    if ( is_object ( $value ) ) {
+            	$this-&gt;boundInVars[$paramIndex] = &quot;'&quot; . $this-&gt;escape($value-&gt;__toString()) . &quot;'&quot;;
+	    } else {
+            	$this-&gt;boundInVars[$paramIndex] = &quot;'&quot; . $this-&gt;escape((string)$value) . &quot;'&quot;;
+	    }
+        }
+    } 
+    
+    /**
+     * @param int $paramIndex
+     * @param string $value
+     * @return void
+     */
+    function setTime($paramIndex, $value) 
+    {        
+        if ($value === null) {
+            $this-&gt;setNull($paramIndex);
+        } else {
+            if ( is_numeric ( $value ) ) {
+	    		$value = date ('H:i:s', $value );
+		    } elseif ( is_object ( $value ) ) {
+		    	$value = date ('H:i:s', $value-&gt;getTime ( ) );
+		    }
+            $this-&gt;boundInVars [ $paramIndex ] = &quot;'&quot; . $this-&gt;escape ( $value ) . &quot;'&quot;;
+        }
+    }
+    
+    /**
+     * @param int $paramIndex
+     * @param string $value
+     * @return void
+     */
+    function setTimestamp($paramIndex, $value) 
+    {        
+        if ($value === null) {
+            $this-&gt;setNull($paramIndex);
+        } else {
+       	    if (is_numeric($value)) $value = date('Y-m-d H:i:s', $value);
+       	    elseif (is_object($value)) $value = date('Y-m-d H:i:s', $value-&gt;getTime());
+            $this-&gt;boundInVars[$paramIndex] = &quot;'&quot;.$this-&gt;escape($value).&quot;'&quot;;
+        }
+    }
+            
+}

Added: trunk/vendor/creole/common/ResultSetCommon.php
===================================================================
--- trunk/vendor/creole/common/ResultSetCommon.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/common/ResultSetCommon.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,439 @@
+&lt;?php
+/*
+ *  $Id: ResultSetCommon.php,v 1.8 2005/09/16 13:09:49 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+/**
+ * This class implements many shared or common methods needed by resultset drivers.
+ * 
+ * This class may (optionally) be extended by driver classes simply to make it easier
+ * to create driver classes.  This is also useful in the early stages of Creole development
+ * as it means that API changes affect fewer files. As Creole matures/stabalizes having
+ * a common class may become less useful, as drivers may have their own ways of doing things
+ * (and we'll have a solid unit test framework to make sure drivers conform to the API
+ * described by the interfaces).
+ * 
+ * The get*() methods in this class will format values before returning them. Note
+ * that if they will return &lt;code&gt;null&lt;/code&gt; if the database returned &lt;code&gt;NULL&lt;/code&gt;
+ * which makes these functions easier to use than simply typecasting the values from the
+ * db. If the requested column does not exist than an exception (SQLException) will be thrown.
+ * 
+ * &lt;code&gt;
+ * $rs = $conn-&gt;executeQuery(&quot;SELECT MAX(stamp) FROM event&quot;, ResultSet::FETCHMODE_NUM);
+ * $rs-&gt;next();
+ * 
+ * $max_stamp = $rs-&gt;getTimestamp(1, &quot;d/m/Y H:i:s&quot;);
+ * // $max_stamp will be date string or null if no MAX(stamp) was found
+ * 
+ * $max_stamp = $rs-&gt;getTimestamp(&quot;max(stamp)&quot;, &quot;d/m/Y H:i:s&quot;);
+ * // will THROW EXCEPTION, because the resultset was fetched using numeric indexing
+ * // SQLException: Invalid resultset column: max(stamp)
+ * &lt;/code&gt;
+ * 
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.8 $
+ * @package   creole.common
+ */
+abstract class ResultSetCommon {          
+    
+    /**
+     * The fetchmode for this recordset.
+     * @var int
+     */
+    protected $fetchmode;
+    
+    /**
+     * DB connection.
+     * @var Connection
+     */
+    protected $conn;
+    
+    /**
+     * Resource identifier used for native result set handling.
+     * @var resource
+     */
+    protected $result;
+
+    /**
+     * The current cursor position (row number). First row is 1. Before first row is 0.
+     * @var int
+     */
+    protected $cursorPos = 0;
+    
+    /**
+     * The current unprocessed record/row from the db.
+     * @var array
+     */
+    protected $fields;
+    
+    /**
+     * Whether to convert assoc col case.
+     */
+    protected $ignoreAssocCase = false;
+    
+    /**
+     * Constructor.
+     */
+    public function __construct(Connection $conn, $result, $fetchmode = null)
+    {
+        $this-&gt;conn = $conn;
+        $this-&gt;result = $result;             
+        if ($fetchmode !== null) {
+            $this-&gt;fetchmode = $fetchmode;
+        } else {
+            $this-&gt;fetchmode = ResultSet::FETCHMODE_ASSOC; // default
+        }
+        $this-&gt;ignoreAssocCase = (($conn-&gt;getFlags() &amp; Creole::NO_ASSOC_LOWER) === Creole::NO_ASSOC_LOWER);
+    }
+    
+    /**
+     * Destructor
+     *
+     * Free db result resource.
+     */
+    public function __destruct()
+    {
+          $this-&gt;close();
+    }
+    
+    /**
+     * @see ResultSet::getIterator()
+     */
+    public function getIterator()
+    {
+        require_once 'creole/ResultSetIterator.php';
+        return new ResultSetIterator($this);
+    }
+    
+    /**
+     * @see ResultSet::getResource()
+     */
+    public function getResource()
+    {
+        return $this-&gt;result;
+    }
+    
+    /**
+     * @see ResultSet::isIgnoreAssocCase()
+     */
+    public function isIgnoreAssocCase()
+    {
+        return $this-&gt;ignoreAssocCase;
+    }        
+    
+    /**
+     * @see ResultSet::setFetchmode()
+     */
+    public function setFetchmode($mode)
+    {
+        $this-&gt;fetchmode = $mode;
+    }
+    
+    /**
+     * @see ResultSet::getFetchmode()
+     */
+    public function getFetchmode()
+    {
+        return $this-&gt;fetchmode;
+    }                
+
+    /**
+     * @see ResultSet::previous()
+     */
+    public function previous()
+    {
+        // Go back 2 spaces so that we can then advance 1 space.
+        $ok = $this-&gt;seek($this-&gt;cursorPos - 2);
+        if ($ok === false) {
+            $this-&gt;beforeFirst();
+            return false;
+        }        
+        return $this-&gt;next();      
+    }
+
+    /**
+     * @see ResultSet::isBeforeFirst()
+     */
+    public function relative($offset)
+    {
+        // which absolute row number are we seeking
+        $pos = $this-&gt;cursorPos + ($offset - 1);
+        $ok = $this-&gt;seek($pos);
+                
+        if ($ok === false) {
+            if ($pos &lt; 0) {
+                $this-&gt;beforeFirst();
+            } else {
+                $this-&gt;afterLast();
+            }
+        } else {
+            $ok = $this-&gt;next();
+        }
+        
+        return $ok;
+    }
+
+    /**
+     * @see ResultSet::absolute()
+     */
+    public function absolute($pos)
+    {
+        $ok = $this-&gt;seek( $pos - 1 ); // compensate for next() factor        
+        if ($ok === false) {
+            if ($pos - 1 &lt; 0) {
+                $this-&gt;beforeFirst();
+            } else {
+                $this-&gt;afterLast();
+            }
+        } else {
+            $ok = $this-&gt;next();
+        }        
+        return $ok;
+    }
+    
+    /**
+     * @see ResultSet::first()
+     */
+    public function first()
+    {
+        if($this-&gt;cursorPos !== 0) { $this-&gt;seek(0); }
+        return $this-&gt;next();
+    }
+
+    /**
+     * @see ResultSet::last()
+     */
+    public function last()
+    {
+        if($this-&gt;cursorPos !==  ($last = $this-&gt;getRecordCount() - 1)) {
+            $this-&gt;seek( $last );
+        }
+        return $this-&gt;next();
+    }
+    
+    /**
+     * @see ResultSet::beforeFirst()
+     */
+    public function beforeFirst()
+    {
+        $this-&gt;cursorPos = 0;
+    }
+
+    /**
+     * @see ResultSet::afterLast()
+     */
+    public function afterLast()
+    {
+        $this-&gt;cursorPos = $this-&gt;getRecordCount() + 1;
+    }
+
+    /**
+     * @see ResultSet::isAfterLast()
+     */
+    public function isAfterLast()
+    {
+        return ($this-&gt;cursorPos === $this-&gt;getRecordCount() + 1);
+    }
+
+    /**
+     * @see ResultSet::isBeforeFirst()
+     */
+    public function isBeforeFirst()
+    {
+        return ($this-&gt;cursorPos === 0);
+    }    
+
+    /**
+     * @see ResultSet::getCursorPos()
+     */
+    public function getCursorPos()
+    {
+        return $this-&gt;cursorPos;
+    }
+    
+    /**
+     * @see ResultSet::getRow()
+     */
+    public function getRow()
+    {
+        return $this-&gt;fields;
+    }
+    
+    /**
+     * @see ResultSet::get()
+     */
+    public function get($column)
+    {
+        $idx = (is_int($column) ? $column - 1 : $column);
+        if (!array_key_exists($idx, $this-&gt;fields)) { throw new SQLException(&quot;Invalid resultset column: &quot; . $column); }
+        return $this-&gt;fields[$idx];
+    }
+    
+    /**
+     * @see ResultSet::getArray()
+     */
+    public function getArray($column) 
+    {
+        $idx = (is_int($column) ? $column - 1 : $column);
+        if (!array_key_exists($idx, $this-&gt;fields)) { throw new SQLException(&quot;Invalid resultset column: &quot; . $column); }
+        if ($this-&gt;fields[$idx] === null) { return null; }
+        return (array) unserialize($this-&gt;fields[$idx]);
+    } 
+
+    /**
+     * @see ResultSet::getBoolean()
+     */
+    public function getBoolean($column) 
+    {
+        $idx = (is_int($column) ? $column - 1 : $column);
+        if (!array_key_exists($idx, $this-&gt;fields)) { throw new SQLException(&quot;Invalid resultset column: &quot; . $column); }
+        if ($this-&gt;fields[$idx] === null) { return null; }
+        return (boolean) $this-&gt;fields[$idx];
+    }
+            
+    /**
+     * @see ResultSet::getBlob()
+     */
+    public function getBlob($column) 
+    {
+        $idx = (is_int($column) ? $column - 1 : $column);
+        if (!array_key_exists($idx, $this-&gt;fields)) { throw new SQLException(&quot;Invalid resultset column: &quot; . $column); }
+        if ($this-&gt;fields[$idx] === null) { return null; }
+        require_once 'creole/util/Blob.php';
+        $b = new Blob();
+        $b-&gt;setContents($this-&gt;fields[$idx]);
+        return $b;
+    }    
+
+    /**
+     * @see ResultSet::getClob()
+     */
+    public function getClob($column) 
+    {
+        $idx = (is_int($column) ? $column - 1 : $column);
+        if (!array_key_exists($idx, $this-&gt;fields)) { throw new SQLException(&quot;Invalid resultset column: &quot; . $column); }
+        if ($this-&gt;fields[$idx] === null) { return null; }
+        require_once 'creole/util/Clob.php';
+        $c = new Clob();
+        $c-&gt;setContents($this-&gt;fields[$idx]);
+        return $c;
+    } 
+
+    /**
+     * @see ResultSet::getDate()
+     */
+    public function getDate($column, $format = '%x') 
+    {
+        $idx = (is_int($column) ? $column - 1 : $column);
+        if (!array_key_exists($idx, $this-&gt;fields)) { throw new SQLException(&quot;Invalid resultset column: &quot; . $column); }
+        if ($this-&gt;fields[$idx] === null) { return null; }
+        $ts = strtotime($this-&gt;fields[$idx]);        
+        if ($ts === -1 || $ts === false) { // in PHP 5.1 return value changes to FALSE
+            throw new SQLException(&quot;Unable to convert value at column &quot; . $column . &quot; to timestamp: &quot; . $this-&gt;fields[$idx]);
+        }
+        if ($format === null) {
+            return $ts;
+        }
+        if (strpos($format, '%') !== false) {
+            return strftime($format, $ts);
+        } else {
+            return date($format, $ts);
+        }
+    }    
+
+    /**
+     * @see ResultSet::getFloat()
+     */
+    public function getFloat($column) 
+    {
+        $idx = (is_int($column) ? $column - 1 : $column);
+        if (!array_key_exists($idx, $this-&gt;fields)) { throw new SQLException(&quot;Invalid resultset column: &quot; . $column); }
+        if ($this-&gt;fields[$idx] === null) { return null; }
+        return (float) $this-&gt;fields[$idx];
+    }
+
+    /**
+     * @see ResultSet::getInt()
+     */
+    public function getInt($column) 
+    {
+        $idx = (is_int($column) ? $column - 1 : $column);
+        if (!array_key_exists($idx, $this-&gt;fields)) { throw new SQLException(&quot;Invalid resultset column: &quot; . $column); }
+        if ($this-&gt;fields[$idx] === null) { return null; }
+        return (int) $this-&gt;fields[$idx];
+    }
+       
+    /**
+     * @see ResultSet::getString()
+     */
+    public function getString($column) 
+    {
+        $idx = (is_int($column) ? $column - 1 : $column);
+        if (!array_key_exists($idx, $this-&gt;fields)) { throw new SQLException(&quot;Invalid resultset column: &quot; . $column); }
+        if ($this-&gt;fields[$idx] === null) { return null; }
+        return rtrim((string) $this-&gt;fields[$idx]);
+    }
+    
+    /**
+     * @see ResultSet::getTime()
+     */
+    public function getTime($column, $format = '%X') 
+    {
+        $idx = (is_int($column) ? $column - 1 : $column);
+        if (!array_key_exists($idx, $this-&gt;fields)) { throw new SQLException(&quot;Invalid resultset column: &quot; . $column); }
+        if ($this-&gt;fields[$idx] === null) { return null; }
+        
+        $ts = strtotime($this-&gt;fields[$idx]);
+        
+        if ($ts === -1 || $ts === false) { // in PHP 5.1 return value changes to FALSE
+            throw new SQLException(&quot;Unable to convert value at column &quot; . (is_int($column) ? $column + 1 : $column) . &quot; to timestamp: &quot; . $this-&gt;fields[$idx]);
+        }
+        if ($format === null) {
+            return $ts;
+        }        
+        if (strpos($format, '%') !== false) {
+            return strftime($format, $ts);
+        } else {
+            return date($format, $ts);
+        }        
+    }
+
+    /**
+     * @see ResultSet::getTimestamp()
+     */
+    public function getTimestamp($column, $format = 'Y-m-d H:i:s') 
+    {
+        $idx = (is_int($column) ? $column - 1 : $column);
+        if (!array_key_exists($idx, $this-&gt;fields)) { throw new SQLException(&quot;Invalid resultset column: &quot; . $column); }
+        if ($this-&gt;fields[$idx] === null) { return null; }
+        
+        $ts = strtotime($this-&gt;fields[$idx]);
+        if ($ts === -1 || $ts === false) { // in PHP 5.1 return value changes to FALSE
+            throw new SQLException(&quot;Unable to convert value at column &quot; . $column . &quot; to timestamp: &quot; . $this-&gt;fields[$idx]);
+        }
+        if ($format === null) {
+            return $ts;
+        }
+        if (strpos($format, '%') !== false) {
+            return strftime($format, $ts);
+        } else {
+            return date($format, $ts);
+        }        
+    }  
+}
\ No newline at end of file

Added: trunk/vendor/creole/common/StatementCommon.php
===================================================================
--- trunk/vendor/creole/common/StatementCommon.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/common/StatementCommon.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,289 @@
+&lt;?php
+/*
+ *  $Id: StatementCommon.php,v 1.4 2004/06/13 02:31:07 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+/**
+ * Class that contains common/shared functionality for Statements.
+ * 
+ * @author   Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version  $Revision: 1.4 $
+ * @package  creole.common
+ */
+abstract class StatementCommon {
+
+    /**
+     * The database connection.
+     * @var Connection
+     */ 
+    protected $conn;
+    
+    /**
+     * Temporarily hold a ResultSet object after an execute() query.
+     * @var ResultSet
+     */
+    protected $resultSet;
+
+    /**
+     * Temporary hold the affected row cound after an execute() query.
+     * @var int
+     */
+    protected $updateCount;
+    
+    /**
+     * Array of warning objects generated by methods performed on result set.
+     * @var array SQLWarning[]
+     */
+    protected $warnings = array();
+    
+    /** 
+     * The ResultSet class name.
+     * @var string
+     */
+    protected $resultClass;
+    
+    /**
+     * The prepared statement resource id.
+     * @var resource
+     */
+    protected $stmt;
+    
+    /**
+     * Max rows to retrieve from DB.
+     * @var int
+     */
+    protected $limit = 0;
+    
+    /**
+     * Offset at which to start processing DB rows.
+     * &quot;Skip X rows&quot;
+     * @var int
+     */
+    protected $offset = 0;
+    
+    /**
+     * Create new statement instance.
+     * 
+     * @param Connection $conn Connection object
+     */ 
+    function __construct(Connection $conn) 
+    {
+        $this-&gt;conn = $conn;        
+    }
+    
+    /**
+     * Sets the maximum number of rows to return from db.
+     * This will affect the SQL if the RDBMS supports native LIMIT; if not,
+     * it will be emulated.  Limit only applies to queries (not update sql).
+     * @param int $v Maximum number of rows or 0 for all rows.
+     * @return void
+     */
+    public function setLimit($v)
+    {
+        $this-&gt;limit = (int) $v;
+    }
+    
+    /**
+     * Returns the maximum number of rows to return or 0 for all.
+     * @return int
+     */
+    public function getLimit()
+    {
+        return $this-&gt;limit;
+    }
+    
+    /**
+     * Sets the start row.
+     * This will affect the SQL if the RDBMS supports native OFFSET; if not,
+     * it will be emulated. Offset only applies to queries (not update) and 
+     * only is evaluated when LIMIT is set!
+     * @param int $v
+     * @return void
+     */ 
+    public function setOffset($v)
+    {
+        $this-&gt;offset = (int) $v;
+    }
+    
+    /**
+     * Returns the start row.
+     * Offset only applies when Limit is set!
+     * @return int
+     */
+    public function getOffset()
+    {
+        return $this-&gt;offset;
+    }
+    
+    /**
+     * Free resources associated with this statement.
+     * Some drivers will need to implement this method to free
+     * database result resources. 
+     * 
+     * @return void
+     */
+    public function close()
+    {
+        // do nothing here (subclasses will implement)
+    }
+    
+    /**
+     * Generic execute() function has to check to see whether SQL is an update or select query.
+     * 
+     * If you already know whether it's a SELECT or an update (manipulating) SQL, then use
+     * the appropriate method, as this one will incurr overhead to check the SQL.
+     * 
+     * @param int $fetchmode Fetchmode (only applies to queries).
+     * @return boolean True if it is a result set, false if not or if no more results (this is identical to JDBC return val).
+     * @throws SQLException
+     * @todo -cStatementCommon Update execute() to not use isSelect() method, but rather to determine type based on returned results.
+     */
+    public function execute($sql, $fetchmode = null)
+    {
+        
+        if (!$this-&gt;isSelect($sql)) {                    
+            $this-&gt;updateCount = $this-&gt;executeUpdate($sql);
+            return false;
+        } else {
+            $this-&gt;resultSet = $this-&gt;executeQuery($sql, $fetchmode);
+            if ($this-&gt;resultSet-&gt;getRecordCount() === 0) {
+                return false;
+            }
+            return true;
+        }
+    }
+
+    /**
+     * Get result set.
+     * This assumes that the last thing done was an executeQuery() or an execute()
+     * with SELECT-type query.
+     *
+     * @return RestultSet (or null if none)
+     */
+    public function getResultSet()
+    {
+        return $this-&gt;resultSet;
+    }
+
+    /**
+     * Get update count.
+     *
+     * @return int Number of records affected, or &lt;code&gt;null&lt;/code&gt; if not applicable.
+     */
+    public function getUpdateCount()
+    {
+        return $this-&gt;updateCount;
+    }
+        
+    /**
+     * Returns whether the passed SQL is a SELECT statement.
+     * 
+     * Returns true if SQL starts with 'SELECT' but not 'SELECT INTO'.  This exists
+     * to support the execute() function -- which could either execute an update or
+     * a query.
+     * 
+     * Currently this function does not take into consideration comments, primarily
+     * because there are a number of different comment options for different drivers:
+     * &lt;pre&gt;
+     *     -- SQL-defined comment, but not truly comment in Oracle
+     *  # comment in mysql
+     *  /* comment in mssql, others * /
+     *  // comment sometimes?
+     *  REM also comment ...
+     * &lt;/pre&gt;
+     * 
+     * If you're wondering why we can't just execute the query and look at the return results
+     * to see whether it was an update or a select, the reason is that for update queries we
+     * need to do stuff before we execute them -- like start transactions if auto-commit is off.
+     * 
+     * @param string $sql
+     * @return boolean Whether statement is a SELECT SQL statement.
+     * @see execute()
+     */
+    protected function isSelect($sql)
+    {
+        // is first word is SELECT, then return true, unless it's SELECT INTO ...
+        // this doesn't, however, take comments into account ...
+        $sql = trim($sql);
+        return (stripos($sql, 'select') === 0 &amp;&amp; stripos($sql, 'select into ') !== 0);
+    }
+
+    /**
+     * Executes the SQL query in this PreparedStatement object and returns the resultset generated by the query.
+     * 
+     * @param string $sql This method may optionally be called with the SQL statement.
+     * @param int $fetchmode The mode to use when fetching the results (e.g. ResultSet::FETCHMODE_NUM, ResultSet::FETCHMODE_ASSOC).
+     * @return object Creole::ResultSet
+     * @throws SQLException If there is an error executing the specified query.
+     * @todo -cStatementCommon Put native query execution logic in statement subclasses.
+     */
+    public function executeQuery($sql, $fetchmode = null)
+    {
+        $this-&gt;updateCount = null;
+        if ($this-&gt;limit &gt; 0 || $this-&gt;offset &gt; 0) {
+            $this-&gt;conn-&gt;applyLimit($sql, $this-&gt;offset, $this-&gt;limit);
+        }
+        $this-&gt;resultSet = $this-&gt;conn-&gt;executeQuery($sql, $fetchmode);
+        return $this-&gt;resultSet;
+    }
+
+    /**
+     * Executes the SQL INSERT, UPDATE, or DELETE statement in this PreparedStatement object.
+     * 
+     * @param string $sql This method may optionally be called with the SQL statement.
+     * @return int Number of affected rows (or 0 for drivers that return nothing).
+     * @throws SQLException if a database access error occurs.
+     */
+    public function executeUpdate($sql) 
+    {
+        if ($this-&gt;resultSet) $this-&gt;resultSet-&gt;close();
+        $this-&gt;resultSet = null;
+        $this-&gt;updateCount = $this-&gt;conn-&gt;executeUpdate($sql);
+        return $this-&gt;updateCount;
+    }
+    
+    /**
+     * Gets next result set (if this behavior is supported by driver).
+     * Some drivers (e.g. MSSQL) support returning multiple result sets -- e.g.
+     * from stored procedures.
+     *
+     * This function also closes any current restult set.
+     *
+     * Default behavior is for this function to return false.  Driver-specific
+     * implementations of this class can override this method if they actually
+     * support multiple result sets.
+     * 
+     * @return boolean True if there is another result set, otherwise false.
+     */
+    public function getMoreResults()
+    {
+        if ($this-&gt;resultSet) $this-&gt;resultSet-&gt;close();        
+        $this-&gt;resultSet = null;
+        return false;        
+    }
+     
+    /**
+     * Gets the db Connection that created this statement.
+     * @return Connection
+     */
+    public function getConnection()
+    {
+        return $this-&gt;conn;
+    }
+}

Added: trunk/vendor/creole/contrib/DebugConnection.php
===================================================================
--- trunk/vendor/creole/contrib/DebugConnection.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/contrib/DebugConnection.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,91 @@
+&lt;?php
+  /**
+   * Debug implementation of Connection.
+   *
+   * This is a Connection that implements the decorator pattern, wrapping around
+   * the true Connection object (stored in $childConnection). This Connection
+   * tracks information about queries executed and makes that information available
+   * for debugging purposes. The information tracked is the last query executed
+   * on the connection (getLastExecutedQuery()) and the total number of
+   * queries executed on the connection thus far (getNumQueriesExecuted()).
+   *
+   * To use this debug connection, you need to register it as a new Creole
+   * driver that handles all connection types. To do this, call the following
+   * before calling Creole::getConnection():
+   *
+   * &lt;code&gt;
+   * Creole::registerDriver('*', 'creole.drivers.debug.DebugConnection');
+   * &lt;/code&gt;
+   *
+   * The next call to Creole::getConnection() will return an instance of
+   * DebugConnection.
+   * 
+   * @author Michael Sims
+   * @package creole.drivers.debug
+   */
+  class DebugConnection implements Connection {
+    /** @var Connection */
+     private $childConnection = null;
+     /** @var int */
+     private $numQueriesExecuted = 0;
+     /** @var string */
+     private $lastExecutedQuery = '';
+     /**
+      * @var object Instance of PEAR Log (or other class with log() method).*/
+     private $logger;
+     /** 
+      * Sets a Logger class (e.g. PEAR Log) to use for logging.
+      * The logger class must have a log() method.  All messages are logged at default log level.
+      * @param object $logger
+      */
+     public function setLogger($logger)
+     {
+       $this-&gt;logger = $logger;
+     }
+     /**
+      * Returns the number of queries executed on this connection so far
+      *
+      * @return int
+      */
+     public function getNumQueriesExecuted()
+     {
+       return $this-&gt;numQueriesExecuted;
+     }
+     /**
+      * Returns the last query executed on this connection
+      *
+      * @return string
+      */
+     public function getLastExecutedQuery()
+     {
+       return $this-&gt;lastExecutedQuery;
+     }
+     
+     /**
+      * connect()
+      */
+      public function connect($dsninfo, $flags = 0)
+      {
+        if (!($driver = Creole::getDriver($dsninfo['phptype']))) {
+          throw new SQLException(&quot;No driver has been registered to handle connection type: $type&quot;);
+        }		
+        $connectionClass = Creole::import($driver);
+        $this-&gt;childConnection = new $connectionClass();
+        $this-&gt;log(&quot;connect(): DSN: &quot;. var_export($dsninfo, true) . &quot;, FLAGS: &quot; . var_export($flags, true));
+        return $this-&gt;childConnection-&gt;connect($dsninfo, $flags);
+      }	
+      
+      /**
+       * @see Connection::getDatabaseInfo()
+       */
+      public function getDatabaseInfo()
+      {
+        return $this-&gt;childConnection-&gt;getDatabaseInfo();
+      }	
+      
+      /**
+       * @see Connection::getIdGenerator()
+       */
+      public function getIdGenerator()	
+      {
+        return $this-&gt;childConnection-&gt;getIdGenerator();
	}
	
	/**
	 * @see Connection::prepareStatement()
	 */
	public function prepareStatement($sql)
	{
		$this-&gt;log(&quot;prepareStatement(): $sql&quot;);
		$obj = $this-&gt;childConnection-&gt;prepareStatement($sql);
		$objClass = get_class($obj);		
		return new $objClass($this, $sql);
	}
	
	/**
	 * @see Connection::createStatement()
	 */
	public function createStatement()
	{
		$obj = $this-&gt;childConnection-&gt;createStatement();
		$objClass = get_class($obj);		
		return new $objClass($this);
	}
	
	/**
	 * @see Connection::applyLimit()
	 */
	public function applyLimit(&amp;$sql, $offset, $limit)
	{
		$this-&gt;log(&quot;applyLimit(): $sql, offset: $offset, limit: $limit&quot;);
		return $this-&gt;childConnection-&gt;applyLimit($sql, $offset, $limit);
	}
	
	/**
	 * @see Connection::close()
	 */
	public function close()
	{
		$this-&gt;log(&quot;close(): Closing connection.&quot;);
		return $this-&gt;childConnection-&gt;close();
	}
	
	/**
	 * @see Connection::executeQuery()
	 */
	publ!
 ic function executeQuery($sql, $fetchmode = null)
	{
		$this-&gt;log(&quot;executeQuery(): $sql&quot;);
		$this-&gt;lastExecutedQuery = $sql;
		$this-&gt;numQueriesExecuted++;
		return $this-&gt;childConnection-&gt;executeQuery($sql, $fetchmode);	
	}
	
	/**
	 * @see Connection::executeUpdate()
	 */
	public function executeUpdate($sql)
	{
		$this-&gt;log(&quot;executeUpdate(): $sql&quot;);
		$this-&gt;lastExecutedQuery = $sql;
		$this-&gt;numQueriesExecuted++;
		return $this-&gt;childConnection-&gt;executeUpdate($sql);	
	}
	
	/**
	 * @see Connection::getUpdateCount()
	 */
	public function getUpdateCount()
	{
		return $this-&gt;childConnection-&gt;getUpdateCount();
	}
	
	/**
	 * @see Connection::prepareCall()
	 **/
	public function prepareCall($sql)
	{
		$this-&gt;log(&quot;prepareCall(): $sql&quot;);
		return $this-&gt;childConnection-&gt;prepareCall($sql);
	}
	
	/**
	 * @see Connection::getResource()
	 */
	public function getResource()
	{
		return $this-&gt;childConnection-&gt;getResource();
	}
	
	/**
	 * @see Connection::connect()
	 */
	public function!
  getDSN()
	{
		return $this-&gt;childConnection-&gt;getDSN();
	}
	
	!
 /**
	 * 
@see Connection::getFlags()
	 */
	public function getFlags()
	{
		return $this-&gt;childConnection-&gt;getFlags();
	}
	
	/**
	 * @see Connection::begin()
	 */
	public function begin()
	{
		$this-&gt;log(&quot;Beginning transaction.&quot;);
		return $this-&gt;childConnection-&gt;begin();
	}
	
	/**
	 * @see Connection::commit()
	 */
	public function commit()
	{
		$this-&gt;log(&quot;Committing transaction.&quot;);
		return $this-&gt;childConnection-&gt;commit();
	}
	
	/**
	 * @see Connection::rollback()
	 */
	public function rollback()
	{
		$this-&gt;log(&quot;Rolling back transaction.&quot;);
		return $this-&gt;childConnection-&gt;rollback();
	}
	
	/**
	 * @see Connection::setAutoCommit()
	 */
	public function setAutoCommit($bit)
	{
		$this-&gt;log(&quot;Setting autocommit to: &quot; . var_export($bit, true));
		return $this-&gt;childConnection-&gt;setAutoCommit($bit);
	}
	
	/**
	 * @see Connection::getAutoCommit()
	 */
	public function getAutoCommit()
	{
		return $this-&gt;childConnection-&gt;getAutoCommit();
	}
	
	/**
	 * Private function that logs message usi!
 ng specified logger (if provided).
	 * @param string $msg Message to log.
	 */
	private function log($msg)
	{
		if ($this-&gt;logger) {
			$this-&gt;logger-&gt;log($msg);
		}
	}

}

Added: trunk/vendor/creole/drivers/mssql/MSSQLCallableStatement.php
===================================================================
--- trunk/vendor/creole/drivers/mssql/MSSQLCallableStatement.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/mssql/MSSQLCallableStatement.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,478 @@
+&lt;?php
+/*
+ *  $Id: MSSQLCallableStatement.php,v 1.20 2005/09/16 13:09:50 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+require_once 'creole/drivers/mssql/MSSQLPreparedStatement.php';
+require_once 'creole/CallableStatement.php';
+include_once 'creole/CreoleTypes.php';
+
+/**
+ * MS SQL Server class to handle stored procedure execution.
+ * 
+ * Developer note: 
+ *
+ *    There is no CallableStatement superclass.  Unlike JDBC, Creole
+ *    uses abstract parent classes rather than interfaces -- in order
+ *    to minimize code duplication.  Since PHP doesn't support multiple
+ *    inheritance, the DRIVERCallableStatement class cannot extend both
+ *    the DRIVERPreparedStatement class and the would-be abstract
+ *    CallableStatement class.
+ *
+ * @author Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version $Revision: 1.20 $
+ * @package creole.drivers.mssql
+ */
+class MSSQLCallableStatement extends MSSQLPreparedStatement implements CallableStatement {
+    
+    /** Output variables */
+    private $boundOutVars = array();
+    
+    /**
+     * Match Creole types to SQL Server types
+     * @var array
+     */
+    private static $typeMap = array(
+        CreoleTypes::BOOLEAN =&gt; SQLBIT,
+        CreoleTypes::BIGINT =&gt; SQLINT4,
+        CreoleTypes::SMALLINT =&gt; SQLINT2,
+        CreoleTypes::TINYINT =&gt; SQLINT2,
+        CreoleTypes::INTEGER =&gt; SQLINT4,
+        CreoleTypes::CHAR =&gt; SQLCHAR,
+        CreoleTypes::VARCHAR =&gt; SQLVARCHAR,
+        CreoleTypes::TEXT =&gt; SQLTEXT,
+        CreoleTypes::FLOAT =&gt; SQLFLT8,
+        CreoleTypes::DOUBLE =&gt; SQLFLT8,
+        CreoleTypes::DATE =&gt; SQLVARCHAR,
+        CreoleTypes::TIME =&gt; SQLVARCHAR,
+        CreoleTypes::TIMESTAMP =&gt; SQLVARCHAR,
+        CreoleTypes::VARBINARY =&gt; SQLVARCHAR,
+        CreoleTypes::NUMERIC =&gt; SQLINT4,
+        CreoleTypes::DECIMAL =&gt; SQLFLT8                                        
+    );
+    
+    /**
+     * Statement created by mssql_init()
+     * @var resource
+     */
+    private $stmt;
+
+
+    /**
+     * The result resource.
+     * @var resource
+     */
+    private $result;
+    
+    /**
+     * Construct new MSSQLCallableStatement.
+     * 
+     * @param Connection $conn
+     * @param resource $stmt
+     */
+    public function __construct(Connection $conn, $stmt)
+    {
+        print &quot; - &gt; IN CONSTRUCTOR \n&quot;;
+        $this-&gt;conn = $conn;
+        $this-&gt;stmt = $stmt;
+    }   
+    
+    /**
+     * @see CallableStatement::getResource()
+     */
+    public function getResource()
+    {
+        return $this-&gt;stmt;
+    }
+        
+    /**
+     * @see CallableStatement::close()
+     */
+    function close()
+    {
+        @mssql_free_statement($this-&gt;stmt);
+        $this-&gt;rsFetchCount = 0;
+    }
+    
+    /**
+     * @see CallableStatement::executeQuery()
+     */
+    function executeQuery($p1 = null, $fetchmode = null)
+    {
+        $params = null;
+        if ($fetchmode !== null) {
+            $params = $p1;
+        } elseif ($p1 !== null) {
+            if (is_array($p1)) $params = $p1;
+            else $fetchmode = $p1;
+        }
+        
+        if ($params) {
+            for($i=0,$cnt=count($params); $i &lt; $cnt; $i++) {
+                $this-&gt;set($i+1, $params[$i]);
+            }
+        }                
+        
+        $this-&gt;result = mssql_execute($this-&gt;stmt);
+        if (!$this-&gt;result) {
+            throw new SQLException('unable to execute callable statement', mssql_get_last_message());
+        }
+        
+        return new MSSQLResultSet($this-&gt;conn, $this-&gt;result, $fetchmode, $this-&gt;offset, $this-&gt;limit);
+    }
+    
+    /**
+     * @see CallableStatement::getMoreResults()
+     */
+    function getMoreResults()
+    {
+        $this-&gt;rsFetchCount++; // we track this because 
+        $hasMore = mssql_next_result($this-&gt;result);
+        if ($this-&gt;resultSet) $this-&gt;resultSet-&gt;close();                    
+        if ($hasMore) {
+            $clazz = $this-&gt;resultClass;
+            $this-&gt;resultSet = new $clazz($this, $this-&gt;result);
+        } else {
+            $this-&gt;resultSet = null;
+        }
+        return $hasMore;
+    }
+
+    /**
+     * @see CallableStatement::registerOutParameter()
+     */
+    function registerOutParameter($paramIndex, $sqlType)
+    {
+        mssql_bind($this-&gt;stmt, $paramIndex, $this-&gt;boundOutVars[$paramIndex], self::$typeMap[$sqlType], true);
+    }
+    
+    /**
+     * @see CallableStatement::setArray()
+     */
+    function setArray($paramIndex, $value, $out = false) 
+    {
+        if ($out) $this-&gt;boundOutVars[$paramIndex] = &amp;$value; // reference means that changes to value, will be reflected
+        if ($value === null) {
+            $this-&gt;setNull($paramIndex);
+        } else {
+            $value = serialize($value);
+            mssql_bind($this-&gt;stmt, $paramIndex, $value, SQLTEXT, $out);
+        }
+    }
+
+    /**
+     * @see CallableStatement::setBoolean()
+     */
+    function setBoolean($paramIndex, $value, $out = false) 
+    {
+        if ($out) $this-&gt;boundOutVars[$paramIndex] = &amp;$value; // reference means that changes to value, will be reflected        
+        if ($value === null) {
+            $this-&gt;setNull($paramIndex);
+        } else {
+            $value = ($value) ? 1 : 0;
+            mssql_bind($this-&gt;stmt, $paramIndex, $value, SQLBIT, $out);
+        }
+    }
+    
+
+    /**
+     * @see CallableStatement::setBlob()
+     */
+    function setBlob($paramIndex, $blob, $out = false) 
+    {
+        if ($blob === null) {
+            $this-&gt;setNull($paramIndex);
+        } else {
+            if (is_object($blob)) {
+                $blob = $blob-&gt;__toString();
+            }
+            if ($out) $this-&gt;boundOutVars[$paramIndex] = &amp;$blob; // reference means that changes to value, will be reflected        
+            $data = unpack(&quot;H*hex&quot;, $blob);
+            mssql_bind($this-&gt;stmt, $paramIndex, $data, SQLTEXT, $out);
+        }
+    } 
+    
+    /**
+     * @see CallableStatement::setClob()
+     */
+    function setClob($paramIndex, $clob, $out = false) 
+    {
+        if ($clob === null) {
+            $this-&gt;setNull($paramIndex);
+        } else {
+            if (is_object($clob)) {
+                $clob = $clob-&gt;__toString();
+            }
+            if ($out) $this-&gt;boundOutVars[$paramIndex] = &amp;$clob; // reference means that changes to value, will be reflected
+            mssql_bind($this-&gt;stmt, $paramIndex, $clob, SQLTEXT, $out);
+        }
+    }
+
+    /**
+     * @see CallableStatement::setDate()
+     */
+    function setDate($paramIndex, $value, $out = false) 
+    {
+        if ($out) $this-&gt;boundOutVars[$paramIndex] = &amp;$value; // reference means that changes to value, will be reflected
+        if ($value === null) {
+            $this-&gt;setNull($paramIndex);
+        } else {
+            if (is_numeric($value)) $value = date(&quot;Y-m-d&quot;, $value);
+            mssql_bind($this-&gt;stmt, $paramIndex, $value, SQLVARCHAR, $out);
+        }
+    } 
+        
+    /**
+     * @see CallableStatement::setFloat()
+     */
+    function setFloat($paramIndex, $value, $out = false) 
+    {
+        if ($out) $this-&gt;boundOutVars[$paramIndex] = &amp;$value; // reference means that changes to value, will be reflected
+        if ($value === null) {
+            $this-&gt;setNull($paramIndex);
+        } else {
+            $value = (float) $value;
+            mssql_bind($this-&gt;stmt, $paramIndex, $value, SQLFLT8, $out);
+        }
+    }
+    
+    /**
+     * @see CallableStatement::setInt()
+     */
+    function setInt($paramIndex, $value, $out = false) 
+    {
+        if ($out) $this-&gt;boundOutVars[$paramIndex] = &amp;$value; // reference means that changes to value, will be reflected
+        if ($value === null) {
+            $this-&gt;setNull($paramIndex);
+        } else {
+            $value = (int) $value;
+            mssql_bind($this-&gt;stmt, $paramIndex, $value, SQLINT4, $out);
+        }
+    }    
+    
+    /**
+     * @see CallableStatement::setNull()
+     */
+    function setNull($paramIndex) 
+    {
+        // hopefully type isn't essential here :)
+        $value = null; // wants a var to pass by reference
+        mssql_bind($this-&gt;stmt, $paramIndex, $value, $type=null, $out=false, $is_null=true);
+    }
+
+    /**
+     * @see CallableStatement::setString()
+     */
+    function setString($paramIndex, $value, $out = false) 
+    {    
+        if ($out) $this-&gt;boundOutVars[$paramIndex] = &amp;$value; // reference means that changes to value, will be reflected
+        if ($value === null) {
+            $this-&gt;setNull($paramIndex);
+        } else {
+            $value = (string) $value;            
+            mssql_bind($this-&gt;stmt, $paramIndex, $value, SQLVARCHAR, $out);
+        }
+    } 
+    
+    /**
+     * @see CallableStatement::setTime()
+     */
+    function setTime($paramIndex, $value, $out = false) 
+    {    
+        if ($out) $this-&gt;boundOutVars[$paramIndex] = &amp;$value; // reference means that changes to value, will be reflected
+        if ($value === null) {
+            $this-&gt;setNull($paramIndex);
+        } else {
+            if (is_numeric($value)) $value = date(&quot;H:i:s&quot;, $value);
+            mssql_bind($this-&gt;stmt, $paramIndex, $value, SQLVARCHAR, $out);
+        }
+    }
+    
+    /**
+     * @see CallableStatement::setTimestamp()
+     */
+    function setTimestamp($paramIndex, $value, $out = false) 
+    {
+        if ($out) $this-&gt;boundOutVars[$paramIndex] = &amp;$value; // reference means that changes to value, will be reflected
+        if ($value === null) {
+            $this-&gt;setNull($paramIndex);
+        } else {
+            if (is_numeric($value)) $value = date('Y-m-d H:i:s', $value);
+            mssql_bind($this-&gt;stmt, $paramIndex, $value, SQLVARCHAR, $out);
+        }
+    }            
+        
+    /**
+     * @see CallableStatement::getArray()
+     */
+    function getArray($paramIndex) 
+    {
+        if (!array_key_exists($paramIndex, $this-&gt;boundOutVars)) {
+            throw new SQLException('Requesting variable not bound to output var: '.$paramIndex);
+        }
+        if ($this-&gt;boundOutVars[$paramIndex] === null) { return null; }
+        return (array) unserialize($this-&gt;boundOutVars[$paramIndex]);
+    } 
+
+    /**
+     * @see CallableStatement::getBoolean()
+     */
+    function getBoolean($paramIndex) 
+    {
+        if (!array_key_exists($paramIndex, $this-&gt;boundOutVars)) {
+            throw new SQLException('Requesting variable not bound to output var: '.$paramIndex);
+        }
+        if ($this-&gt;boundOutVars[$paramIndex] === null) { return null; }
+        return (boolean) $this-&gt;boundOutVars[$paramIndex];
+    }
+            
+    /**
+     * @see CallableStatement::getBlob()
+     */
+    function getBlob($paramIndex) 
+    {
+        if (!array_key_exists($paramIndex, $this-&gt;boundOutVars)) {
+            throw new SQLException('Requesting variable not bound to output var: '.$paramIndex);
+        }
+        if ($this-&gt;boundOutVars[$paramIndex] === null) { return null; }
+        require_once 'creole/util/Blob.php';
+        $b = new Blob();
+        $b-&gt;setContents($this-&gt;boundOutVars[$paramIndex]);
+        return $b;
+    }     
+
+    /**
+     * @see CallableStatement::getClob()
+     */
+    function getClob($paramIndex) 
+    {
+        if (!array_key_exists($paramIndex, $this-&gt;boundOutVars)) {
+            throw new SQLException('Requesting variable not bound to output var: '.$paramIndex);
+        }
+        if ($this-&gt;boundOutVars[$paramIndex] === null) { return null; }
+        require_once 'creole/util/Clob.php';
+        $c = new Clob();
+        $c-&gt;setContents($this-&gt;boundOutVars[$paramIndex]);
+        return $c;
+    } 
+    
+    /**
+     * @see CallableStatement::getDate()
+     */
+    function getDate($paramIndex, $fmt = '%Y-%m-%d') 
+    {
+        if (!array_key_exists($paramIndex, $this-&gt;boundOutVars)) {
+            throw new SQLException('Requesting variable not bound to output var: '.$paramIndex);
+        }
+        if ($this-&gt;boundOutVars[$paramIndex] === null) { return null; }
+        
+        $ts = strtotime($this-&gt;boundOutVars[$paramIndex]);        
+        if ($ts === -1 || $ts === false) { // in PHP 5.1 return value changes to FALSE
+            throw new SQLException(&quot;Unable to convert value at column &quot; . $paramIndex . &quot; to timestamp: &quot; . $this-&gt;boundOutVars[$paramIndex]);
+        }        
+        if (strpos($format, '%') !== false) {
+            return strftime($format, $ts);
+        } else {
+            return date($format, $ts);
+        }
+        
+        return $this-&gt;boundOutVars[$paramIndex];
+    } 
+
+    /**
+     * @param mixed $paramIndex Column name (string) or index (int).
+     * @return float
+     */
+    function getFloat($paramIndex) 
+    {
+        if (!array_key_exists($paramIndex, $this-&gt;boundOutVars)) {
+            throw new SQLException('Requesting variable not bound to output var: '.$paramIndex);
+        }
+        if ($this-&gt;boundOutVars[$paramIndex] === null) { return null; }
+        return (float) $this-&gt;boundOutVars[$paramIndex];
+    }
+
+    /**
+     * @see CallableStatement::getInt()
+     */
+    function getInt($paramIndex) 
+    {
+        if (!array_key_exists($paramIndex, $this-&gt;boundOutVars)) {
+            throw new SQLException('Requesting variable not bound to output var: '.$paramIndex);
+        }
+        if ($this-&gt;boundOutVars[$paramIndex] === null) { return null; }
+        return (int) $this-&gt;boundOutVars[$paramIndex];
+    }            
+
+    /**
+     * @see CallableStatement::getString()
+     */
+    function getString($paramIndex) 
+    {
+        if (!array_key_exists($paramIndex, $this-&gt;boundOutVars)) {
+            throw new SQLException('Requesting variable not bound to output var: '.$paramIndex);
+        }
+        if ($this-&gt;boundOutVars[$paramIndex] === null) { return null; }
+        return (string) $this-&gt;boundOutVars[$paramIndex];
+    } 
+
+    /**
+     * @see CallableStatement::getTime()
+     */
+    function getTime($paramIndex, $format='%X') 
+    {
+        if (!array_key_exists($paramIndex, $this-&gt;boundOutVars)) {
+            throw new SQLException('Requesting variable not bound to output var: '.$paramIndex);
+        }
+        if ($this-&gt;boundOutVars[$paramIndex] === null) { return null; }
+        
+        $ts = strtotime($this-&gt;boundOutVars[$paramIndex]);        
+        if ($ts === -1  || $ts === false) { // in PHP 5.1 return value changes to FALSE
+            throw new SQLException(&quot;Unable to convert value at column &quot; . $paramIndex . &quot; to timestamp: &quot; . $this-&gt;boundOutVars[$paramIndex]);
+        }        
+        if (strpos($format, '%') !== false) {
+            return strftime($format, $ts);
+        } else {
+            return date($format, $ts);
+        }
+            
+    }
+
+    /**
+     * @see CallableStatement::getTimestamp()
+     */
+    function getTimestamp($paramIndex, $format = 'Y-m-d H:i:s') 
+    {
+        if (!array_key_exists($paramIndex, $this-&gt;boundOutVars)) {
+            throw new SQLException('Requesting variable not bound to output var: '.$paramIndex);
+        }
+        if ($this-&gt;boundOutVars[$paramIndex] === null) { return null; }
+                
+        $ts = strtotime($this-&gt;boundOutVars[$paramIndex]);        
+        if ($ts === -1 || $ts === false) { // in PHP 5.1 return value changes to FALSE
+            throw new SQLException(&quot;Unable to convert value at column &quot; . $paramIndex . &quot; to timestamp: &quot; . $this-&gt;boundOutVars[$paramIndex]);
+        }        
+        if (strpos($format, '%') !== false) {
+            return strftime($format, $ts);
+        } else {
+            return date($format, $ts);
+        }
+    }    
+
+}

Added: trunk/vendor/creole/drivers/mssql/MSSQLConnection.php
===================================================================
--- trunk/vendor/creole/drivers/mssql/MSSQLConnection.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/mssql/MSSQLConnection.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,283 @@
+&lt;?php
+
+/*
+ *  $Id: MSSQLConnection.php,v 1.25 2005/10/17 19:03:51 dlawson_mi Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+
+require_once 'creole/Connection.php';
+require_once 'creole/common/ConnectionCommon.php';
+include_once 'creole/drivers/mssql/MSSQLResultSet.php';
+
+/**
+ * MS SQL Server implementation of Connection.
+ * 
+ * If you have trouble with BLOB / CLOB support
+ * --------------------------------------------
+ * 
+ * You may need to change some PHP ini settings.  In particular, the following settings
+ * set the text size to maximum which should get around issues with truncated data:
+ * &lt;code&gt;
+ *  ini_set('mssql.textsize', 2147483647);
+ *  ini_set('mssql.textlimit', 2147483647);
+ * &lt;/code&gt;
+ * We do not set these by default (anymore) because they do not apply to cases where MSSQL
+ * is being used w/ FreeTDS.
+ * 
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @author    Stig Bakken &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">ssb at fast.no</A>&gt; 
+ * @author    Lukas Smith
+ * @version   $Revision: 1.25 $
+ * @package   creole.drivers.mssql
+ */ 
+class MSSQLConnection extends ConnectionCommon implements Connection {        
+    
+    /** Current database (used in mssql_select_db()). */
+    private $database;
+    
+    /**
+     * @see Connection::connect()
+     */
+    function connect($dsninfo, $flags = 0)
+    {                
+        if (!extension_loaded('mssql') &amp;&amp; !extension_loaded('sybase') &amp;&amp; !extension_loaded('sybase_ct')) {
+            throw new SQLException('mssql extension not loaded');
+        }
+
+        $this-&gt;dsn = $dsninfo;
+        $this-&gt;flags = $flags;
+                
+        $persistent = ($flags &amp; Creole::PERSISTENT === Creole::PERSISTENT);
+
+        $user = $dsninfo['username'];
+        $pw = $dsninfo['password'];
+        $dbhost = $dsninfo['hostspec'] ? $dsninfo['hostspec'] : 'localhost';
+		
+		if (PHP_OS == &quot;WINNT&quot; || PHP_OS == &quot;WIN32&quot;) {
+            $portDelimiter = &quot;,&quot;;
+        } else {
+            $portDelimiter = &quot;:&quot;;
+        }
+       
+        if(!empty($dsninfo['port'])) {
+                $dbhost .= $portDelimiter.$dsninfo['port'];
+        } else {
+                $dbhost .= $portDelimiter.'1433';
+        }
+		
+        $connect_function = $persistent ? 'mssql_pconnect' : 'mssql_connect';
+
+        if ($dbhost &amp;&amp; $user &amp;&amp; $pw) {
+            $conn = @$connect_function($dbhost, $user, $pw);
+        } elseif ($dbhost &amp;&amp; $user) {
+            $conn = @$connect_function($dbhost, $user);
+        } else {
+            $conn = @$connect_function($dbhost);
+        }
+        if (!$conn) {
+            throw new SQLException('connect failed', mssql_get_last_message());
+        }
+        
+        if ($dsninfo['database']) {
+            if (!@mssql_select_db($dsninfo['database'], $conn)) {
+                throw new SQLException('No database selected');               
+            }
+            
+            $this-&gt;database = $dsninfo['database'];
+        }
+        
+        $this-&gt;dblink = $conn;        
+    }    
+    
+    /**
+     * @see Connection::getDatabaseInfo()
+     */
+    public function getDatabaseInfo()
+    {
+        require_once 'creole/drivers/mssql/metadata/MSSQLDatabaseInfo.php';
+        return new MSSQLDatabaseInfo($this);
+    }
+    
+     /**
+     * @see Connection::getIdGenerator()
+     */
+    public function getIdGenerator()
+    {
+        require_once 'creole/drivers/mssql/MSSQLIdGenerator.php';
+        return new MSSQLIdGenerator($this);
+    }
+    
+    /**
+     * @see Connection::prepareStatement()
+     */
+    public function prepareStatement($sql) 
+    {
+        require_once 'creole/drivers/mssql/MSSQLPreparedStatement.php';
+        return new MSSQLPreparedStatement($this, $sql);
+    }
+    
+    /**
+     * @see Connection::createStatement()
+     */
+    public function createStatement()
+    {
+        require_once 'creole/drivers/mssql/MSSQLStatement.php';
+        return new MSSQLStatement($this);
+    }
+    
+    /**
+     * Returns false since MSSQL doesn't support this method.
+     */
+    public function applyLimit(&amp;$sql, $offset, $limit)
+    {
+        return false;
+    }
+    
+    /**
+     * @see Connection::close()
+     */
+    function close()
+    {
+        $ret = @mssql_close($this-&gt;dblink);
+        $this-&gt;dblink = null;
+        return $ret;
+    }
+    
+    /**
+     * @see Connection::executeQuery()
+     */
+    function executeQuery($sql, $fetchmode = null)
+    {            
+        $this-&gt;lastQuery = $sql;
+        if (!@mssql_select_db($this-&gt;database, $this-&gt;dblink)) {
+            throw new SQLException('No database selected');
+        }       
+        $result = @mssql_query($sql, $this-&gt;dblink);
+        if (!$result) {
+            throw new SQLException('Could not execute query', mssql_get_last_message());
+        }
+        return new MSSQLResultSet($this, $result, $fetchmode);
+    }
+
+    /**
+     * @see Connection::executeUpdate()
+     */
+    function executeUpdate($sql)
+    {    
+        
+        $this-&gt;lastQuery = $sql;
+        if (!mssql_select_db($this-&gt;database, $this-&gt;dblink)) {
+            throw new SQLException('No database selected');
+        }
+        
+        $result = @mssql_query($sql, $this-&gt;dblink);
+        if (!$result) {
+            throw new SQLException('Could not execute update', mssql_get_last_message(), $sql);
+        }
+        
+        return $this-&gt;getUpdateCount();
+    }
+
+    /**
+     * Start a database transaction.
+     * @throws SQLException
+     * @return void
+     */
+    protected function beginTrans()
+    {
+        $result = @mssql_query('BEGIN TRAN', $this-&gt;dblink);
+        if (!$result) {
+            throw new SQLException('Could not begin transaction', mssql_get_last_message());
+        }
+    }
+    
+    /**
+     * Commit the current transaction.
+     * @throws SQLException
+     * @return void
+     */
+    protected function commitTrans()
+    {
+        if (!@mssql_select_db($this-&gt;database, $this-&gt;dblink)) {
+            throw new SQLException('No database selected');
+        }
+        $result = @mssql_query('COMMIT TRAN', $this-&gt;dblink);
+        if (!$result) {
+            throw new SQLException('Could not commit transaction', mssql_get_last_message());
+        }
+    }
+
+    /**
+     * Roll back (undo) the current transaction.
+     * @throws SQLException
+     * @return void
+     */
+    protected function rollbackTrans()
+    {
+        if (!@mssql_select_db($this-&gt;database, $this-&gt;dblink)) {            
+            throw new SQLException('no database selected');
+        }
+        $result = @mssql_query('ROLLBACK TRAN', $this-&gt;dblink);
+        if (!$result) {
+            throw new SQLException('Could not rollback transaction', mssql_get_last_message());
+        }
+    }
+
+    /**
+     * Gets the number of rows affected by the last query.
+     * if the last query was a select, returns 0.
+     *
+     * @return int Number of rows affected by the last query
+     * @throws SQLException
+     */
+    function getUpdateCount()
+    {       
+        $res = @mssql_query('select @@rowcount', $this-&gt;dblink);
+        if (!$res) {
+            throw new SQLException('Unable to get affected row count', mssql_get_last_message());
+        }
+        $ar = @mssql_fetch_row($res);
+        if (!$ar) {
+            $result = 0;
+        } else {
+            @mssql_free_result($res);
+            $result = $ar[0];
+        }
+        
+        return $result;
+    }          
+    
+    
+    /**
+     * Creates a CallableStatement object for calling database stored procedures.
+     * 
+     * @param string $sql
+     * @return CallableStatement
+     * @throws SQLException
+     */
+    function prepareCall($sql) 
+    {             
+        require_once 'creole/drivers/mssql/MSSQLCallableStatement.php';
+        $stmt = mssql_init($sql);
+        if (!$stmt) {
+            throw new SQLException('Unable to prepare statement', mssql_get_last_message(), $sql);
+        }
+        return new MSSQLCallableStatement($this, $stmt);
+    }
+}
\ No newline at end of file

Added: trunk/vendor/creole/drivers/mssql/MSSQLIdGenerator.php
===================================================================
--- trunk/vendor/creole/drivers/mssql/MSSQLIdGenerator.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/mssql/MSSQLIdGenerator.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,62 @@
+&lt;?php
+
+require_once 'creole/IdGenerator.php';
+
+/**
+ * MSSQL IdGenerator implimenation.
+ *
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.5 $
+ * @package   creole.drivers.mssql
+ */
+class MSSQLIdGenerator implements IdGenerator {
+    
+    /** Connection object that instantiated this class */
+    private $conn;
+
+    /**
+     * Creates a new IdGenerator class, saves passed connection for use
+     * later by getId() method.
+     * @param Connection $conn
+     */
+    public function __construct(Connection $conn)
+    {
+        $this-&gt;conn = $conn;
+    }
+    
+    /**
+     * @see IdGenerator::isBeforeInsert()
+     */
+    public function isBeforeInsert()
+    {
+        return false;
+    }    
+    
+    /**
+     * @see IdGenerator::isAfterInsert()
+     */
+    public function isAfterInsert()
+    {
+        return true;
+    }
+        
+    /**
+     * @see IdGenerator::getIdMethod()
+     */
+    public function getIdMethod()
+    {
+        return self::AUTOINCREMENT;
+    }
+    
+    /**
+     * @see IdGenerator::getId()
+     */
+    public function getId($unused = null)
+    {
+        $rs = $this-&gt;conn-&gt;executeQuery(&quot;select @@identity&quot;, ResultSet::FETCHMODE_NUM);
+        $rs-&gt;next();
+        return $rs-&gt;getInt(1);        
+    }
+    
+}
+

Added: trunk/vendor/creole/drivers/mssql/MSSQLPreparedStatement.php
===================================================================
--- trunk/vendor/creole/drivers/mssql/MSSQLPreparedStatement.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/mssql/MSSQLPreparedStatement.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,98 @@
+&lt;?php
+/*
+ *  $Id: MSSQLPreparedStatement.php,v 1.12 2004/06/13 02:31:07 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+require_once 'creole/PreparedStatement.php';
+require_once 'creole/common/PreparedStatementCommon.php';
+
+/**
+ * MSSQL specific PreparedStatement functions.
+ * 
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.12 $
+ * @package   creole.drivers.mssql
+ */
+class MSSQLPreparedStatement extends PreparedStatementCommon implements PreparedStatement {
+    
+    /**
+     * MSSQL-specific implementation of setBlob().
+     * 
+     * If you are having trouble getting BLOB data into the database, see the phpdoc comment
+     * in the MSSQLConnection for some PHP ini values that may need to be set. (This also
+     * applies to CLOB support.)
+     * 
+     * @param int $paramIndex
+     * @param mixed $value Blob object or string.
+     * @return void
+     */
+    function setBlob($paramIndex, $blob) 
+    {
+        if ($blob === null) {
+            $this-&gt;setNull($paramIndex);
+        } else {
+            // they took magic __toString() out of PHP5.0.0; this sucks
+            if (is_object($blob)) {
+                $blob = $blob-&gt;__toString();
+            }            
+            $data = unpack(&quot;H*hex&quot;, $blob);
+            $this-&gt;boundInVars[$paramIndex] = '0x'.$data['hex']; // no surrounding quotes!
+        }        
+    }
+
+    
+    /**
+     * Add quotes using str_replace.
+     * This is not as thorough as MySQL.
+     */
+    protected function escape($subject)
+    {
+        // use this instead of magic_quotes_sybase + addslashes(),
+        // just in case multiple RDBMS being used at the same time
+        return str_replace(&quot;'&quot;, &quot;''&quot;, $subject);
+    }
+    
+    /**
+     * MSSQL must emulate OFFSET/LIMIT support.
+     */
+    public function executeQuery($p1 = null, $fetchmode = null)
+    {    
+        $params = null;
+        if ($fetchmode !== null) {
+            $params = $p1;
+        } elseif ($p1 !== null) {
+            if (is_array($p1)) $params = $p1;
+            else $fetchmode = $p1;
+        }
+        
+        if ($params) {
+            for($i=0,$cnt=count($params); $i &lt; $cnt; $i++) {
+                $this-&gt;set($i+1, $params[$i]);
+            }
+        }
+        
+        $this-&gt;updateCount = null; // reset
+        $sql = $this-&gt;replaceParams();                
+        
+        $this-&gt;resultSet = $this-&gt;conn-&gt;executeQuery($sql, $fetchmode);
+        $this-&gt;resultSet-&gt;_setOffset($this-&gt;offset);
+        $this-&gt;resultSet-&gt;_setLimit($this-&gt;limit);                
+        return $this-&gt;resultSet;
+    }
+}

Added: trunk/vendor/creole/drivers/mssql/MSSQLResultSet.php
===================================================================
--- trunk/vendor/creole/drivers/mssql/MSSQLResultSet.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/mssql/MSSQLResultSet.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,159 @@
+&lt;?php
+/*
+ *  $Id: MSSQLResultSet.php,v 1.20 2004/03/20 04:16:49 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+require_once 'creole/ResultSet.php';
+require_once 'creole/common/ResultSetCommon.php';
+
+/**
+ * MSSQL implementation of ResultSet.
+ *
+ * MS SQL does not support LIMIT or OFFSET natively so the methods
+ * in here need to perform some adjustments and extra checking to make sure
+ * that this behaves the same as RDBMS drivers using native OFFSET/LIMIT.
+ * 
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.20 $
+ * @package   creole.drivers.mssql
+ */
+class MSSQLResultSet extends ResultSetCommon implements ResultSet {    
+    
+    /**
+     * Offset at which to start reading rows.
+     * @var int
+     */
+    private $offset = 0;
+    
+    /**
+     * Maximum rows to retrieve, or 0 if all.
+     * @var int
+     */
+    private $limit = 0;   
+    
+    /**
+     * This MSSQL-only function exists to set offset after ResultSet is instantiated.
+     * This function should be &quot;protected&quot; in Java sense: only available to classes in package.
+     * THIS METHOD SHOULD NOT BE CALLED BY ANYTHING EXCEPTION DRIVER CLASSES.
+     * @param int $offset New offset.  If great than 0, then seek(0) will be called to move cursor.
+     * @access protected
+     */
+    public function _setOffset($offset)
+    {
+        $this-&gt;offset = $offset;
+        if ($offset &gt; 0) {
+            $this-&gt;seek(0);  // 0 becomes $offset by seek() method
+        }
+    }
+    
+    /**
+     * This MSSQL-only function exists to set limit after ResultSet is instantiated.
+     * This function should be &quot;protected&quot; in Java sense: only available to classes in package.
+     * THIS METHOD SHOULD NOT BE CALLED BY ANYTHING EXCEPTION DRIVER CLASSES.
+     * @param int $limit New limit.
+     * @access protected
+     */
+    public function _setLimit($limit)
+    {
+        $this-&gt;limit = $limit;
+    }
+    
+    /**
+     * @see ResultSet::seek()
+     */ 
+    function seek($rownum)
+    {
+        // support emulated OFFSET
+        $actual = $rownum + $this-&gt;offset;
+        
+        if (($this-&gt;limit &gt; 0 &amp;&amp; $rownum &gt;= $this-&gt;limit) || $rownum &lt; 0) {
+                    // have to check for rownum &lt; 0, because mssql_seek() won't
+                    // complain if the $actual is valid.
+            return false;
+        }
+                
+        // MSSQL rows start w/ 0, but this works, because we are
+        // looking to move the position _before_ the next desired position
+         if (!@mssql_data_seek($this-&gt;result, $actual)) {
+                return false;
+        }
+
+        $this-&gt;cursorPos = $rownum;
+        return true;
+    }
+    
+    /**
+     * @see ResultSet::next()
+     */
+    function next()
+    {
+        // support emulated LIMIT
+        if ( $this-&gt;limit &gt; 0 &amp;&amp; ($this-&gt;cursorPos &gt;= $this-&gt;limit) ) {
+            $this-&gt;afterLast();
+            return false;
+        }
+        
+        $this-&gt;fields = mssql_fetch_array($this-&gt;result, $this-&gt;fetchmode);        
+                
+        if (!$this-&gt;fields) {
+            if ($errmsg = mssql_get_last_message()) {
+                throw new SQLWarning(&quot;Error fetching result&quot;, $errmsg);
+             } else {
+                // We've advanced beyond end of recordset.
+                $this-&gt;afterLast();
+                return false;
+             }          
+        }
+        
+        if (!$this-&gt;ignoreAssocCase) {
+            $this-&gt;fields = array_change_key_case($this-&gt;fields, CASE_LOWER);
+        }
+        
+        // Advance cursor position
+        $this-&gt;cursorPos++;
+        return true;
+    }
+    
+    /**
+     * @see ResultSet::getRecordCount()
+     */
+    function getRecordCount()
+    {
+        $rows = @mssql_num_rows($this-&gt;result);
+        if ($rows === null) {
+            throw new SQLException('Error getting record count', mssql_get_last_message());
+        }
+        // adjust count based on emulated LIMIT/OFFSET
+        $rows -= $this-&gt;offset;
+        return ($this-&gt;limit &gt; 0 &amp;&amp; $rows &gt; $this-&gt;limit ? $this-&gt;limit : $rows);
+    }
+
+    /**
+     * @see ResultSet::close()
+     */ 
+    function close()
+    {
+        $ret = @mssql_free_result($this-&gt;result);
+        $this-&gt;result = false;
+        $this-&gt;fields = array();
+        $this-&gt;limit = 0;
+        $this-&gt;offset = 0;        
+    }   
+
+}

Added: trunk/vendor/creole/drivers/mssql/MSSQLStatement.php
===================================================================
--- trunk/vendor/creole/drivers/mssql/MSSQLStatement.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/mssql/MSSQLStatement.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,72 @@
+&lt;?php
+/*
+ *  $Id: MSSQLStatement.php,v 1.4 2004/06/13 02:31:07 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+require_once 'creole/common/StatementCommon.php';
+require_once 'creole/Statement.php';
+
+/**
+ * Class that contains MSSQL functionality for Statements.
+ * 
+ * @author   Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version  $Revision: 1.4 $
+ * @package  creole.drivers.mssql
+ */
+class MSSQLStatement extends StatementCommon implements Statement {
+    
+    /**
+     * Executes the SQL query in this PreparedStatement object and returns the resultset generated by the query.
+     * 
+     * @param string $sql This method may optionally be called with the SQL statement.
+     * @param int $fetchmode The mode to use when fetching the results (e.g. ResultSet::FETCHMODE_NUM, ResultSet::FETCHMODE_ASSOC).
+     * @return object Creole::ResultSet
+     * @throws SQLException If there is an error executing the specified query.
+     */
+    public function executeQuery($sql, $fetchmode = null)
+    {
+        $this-&gt;updateCount = null;                
+        $this-&gt;resultSet = $this-&gt;conn-&gt;executeQuery($sql, $fetchmode);
+        $this-&gt;resultSet-&gt;_setOffset($this-&gt;offset);
+        $this-&gt;resultSet-&gt;_setLimit($this-&gt;limit);
+        return $this-&gt;resultSet;
+    }
+
+
+    /**
+     * Gets next result set (if this behavior is supported by driver).
+     * Some drivers (e.g. MSSQL) support returning multiple result sets -- e.g.
+     * from stored procedures.
+     *
+     * This function also closes any current restult set.
+     *
+     * Default behavior is for this function to return false.  Driver-specific
+     * implementations of this class can override this method if they actually
+     * support multiple result sets.
+     * 
+     * @return boolean True if there is another result set, otherwise false.
+     */
+    public function getMoreResults()
+    {
+        if ($this-&gt;resultSet) $this-&gt;resultSet-&gt;close();        
+        $this-&gt;resultSet = null;
+        return false;        
+    }
+         
+}

Added: trunk/vendor/creole/drivers/mssql/MSSQLTypes.php
===================================================================
--- trunk/vendor/creole/drivers/mssql/MSSQLTypes.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/mssql/MSSQLTypes.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,94 @@
+&lt;?php
+
+/*
+ *  $Id: MSSQLTypes.php,v 1.8 2004/07/27 23:16:50 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+ 
+require_once 'creole/CreoleTypes.php';
+
+/**
+ * MSSQL types / type map.
+ *
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.8 $
+ * @package   creole.drivers.mssql
+ */
+class MSSQLTypes extends CreoleTypes {
+
+    /** Map PostgreSQL native types to Creole (JDBC) types. */
+    private static $typeMap = array (
+                &quot;binary&quot; =&gt; CreoleTypes::BINARY,
+                &quot;bit&quot; =&gt; CreoleTypes::BOOLEAN, 
+                &quot;char&quot; =&gt; CreoleTypes::CHAR,
+                &quot;datetime&quot; =&gt; CreoleTypes::TIMESTAMP,
+                &quot;decimal() identity&quot;  =&gt; CreoleTypes::DECIMAL,
+                &quot;decimal&quot;  =&gt; CreoleTypes::DECIMAL,                
+                &quot;image&quot; =&gt; CreoleTypes::LONGVARBINARY,
+                &quot;int&quot; =&gt; CreoleTypes::INTEGER,
+                &quot;int identity&quot; =&gt; CreoleTypes::INTEGER,
+                &quot;integer&quot; =&gt; CreoleTypes::INTEGER,
+                &quot;money&quot; =&gt; CreoleTypes::DECIMAL, 
+                &quot;nchar&quot; =&gt; CreoleTypes::CHAR, 
+                &quot;ntext&quot; =&gt; CreoleTypes::LONGVARCHAR, 
+                &quot;numeric() identity&quot; =&gt; CreoleTypes::NUMERIC,
+                &quot;numeric&quot; =&gt; CreoleTypes::NUMERIC,                  
+                &quot;nvarchar&quot; =&gt; CreoleTypes::VARCHAR,
+                &quot;real&quot; =&gt; CreoleTypes::REAL, 
+                &quot;float&quot; =&gt; CreoleTypes::FLOAT,
+                &quot;smalldatetime&quot; =&gt; CreoleTypes::TIMESTAMP, 
+                &quot;smallint&quot; =&gt; CreoleTypes::SMALLINT, 
+                &quot;smallint identity&quot; =&gt; CreoleTypes::SMALLINT,
+                &quot;smallmoney&quot; =&gt; CreoleTypes::DECIMAL,
+                &quot;sysname&quot; =&gt; CreoleTypes::VARCHAR,
+                &quot;text&quot; =&gt; CreoleTypes::LONGVARCHAR,
+                &quot;timestamp&quot; =&gt; CreoleTypes::BINARY,
+                &quot;tinyint identity&quot; =&gt; CreoleTypes::TINYINT, 
+                &quot;tinyint&quot; =&gt; CreoleTypes::TINYINT,                 
+                &quot;uniqueidentifier&quot; =&gt; CreoleTypes::CHAR,
+                &quot;varbinary&quot; =&gt; CreoleTypes::VARBINARY,
+                &quot;varchar&quot; =&gt; CreoleTypes::VARCHAR,
+                &quot;uniqueidentifier&quot; =&gt; CreoleTypes::CHAR,
+                // SQL Server 2000 only
+                &quot;bigint identity&quot; =&gt; CreoleTypes::BIGINT,
+                &quot;bigint&quot; =&gt; CreoleTypes::BIGINT,                
+                &quot;sql_variant&quot; =&gt; CreoleTypes::VARCHAR,
+                ); 
+                 
+    /** Reverse lookup map, created on demand. */
+    private static $reverseMap = null;
+    
+    public static function getType($mssqlType)
+    {    
+        $t = strtolower($mssqlType);
+        if (isset(self::$typeMap[$t])) {
+            return self::$typeMap[$t];
+        } else {
+            return CreoleTypes::OTHER;
+        }
+    }
+    
+    public static function getNativeType($creoleType)
+    {
+        if (self::$reverseMap === null) {
+            self::$reverseMap = array_flip(self::$typeMap);
+        }
+        return @self::$reverseMap[$creoleType];
+    }
+    
+}
\ No newline at end of file

Added: trunk/vendor/creole/drivers/mssql/metadata/MSSQLDatabaseInfo.php
===================================================================
--- trunk/vendor/creole/drivers/mssql/metadata/MSSQLDatabaseInfo.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/mssql/metadata/MSSQLDatabaseInfo.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,69 @@
+&lt;?php
+/*
+ *  $Id: MSSQLDatabaseInfo.php,v 1.10 2004/06/27 04:26:13 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+require_once 'creole/metadata/DatabaseInfo.php';
+
+/**
+ * MSSQL impementation of DatabaseInfo.
+ *
+ * @author    Hans Lellelid
+ * @version   $Revision: 1.10 $
+ * @package   creole.drivers.mssql.metadata
+ */ 
+class MSSQLDatabaseInfo extends DatabaseInfo {
+    
+    /**
+     * @throws SQLException
+     * @return void
+     */
+    protected function initTables()
+    {
+        include_once 'creole/drivers/mssql/metadata/MSSQLTableInfo.php';
+        
+        $dsn = $this-&gt;conn-&gt;getDSN();
+        
+        
+        if (!@mssql_select_db($this-&gt;dbname, $this-&gt;dblink)) {
+            throw new SQLException('No database selected');
+        }
+             
+        $result = mssql_query(&quot;SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE = 'BASE TABLE' AND TABLE_NAME &lt;&gt; 'dtproperties'&quot;, $this-&gt;dblink);
+    
+        if (!$result) {
+            throw new SQLException(&quot;Could not list tables&quot;, mssql_get_last_message());            
+        }
+        
+        while ($row = mssql_fetch_row($result)) {
+            $this-&gt;tables[strtoupper($row[0])] = new MSSQLTableInfo($this, $row[0]);            
+        }
+    }            
+    
+    /**
+     * 
+     * @return void 
+     * @throws SQLException
+     */
+    protected function initSequences()
+    {
+        // there are no sequences -- afaik -- in MSSQL.
+    }
+        
+}

Added: trunk/vendor/creole/drivers/mssql/metadata/MSSQLTableInfo.php
===================================================================
--- trunk/vendor/creole/drivers/mssql/metadata/MSSQLTableInfo.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/mssql/metadata/MSSQLTableInfo.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,178 @@
+&lt;?php
+/*
+ *  $Id: MSSQLTableInfo.php,v 1.12 2004/12/17 09:58:40 micha Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+require_once 'creole/CreoleTypes.php';
+require_once 'creole/metadata/TableInfo.php';
+
+/**
+ * MSSQL implementation of TableInfo.
+ * 
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.12 $
+ * @package   creole.drivers.mssql.metadata
+ */
+class MSSQLTableInfo extends TableInfo {    
+    
+    /**
+     * Loads the columns for this table.
+     * @return void
+     */                          
+    protected function initColumns() 
+    {    
+        include_once 'creole/metadata/ColumnInfo.php';
+        include_once 'creole/drivers/mssql/MSSQLTypes.php';
+        
+        if (!@mssql_select_db($this-&gt;dbname, $this-&gt;dblink)) {
+            throw new SQLException('No database selected');
+        }
+         
+        $res = mssql_query(&quot;sp_columns &quot;.$this-&gt;name, $this-&gt;dblink);
+        if (!$res) {
+            throw new SQLException('Could not get column names', mssql_get_last_message());
+        }
+        
+        while ($row = mssql_fetch_array($res)) {
+            $name = $row['COLUMN_NAME'];
+            $type = $row['TYPE_NAME'];
+            $length = $row['LENGTH'];
+            $is_nullable = $row['NULLABLE'];
+            $default = $row['COLUMN_DEF'];
+            $precision = $row['PRECISION'];
+            $this-&gt;columns[$name] = new ColumnInfo($this, $name, MSSQLTypes::getType($type), $type, $length, $precision, $is_nullable, $default);
+        }
+                
+        $this-&gt;colsLoaded = true;
+    }
+
+    /**
+     * Loads the indexes for this table.
+     * @return void
+     */      
+    protected function initIndexes()
+    {
+        // columns have to be loaded first
+        if (!$this-&gt;colsLoaded) $this-&gt;initColumns();
+        include_once 'creole/metadata/IndexInfo.php';
+        
+        if (!@mssql_select_db($this-&gt;dbname, $this-&gt;dblink)) {
+            throw new SQLException('No database selected');
+        } 
+        
+        $res = mssql_query(&quot;sp_indexes_rowset &quot;.$this-&gt;name, $this-&gt;dblink);
+        
+        while ($row = mssql_fetch_array($res)) {
+            $name = $row['INDEX_NAME'];            
+            // All primary keys are indexes (right...?)
+            if (!isset($this-&gt;indexes[$name])) {
+                $this-&gt;indexes[$name] = new IndexInfo($name);
+            }
+            $this-&gt;indexes[$name]-&gt;addColumn($this-&gt;columns[ $row['COLUMN_NAME'] ]);
+        }
+        
+        $this-&gt;indexesLoaded = true;        
+    }
+
+    /**
+     * Loads the foreign keys for this table.
+     * @return void
+     */      
+    protected function initForeignKeys()
+    {
+        // columns have to be loaded first
+        if (!$this-&gt;colsLoaded) $this-&gt;initColumns();
+        include_once 'creole/metadata/ForeignKeyInfo.php';
+        
+        if (!@mssql_select_db($this-&gt;dbname, $this-&gt;dblink)) {
+            throw new SQLException('No database selected');
+        } 
+        
+        $res = mssql_query(&quot;SELECT     ccu1.TABLE_NAME, ccu1.COLUMN_NAME, ccu2.TABLE_NAME AS FK_TABLE_NAME, ccu2.COLUMN_NAME AS FK_COLUMN_NAME
+                            FROM         INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE ccu1 INNER JOIN
+                                      INFORMATION_SCHEMA.TABLE_CONSTRAINTS tc1 ON tc1.CONSTRAINT_NAME = ccu1.CONSTRAINT_NAME AND 
+                                      CONSTRAINT_TYPE = 'Foreign Key' INNER JOIN
+                                      INFORMATION_SCHEMA.REFERENTIAL_CONSTRAINTS rc1 ON rc1.CONSTRAINT_NAME = tc1.CONSTRAINT_NAME INNER JOIN
+                                      INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE ccu2 ON ccu2.CONSTRAINT_NAME = rc1.UNIQUE_CONSTRAINT_NAME
+                            WHERE     (ccu1.table_name = '&quot;.$this-&gt;name.&quot;')&quot;, $this-&gt;dblink);
+        
+        while($row = mssql_fetch_array($res)) {
+            $name = $row['COLUMN_NAME'];
+            $ftbl = $row['FK_TABLE_NAME'];
+            $fcol = $row['FK_COLUMN_NAME'];
+
+            if (!isset($this-&gt;foreignKeys[$name])) {
+                $this-&gt;foreignKeys[$name] = new ForeignKeyInfo($name);
+
+                if ($this-&gt;database-&gt;hasTable($ftbl)) {
+                    $foreignTable = $this-&gt;database-&gt;getTable($ftbl);
+                } else {                
+                    $foreignTable = new TableInfo($ltbl);
+                    $this-&gt;database-&gt;addTable($foreignTable);
+                }
+
+                if ($foreignTable-&gt;hasColumn($fcol)) {
+                    $foreignCol = $foreignTable-&gt;getColumn($fcol);
+                } else {                
+                    $foreignCol = new ColumnInfo($foreignTable, $fcol);
+                    $foreignTable-&gt;addColumn($foreignCol);
+                }
+                                
+                $this-&gt;foreignKeys[$name]-&gt;addReference($this-&gt;columns[$name], $foreignCol);
+            }
+        }
+        
+        $this-&gt;fksLoaded = true;
+    }
+
+    /**
+     * Loads the primary key info for this table.
+     * @return void
+     */      
+    protected function initPrimaryKey()
+    {
+        // columns have to be loaded first
+        if (!$this-&gt;colsLoaded) $this-&gt;initColumns();
+        include_once 'creole/metadata/PrimaryKeyInfo.php';
+        
+        if (!@mssql_select_db($this-&gt;dbname, $this-&gt;dblink)) {
+            throw new SQLException('No database selected');
+        } 
+        
+        $res = mssql_query(&quot;SELECT COLUMN_NAME 
+                        FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS 
+                                INNER JOIN INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE ON 
+                      INFORMATION_SCHEMA.TABLE_CONSTRAINTS.CONSTRAINT_NAME = INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE.constraint_name
+                        WHERE     (INFORMATION_SCHEMA.TABLE_CONSTRAINTS.CONSTRAINT_TYPE = 'PRIMARY KEY') AND 
+                      (INFORMATION_SCHEMA.TABLE_CONSTRAINTS.TABLE_NAME = '&quot;.$this-&gt;name.&quot;')&quot;, $this-&gt;dblink);
+        
+        // Loop through the returned results, grouping the same key_name together.
+        // name of the primary key will be the first column name in the key.
+        while($row = mssql_fetch_row($res)) {
+            $name = $row[0];            
+            if (!isset($this-&gt;primaryKey)) {
+                $this-&gt;primaryKey = new PrimaryKeyInfo($name);
+            }
+            $this-&gt;primaryKey-&gt;addColumn($this-&gt;columns[ $name ]);
+        }        
+        
+        $this-&gt;pkLoaded = true;
+    }    
+    
+}

Added: trunk/vendor/creole/drivers/mysql/MySQLConnection.php
===================================================================
--- trunk/vendor/creole/drivers/mysql/MySQLConnection.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/mysql/MySQLConnection.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,285 @@
+&lt;?php
+/*
+ *  $Id: MySQLConnection.php,v 1.18 2004/09/01 14:00:28 dlawson_mi Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+ 
+require_once 'creole/Connection.php';
+require_once 'creole/common/ConnectionCommon.php';
+include_once 'creole/drivers/mysql/MySQLResultSet.php';
+
+/**
+ * MySQL implementation of Connection.
+ * 
+ * 
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @author    Stig Bakken &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">ssb at fast.no</A>&gt; 
+ * @author    Lukas Smith
+ * @version   $Revision: 1.18 $
+ * @package   creole.drivers.mysql
+ */ 
+class MySQLConnection extends ConnectionCommon implements Connection {
+
+    /** Current database (used in mysql_select_db()). */
+    private $database;
+    
+    /**
+     * Connect to a database and log in as the specified user.
+     *
+     * @param $dsn the data source name (see DB::parseDSN for syntax)
+     * @param $flags Any conneciton flags.
+     * @access public
+     * @throws SQLException
+     * @return void
+     */
+    function connect($dsninfo, $flags = 0)
+    {
+        if (!extension_loaded('mysql')) {
+            throw new SQLException('mysql extension not loaded');
+        }
+
+        $this-&gt;dsn = $dsninfo;
+        $this-&gt;flags = $flags;
+        
+        $persistent = ($flags &amp; Creole::PERSISTENT) === Creole::PERSISTENT;
+
+        if (isset($dsninfo['protocol']) &amp;&amp; $dsninfo['protocol'] == 'unix') {
+            $dbhost = ':' . $dsninfo['socket'];
+        } else {
+            $dbhost = $dsninfo['hostspec'] ? $dsninfo['hostspec'] : 'localhost';
+            if (!empty($dsninfo['port'])) {
+                $dbhost .= ':' . $dsninfo['port'];
+            }
+        }
+        $user = $dsninfo['username'];
+        $pw = $dsninfo['password'];
+
+        $connect_function = $persistent ? 'mysql_pconnect' : 'mysql_connect';
+
+        @ini_set('track_errors', true);
+        if ($dbhost &amp;&amp; $user &amp;&amp; $pw) {
+            $conn = @$connect_function($dbhost, $user, $pw);
+        } elseif ($dbhost &amp;&amp; $user) {
+            $conn = @$connect_function($dbhost, $user);
+        } elseif ($dbhost) {
+            $conn = @$connect_function($dbhost);
+        } else {
+            $conn = false;
+        }
+        @ini_restore('track_errors');
+        if (empty($conn)) {
+            if (($err = @mysql_error()) != '') {
+                throw new SQLException(&quot;connect failed&quot;, $err);
+            } elseif (empty($php_errormsg)) {
+                throw new SQLException(&quot;connect failed&quot;);
+            } else {
+                throw new SQLException(&quot;connect failed&quot;, $php_errormsg);
+            }
+        }
+
+        if ($dsninfo['database']) {
+            if (!@mysql_select_db($dsninfo['database'], $conn)) {
+               switch(mysql_errno($conn)) {
+                        case 1049:
+                            $exc = new SQLException(&quot;no such database&quot;, mysql_error($conn));         
+                        break;
+                        case 1044:
+                            $exc = new SQLException(&quot;access violation&quot;, mysql_error($conn));
+                        break;
+                        default:
+                           $exc = new SQLException(&quot;cannot select database&quot;, mysql_error($conn));
+                }
+                
+                throw $exc;
+                
+            }
+            // fix to allow calls to different databases in the same script
+            $this-&gt;database = $dsninfo['database'];
+        }
+
+        $this-&gt;dblink = $conn;
+        
+    }    
+    
+    /**
+     * @see Connection::getDatabaseInfo()
+     */
+    public function getDatabaseInfo()
+    {
+        require_once 'creole/drivers/mysql/metadata/MySQLDatabaseInfo.php';
+        return new MySQLDatabaseInfo($this);
+    }
+    
+    /**
+     * @see Connection::getIdGenerator()
+     */
+    public function getIdGenerator()
+    {
+        require_once 'creole/drivers/mysql/MySQLIdGenerator.php';
+        return new MySQLIdGenerator($this);
+    }
+    
+    /**
+     * @see Connection::prepareStatement()
+     */
+    public function prepareStatement($sql) 
+    {
+        require_once 'creole/drivers/mysql/MySQLPreparedStatement.php';
+        return new MySQLPreparedStatement($this, $sql);
+    }
+    
+    /**
+     * @see Connection::prepareCall()
+     */
+    public function prepareCall($sql) {
+        throw new SQLException('MySQL does not support stored procedures.');
+    }
+    
+    /**
+     * @see Connection::createStatement()
+     */
+    public function createStatement()
+    {
+        require_once 'creole/drivers/mysql/MySQLStatement.php';
+        return new MySQLStatement($this);
+    }
+        
+    /**
+     * @see Connection::disconnect()
+     */
+    function close()
+    {
+        $ret = mysql_close($this-&gt;dblink);
+        $this-&gt;dblink = null;
+        return $ret;
+    }
+    
+    /**
+     * @see Connection::applyLimit()
+     */
+    public function applyLimit(&amp;$sql, $offset, $limit)
+    {
+        if ( $limit &gt; 0 ) {
+            $sql .= &quot; LIMIT &quot; . ($offset &gt; 0 ? $offset . &quot;, &quot; : &quot;&quot;) . $limit;
+        } else if ( $offset &gt; 0 ) {
+            $sql .= &quot; LIMIT &quot; . $offset . &quot;, 18446744073709551615&quot;;
+        }
+    }
+
+    /**
+     * @see Connection::executeQuery()
+     */
+    function executeQuery($sql, $fetchmode = null)
+    {
+        $this-&gt;lastQuery = $sql;
+        if ($this-&gt;database) {
+            if (!@mysql_select_db($this-&gt;database, $this-&gt;dblink)) {
+                throw new SQLException('No database selected', mysql_error($this-&gt;dblink));
+            }
+        }
+        $result = @mysql_query($sql, $this-&gt;dblink);
+        if (!$result) {
+            throw new SQLException('Could not execute query', mysql_error($this-&gt;dblink), $sql);
+        }
+        return new MySQLResultSet($this, $result, $fetchmode);
+    }
+    
+    /**
+     * @see Connection::executeUpdate()
+     */
+    function executeUpdate($sql)
+    {    
+        $this-&gt;lastQuery = $sql;
+
+        if ($this-&gt;database) {
+            if (!@mysql_select_db($this-&gt;database, $this-&gt;dblink)) {
+                    throw new SQLException('No database selected', mysql_error($this-&gt;dblink));
+            }
+        }
+        
+        $result = @mysql_query($sql, $this-&gt;dblink);
+        if (!$result) {
+            throw new SQLException('Could not execute update', mysql_error($this-&gt;dblink), $sql);
+        }        
+        return (int) mysql_affected_rows($this-&gt;dblink);
+    }
+
+    /**
+     * Start a database transaction.
+     * @throws SQLException
+     * @return void
+     */
+    protected function beginTrans()
+    {
+        $result = @mysql_query('SET AUTOCOMMIT=0', $this-&gt;dblink);
+        $result = @mysql_query('BEGIN', $this-&gt;dblink);
+        if (!$result) {
+            throw new SQLException('Could not begin transaction', mysql_error($this-&gt;dblink));
+        }
+    }
+        
+    /**
+     * Commit the current transaction.
+     * @throws SQLException
+     * @return void
+     */
+    protected function commitTrans()
+    {
+        if ($this-&gt;database) {
+            if (!@mysql_select_db($this-&gt;database, $this-&gt;dblink)) {
+                 throw new SQLException('No database selected', mysql_error($this-&gt;dblink));
+            }
+        }
+        $result = @mysql_query('COMMIT', $this-&gt;dblink);
+        $result = @mysql_query('SET AUTOCOMMIT=1', $this-&gt;dblink);
+        if (!$result) {
+            throw new SQLException('Can not commit transaction', mysql_error($this-&gt;dblink));                
+        }
+    }
+
+    /**
+     * Roll back (undo) the current transaction.
+     * @throws SQLException
+     * @return void
+     */
+    protected function rollbackTrans()
+    {
+        if ($this-&gt;database) {
+            if (!@mysql_select_db($this-&gt;database, $this-&gt;dblink)) {
+                throw new SQLException('No database selected', mysql_error($this-&gt;dblink));
+            }
+        }
+        $result = @mysql_query('ROLLBACK', $this-&gt;dblink);
+        $result = @mysql_query('SET AUTOCOMMIT=1', $this-&gt;dblink);
+        if (!$result) {
+            throw new SQLException('Could not rollback transaction', mysql_error($this-&gt;dblink));
+        }
+    }
+
+    /**
+     * Gets the number of rows affected by the data manipulation
+     * query.
+     *
+     * @return int Number of rows affected by the last query.
+     */
+    function getUpdateCount()
+    {
+        return (int) @mysql_affected_rows($this-&gt;dblink);
+    }
+    
+}
\ No newline at end of file

Added: trunk/vendor/creole/drivers/mysql/MySQLIdGenerator.php
===================================================================
--- trunk/vendor/creole/drivers/mysql/MySQLIdGenerator.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/mysql/MySQLIdGenerator.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,75 @@
+&lt;?php
+
+require_once 'creole/IdGenerator.php';
+
+/**
+ * MySQL IdGenerator implimenation.
+ *
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.6 $
+ * @package   creole.drivers.mysql
+ */
+class MySQLIdGenerator implements IdGenerator {
+    
+    /** Connection object that instantiated this class */
+    private $conn;
+
+    /**
+     * Creates a new IdGenerator class, saves passed connection for use
+     * later by getId() method.
+     * @param Connection $conn
+     */
+    public function __construct(Connection $conn)
+    {
+        $this-&gt;conn = $conn;
+    }
+    
+    /**
+     * @see IdGenerator::isBeforeInsert()
+     */
+    public function isBeforeInsert()
+    {
+        return false;
+    }    
+    
+    /**
+     * @see IdGenerator::isAfterInsert()
+     */
+    public function isAfterInsert()
+    {
+        return true;
+    }
+        
+    /**
+     * @see IdGenerator::getIdMethod()
+     */
+    public function getIdMethod()
+    {
+        return self::AUTOINCREMENT;
+    }
+    
+    /**
+     * Returns last-generated auto-increment ID.
+     * 
+     * Note that for very large values (2,147,483,648 to 9,223,372,036,854,775,807) a string
+     * will be returned, because these numbers are larger than supported by PHP's native
+     * numeric datatypes.
+     * 
+     * @see IdGenerator::getId()
+     */
+    public function getId($unused = null)
+    {
+        $insert_id = mysql_insert_id($this-&gt;conn-&gt;getResource());
+        if ( $insert_id &lt; 0 ) {
+            $insert_id = null;
+            $result = mysql_query('SELECT LAST_INSERT_ID()', $this-&gt;conn-&gt;getResource());
+            if ( $result ) {
+                $row = mysql_fetch_row($result);
+                $insert_id = $row ? $row[0] : null;
+            }
+        }
+        return $insert_id;
+    }
+    
+}
+

Added: trunk/vendor/creole/drivers/mysql/MySQLPreparedStatement.php
===================================================================
--- trunk/vendor/creole/drivers/mysql/MySQLPreparedStatement.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/mysql/MySQLPreparedStatement.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,44 @@
+&lt;?php
+/*
+ *  $Id: MySQLPreparedStatement.php,v 1.6 2004/03/20 04:16:49 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+ 
+require_once 'creole/PreparedStatement.php';
+require_once 'creole/common/PreparedStatementCommon.php';
+
+/**
+ * MySQL subclass for prepared statements.
+ * 
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.6 $
+ * @package   creole.drivers.mysql
+ */
+class MySQLPreparedStatement extends PreparedStatementCommon implements PreparedStatement {        
+    
+    /**
+     * Quotes string using native mysql function.
+     * @param string $str
+     * @return string
+     */
+    protected function escape($str)
+    {
+        return mysql_escape_string($str);
+    }    
+    
+}

Added: trunk/vendor/creole/drivers/mysql/MySQLResultSet.php
===================================================================
--- trunk/vendor/creole/drivers/mysql/MySQLResultSet.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/mysql/MySQLResultSet.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,148 @@
+&lt;?php
+/*
+ *  $Id: MySQLResultSet.php,v 1.23 2005/09/16 13:09:50 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+ 
+require_once 'creole/ResultSet.php';
+require_once 'creole/common/ResultSetCommon.php';
+
+/**
+ * MySQL implementation of ResultSet class.
+ *
+ * MySQL supports OFFSET / LIMIT natively; this means that no adjustments or checking
+ * are performed.  We will assume that if the lmitSQL() operation failed that an
+ * exception was thrown, and that OFFSET/LIMIT will never be emulated for MySQL.
+ * 
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.23 $
+ * @package   creole.drivers.mysql
+ */
+class MySQLResultSet extends ResultSetCommon implements ResultSet {
+
+    /**
+     * @see ResultSet::seek()
+     */ 
+    public function seek($rownum)
+    {
+        // MySQL rows start w/ 0, but this works, because we are
+        // looking to move the position _before_ the next desired position
+         if (!@mysql_data_seek($this-&gt;result, $rownum)) {
+                return false;
+        }
+        $this-&gt;cursorPos = $rownum;
+        return true;
+    }
+    
+    /**
+     * @see ResultSet::next()
+     */ 
+    public function next()
+    {
+        $this-&gt;fields = mysql_fetch_array($this-&gt;result, $this-&gt;fetchmode);        
+
+           if (!$this-&gt;fields) {
+            $errno = mysql_errno($this-&gt;conn-&gt;getResource());
+            if (!$errno) {
+                // We've advanced beyond end of recordset.
+                $this-&gt;afterLast();
+                return false;
+            } else {
+                throw new SQLException(&quot;Error fetching result&quot;, mysql_error($this-&gt;conn-&gt;getResource()));
+            }
+        }
+        
+        if (!$this-&gt;ignoreAssocCase) {
+            $this-&gt;fields = array_change_key_case($this-&gt;fields, CASE_LOWER);
+        }
+        
+        // Advance cursor position
+        $this-&gt;cursorPos++;                
+        return true;
+    }
+
+    /**
+     * @see ResultSet::getRecordCount()
+     */
+    function getRecordCount()
+    {
+        $rows = @mysql_num_rows($this-&gt;result);
+        if ($rows === null) {
+            throw new SQLException(&quot;Error fetching num rows&quot;, mysql_error($this-&gt;conn-&gt;getResource()));
+        }
+        return (int) $rows;
+    }
+
+    /**
+     * @see ResultSet::close()
+     */ 
+    function close()
+    {        
+        @mysql_free_result($this-&gt;result);
+        $this-&gt;fields = array();
+    }    
+        
+    /**
+     * Get string version of column.
+     * No rtrim() necessary for MySQL, as this happens natively.
+     * @see ResultSet::getString()
+     */
+    public function getString($column) 
+    {
+        $idx = (is_int($column) ? $column - 1 : $column);
+        if (!array_key_exists($idx, $this-&gt;fields)) { throw new SQLException(&quot;Invalid resultset column: &quot; . $column); }
+        if ($this-&gt;fields[$idx] === null) { return null; }
+        return (string) $this-&gt;fields[$idx];
+    }
+    
+    /**
+     * Returns a unix epoch timestamp based on either a TIMESTAMP or DATETIME field.
+     * @param mixed $column Column name (string) or index (int) starting with 1.
+     * @return string
+     * @throws SQLException - If the column specified is not a valid key in current field array.
+     */
+    function getTimestamp($column, $format='Y-m-d H:i:s') 
+    {
+        if (is_int($column)) { $column--; } // because Java convention is to start at 1 
+        if (!array_key_exists($column, $this-&gt;fields)) { throw new SQLException(&quot;Invalid resultset column: &quot; . (is_int($column) ? $column + 1 : $column)); }
+        if ($this-&gt;fields[$column] === null) { return null; }
+        
+        $ts = strtotime($this-&gt;fields[$column]);
+        if ($ts === -1 || $ts === false) { // in PHP 5.1 return value changes to FALSE
+            // otherwise it's an ugly MySQL timestamp!
+            // YYYYMMDDHHMMSS
+            if (preg_match('/([\d]{4})([\d]{2})([\d]{2})([\d]{2})([\d]{2})([\d]{2})/', $this-&gt;fields[$column], $matches)) {
+                //              YYYY      MM        DD      HH        MM       SS
+                //                $1        $2          $3      $4        $5         $6
+                $ts = mktime($matches[4], $matches[5], $matches[6], $matches[2], $matches[3], $matches[1]);        
+            }
+        }
+        if ($ts === -1 || $ts === false) { // if it's still -1, then there's nothing to be done; use a different method.
+            throw new SQLException(&quot;Unable to convert value at column &quot; . (is_int($column) ? $column + 1 : $column) . &quot; to timestamp: &quot; . $this-&gt;fields[$column]);
+        }        
+        if ($format === null) {
+            return $ts;
+        }
+        if (strpos($format, '%') !== false) {
+            return strftime($format, $ts);
+        } else {
+            return date($format, $ts);
+        }
+    }
+
+}

Added: trunk/vendor/creole/drivers/mysql/MySQLStatement.php
===================================================================
--- trunk/vendor/creole/drivers/mysql/MySQLStatement.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/mysql/MySQLStatement.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,36 @@
+&lt;?php
+/*
+ *  $Id: MySQLStatement.php,v 1.1 2004/02/19 02:49:42 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+ 
+require_once 'creole/Statement.php';
+require_once 'creole/common/StatementCommon.php';
+
+/**
+ * MySQL Statement
+ * 
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @author    Stig Bakken &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">ssb at fast.no</A>&gt; 
+ * @author    Lukas Smith
+ * @version   $Revision: 1.1 $
+ * @package   creole.drivers.mysql
+ */ 
+class MySQLStatement extends StatementCommon implements Statement {   
+    
+}

Added: trunk/vendor/creole/drivers/mysql/MySQLTypes.php
===================================================================
--- trunk/vendor/creole/drivers/mysql/MySQLTypes.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/mysql/MySQLTypes.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,102 @@
+&lt;?php
+
+/*
+ *  $Id: MySQLTypes.php,v 1.8 2005/02/10 09:22:40 pachanga Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+require_once 'creole/CreoleTypes.php';
+
+/**
+ * MySQL types / type map.
+ *
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.8 $
+ * @package   creole.drivers.mysql
+ */
+class MySQLTypes extends CreoleTypes {
+
+    /** Map MySQL native types to Creole (JDBC) types. */
+    private static $typeMap = array(
+                                'tinyint' =&gt; CreoleTypes::TINYINT,
+                                'smallint' =&gt; CreoleTypes::SMALLINT,
+                                'mediumint' =&gt; CreoleTypes::SMALLINT,
+                                'int' =&gt; CreoleTypes::INTEGER,
+                                'integer' =&gt; CreoleTypes::INTEGER,
+                                'bigint' =&gt; CreoleTypes::BIGINT,
+                                'int24' =&gt; CreoleTypes::BIGINT,
+                                'real' =&gt; CreoleTypes::REAL,
+                                'float' =&gt; CreoleTypes::FLOAT,
+                                'decimal' =&gt; CreoleTypes::DECIMAL,
+                                'numeric' =&gt; CreoleTypes::NUMERIC,
+                                'double' =&gt; CreoleTypes::DOUBLE,
+                                'char' =&gt; CreoleTypes::CHAR,
+                                'varchar' =&gt; CreoleTypes::VARCHAR,
+                                'date' =&gt; CreoleTypes::DATE,
+                                'time' =&gt; CreoleTypes::TIME,
+                                'year' =&gt; CreoleTypes::YEAR,
+                                'datetime' =&gt; CreoleTypes::TIMESTAMP,
+                                'timestamp' =&gt; CreoleTypes::TIMESTAMP,
+                                'tinyblob' =&gt; CreoleTypes::BINARY,
+                                'blob' =&gt; CreoleTypes::VARBINARY,
+                                'mediumblob' =&gt; CreoleTypes::VARBINARY,
+                                'longblob' =&gt; CreoleTypes::VARBINARY,
+                                'longtext' =&gt; CreoleTypes::LONGVARCHAR,
+                                'tinytext' =&gt; CreoleTypes::VARCHAR,
+                                'mediumtext' =&gt; CreoleTypes::LONGVARCHAR,
+                                'text' =&gt; CreoleTypes::LONGVARCHAR,
+                                'enum' =&gt; CreoleTypes::CHAR,
+                                'set' =&gt; CreoleTypes::CHAR,
+                                );
+
+    /** Reverse mapping, created on demand. */
+    private static $reverseMap = null;
+
+    /**
+     * This method returns the generic Creole (JDBC-like) type
+     * when given the native db type.
+     * @param string $nativeType DB native type (e.g. 'TEXT', 'byetea', etc.).
+     * @return int Creole native type (e.g. CreoleTypes::LONGVARCHAR, CreoleTypes::BINARY, etc.).
+     */
+    public static function getType($nativeType)
+    {
+        $t = strtolower($nativeType);
+        if (isset(self::$typeMap[$t])) {
+            return self::$typeMap[$t];
+        } else {
+            return CreoleTypes::OTHER;
+        }
+    }
+
+    /**
+     * This method will return a native type that corresponds to the specified
+     * Creole (JDBC-like) type.
+     * If there is more than one matching native type, then the LAST defined
+     * native type will be returned.
+     * @param int $creoleType
+     * @return string Native type string.
+     */
+    public static function getNativeType($creoleType)
+    {
+        if (self::$reverseMap === null) {
+            self::$reverseMap = array_flip(self::$typeMap);
+        }
+        return @self::$reverseMap[$creoleType];
+    }
+
+}
\ No newline at end of file

Added: trunk/vendor/creole/drivers/mysql/metadata/MySQLDatabaseInfo.php
===================================================================
--- trunk/vendor/creole/drivers/mysql/metadata/MySQLDatabaseInfo.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/mysql/metadata/MySQLDatabaseInfo.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,61 @@
+&lt;?php
+/*
+ * $Id: MySQLDatabaseInfo.php,v 1.12 2005/02/21 16:48:40 pachanga Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+require_once 'creole/metadata/DatabaseInfo.php';
+
+/**
+ * MySQL implementation of DatabaseInfo.
+ *
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.12 $
+ * @package   creole.drivers.mysql.metadata
+ */
+class MySQLDatabaseInfo extends DatabaseInfo {
+    /**
+     * @throws SQLException
+     * @return void
+     */
+    protected function initTables()
+    {
+        include_once 'creole/drivers/mysql/metadata/MySQLTableInfo.php';
+
+        $result = @mysql_query(&quot;SHOW TABLES FROM `&quot; . $this-&gt;dbname . &quot;`&quot;, $this-&gt;dblink);
+
+        if (!$result) {
+            throw new SQLException(&quot;Could not list tables&quot;, mysql_error($this-&gt;dblink));
+        }
+
+        while ($row = mysql_fetch_row($result)) {
+            $this-&gt;tables[strtoupper($row[0])] = new MySQLTableInfo($this, $row[0]);
+        }
+    }
+
+    /**
+     * MySQL does not support sequences.
+     *
+     * @return void
+     * @throws SQLException
+     */
+    protected function initSequences()
+    {
+        // throw new SQLException(&quot;MySQL does not support sequences natively.&quot;);
+    }
+}

Added: trunk/vendor/creole/drivers/mysql/metadata/MySQLTableInfo.php
===================================================================
--- trunk/vendor/creole/drivers/mysql/metadata/MySQLTableInfo.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/mysql/metadata/MySQLTableInfo.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,249 @@
+&lt;?php
+/*
+ *  $Id: MySQLTableInfo.php,v 1.19 2005/10/18 11:20:11 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+require_once 'creole/metadata/TableInfo.php';
+
+/**
+ * MySQL implementation of TableInfo.
+ *
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.19 $
+ * @package   creole.drivers.mysql.metadata
+ */
+class MySQLTableInfo extends TableInfo {
+
+    /** Loads the columns for this table. */
+    protected function initColumns()
+    {
+        include_once 'creole/metadata/ColumnInfo.php';
+        include_once 'creole/drivers/mysql/MySQLTypes.php';
+
+        if (!@mysql_select_db($this-&gt;dbname, $this-&gt;dblink)) {
+            throw new SQLException('No database selected');
+        }
+
+        // To get all of the attributes we need, we use
+        // the MySQL &quot;SHOW COLUMNS FROM $tablename&quot; SQL.  We cannot
+        // use the API functions (e.g. mysql_list_fields() because they
+        // do not return complete information -- e.g. precision / scale, default
+        // values).
+
+        $res = mysql_query(&quot;SHOW COLUMNS FROM `&quot; . $this-&gt;name . &quot;`&quot;, $this-&gt;dblink);
+
+        $defaults = array();
+        $nativeTypes = array();
+        $precisions = array();
+
+        while($row = mysql_fetch_assoc($res)) {
+            $name = $row['Field'];
+            $is_nullable = ($row['Null'] == 'YES');
+            $is_auto_increment = (strpos($row['Extra'], 'auto_increment') !== false);
+            $size = null;
+            $precision = null;
+
+            if (preg_match('/^(\w+)[\(]?([\d,]*)[\)]?( |$)/', $row['Type'], $matches)) {
+                //            colname[1]   size/precision[2]
+                $nativeType = $matches[1];
+                if ($matches[2]) {
+                    if ( ($cpos = strpos($matches[2], ',')) !== false) {
+                        $size = (int) substr($matches[2], 0, $cpos);
+                        $precision = (int) substr($matches[2], $cpos + 1);
+                    } else {
+                        $size = (int) $matches[2];
+                    }
+                }
+            } elseif (preg_match('/^(\w+)\(/', $row['Type'], $matches)) {
+                $nativeType = $matches[1];
+            } else {
+                $nativeType = $row['Type'];
+            }
+            //BLOBs can't have any default values in MySQL
+            $default = preg_match('~blob|text~', $nativeType) ? null : $row['Default'];
+            $this-&gt;columns[$name] = new ColumnInfo($this,
+                                                   $name,
+                                                   MySQLTypes::getType($nativeType),
+                                                   $nativeType,
+                                                   $size,
+                                                   $precision,
+                                                   $is_nullable,
+                                                   $default,
+                                                   $is_auto_increment,
+                                                   $row);
+        }
+
+        $this-&gt;colsLoaded = true;
+    }
+
+    /** Loads the primary key information for this table. */
+    protected function initPrimaryKey()
+    {
+        include_once 'creole/metadata/PrimaryKeyInfo.php';
+
+        // columns have to be loaded first
+        if (!$this-&gt;colsLoaded) $this-&gt;initColumns();
+
+        if (!@mysql_select_db($this-&gt;dbname, $this-&gt;dblink)) {
+            throw new SQLException('No database selected');
+        }
+
+        // Primary Keys
+        $res = mysql_query(&quot;SHOW KEYS FROM `&quot; . $this-&gt;name . &quot;`&quot;, $this-&gt;dblink);
+
+        // Loop through the returned results, grouping the same key_name together
+        // adding each column for that key.
+
+        while($row = mysql_fetch_assoc($res)) {
+            // Skip any non-primary keys.
+            if ($row['Key_name'] !== 'PRIMARY') {
+                continue;
+            }
+            $name = $row[&quot;Column_name&quot;];
+            if (!isset($this-&gt;primaryKey)) {
+                $this-&gt;primaryKey = new PrimaryKeyInfo($name, $row);
+            }
+            $this-&gt;primaryKey-&gt;addColumn($this-&gt;columns[$name]);
+        }
+
+        $this-&gt;pkLoaded = true;
+    }
+
+    /** Loads the indexes for this table. */
+    protected function initIndexes() {
+
+        include_once 'creole/metadata/IndexInfo.php';
+
+        // columns have to be loaded first
+        if (!$this-&gt;colsLoaded) $this-&gt;initColumns();
+
+        if (!@mysql_select_db($this-&gt;dbname, $this-&gt;dblink)) {
+            throw new SQLException('No database selected');
+        }
+
+        // Indexes
+        $res = mysql_query(&quot;SHOW INDEX FROM `&quot; . $this-&gt;name . &quot;`&quot;, $this-&gt;dblink);
+
+        // Loop through the returned results, grouping the same key_name together
+        // adding each column for that key.
+
+        while($row = mysql_fetch_assoc($res)) {
+            $colName = $row[&quot;Column_name&quot;];
+            $name = $row[&quot;Key_name&quot;];
+
+            if($name == &quot;PRIMARY&quot;) {
+                continue;
+            }
+
+            if (!isset($this-&gt;indexes[$name])) {
+                $isUnique = ($row[&quot;Non_unique&quot;] == 0);
+                $this-&gt;indexes[$name] = new IndexInfo($name, $isUnique, $row);
+            }
+            $this-&gt;indexes[$name]-&gt;addColumn($this-&gt;columns[$colName]);
+        }
+
+        $this-&gt;indexesLoaded = true;
+    }
+
+  /**
+   * Load foreign keys for supporting versions of MySQL.
+   * @author Tony Bibbs
+   */
+  protected function initForeignKeys() {
+
+    // First make sure we have supported version of MySQL:
+    $res = mysql_query(&quot;SELECT VERSION()&quot;);
+    $row = mysql_fetch_row($res);
+
+    // Yes, it is OK to hardcode this...this was the first version of MySQL
+    // that supported foreign keys
+    if ($row[0] &lt; '3.23.44') {
+       $this-&gt;fksLoaded = true;
+       return;
+    }
+
+    include_once 'creole/metadata/ForeignKeyInfo.php';
+
+    // columns have to be loaded first
+    if (!$this-&gt;colsLoaded) $this-&gt;initColumns();
+    if (!@mysql_select_db($this-&gt;dbname, $this-&gt;dblink)) {
+      throw new SQLException('No database selected');
+    }
+       // Get the CREATE TABLE syntax
+    $res = mysql_query(&quot;SHOW CREATE TABLE `&quot; . $this-&gt;name . &quot;`&quot;, $this-&gt;dblink);
+    $row = mysql_fetch_row($res);
+
+    // Get the information on all the foreign keys
+    $regEx = '/FOREIGN KEY \(`([^`]*)`\) REFERENCES `([^`]*)` \(`([^`]*)`\)(.*)/';
+    if (preg_match_all($regEx,$row[1],$matches)) {
+      $tmpArray = array_keys($matches[0]);
+      foreach ($tmpArray as $curKey) {
+        $name = $matches[1][$curKey];
+        $ftbl = $matches[2][$curKey];
+        $fcol = $matches[3][$curKey];
+        $fkey = $matches[4][$curKey];
+        if (!isset($this-&gt;foreignKeys[$name])) {
+          $this-&gt;foreignKeys[$name] = new ForeignKeyInfo($name);
+          if ($this-&gt;database-&gt;hasTable($ftbl)) {
+            $foreignTable = $this-&gt;database-&gt;getTable($ftbl);
+          } else {
+            $foreignTable = new MySQLTableInfo($this-&gt;database, $ftbl);
+            $this-&gt;database-&gt;addTable($foreignTable);
+          }
+          if ($foreignTable-&gt;hasColumn($fcol)) {
+            $foreignCol = $foreignTable-&gt;getColumn($fcol);
+          } else {
+            $foreignCol = new ColumnInfo($foreignTable, $fcol);
+            $foreignTable-&gt;addColumn($foreignCol);
+          }
+
+          //typical for mysql is RESTRICT
+          $fkactions = array(
+            'ON DELETE'	=&gt; ForeignKeyInfo::RESTRICT,
+            'ON UPDATE'	=&gt; ForeignKeyInfo::RESTRICT,
+          );
+                              
+          if ($fkey) {
+            //split foreign key information -&gt; search for ON DELETE and afterwords for ON UPDATE action
+            foreach (array_keys($fkactions) as $fkaction) {
+              $result = NULL;
+              preg_match('/' . $fkaction . ' (' . ForeignKeyInfo::CASCADE . '|' . ForeignKeyInfo::SETNULL . ')/', $fkey, $result);
+              if ($result &amp;&amp; is_array($result) &amp;&amp; isset($result[1])) {
+                $fkactions[$fkaction] = $result[1];
+              }
+            }
+          }
+
+          $this-&gt;foreignKeys[$name]-&gt;addReference($this-&gt;columns[$name], $foreignCol, $fkactions['ON DELETE'], $fkactions['ON UPDATE']);
+        }
+      }
+    }
+    $this-&gt;fksLoaded = true;
+    
+  }
+
+  protected function initVendorSpecificInfo()
+  {
+      $res = mysql_query(&quot;SHOW TABLE STATUS LIKE '&quot; . $this-&gt;name . &quot;'&quot;, $this-&gt;dblink);
+      $this-&gt;vendorSpecificInfo = mysql_fetch_assoc($res);
+
+      $this-&gt;vendorLoaded = true;
+  }
+
+}

Added: trunk/vendor/creole/drivers/mysqli/MySQLiConnection.php
===================================================================
--- trunk/vendor/creole/drivers/mysqli/MySQLiConnection.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/mysqli/MySQLiConnection.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,288 @@
+&lt;?php
+/*
+ * $Id: MySQLiConnection.php,v 1.7 2004/09/18 09:29:22 sb Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+require_once 'creole/Connection.php';
+require_once 'creole/common/ConnectionCommon.php';
+include_once 'creole/drivers/mysqli/MySQLiResultSet.php';
+
+/**
+ * MySQLi implementation of Connection.
+ *
+ *
+ * @author    Sebastian Bergmann &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">sb at sebastian-bergmann.de</A>&gt;
+ * @version   $Revision: 1.7 $
+ * @package   creole.drivers.mysqli
+ */
+class MySQLiConnection extends ConnectionCommon implements Connection {
+    /** Current database (used in mysqli_select_db()). */
+    private $database;
+
+    /**
+     * Connect to a database and log in as the specified user.
+     *
+     * @param $dsn the data source name (see DB::parseDSN for syntax)
+     * @param $flags Any conneciton flags.
+     * @access public
+     * @throws SQLException
+     * @return void
+     */
+    public function connect($dsninfo, $flags = 0)
+    {
+        if (!extension_loaded('mysqli')) {
+            throw new SQLException('mysqli extension not loaded');
+        }
+
+        $this-&gt;dsn = $dsninfo;
+        $this-&gt;flags = $flags;
+
+        if (isset($dsninfo['protocol']) &amp;&amp; $dsninfo['protocol'] == 'unix') {
+            $dbhost = ':' . $dsninfo['socket'];
+        } else {
+            $dbhost = $dsninfo['hostspec'] ? $dsninfo['hostspec'] : 'localhost';
+
+            if (!empty($dsninfo['port'])) {
+                $dbhost .= ':' . $dsninfo['port'];
+            }
+        }
+
+        $user = $dsninfo['username'];
+        $pw = $dsninfo['password'];
+
+        @ini_set('track_errors', true);
+
+        if ($dbhost &amp;&amp; $user &amp;&amp; $pw) {
+            $conn = @mysqli_connect($dbhost, $user, $pw);
+        } elseif ($dbhost &amp;&amp; $user) {
+            $conn = @mysqli_connect($dbhost, $user);
+        } elseif ($dbhost) {
+            $conn = @mysqli_connect($dbhost);
+        } else {
+            $conn = false;
+        }
+
+        @ini_restore('track_errors');
+
+        if (empty($conn)) {
+            if (($err = @mysqli_error()) != '') {
+                throw new SQLException(&quot;connect failed&quot;, $err);
+            } elseif (empty($php_errormsg)) {
+                throw new SQLException(&quot;connect failed&quot;);
+            } else {
+                throw new SQLException(&quot;connect failed&quot;, $php_errormsg);
+            }
+        }
+
+        if ($dsninfo['database']) {
+            if (!@mysqli_select_db($conn, $dsninfo['database'])) {
+               switch(mysqli_errno($conn)) {
+                        case 1049:
+                            $exc = new SQLException(&quot;no such database&quot;, mysqli_error($conn));
+                        break;
+                        case 1044:
+                            $exc = new SQLException(&quot;access violation&quot;, mysqli_error($conn));
+                        break;
+                        default:
+                           $exc = new SQLException(&quot;cannot select database&quot;, mysqli_error($conn));
+                }
+
+                throw $exc;
+
+            }
+
+            // fix to allow calls to different databases in the same script
+            $this-&gt;database = $dsninfo['database'];
+        }
+
+        $this-&gt;dblink = $conn;
+    }
+
+    /**
+     * @see Connection::getDatabaseInfo()
+     */
+    public function getDatabaseInfo()
+    {
+        require_once 'creole/drivers/mysqli/metadata/MySQLiDatabaseInfo.php';
+        return new MySQLiDatabaseInfo($this);
+    }
+
+    /**
+     * @see Connection::getIdGenerator()
+     */
+    public function getIdGenerator()
+    {
+        require_once 'creole/drivers/mysqli/MySQLiIdGenerator.php';
+        return new MySQLiIdGenerator($this);
+    }
+
+    /**
+     * @see Connection::prepareStatement()
+     */
+    public function prepareStatement($sql)
+    {
+        require_once 'creole/drivers/mysqli/MySQLiPreparedStatement.php';
+        return new MySQLiPreparedStatement($this, $sql);
+    }
+
+    /**
+     * @see Connection::prepareCall()
+     */
+    public function prepareCall($sql) {
+        throw new SQLException('MySQL does not support stored procedures.');
+    }
+
+    /**
+     * @see Connection::createStatement()
+     */
+    public function createStatement()
+    {
+        require_once 'creole/drivers/mysqli/MySQLiStatement.php';
+        return new MySQLiStatement($this);
+    }
+
+    /**
+     * @see Connection::disconnect()
+     */
+    public function close()
+    {
+        $ret = mysqli_close($this-&gt;dblink);
+        $this-&gt;dblink = null;
+        return $ret;
+    }
+
+    /**
+     * @see Connection::applyLimit()
+     */
+    public function applyLimit(&amp;$sql, $offset, $limit)
+    {
+        if ( $limit &gt; 0 ) {
+            $sql .= &quot; LIMIT &quot; . ($offset &gt; 0 ? $offset . &quot;, &quot; : &quot;&quot;) . $limit;
+        } else if ( $offset &gt; 0 ) {
+            $sql .= &quot; LIMIT &quot; . $offset . &quot;, 18446744073709551615&quot;;
+        }
+    }
+
+    /**
+     * @see Connection::executeQuery()
+     */
+    public function executeQuery($sql, $fetchmode = null)
+    {
+        $this-&gt;lastQuery = $sql;
+
+        if ($this-&gt;database) {
+            if (!@mysqli_select_db($this-&gt;dblink, $this-&gt;database)) {
+                throw new SQLException('No database selected', mysqli_error($this-&gt;dblink));
+            }
+        }
+
+        $result = @mysqli_query($this-&gt;dblink, $sql);
+
+        if (!$result) {
+            throw new SQLException('Could not execute query', mysqli_error($this-&gt;dblink), $sql);
+        }
+
+        return new MySQLiResultSet($this, $result, $fetchmode);
+    }
+
+    /**
+     * @see Connection::executeUpdate()
+     */
+    public function executeUpdate($sql)
+    {
+        $this-&gt;lastQuery = $sql;
+
+        if ($this-&gt;database) {
+            if (!@mysqli_select_db($this-&gt;dblink, $this-&gt;database)) {
+                    throw new SQLException('No database selected', mysqli_error($this-&gt;dblink));
+            }
+        }
+
+        $result = @mysqli_query($this-&gt;dblink, $sql);
+
+        if (!$result) {
+            throw new SQLException('Could not execute update', mysqli_error($this-&gt;dblink), $sql);
+        }
+
+        return (int) mysqli_affected_rows($this-&gt;dblink);
+    }
+
+    /**
+     * Start a database transaction.
+     * @throws SQLException
+     * @return void
+     */
+    protected function beginTrans()
+    {
+        if (!mysqli_autocommit($this-&gt;dblink, FALSE)) {
+            throw new SQLException('Could not begin transaction', mysqli_error($this-&gt;dblink));
+        }
+    }
+
+    /**
+     * Commit the current transaction.
+     * @throws SQLException
+     * @return void
+     */
+    protected function commitTrans()
+    {
+        if ($this-&gt;database) {
+            if (!@mysqli_select_db($this-&gt;dblink, $this-&gt;database)) {
+                 throw new SQLException('No database selected', mysqli_error($this-&gt;dblink));
+            }
+        }
+
+        if (!mysqli_commit($this-&gt;dblink)) {
+            throw new SQLException('Can not commit transaction', mysqli_error($this-&gt;dblink));                
+        }
+
+        mysqli_autocommit($this-&gt;dblink, TRUE);
+    }
+
+    /**
+     * Roll back (undo) the current transaction.
+     * @throws SQLException
+     * @return void
+     */
+    protected function rollbackTrans()
+    {
+        if ($this-&gt;database) {
+            if (!@mysqli_select_db($this-&gt;dblink, $this-&gt;database)) {
+                throw new SQLException('No database selected', mysqli_error($this-&gt;dblink));
+            }
+        }
+
+        if (!mysqli_rollback($this-&gt;dblink)) {
+            throw new SQLException('Could not rollback transaction', mysqli_error($this-&gt;dblink));
+        }
+
+        mysqli_autocommit($this-&gt;dblink, TRUE);
+    }
+
+    /**
+     * Gets the number of rows affected by the data manipulation
+     * query.
+     *
+     * @return int Number of rows affected by the last query.
+     */
+    public function getUpdateCount()
+    {
+        return (int) @mysqli_affected_rows($this-&gt;dblink);
+    }
+}

Added: trunk/vendor/creole/drivers/mysqli/MySQLiIdGenerator.php
===================================================================
--- trunk/vendor/creole/drivers/mysqli/MySQLiIdGenerator.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/mysqli/MySQLiIdGenerator.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,96 @@
+&lt;?php
+/*
+ * $Id: MySQLiIdGenerator.php,v 1.4 2004/09/18 09:15:49 sb Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+require_once 'creole/IdGenerator.php';
+
+/**
+ * MySQLi implementation of IdGenerator.
+ *
+ * @author    Sebastian Bergmann &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">sb at sebastian-bergmann.de</A>&gt;
+ * @version   $Revision: 1.4 $
+ * @package   creole.drivers.mysqli
+ */
+class MySQLiIdGenerator implements IdGenerator {
+    /** Connection object that instantiated this class */
+    private $conn;
+
+    /**
+     * Creates a new IdGenerator class, saves passed connection for use
+     * later by getId() method.
+     * @param Connection $conn
+     */
+    public function __construct(Connection $conn)
+    {
+        $this-&gt;conn = $conn;
+    }
+
+    /**
+     * @see IdGenerator::isBeforeInsert()
+     */
+    public function isBeforeInsert()
+    {
+        return false;
+    }
+
+    /**
+     * @see IdGenerator::isAfterInsert()
+     */
+    public function isAfterInsert()
+    {
+        return true;
+    }
+
+    /**
+     * @see IdGenerator::getIdMethod()
+     */
+    public function getIdMethod()
+    {
+        return self::AUTOINCREMENT;
+    }
+
+    /**
+     * Returns last-generated auto-increment ID.
+     *
+     * Note that for very large values (2,147,483,648 to 9,223,372,036,854,775,807) a string
+     * will be returned, because these numbers are larger than supported by PHP's native
+     * numeric datatypes.
+     *
+     * @see IdGenerator::getId()
+     */
+    public function getId($unused = null)
+    {
+        $resource = $this-&gt;conn-&gt;getResource();
+        $insert_id = mysqli_insert_id($resource);
+
+        if ( $insert_id &lt; 0 ) {
+            $insert_id = null;
+
+            $result = mysqli_query($resource, 'SELECT LAST_INSERT_ID()');
+
+            if ( $result ) {
+                $row = mysqli_fetch_row($result);
+                $insert_id = $row ? $row[0] : null;
+            }
+        }
+
+        return $insert_id;
+    }
+}

Added: trunk/vendor/creole/drivers/mysqli/MySQLiPreparedStatement.php
===================================================================
--- trunk/vendor/creole/drivers/mysqli/MySQLiPreparedStatement.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/mysqli/MySQLiPreparedStatement.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,42 @@
+&lt;?php
+/*
+ * $Id: MySQLiPreparedStatement.php,v 1.3 2004/09/18 09:15:49 sb Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+require_once 'creole/PreparedStatement.php';
+require_once 'creole/common/PreparedStatementCommon.php';
+
+/**
+ * MySQLi implementation of PreparedStatement.
+ *
+ * @author    Sebastian Bergmann &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">sb at sebastian-bergmann.de</A>&gt;
+ * @version   $Revision: 1.3 $
+ * @package   creole.drivers.mysqli
+ */
+class MySQLiPreparedStatement extends PreparedStatementCommon implements PreparedStatement {
+    /**
+     * Quotes string using native MySQL function.
+     * @param string $str
+     * @return string
+     */
+    protected function escape($str)
+    {
+        return mysqli_real_escape_string($this-&gt;getConnection()-&gt;getResource(), $str);
+    }
+}

Added: trunk/vendor/creole/drivers/mysqli/MySQLiResultSet.php
===================================================================
--- trunk/vendor/creole/drivers/mysqli/MySQLiResultSet.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/mysqli/MySQLiResultSet.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,173 @@
+&lt;?php
+/*
+ * $Id: MySQLiResultSet.php,v 1.4 2005/09/16 13:09:50 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+require_once 'creole/ResultSet.php';
+require_once 'creole/common/ResultSetCommon.php';
+
+/**
+ * MySQLi implementation of ResultSet.
+ *
+ * MySQL supports OFFSET / LIMIT natively; this means that no adjustments or checking
+ * are performed.  We will assume that if the lmitSQL() operation failed that an
+ * exception was thrown, and that OFFSET/LIMIT will never be emulated for MySQL.
+ *
+ * @author    Sebastian Bergmann &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">sb at sebastian-bergmann.de</A>&gt;
+ * @version   $Revision: 1.4 $
+ * @package   creole.drivers.mysqli
+ */
+class MySQLiResultSet extends ResultSetCommon implements ResultSet {
+    /**
+     * @see ResultSet::seek()
+     */
+    public function seek($rownum)
+    {
+        // MySQL rows start w/ 0, but this works, because we are
+        // looking to move the position _before_ the next desired position
+         if (!@mysqli_data_seek($this-&gt;result, $rownum)) {
+                return false;
+        }
+
+        $this-&gt;cursorPos = $rownum;
+
+        return true;
+    }
+
+    /**
+     * @see ResultSet::next()
+     */
+    public function next()
+    {
+        $this-&gt;fields = mysqli_fetch_array($this-&gt;result, $this-&gt;fetchmode);
+        $resource = $this-&gt;conn-&gt;getResource();
+
+        if (!$this-&gt;fields) {
+            $errno = mysqli_errno($resource);
+
+            if (!$errno) {
+                // We've advanced beyond end of recordset.
+                $this-&gt;afterLast();
+                return false;
+            } else {
+                throw new SQLException(&quot;Error fetching result&quot;, mysqli_error($resource));
+            }
+        }
+
+        if (!$this-&gt;ignoreAssocCase) {
+            $this-&gt;fields = array_change_key_case($this-&gt;fields, CASE_LOWER);
+        }
+
+        // Advance cursor position
+        $this-&gt;cursorPos++;
+        return true;
+    }
+
+    /**
+     * @see ResultSet::getRecordCount()
+     */
+    public function getRecordCount()
+    {
+        $rows = @mysqli_num_rows($this-&gt;result);
+
+        if ($rows === null) {
+            throw new SQLException(&quot;Error fetching num rows&quot;, mysqli_error($this-&gt;conn-&gt;getResource()));
+        }
+
+        return (int) $rows;
+    }
+
+    /**
+     * @see ResultSet::close()
+     */
+    public function close()
+    {
+        @mysqli_free_result($this-&gt;result);
+        $this-&gt;fields = array();
+    }
+
+    /**
+     * Get string version of column.
+     * No rtrim() necessary for MySQL, as this happens natively.
+     * @see ResultSet::getString()
+     */
+    public function getString($column)
+    {
+        $idx = (is_int($column) ? $column - 1 : $column);
+
+        if (!array_key_exists($idx, $this-&gt;fields)) {
+            throw new SQLException(&quot;Invalid resultset column: &quot; . $column);
+        }
+
+        if ($this-&gt;fields[$idx] === null) {
+            return null;
+        }
+
+        return (string) $this-&gt;fields[$idx];
+    }
+
+    /**
+     * Returns a unix epoch timestamp based on either a TIMESTAMP or DATETIME field.
+     * @param mixed $column Column name (string) or index (int) starting with 1.
+     * @return string
+     * @throws SQLException - If the column specified is not a valid key in current field array.
+     */
+    public function getTimestamp($column, $format='Y-m-d H:i:s')
+    {
+        if (is_int($column)) {
+            // because Java convention is to start at 1
+            $column--;
+        }
+
+        if (!array_key_exists($column, $this-&gt;fields)) {
+            throw new SQLException(&quot;Invalid resultset column: &quot; . (is_int($column) ? $column + 1 : $column));
+        }
+
+        if ($this-&gt;fields[$column] === null) {
+            return null;
+        }
+
+        $ts = strtotime($this-&gt;fields[$column]);
+
+        if ($ts === -1 || $ts === false) { // in PHP 5.1 return value changes to FALSE
+            // otherwise it's an ugly MySQL timestamp!
+            // YYYYMMDDHHMMSS
+            if (preg_match('/([\d]{4})([\d]{2})([\d]{2})([\d]{2})([\d]{2})([\d]{2})/', $this-&gt;fields[$column], $matches)) {
+                //              YYYY       MM       DD       HH       MM       SS
+                //                $1       $2       $3       $4       $5       $6
+                $ts = mktime($matches[4], $matches[5], $matches[6], $matches[2], $matches[3], $matches[1]);
+            }
+        }
+
+        if ($ts === -1 || $ts === false) { // in PHP 5.1 return value changes to FALSE
+            // if it's still -1, then there's nothing to be done; use a different method.
+            throw new SQLException(&quot;Unable to convert value at column &quot; . (is_int($column) ? $column + 1 : $column) . &quot; to timestamp: &quot; . $this-&gt;fields[$column]);
+        }
+
+        if ($format === null) {
+            return $ts;
+        }
+
+        if (strpos($format, '%') !== false) {
+            return strftime($format, $ts);
+        } else {
+            return date($format, $ts);
+        }
+    }
+}

Added: trunk/vendor/creole/drivers/mysqli/MySQLiStatement.php
===================================================================
--- trunk/vendor/creole/drivers/mysqli/MySQLiStatement.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/mysqli/MySQLiStatement.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,33 @@
+&lt;?php
+/*
+ * $Id: MySQLiStatement.php,v 1.2 2004/09/18 09:15:49 sb Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+require_once 'creole/Statement.php';
+require_once 'creole/common/StatementCommon.php';
+
+/**
+ * MySQLi implementation of Statement.
+ *
+ * @author    Sebastian Bergmann &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">sb at sebastian-bergmann.de</A>&gt;
+ * @version   $Revision: 1.2 $
+ * @package   creole.drivers.mysqli
+ */
+class MySQLiStatement extends StatementCommon implements Statement {
+}

Added: trunk/vendor/creole/drivers/mysqli/metadata/MySQLiDatabaseInfo.php
===================================================================
--- trunk/vendor/creole/drivers/mysqli/metadata/MySQLiDatabaseInfo.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/mysqli/metadata/MySQLiDatabaseInfo.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,61 @@
+&lt;?php
+/*
+ * $Id: MySQLiDatabaseInfo.php,v 1.2 2004/09/17 17:21:13 sb Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+require_once 'creole/metadata/DatabaseInfo.php';
+
+/**
+ * MySQLi implementation of DatabaseInfo.
+ *
+ * @author    Sebastian Bergmann &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">sb at sebastian-bergmann.de</A>&gt;
+ * @version   $Revision: 1.2 $
+ * @package   creole.drivers.mysqli.metadata
+ */
+class MySQLiDatabaseInfo extends DatabaseInfo {
+    /**
+     * @throws SQLException
+     * @return void
+     */
+    protected function initTables()
+    {
+        include_once 'creole/drivers/mysqli/metadata/MySQLiTableInfo.php';
+        
+        $result = @mysqli_query($this-&gt;dblink, 'SHOW TABLES FROM ' . $this-&gt;dbname);
+    
+        if (!$result) {
+            throw new SQLException(&quot;Could not list tables&quot;, mysqli_error($this-&gt;dblink));
+        }
+        
+        while ($row = mysqli_fetch_row($result)) {
+            $this-&gt;tables[strtoupper($row[0])] = new MySQLiTableInfo($this, $row[0]);
+        }
+    }
+
+    /**
+     * MySQL does not support sequences.
+     *
+     * @return void
+     * @throws SQLException
+     */
+    protected function initSequences()
+    {
+        // throw new SQLException(&quot;MySQL does not support sequences natively.&quot;);
+    }
+}

Added: trunk/vendor/creole/drivers/mysqli/metadata/MySQLiTableInfo.php
===================================================================
--- trunk/vendor/creole/drivers/mysqli/metadata/MySQLiTableInfo.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/mysqli/metadata/MySQLiTableInfo.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,153 @@
+&lt;?php
+/*
+ * $Id: MySQLiTableInfo.php,v 1.2 2004/09/17 17:21:13 sb Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+require_once 'creole/metadata/TableInfo.php';
+
+/**
+ * MySQLi implementation of TableInfo.
+ *
+ * @author    Sebastian Bergmann &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">sb at sebastian-bergmann.de</A>&gt;
+ * @version   $Revision: 1.2 $
+ * @package   creole.drivers.mysqli.metadata
+ */
+class MySQLiTableInfo extends TableInfo {
+    /** Loads the columns for this table. */
+    protected function initColumns()
+    {
+        require_once 'creole/metadata/ColumnInfo.php';
+        require_once 'creole/drivers/mysql/MySQLTypes.php';
+
+        if (!@mysqli_select_db($this-&gt;dblink, $this-&gt;dbname)) {
+            throw new SQLException('No database selected');
+        }
+
+        // To get all of the attributes we need, we use
+        // the MySQL &quot;SHOW COLUMNS FROM $tablename&quot; SQL.
+        $res = mysqli_query($this-&gt;dblink, &quot;SHOW COLUMNS FROM &quot; . $this-&gt;name);
+
+        $defaults = array();
+        $nativeTypes = array();
+        $precisions = array();
+
+        while($row = mysqli_fetch_assoc($res)) {
+            $name = $row['Field'];
+            $default = $row['Default'];
+            $is_nullable = ($row['Null'] == 'YES');
+
+            $size = null;
+            $precision = null;
+
+            if (preg_match('/^(\w+)[\(]?([\d,]*)[\)]?( |$)/', $row['Type'], $matches)) {
+                //            colname[1]   size/precision[2]
+                $nativeType = $matches[1];
+                if ($matches[2]) {
+                    if ( ($cpos = strpos($matches[2], ',')) !== false) {
+                        $size = (int) substr($matches[2], 0, $cpos);
+                        $precision = (int) substr($matches[2], $cpos + 1);
+                    } else {
+                        $size = (int) $matches[2];
+                    }
+                }
+            } elseif (preg_match('/^(\w+)\(/', $row['Type'], $matches)) {
+                $nativeType = $matches[1];
+            } else {
+                $nativeType = $row['Type'];
+            }
+
+            $this-&gt;columns[$name] = new ColumnInfo($this, $name, MySQLTypes::getType($nativeType), $nativeType, $size, $precision, $is_nullable, $default);
+        }
+
+        $this-&gt;colsLoaded = true;
+    }
+
+    /** Loads the primary key information for this table. */
+    protected function initPrimaryKey()
+    {
+        require_once 'creole/metadata/PrimaryKeyInfo.php';
+
+        // columns have to be loaded first
+        if (!$this-&gt;colsLoaded) {
+            $this-&gt;initColumns();
+        }
+
+        if (!@mysqli_select_db($this-&gt;dblink, $this-&gt;dbname)) {
+            throw new SQLException('No database selected');
+        }
+
+        // Primary Keys
+        $res = mysqli_query($this-&gt;dblink, &quot;SHOW KEYS FROM &quot; . $this-&gt;name);
+
+        // Loop through the returned results, grouping the same key_name together
+        // adding each column for that key.
+        while($row = mysqli_fetch_assoc($res)) {
+            $name = $row[&quot;Column_name&quot;];
+            if (!isset($this-&gt;primaryKey)) {
+                $this-&gt;primaryKey = new PrimaryKeyInfo($name);
+            }
+
+            $this-&gt;primaryKey-&gt;addColumn($this-&gt;columns[ $name ]);
+        }
+
+        $this-&gt;pkLoaded = true;
+    }
+
+    /** Loads the indexes for this table. */
+    protected function initIndexes() {
+        require_once 'creole/metadata/IndexInfo.php';
+
+        // columns have to be loaded first
+        if (!$this-&gt;colsLoaded) {
+            $this-&gt;initColumns();
+        }
+
+        if (!@mysqli_select_db($this-&gt;dblink, $this-&gt;dbname)) {
+            throw new SQLException('No database selected');
+        }
+
+        // Indexes
+        $res = mysqli_query($this-&gt;dblink . &quot;SHOW INDEX FROM &quot; . $this-&gt;name);
+
+        // Loop through the returned results, grouping the same key_name together
+        // adding each column for that key.
+        while($row = mysqli_fetch_assoc($res)) {
+            $name = $row[&quot;Column_name&quot;];
+
+            if (!isset($this-&gt;indexes[$name])) {
+                $this-&gt;indexes[$name] = new IndexInfo($name);
+            }
+
+            $this-&gt;indexes[$name]-&gt;addColumn($this-&gt;columns[ $name ]);
+        }
+
+        $this-&gt;indexesLoaded = true;
+    }
+
+    /** Load foreign keys (unsupported in MySQL). */
+    protected function initForeignKeys() {
+        // columns have to be loaded first
+        if (!$this-&gt;colsLoaded) {
+            $this-&gt;initColumns();
+        }
+
+        // Foreign keys are not supported in mysql.
+        $this-&gt;fksLoaded = true;
+    }
+}

Added: trunk/vendor/creole/drivers/odbc/ODBCCachedResultSet.php
===================================================================
--- trunk/vendor/creole/drivers/odbc/ODBCCachedResultSet.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/odbc/ODBCCachedResultSet.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,218 @@
+&lt;?php
+/*
+ *  $Id: ODBCCachedResultSet.php,v 1.2 2005/04/01 17:04:00 dlawson_mi Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+require_once 'creole/drivers/odbc/ODBCResultSetCommon.php';
+require_once 'creole/drivers/odbc/ODBCTypes.php';
+
+/**
+ * ODBC implementation of a cached ResultSet.
+ *
+ * In addition to limit/offset emulation, this class implements a resultset
+ * cache. This can be useful as a workaround for some ODBC drivers which lack
+ * support for reverse/absolute cursor scrolling, etc. 
+ *
+ * This class will cache rows _on-demand_. So if you only read the first couple
+ * rows of a result, then only those rows will be cached. However, note that if
+ * you call getRecordCount() or last(), the class must read and cache all 
+ * available records. 
+ *
+ * The offset / limit variables are also taken into account when caching. Any 
+ * rows preceding the offset value will be skipped. Caching will stop once the
+ * limit value is reached.
+ *
+ * To use this class, create a derived {@link ODBCAdapter} class which returns
+ * an instance of ODBCCachedResultSet from the {@link ODBCAdapter::createResultSet()} method.
+ * Specify the adapter via the query portion of the Connection URL:
+ *
+ * <A HREF="odbc://localhost/Driver=MySQL">odbc://localhost/Driver=MySQL</A> ODBC 3.51 Driver;Database=test?adapter=MySQL
+ *
+ * @author    Dave Lawson &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">dlawson at masterytech.com</A>&gt;
+ * @version   $Revision: 1.2 $
+ * @package   creole.drivers.odbc
+ */
+class ODBCCachedResultSet extends ODBCResultSetCommon implements ResultSet
+{
+    /**
+     * Record cache
+     * @var array
+     */
+    protected $recs = array();
+
+    /**
+     * Tracks the last cursor position of the recordset.
+     * @var integer
+     */
+    protected $lastPos = -1;
+
+    /**
+     * True if blobs/clobs should also be cached.
+     * @var boolean
+     */
+    protected $cacheLobs = false;
+
+    /**
+     * @see ResultSet::__construct()
+     */
+    public function __construct(Connection $conn, $result, $fetchmode = null, $cacheLobs = false)
+    {
+        parent::__construct($conn, $result, $fetchmode);
+
+        $this-&gt;cacheLobs = $cacheLobs;
+    }
+
+    /**
+     * @see ODBCResultSetCommon::close()
+     */
+    function close()
+    {
+        parent::close();
+        $this-&gt;recs = null;
+        $this-&gt;lastPos = -1;
+        $this-&gt;cacheLobs = false;
+    }
+
+    /**
+     * Caches specified records up to and including the specified 1-based
+     * record position. If -1 is specified, all records will be cached.
+     * @param integer Maximum record position to cache.
+     * @return void
+     * @throws SQLException
+     */
+    public function loadCache($recPos = -1)
+    {
+        $rid = $this-&gt;result-&gt;getHandle();
+
+        $curRecs = count($this-&gt;recs);
+        $totRecs = ($curRecs ? $this-&gt;offset + $curRecs : 0);
+
+        while (1)
+        {
+            // Is record already cached?
+            if ($this-&gt;lastPos != -1 || ($recPos &gt; -1 &amp;&amp; $recPos &lt;= $curRecs))
+                return;
+
+            // Fetch row (no buffers copied yet).
+            $rowNum = ++$totRecs;
+            $result = @odbc_fetch_row($rid, $rowNum);
+
+            // All records cached?
+            if ($result === false || ($this-&gt;limit &gt; 0 &amp;&amp; $curRecs+1 &gt; $this-&gt;limit))
+            {
+                $this-&gt;lastPos = $curRecs;
+                continue;
+            }
+
+            // Ignore offset records.
+            if ($totRecs &lt;= $this-&gt;offset)
+                continue;
+
+            // Load row array.
+            $row = array();
+            for ($i = 0, $n = @odbc_num_fields($rid); $i &lt; $n; $i++)
+            {
+                $fldNum = $i+1;
+                $row[$i] = odbc_result($rid, $fldNum);
+                
+                // Cache lobs if necessary
+                if ($this-&gt;cacheLobs)
+                {
+                    ODBCTypes::loadTypeMap($this-&gt;conn);
+
+                    $nativeType = @odbc_field_type($rid, $fldNum);
+                    $creoleType = ODBCTypes::getType($nativeType);
+
+                    $isBlob = ($creoleType == CreoleTypes::BLOB ||
+                               $creoleType == CreoleTypes::LONGVARBINARY);
+
+                    $isClob = ($creoleType == CreoleTypes::CLOB ||
+                               $creoleType == CreoleTypes::LONGVARCHAR);
+
+                    if (($isBlob || $isClob) &amp;&amp; $row[$i] !== null)
+                    {
+                        $binmode = ($isBlob ? ODBC_BINMODE_RETURN : ODBC_BINMODE_CONVERT);
+                        $curdata = $row[$i];
+                        $row[$i] = $this-&gt;readLobData($fldNum, $binmode, $curdata);
+                    }
+                }
+            }
+                        
+            // Add record to cache.
+            $this-&gt;recs[++$curRecs] = $row;
+        }
+    }
+
+    /**
+     * @see ResultSet::seek()
+     */
+    public function seek($rownum)
+    {
+        $this-&gt;loadCache($rownum);
+
+        if ($rownum &lt; 0 || $rownum &gt; count($this-&gt;recs)+1)
+            return false;
+
+        $this-&gt;cursorPos = $rownum;
+
+        return true;
+    }
+
+    /**
+     * @see ResultSet::next()
+     */
+    function next()
+    {
+        $this-&gt;loadCache(++$this-&gt;cursorPos);
+
+        if ($this-&gt;isAfterLast())
+        {
+            $this-&gt;afterLast();
+            return false;
+        }
+
+        $this-&gt;fields =&amp; $this-&gt;checkFetchMode($this-&gt;recs[$this-&gt;cursorPos]);
+
+        return true;
+    }
+
+    /**
+     * @see ResultSet::getRecordCount()
+     */
+    function getRecordCount()
+    {
+        if ($this-&gt;lastPos == -1)
+            $this-&gt;loadCache(-1);
+
+        return $this-&gt;lastPos;
+    }
+
+    /**
+     * @see ResultSet::isAfterLast()
+     */
+    public function isAfterLast()
+    {
+        // All records cached yet?
+        if ($this-&gt;lastPos == -1)
+            return false;
+
+        return ($this-&gt;cursorPos &gt; $this-&gt;lastPos);
+    }
+
+}
\ No newline at end of file

Added: trunk/vendor/creole/drivers/odbc/ODBCConnection.php
===================================================================
--- trunk/vendor/creole/drivers/odbc/ODBCConnection.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/odbc/ODBCConnection.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,362 @@
+&lt;?php
+/*
+ *  $Id: ODBCConnection.php,v 1.5 2005/10/17 19:03:51 dlawson_mi Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+require_once 'creole/Connection.php';
+require_once 'creole/common/ConnectionCommon.php';
+require_once 'creole/drivers/odbc/adapters/ODBCAdapter.php';
+
+/**
+ * ODBC implementation of Connection.
+ *
+ * @author    Dave Lawson &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">dlawson at masterytech.com</A>&gt;
+ * @version   $Revision: 1.5 $
+ * @package   creole.drivers.odbc
+ */
+class ODBCConnection extends ConnectionCommon implements Connection {
+
+    /**
+     * Implements driver-specific behavior
+     * @var ODBCAdapter
+     */
+    protected $adapter = null;
+
+    /**
+     * Last ODBC result resource from executeQuery/executeUpdate. Used in getUpdateCount()
+     * @var ODBCResultResource
+     */
+    protected $odbcresult = null;
+
+    /**
+     * @see Connection::connect()
+     */
+    public function connect($dsninfo, $flags = 0)
+    {
+		if (!function_exists('odbc_connect'))
+            throw new SQLException('odbc extension not loaded');
+
+        $adapterclass = @$dsninfo['adapter'];
+
+        if (!$adapterclass)
+            $adapterclass = 'ODBCAdapter';
+        else
+            $adapterclass .= 'Adapter';
+
+        Creole::import('creole.drivers.odbc.adapters.' . $adapterclass);
+        $this-&gt;adapter = new $adapterclass();
+
+        $this-&gt;dsn = $dsninfo;
+        $this-&gt;flags = $flags;
+
+        if (($this-&gt;flags &amp; Creole::NO_ASSOC_LOWER) &amp;&amp; !$this-&gt;adapter-&gt;preservesColumnCase())
+        {
+            trigger_error('Connection created with Creole::NO_ASSOC_LOWER, ' .
+                          'but driver does not support case preservation.',
+                          E_USER_WARNING);
+            $this-&gt;flags &amp;= ~Creole::NO_ASSOC_LOWER;
+        }
+
+        $persistent = ($flags &amp; Creole::PERSISTENT) === Creole::PERSISTENT;
+
+        if ($dsninfo['database'])
+            $odbcdsn = $dsninfo['database'];
+        elseif ($dsninfo['hostspec'])
+            $odbcdsn = $dsninfo['hostspec'];
+        else
+            $odbcdsn = 'localhost';
+
+        $user = @$dsninfo['username'];
+        $pw = @$dsninfo['password'];
+
+        $connect_function = $persistent ? 'odbc_pconnect' : 'odbc_connect';
+
+        $conn = @$connect_function($odbcdsn, $user, $pw, SQL_CUR_USE_IF_NEEDED);
+
+        if (!is_resource($conn))
+            throw new SQLException('connect failed', $this-&gt;nativeError(), $odbcdsn);
+
+        $this-&gt;dblink = $conn;
+
+        /**
+         * This prevents blob fields from being fetched when a row is loaded
+         * from a recordset. Clob fields however are loaded with up to
+         * 'odbc.defaultlrl' data. This should be the default anyway, but we'll
+         * set it here just to keep things consistent.
+         */
+        @odbc_binmode(0, ODBC_BINMODE_PASSTHRU);
+        @odbc_longreadlen(0, ini_get('odbc.defaultlrl'));
+    }
+
+    /**
+     * @see Connection::close()
+     */
+    public function close()
+    {
+        $ret = true;
+
+        $this-&gt;adapter = null;
+        $this-&gt;odbcresult = null;
+
+        if ($this-&gt;dblink !== null)
+        {
+            $ret = @odbc_close($this-&gt;dblink);
+            $this-&gt;dblink = null;
+        }
+
+        return $ret;
+    }
+
+    /**
+     * Shouldn't this be in ConnectionCommon.php?
+     */
+    public function __destruct()
+    {
+        $this-&gt;close();
+    }
+
+    /**
+     * Returns a formatted ODBC error string.
+     * @return string
+     */
+    public function nativeError()
+    {
+        if ($this-&gt;dblink &amp;&amp; is_resource($this-&gt;dblink))
+            $errstr = '[' . @odbc_error($this-&gt;dblink) . '] ' . @odbc_errormsg($this-&gt;dblink);
+        else
+            $errstr = '[' . @odbc_error() . '] ' . @odbc_errormsg();
+
+        return $errstr;
+    }
+
+    /**
+     * Returns driver-specific ODBCAdapter.
+     * @return ODBCAdapter
+     */
+    public function getAdapter()
+    {
+        return $this-&gt;adapter;
+    }
+
+    /**
+     * @see Connection::getDatabaseInfo()
+     */
+    public function getDatabaseInfo()
+    {
+        require_once 'creole/drivers/odbc/metadata/ODBCDatabaseInfo.php';
+        return new ODBCDatabaseInfo($this);
+    }
+
+    /**
+     * @see Connection::getIdGenerator()
+     */
+    public function getIdGenerator()
+    {
+        return $this-&gt;adapter-&gt;getIdGenerator($this);
+    }
+
+    /**
+     * Creates the appropriate ResultSet
+     * @return ResultSet
+     */
+    public function createResultSet($odbcresult, $fetchmode)
+    {
+        return $this-&gt;adapter-&gt;createResultSet($this, $odbcresult, $fetchmode);
+    }
+
+    /**
+     * @see Connection::prepareStatement()
+     */
+    public function prepareStatement($sql)
+    {
+        require_once 'creole/drivers/odbc/ODBCPreparedStatement.php';
+        return new ODBCPreparedStatement($this, $sql);
+    }
+
+    /**
+     * @see Connection::createStatement()
+     */
+    public function createStatement()
+    {
+        require_once 'creole/drivers/odbc/ODBCStatement.php';
+        return new ODBCStatement($this);
+    }
+
+    /**
+     * @todo To be implemented
+     * @see Connection::prepareCall()
+     */
+    public function prepareCall($sql)
+    {
+        throw new SQLException('Stored procedures not currently implemented.');
+    }
+
+    /**
+     * @see Connection::applyLimit()
+     */
+    public function applyLimit(&amp;$sql, $offset, $limit)
+    {
+        if ($this-&gt;adapter-&gt;hasLimitOffset())
+            $this-&gt;adapter-&gt;applyLimit($sql, $offset, $limit);
+    }
+
+    /**
+     * @see Connection::executeQuery()
+     */
+    public function executeQuery($sql, $fetchmode = null)
+    {
+        if ($this-&gt;odbcresult)
+            $this-&gt;odbcresult = null;
+
+        $r = @odbc_exec($this-&gt;dblink, $sql);
+
+        if ($r === false)
+            throw new SQLException('Could not execute query', $this-&gt;nativeError(), $sql);
+
+        $this-&gt;odbcresult = new ODBCResultResource($r);
+
+        return $this-&gt;createResultSet($this-&gt;odbcresult, $fetchmode);
+    }
+
+    /**
+     * @see Connection::executeUpdate()
+     */
+    public function executeUpdate($sql)
+    {
+        if ($this-&gt;odbcresult)
+            $this-&gt;odbcresult = null;
+
+        $r = @odbc_exec($this-&gt;dblink, $sql);
+
+        if ($r === false)
+            throw new SQLException('Could not execute update', $this-&gt;nativeError(), $sql);
+
+        $this-&gt;odbcresult = new ODBCResultResource($r);
+
+        return $this-&gt;getUpdateCount();
+    }
+
+    /**
+     * Start a database transaction.
+     * @throws SQLException
+     * @return void
+     */
+    protected function beginTrans()
+    {
+        if ($this-&gt;adapter-&gt;supportsTransactions()) {
+            @odbc_autocommit($this-&gt;dblink, false);
+            if (odbc_error($this-&gt;dblink) == 'S1C00') {
+                throw new SQLException('Could not begin transaction', $this-&gt;nativeError());
+            }
+        }
+    }
+    
+    /**
+     * Commit the current transaction.
+     * @throws SQLException
+     * @return void
+     */
+    protected function commitTrans()
+    {
+        if ($this-&gt;adapter-&gt;supportsTransactions()) {
+            $result = @odbc_commit($this-&gt;dblink);
+            if (!$result) {
+                throw new SQLException('Could not commit transaction', $this-&gt;nativeError());
+            }
+            @odbc_autocommit($this-&gt;dblink, true);
+            if (odbc_error($this-&gt;dblink) == 'S1C00') {
+                throw new SQLException('Could not commit transaction (autocommit failed)', $this-&gt;nativeError());
+            }
+        }
+    }
+
+    /**
+     * Roll back (undo) the current transaction.
+     * @throws SQLException
+     * @return void
+     */
+    protected function rollbackTrans()
+    {
+        if ($this-&gt;adapter-&gt;supportsTransactions()) {
+            $result = @odbc_rollback($this-&gt;dblink);
+            if (!$result) {
+                throw new SQLException('Could not rollback transaction', $this-&gt;nativeError());
+            }
+            @odbc_autocommit($this-&gt;dblink, true);
+            if (odbc_error($this-&gt;dblink) == 'S1C00') {
+                throw new SQLException('Could not rollback transaction (autocommit failed)', $this-&gt;nativeError());
+            }
+        }
+    }
+
+    /**
+     * @see Connection::getUpdateCount()
+     */
+    public function getUpdateCount()
+    {
+        if ($this-&gt;odbcresult === null)
+            return 0;
+
+        $n = @odbc_num_rows($this-&gt;odbcresult-&gt;getHandle());
+
+        if ($n == -1)
+            throw new SQLException('Could not retrieve update count', $this-&gt;nativeError());
+
+        return (int) $n;
+    }
+
+}
+
+/**
+ * This is a simple wrapper class to manage the lifetime of an ODBC result resource
+ * (returned by odbc_exec(), odbc_execute(), etc.) We use a separate class because
+ * the resource can be shared by both ODBCConnection and an ODBCResultSet at the
+ * same time. ODBCConnection hangs on to the last result resource to be used in
+ * its getUpdateCount() method. It also passes this resource to new instances of
+ * ODBCResultSet. At some point the resource has to be cleaned up via
+ * odbc_free_result(). Using this class as a wrapper, we can pass around multiple
+ * references to the same resource. PHP's reference counting mechanism will clean
+ * up the resource when its no longer used via ODBCResultResource::__destruct().
+ * @package   creole.drivers.odbc
+ */
+class ODBCResultResource
+{
+    /**
+     * @var resource ODBC result resource returned by {@link odbc_exec()}/{@link odbc_execute()}.
+     */
+    protected $handle = null;
+
+    public function __construct($handle)
+    {
+        if (is_resource($handle))
+            $this-&gt;handle = $handle;
+    }
+
+    public function __destruct()
+    {
+        if ($this-&gt;handle !== null)
+            @odbc_free_result($this-&gt;handle);
+    }
+
+    public function getHandle()
+    {
+        return $this-&gt;handle;
+    }
+
+}
\ No newline at end of file

Added: trunk/vendor/creole/drivers/odbc/ODBCIdGenerator.php
===================================================================
--- trunk/vendor/creole/drivers/odbc/ODBCIdGenerator.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/odbc/ODBCIdGenerator.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,118 @@
+&lt;?php
+
+require_once 'creole/IdGenerator.php';
+
+/**
+ * ODBC IdGenerator implimenation.
+ *
+ * NOTE: I tried keeping the SQL as basic as possible in this class.
+ *       If you need something more optimized, derive your own IdGenerator
+ *       and use {@link ODBCAdapter::getIdGenerator()} to use it.
+ *
+ * @author    Dave Lawson &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">dlawson at masterytech.com</A>&gt;
+ * @version   $Revision: 1.2 $
+ * @package   creole.drivers.odbc
+ */
+class ODBCIdGenerator implements IdGenerator {
+
+    /** Connection object that instantiated this class */
+    private $conn;
+
+    /**
+     * Creates a new IdGenerator class, saves passed connection for use
+     * later by getId() method.
+     * @param Connection $conn
+     */
+    public function __construct(Connection $conn)
+    {
+        $this-&gt;conn = $conn;
+    }
+
+    /**
+     * @see IdGenerator::isBeforeInsert()
+     */
+    public function isBeforeInsert()
+    {
+        return true;
+    }
+
+    /**
+     * @see IdGenerator::isAfterInsert()
+     */
+    public function isAfterInsert()
+    {
+        return false;
+    }
+
+    /**
+     * @see IdGenerator::getIdMethod()
+     */
+    public function getIdMethod()
+    {
+        return self::SEQUENCE;
+    }
+
+    /**
+     * @see IdGenerator::getId()
+     */
+    public function getId($seqname = null)
+    {
+        if ($seqname === null)
+            throw new SQLException('You must specify the sequence name when calling getId() method.');
+
+        $triedcreate = false;
+
+        while (1)
+        {
+            try
+            {
+                $n = $this-&gt;conn-&gt;executeUpdate(&quot;UPDATE $seqname SET id = id + 1&quot;, ResultSet::FETCHMODE_NUM);
+
+                if ($n == 0)
+                    throw new SQLException('Failed to update IdGenerator id', $this-&gt;conn-&gt;nativeError());
+
+                $rs = $this-&gt;conn-&gt;executeQuery(&quot;SELECT id FROM $seqname&quot;, ResultSet::FETCHMODE_NUM);
+            }
+            catch (SQLException $e)
+            {
+                //$odbcerr = odbc_error($this-&gt;conn-&gt;getResource());
+
+                if ($triedcreate)// || ($odbcerr != 'S0000' &amp;&amp; $odbcerr != 'S0002'))
+                    throw $e;
+
+                $this-&gt;drop($seqname, true);
+                $this-&gt;create($seqname);
+                $triedcreate = true;
+                continue;
+            }
+
+            break;
+        }
+
+        $rs-&gt;first();
+
+        return $rs-&gt;getInt(1);
+    }
+
+    /**
+     * Creates the sequence emulation table.
+     */
+    public function create($seqname)
+    {
+        $this-&gt;conn-&gt;executeUpdate(&quot;CREATE TABLE $seqname ( id numeric(19,0) NOT NULL )&quot;);
+        $this-&gt;conn-&gt;executeUpdate(&quot;INSERT INTO $seqname ( id ) VALUES ( 0 )&quot;);
+    }
+
+    /**
+     * Drops the sequence emulation table.
+     */
+    public function drop($seqname, $ignoreerrs = false)
+    {
+        try {
+            $this-&gt;conn-&gt;executeUpdate(&quot;DROP TABLE $seqname&quot;);
+        } catch (Exception $e) {
+            if (!$ignoreerrs) throw $e;
+        }
+    }
+
+}
\ No newline at end of file

Added: trunk/vendor/creole/drivers/odbc/ODBCPreparedStatement.php
===================================================================
--- trunk/vendor/creole/drivers/odbc/ODBCPreparedStatement.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/odbc/ODBCPreparedStatement.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,243 @@
+&lt;?php
+/*
+ *  $Id: ODBCPreparedStatement.php,v 1.3 2005/04/01 17:08:37 dlawson_mi Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+require_once 'creole/PreparedStatement.php';
+require_once 'creole/common/PreparedStatementCommon.php';
+require_once 'creole/util/Lob.php';
+
+/**
+ * ODBC specific PreparedStatement functions.
+ *
+ * @author    Dave Lawson &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">dlawson at masterytech.com</A>&gt;
+ * @version   $Revision: 1.3 $
+ * @package   creole.drivers.odbc
+ */
+class ODBCPreparedStatement extends PreparedStatementCommon implements PreparedStatement
+{
+    /**
+     * This does nothing since ODBC natively supports prepared statements.
+     * @see PreparedStatementCommon::replaceParams()
+     */
+    protected function replaceParams()
+    {
+        if ($this-&gt;conn-&gt;getAdapter()-&gt;emulatePrepareStmt())
+            return parent::replaceParams();
+        else
+            return $this-&gt;sql;
+    }
+
+    /**
+     * Internal function to call native ODBC prepare/execute functions.
+     */
+    protected function _execute($sql, $params, $fetchmode, $isupdate)
+    {
+        if ($this-&gt;resultSet)
+        {
+            $this-&gt;resultSet-&gt;close();
+            $this-&gt;resultSet = null;
+        }
+
+        $this-&gt;updateCount = null;
+
+        if ($this-&gt;conn-&gt;getAdapter()-&gt;emulatePrepareStmt())
+        {
+            $stmt = @odbc_exec($this-&gt;conn-&gt;getResource(), $sql);
+            $ret = ($stmt !== false);
+        }
+        else
+        {
+            // Trim surrounding quotes added from default set methods.
+            // Exception: for LOB-based parameters, odbc_execute() will
+            // accept a filename surrounded by single-quotes.
+            foreach ($this-&gt;boundInVars as $idx =&gt; $var)
+            {
+                if ($var instanceof Lob)
+                {
+                    $file = ($isupdate ? $var-&gt;getInputFile() : $var-&gt;getOutputFile());
+                    $this-&gt;boundInVars[$idx] = &quot;'$file'&quot;;
+                }
+                else if (is_string($var))
+                {
+                    $this-&gt;boundInVars[$idx] = trim($var, &quot;\&quot;\'&quot;);
+                }
+            }
+
+            $stmt = @odbc_prepare($this-&gt;conn-&gt;getResource(), $sql);
+
+            if ($stmt === FALSE)
+                throw new SQLException('Could not prepare query', $this-&gt;conn-&gt;nativeError(), $sql);
+
+            $ret = @odbc_execute($stmt, $this-&gt;boundInVars);
+        }
+
+        if ($ret === FALSE)
+        {
+            @odbc_free_result($stmt);
+            throw new SQLException('Could not execute query', $this-&gt;conn-&gt;nativeError(), $sql);
+        }
+
+        return $this-&gt;conn-&gt;createResultSet(new ODBCResultResource($stmt), $fetchmode);
+    }
+
+    /**
+     * @see PreparedStatement::executeQuery()
+     */
+    public function executeQuery()
+    {
+        switch (func_num_args()) {
+        case 2:
+        list($params, $fetchmode) = func_get_args();
+            if (!is_array($params)) {
+                unset($params);
+            }
+            break;
+        case 1:
+            $params = null;
+            list($fetchmode) = func_get_args();
+            break;
+        case 0:
+            $params = null;
+            $fetchmode = null;
+            break;
+        }	
+        
+        // Set any params passed directly
+        if (isset($params)) {
+            for($i=0,$cnt=count($params); $i &lt; $cnt; $i++) {
+                $this-&gt;set($i+1, $params[$i]);
+            }
+        }
+        
+        $sql = $this-&gt;replaceParams();
+        
+        if ($this-&gt;conn-&gt;getAdapter()-&gt;hasLimitOffset())
+        {
+            if ($this-&gt;limit &gt; 0 || $this-&gt;offset &gt; 0)
+                $this-&gt;conn-&gt;applyLimit($sql, $this-&gt;offset, $this-&gt;limit);
+        }
+
+        $this-&gt;resultSet = $this-&gt;_execute($sql, $params, $fetchmode, false);
+
+        if (!$this-&gt;conn-&gt;getAdapter()-&gt;hasLimitOffset())
+        {
+            $this-&gt;resultSet-&gt;_setOffset($this-&gt;offset);
+            $this-&gt;resultSet-&gt;_setLimit($this-&gt;limit);
+        }
+
+        return $this-&gt;resultSet;
+    }
+
+    /**
+     * @see PreparedStatement::executeUpdate()
+     */
+    public function executeUpdate($params = null)
+    {
+        // Set any params passed directly
+        if ($params) {
+            for($i=0,$cnt=count($params); $i &lt; $cnt; $i++) {
+                $this-&gt;set($i+1, $params[$i]);
+            }
+        }
+
+        $sql = $this-&gt;replaceParams();
+        $this-&gt;_execute($sql, $params, 0, true);
+        $this-&gt;updateCount = $this-&gt;conn-&gt;getUpdateCount();
+
+        return $this-&gt;updateCount;
+    }
+
+    /**
+     * @see PreparedStatementCommon::escape()
+     */
+    protected function escape($str)
+    {
+        if ($this-&gt;conn-&gt;getAdapter()-&gt;emulatePrepareStmt())
+            return $this-&gt;conn-&gt;getAdapter()-&gt;escape($str);
+            
+        // Nothing to do here. odbc_execute() takes care of escaping strings.
+        return $str;
+    }
+
+    /**
+     * @see PreparedStatement::setNull()
+     */
+    function setNull($paramIndex)
+    {
+        $this-&gt;boundInVars[$paramIndex] = null;
+    }
+
+    /**
+     * @see PreparedStatement::setBlob()
+     */
+    function setBlob($paramIndex, $blob)
+    {
+        if ($this-&gt;conn-&gt;getAdapter()-&gt;emulatePrepareStmt())
+            return parent::setBlob($paramIndex, $blob);
+            
+        if ($blob === null)
+        {
+            $this-&gt;setNull($paramIndex);
+            return;
+        }
+
+        if ($blob instanceof Blob)
+        {
+            if ($blob-&gt;isFromFile() &amp;&amp; !$blob-&gt;isModified())
+            {
+                $this-&gt;boundInVars[$paramIndex] = $blob;
+                return;
+            }
+
+            $blob = $blob-&gt;__toString();
+        }
+
+        $this-&gt;boundInVars[$paramIndex] = &quot;'&quot; . $this-&gt;escape($blob) . &quot;'&quot;;
+    }
+
+    /**
+     * @see PreparedStatement::setClob()
+     */
+    function setClob($paramIndex, $clob)
+    {
+        if ($this-&gt;conn-&gt;getAdapter()-&gt;emulatePrepareStmt())
+            return parent::setClob($paramIndex, $clob);
+
+        if ($clob === null)
+        {
+            $this-&gt;setNull($paramIndex);
+            return;
+        }
+
+        if ($clob instanceof Clob)
+        {
+            if ($clob-&gt;isFromFile() &amp;&amp; !$clob-&gt;isModified())
+            {
+                $this-&gt;boundInVars[$paramIndex] = $clob;
+                return;
+            }
+
+            $clob = $clob-&gt;__toString();
+        }
+
+        $this-&gt;boundInVars[$paramIndex] = &quot;'&quot; . $this-&gt;escape($clob) . &quot;'&quot;;
+    }
+
+}
\ No newline at end of file

Added: trunk/vendor/creole/drivers/odbc/ODBCResultSet.php
===================================================================
--- trunk/vendor/creole/drivers/odbc/ODBCResultSet.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/odbc/ODBCResultSet.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,209 @@
+&lt;?php
+/*
+ *  $Id: ODBCResultSet.php,v 1.2 2005/04/01 17:10:42 dlawson_mi Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+require_once 'creole/drivers/odbc/ODBCResultSetCommon.php';
+
+/**
+ * ODBC implementation of ResultSet.
+ *
+ * If the current ODBC driver does not support LIMIT or OFFSET natively,
+ * the methods in here perform some adjustments and extra checking to make
+ * sure that this behaves the same as RDBMS drivers using native OFFSET/LIMIT.
+ *
+ * This class also emulates a row count if the driver is not capable of 
+ * providing one natively.
+ * 
+ * NOTE: This class only works with drivers that support absolute cursor 
+ *       positioning (SQL_FETCH_DIRECTION = SQL_FD_FETCH_ABSOLUTE). If the
+ *       driver you are using does not support reverse/absolute cursor 
+ *       scrolling, you should use the {@link ODBCCachedResultSet} class instead.
+ *       See the documentation for ODBCCachedResultSet for instructions on how
+ *       to use it.
+ *
+ * @author    Dave Lawson &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">dlawson at masterytech.com</A>&gt;
+ * @version   $Revision: 1.2 $
+ * @package   creole.drivers.odbc
+ */
+class ODBCResultSet extends ODBCResultSetCommon implements ResultSet
+{
+    /**
+     * Number of rows in resultset.
+     *
+     * @var int
+     */
+    protected $numRows = -1;
+
+    /**
+     * True if ODBC driver supports odbc_num_rows().
+     *
+     * @var boolean
+     */
+    protected $hasRowCount = false;
+    
+    /**
+     * @see ResultSet::__construct()
+     */
+    public function __construct(Connection $conn, $result, $fetchmode = null)
+    {
+        parent::__construct($conn, $result, $fetchmode);
+
+        /**
+         * Some ODBC drivers appear not to handle odbc_num_rows() very well when
+         * more than one result handle is active at once. For example, the MySQL
+         * ODBC driver always returns the number of rows for the last executed
+         * result. For this reason, we'll store the row count here.
+         *
+         * Note also that many ODBC drivers do not support this method. In this
+         * case, getRecordCount() will perform a manual count.
+         */
+        $this-&gt;numRows = @odbc_num_rows($result-&gt;getHandle());
+        $this-&gt;hasRowCount = $this-&gt;numRows != -1;
+    }
+
+    /**
+     * @see ODBCResultSetCommon::close()
+     */
+    function close()
+    {
+        parent::close();
+        $numRows = -1;
+    }
+
+    /**
+     * @see ResultSet::seek()
+     */
+    public function seek($rownum)
+    {
+        if ($rownum &lt; 0 || $this-&gt;limit &gt; 0 &amp;&amp; $rownum &gt; $this-&gt;limit)
+            return false;
+        
+        $this-&gt;cursorPos = $rownum;
+
+        return true;
+    }
+
+    /**
+     * @see ResultSet::next()
+     */
+    public function next()
+    {
+        $this-&gt;cursorPos++;
+        
+        if ($this-&gt;limit &gt; 0 &amp;&amp; $this-&gt;cursorPos &gt; $this-&gt;limit) {
+            $this-&gt;cursorPos = $this-&gt;limit+1;
+            return false;
+        }
+
+        $rowNum = $this-&gt;offset + $this-&gt;cursorPos;
+        $fields = null;
+        
+        $cols = @odbc_fetch_into($this-&gt;result-&gt;getHandle(), $fields, $rowNum);
+
+        if ($cols === false) {
+            $this-&gt;cursorPos = -1;
+            return false;
+        }
+
+        $this-&gt;fields =&amp; $this-&gt;checkFetchMode($fields);
+        
+        return true;
+    }
+
+    /**
+     * @see ResultSet::isAfterLast()
+     */
+    public function isAfterLast()
+    {
+        // Force calculation of last record pos.
+        if ($this-&gt;cursorPos == -1)
+            $this-&gt;getRecordCount();
+            
+        return parent::isAfterLast();
+    }
+
+    /**
+     * @see ResultSet::getRecordCount()
+     */
+    function getRecordCount()
+    {
+        if ($this-&gt;hasRowCount)
+        {
+            // Use driver row count if provided.
+            $numRows = $this-&gt;numRows - $this-&gt;offset;
+
+            if ($this-&gt;limit &gt; 0 &amp;&amp; $numRows &gt; $this-&gt;limit)
+                $numRows = $this-&gt;limit;
+        }
+        else 
+        {
+            // Do manual row count if driver doesn't provide one.
+            if ($this-&gt;numRows == -1) 
+            {
+                $this-&gt;numRows = 0;
+                $this-&gt;beforeFirst();
+            
+                while($this-&gt;next()) 
+                    $this-&gt;numRows++;
+            }
+                
+            $numRows = $this-&gt;numRows;
+        }
+
+        // Cursor pos is -1 when an attempt to fetch past the last row was made
+        // (or a fetch error occured).
+        
+        if ($this-&gt;cursorPos == -1)
+            $this-&gt;cursorPos = $numRows+1;
+            
+        return $numRows;
+    }
+
+    /**
+     * @see ResultSet::getBlob()
+     */
+    public function getBlob($column)
+    {
+        require_once 'creole/util/Blob.php';
+        $idx = (is_int($column) ? $column - 1 : $column);
+        if (!array_key_exists($idx, $this-&gt;fields)) { throw new SQLException(&quot;Invalid resultset column: &quot; . $column); }
+        $data = $this-&gt;readLobData($column, ODBC_BINMODE_RETURN, $this-&gt;fields[$idx]);
+        if (!$data) { return null; }
+        $b = new Blob();
+        $b-&gt;setContents($data);
+        return $b;
+    }
+
+    /**
+     * @see ResultSet::getClob()
+     */
+    public function getClob($column)
+    {
+        require_once 'creole/util/Clob.php';
+        $idx = (is_int($column) ? $column - 1 : $column);
+        if (!array_key_exists($idx, $this-&gt;fields)) { throw new SQLException(&quot;Invalid resultset column: &quot; . $column); }
+        $data = $this-&gt;readLobData($column, ODBC_BINMODE_CONVERT, $this-&gt;fields[$idx]);
+        if (!$data) { return null; }
+        $c = new Clob();
+        $c-&gt;setContents($data);
+        return $c;
+    }
+
+}
\ No newline at end of file

Added: trunk/vendor/creole/drivers/odbc/ODBCResultSetCommon.php
===================================================================
--- trunk/vendor/creole/drivers/odbc/ODBCResultSetCommon.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/odbc/ODBCResultSetCommon.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,187 @@
+&lt;?php
+/*
+ *  $Id: ODBCResultSetCommon.php,v 1.2 2005/04/01 17:12:09 dlawson_mi Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+require_once 'creole/ResultSet.php';
+require_once 'creole/common/ResultSetCommon.php';
+
+/**
+ * Base class for ODBC implementation of ResultSet.
+ *
+ * @author    Dave Lawson &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">dlawson at masterytech.com</A>&gt;
+ * @version   $Revision: 1.2 $
+ * @package   creole.drivers.odbc
+ */
+abstract class ODBCResultSetCommon extends ResultSetCommon
+{
+    /**
+     * Offset at which to start reading rows (for emulated offset).
+     * @var int
+     */
+    protected $offset = 0;
+
+    /**
+     * Maximum rows to retrieve, or 0 if all (for emulated limit).
+     * @var int
+     */
+    protected $limit = 0;
+
+    /**
+     * @see ResultSet::__construct()
+     */
+    public function __construct(Connection $conn, $result, $fetchmode = null)
+    {
+        parent::__construct($conn, $result, $fetchmode);
+    }
+
+    /**
+     * @see ResultSet::close()
+     */
+    public function close()
+    {
+        $this-&gt;result = null;
+        $this-&gt;conn = null;
+        $this-&gt;fetchmode = null;
+        $this-&gt;cursorPos = 0;
+        $this-&gt;fields = null;
+        $this-&gt;ignoreAssocCase = false;
+        $this-&gt;limit = 0;
+        $this-&gt;offset = 0;
+    }
+
+    /**
+     * This function exists to set offset after ResultSet is instantiated.
+     * This function should be &quot;protected&quot; in Java sense: only available to classes in package.
+     * THIS METHOD SHOULD NOT BE CALLED BY ANYTHING EXCEPTION DRIVER CLASSES.
+     * @param int $offset New offset.
+     * @access protected
+     */
+    public function _setOffset($offset)
+    {
+        $this-&gt;offset = $offset;
+    }
+
+    /**
+     * This function exists to set limit after ResultSet is instantiated.
+     * This function should be &quot;protected&quot; in Java sense: only available to classes in package.
+     * THIS METHOD SHOULD NOT BE CALLED BY ANYTHING EXCEPTION DRIVER CLASSES.
+     * @param int $limit New limit.
+     * @access protected
+     */
+    public function _setLimit($limit)
+    {
+        $this-&gt;limit = $limit;
+    }
+
+    /**
+     * If fetchmode is FETCHMODE_ASSOC, returns the 1-based field index number
+     * for the specified column name. Otherwise returns 0 (false).
+     * @return int
+     */
+    function getFieldNum($colname)
+    {
+        $fieldnum = 0;
+
+        if ($this-&gt;fetchmode == ResultSet::FETCHMODE_ASSOC)
+        {
+            $keys = array_keys($this-&gt;fields);
+            $fieldnum = array_search($colname, $keys);
+        }
+
+        return $fieldnum;
+    }
+
+    /**
+     * Reads in any unread LOB data. For long char fields, we may already
+     * have up to odbc_longreadlen() bytes in the buffer. These are passed
+     * in via the $curdata parm. For long binary fields, no data is read
+     * initially since odbc_binmode() is set to ODBC_BINMODE_PASSTHRU.
+     * This method adjusts the binmode and longreadlen to finish reading
+     * these datatypes into the buffer. Returns a string with the complete
+     * contents.
+     *
+     * @param int|string $column Column index or name to read data from.
+     * @param int $binmode ODBC_BINMODE_RETURN for binary data, ODBC_BINMODE_CONVERT for char data.
+     * @param string $curdata Existing LOB data already in buffer.
+     * @return string
+     */
+    protected function readLobData($column, $binmode, $curdata = null)
+    {
+        // Retrieve field num
+        $fldNum = (is_int($column) ? $column : getFieldNum($column));
+
+        $data = $curdata;
+        $newdata = null;
+
+        // Adjust binmode and longreadlen
+        odbc_binmode($this-&gt;result-&gt;getHandle(), $binmode);
+        odbc_longreadlen($this-&gt;result-&gt;getHandle(), 4096);
+
+        while (1)
+        {
+            $newdata = odbc_result($this-&gt;result-&gt;getHandle(), $fldNum);
+
+            if ($newdata === false)
+                break;
+            else
+                $data .= $newdata;
+        }
+
+        // Restore the default binmode and longreadlen
+        odbc_binmode($this-&gt;result-&gt;getHandle(), ODBC_BINMODE_PASSTHRU);
+        odbc_longreadlen($this-&gt;result-&gt;getHandle(), ini_get('odbc.defaultlrl'));
+
+        // The ODBC driver I use seems to return a string with an escaped
+        // null char at the end for clob data.
+        $data = rtrim($data, &quot;\x0&quot;);
+
+        return $data;
+    }
+    
+    /**
+     * Converts row fields to names if FETCHMODE_ASSOC is set.
+     *
+     * @param array&amp; Row to convert.
+     *
+     * @return array&amp; Converted row.
+     */
+    protected function checkFetchMode(&amp;$row)
+    {
+        if ($this-&gt;fetchmode == ResultSet::FETCHMODE_ASSOC)
+        {
+            $newrow = array();
+            
+            for ($i = 0, $n = count($row); $i &lt; $n; $i++)
+            {
+                $colname = @odbc_field_name($this-&gt;result-&gt;getHandle(), $i+1);
+                
+                if (!$this-&gt;ignoreAssocCase)
+                    $colname = strtolower($colname);
+                    
+                $newrow[$colname] = $row[$i];
+            }
+            
+            $row =&amp; $newrow;
+        }
+        
+        return $row;
+    }
+
+}
\ No newline at end of file

Added: trunk/vendor/creole/drivers/odbc/ODBCStatement.php
===================================================================
--- trunk/vendor/creole/drivers/odbc/ODBCStatement.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/odbc/ODBCStatement.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,64 @@
+&lt;?php
+/*
+ *  $Id: ODBCStatement.php,v 1.1 2004/07/27 23:08:30 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+require_once 'creole/Statement.php';
+require_once 'creole/common/StatementCommon.php';
+
+/**
+ * ODBC Statement
+ *
+ * @author    Dave Lawson &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">dlawson at masterytech.com</A>&gt;
+ * @version   $Revision: 1.1 $
+ * @package   creole.drivers.odbc
+ */
+class ODBCStatement extends StatementCommon implements Statement
+{
+    /**
+     * @see Statement::executeQuery()
+     */
+    public function executeQuery($sql, $fetchmode = null)
+    {
+        if ($this-&gt;resultSet)
+        {
+            $this-&gt;resultSet-&gt;close();
+            $this-&gt;resultSet = null;
+        }
+
+        $this-&gt;updateCount = null;
+
+        if ($this-&gt;conn-&gt;getAdapter()-&gt;hasLimitOffset())
+        {
+            if ($this-&gt;limit &gt; 0 || $this-&gt;offset &gt; 0)
+                $this-&gt;conn-&gt;applyLimit($sql, $this-&gt;offset, $this-&gt;limit);
+        }
+
+        $this-&gt;resultSet = $this-&gt;conn-&gt;executeQuery($sql, $fetchmode);
+
+        if (!$this-&gt;conn-&gt;getAdapter()-&gt;hasLimitOffset())
+        {
+            $this-&gt;resultSet-&gt;_setOffset($this-&gt;offset);
+            $this-&gt;resultSet-&gt;_setLimit($this-&gt;limit);
+        }
+
+        return $this-&gt;resultSet;
+    }
+
+}
\ No newline at end of file

Added: trunk/vendor/creole/drivers/odbc/ODBCTypes.php
===================================================================
--- trunk/vendor/creole/drivers/odbc/ODBCTypes.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/odbc/ODBCTypes.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,189 @@
+&lt;?php
+
+/*
+ *  $Id: ODBCTypes.php,v 1.1 2004/07/27 23:08:30 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+require_once 'creole/CreoleTypes.php';
+
+/**
+ * ODBC types / type map.
+ *
+ * @author    Dave Lawson &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">dlawson at masterytech.com</A>&gt;
+ * @version   $Revision: 1.1 $
+ * @package   creole.drivers.odbc
+ */
+class ODBCTypes extends CreoleTypes {
+
+    /**
+     * Map ODBC native types to Creole (JDBC) types.
+     */
+    protected static $typeMap = null;
+
+    /**
+     * Reverse mapping, created on demand.
+     */
+    protected static $reverseMap = null;
+
+    /**
+     * Loads the map of ODBC data types to Creole (JDBC) types.
+     *
+     * NOTE: This function cannot map DBMS-specific datatypes. If you use a
+     *       driver which implements DBMS-specific datatypes, you will need
+     *       to modify/extend this class to add the correct mapping.
+     */
+    public static function loadTypeMap($conn = null)
+    {
+        if (self::$typeMap !== null &amp;&amp; count(self::$typeMap) &gt; 0)
+            return;
+
+        if ($conn == null)
+            throw new SQLException('No connection specified when loading ODBC type map.');
+
+        self::$typeMap = array();
+
+        $result = @odbc_gettypeinfo($conn-&gt;getResource());
+
+        if ($result === false)
+            throw new SQLException('Failed to retrieve type info.', $conn-&gt;nativeError());
+
+        $rowNum = 1;
+
+        while (odbc_fetch_row($result, $rowNum++))
+        {
+            $odbctypeid = odbc_result($result, 'DATA_TYPE');
+            $odbctypename = odbc_result($result, 'TYPE_NAME');
+
+            switch ($odbctypeid)
+            {
+                case SQL_CHAR:
+                    self::$typeMap[$odbctypename] = CreoleTypes::CHAR;
+                    break;
+                case SQL_VARCHAR:
+                    self::$typeMap[$odbctypename] = CreoleTypes::VARCHAR;
+                    break;
+                case SQL_LONGVARCHAR:
+                    self::$typeMap[$odbctypename] = CreoleTypes::LONGVARCHAR;
+                    break;
+                case SQL_DECIMAL:
+                    self::$typeMap[$odbctypename] = CreoleTypes::DECIMAL;
+                    break;
+                case SQL_NUMERIC:
+                    self::$typeMap[$odbctypename] = CreoleTypes::NUMERIC;
+                    break;
+                case SQL_BIT:
+                    self::$typeMap[$odbctypename] = CreoleTypes::BOOLEAN;
+                    break;
+                case SQL_TINYINT:
+                    self::$typeMap[$odbctypename] = CreoleTypes::TINYINT;
+                    break;
+                case SQL_SMALLINT:
+                    self::$typeMap[$odbctypename] = CreoleTypes::SMALLINT;
+                    break;
+                case SQL_INTEGER:
+                    self::$typeMap[$odbctypename] = CreoleTypes::INTEGER;
+                    break;
+                case SQL_BIGINT:
+                    self::$typeMap[$odbctypename] = CreoleTypes::BIGINT;
+                    break;
+                case SQL_REAL:
+                    self::$typeMap[$odbctypename] = CreoleTypes::REAL;
+                    break;
+                case SQL_FLOAT:
+                    self::$typeMap[$odbctypename] = CreoleTypes::FLOAT;
+                    break;
+                case SQL_DOUBLE:
+                    self::$typeMap[$odbctypename] = CreoleTypes::DOUBLE;
+                    break;
+                case SQL_BINARY:
+                    self::$typeMap[$odbctypename] = CreoleTypes::BINARY;
+                    break;
+                case SQL_VARBINARY:
+                    self::$typeMap[$odbctypename] = CreoleTypes::VARBINARY;
+                    break;
+                case SQL_LONGVARBINARY:
+                    self::$typeMap[$odbctypename] = CreoleTypes::LONGVARBINARY;
+                    break;
+                case SQL_DATE:
+                    self::$typeMap[$odbctypename] = CreoleTypes::DATE;
+                    break;
+                case SQL_TIME:
+                    self::$typeMap[$odbctypename] = CreoleTypes::TIME;
+                    break;
+                case SQL_TIMESTAMP:
+                    self::$typeMap[$odbctypename] = CreoleTypes::TIMESTAMP;
+                    break;
+                case SQL_TYPE_DATE:
+                    self::$typeMap[$odbctypename] = CreoleTypes::DATE;
+                    break;
+                case SQL_TYPE_TIME:
+                    self::$typeMap[$odbctypename] = CreoleTypes::TIME;
+                    break;
+                case SQL_TYPE_TIMESTAMP:
+                    self::$typeMap[$odbctypename] = CreoleTypes::TIMESTAMP;
+                    break;
+                default:
+                    self::$typeMap[$odbctypename] = CreoleTypes::OTHER;
+                    break;
+            }
+        }
+
+        @odbc_free_result($result);
+    }
+
+    /**
+     * This method returns the generic Creole (JDBC-like) type
+     * when given the native db type.
+     * @param string $nativeType DB native type (e.g. 'TEXT', 'byetea', etc.).
+     * @return int Creole native type (e.g. CreoleTypes::LONGVARCHAR, CreoleTypes::BINARY, etc.).
+     */
+    public static function getType($nativeType)
+    {
+        if (!self::$typeMap)
+            self::loadTypeMap();
+
+        $t = strtoupper($nativeType);
+
+        if (isset(self::$typeMap[$t])) {
+            return self::$typeMap[$t];
+        } else {
+            return CreoleTypes::OTHER;
+        }
+    }
+
+    /**
+     * This method will return a native type that corresponds to the specified
+     * Creole (JDBC-like) type.
+     * If there is more than one matching native type, then the LAST defined
+     * native type will be returned.
+     * @param int $creoleType
+     * @return string Native type string.
+     */
+    public static function getNativeType($creoleType)
+    {
+        if (!self::$typeMap)
+            self::loadTypeMap();
+
+        if (self::$reverseMap === null) {
+            self::$reverseMap = array_flip(self::$typeMap);
+        }
+        return @self::$reverseMap[$creoleType];
+    }
+
+}
\ No newline at end of file

Added: trunk/vendor/creole/drivers/odbc/README
===================================================================
--- trunk/vendor/creole/drivers/odbc/README	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/odbc/README	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,90 @@
+
+
+Creole ODBC Bridge Driver
+=========================
+
+
+I. Overview
+-----------
+
+In the text below, the word &quot;driver&quot; can get somewhat muddled since there are 
+two libraries concerned here (Creole &amp; ODBC). So, we'll use the term &quot;bridge 
+driver&quot; to refer to Creole's ODBC bridge driver, and &quot;ODBC driver&quot; to refer to 
+an ODBC database driver.
+
+The Creole ODBC Bridge driver provides a solution for databases which 
+currently have no PHP-native interface. It is currently in an experimental
+stage of development. It has been tested with two ODBC drivers (Sequiter's
+CodeBase ODBC driver and the MySQL ODBC driver (as a baseline test)). To
+use any other ODBC drivers you may need to write your own ODBCAdapter-derived
+class (see below).
+
+
+II. ODBCAdapter
+---------------
+
+Because ODBC itself is a database abstraction library, the bridge driver needed
+a way of hiding ODBC driver-specific behavior. The solution to this was to 
+create an adapter layer (akin to how the Propel runtime engine works). Think of
+it as a sub-driver for the bridge driver. Any ODBC driver-specific behavior is
+handled by an ODBCAdapter-derived class. To use a specific adapter class, you
+specify its name via a parameter in the connection string:
+
+<A HREF="odbc://localhost/DSN=CodeBase;?adapter=CodeBase">odbc://localhost/DSN=CodeBase;?adapter=CodeBase</A>
+
+The string above will load the following file as the adapter to use with the
+bridge driver: creole/drivers/odbc/adapters/CodeBaseAdapter.php
+
+Some ODBC drivers are limited in support for various Creole features. The 
+ODBCAdapter also provides a method for emulation of some of these missing 
+features:
+
+    -The emulatePrepareStmt() method provides a switch for enabling prepared
+     statement emulation for drivers that do not support (or have trouble with)
+     prepared statements. This emulation is disabled by default.
+     
+    -The hasLimitOffset() method provides a switch for enabling LIMIT/OFFSET 
+     emulation for drivers that do not support this. This emulation is enabled
+     by default. The LIMIT/OFFSET emulation was borrowed from the MSSQL Creole 
+     driver.
+
+    -The createResultSet() method provides a switch for enabling cached 
+     result sets. To enable this feature, return an instance of 
+     ODBCCachedResultSet in the createResultSet() method of your ODBCAdapter-
+     derived class. This can be useful as a workaround for ODBC drivers which
+     lack support for record count retrieval, reverse/absolute cursor
+     scrolling, etc. In most cases, result rows are cached on-demand. So if 
+     you only read the first couple rows of a result, then only those rows will 
+     be cached.
+
+    -The getIdGenerator() method provides a switch for enabling sequence
+     emulation. This feature is enabled by default in ODBCAdapter and is 
+     implemented in the ODBCIdGenerator class. The emulation code was inspired
+     by the PEAR::DB nextID() method. If your database supports sequences or
+     autoincrement natively, you can return your own IdGenerator-derived class 
+     instead. Check out some of the other Creole drivers for IdGenerator 
+     examples.
+     
+     
+III. Incomplete Features
+------------------------
+
+    -The database metadata classes are not fully tested/complete. Specifically, 
+     the ODBCDatabaseInfo class does not currently set the database name. There 
+     may be other problems as well. 
+ 
+    -The Creole CallableStatement class (stored procedures) is not currently 
+     implemented. No immediate plans to do this in the future, but it looks
+     feasible.
+
+
+IV. Known Issues
+----------------
+
+This driver was developed using the PHP v5.0 final build. During the course 
+of testing I uncovered several bugs in the php_odbc module. I submitted
+patches for these bugs, but have not yet received word that they were 
+committed (they were just submitted this morning). If you want more details
+on the problems I encountered or would like a copy of the patches, please
+e-mail me (<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">dlawson at masterytech.com</A>).
+

Added: trunk/vendor/creole/drivers/odbc/adapters/CodeBaseAdapter.php
===================================================================
--- trunk/vendor/creole/drivers/odbc/adapters/CodeBaseAdapter.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/odbc/adapters/CodeBaseAdapter.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,73 @@
+&lt;?php
+/*
+ *  $Id: CodeBaseAdapter.php,v 1.3 2005/10/17 19:03:51 dlawson_mi Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+require_once 'creole/drivers/odbc/adapters/ODBCAdapter.php';
+
+/**
+ * CodeBase driver-specific behavior.
+ *
+ * This adapter is for Sequiter's CodeBaseSQL product. It is a dBase ODBC
+ * driver. The driver only supports forward-only cursor scrolling so this
+ * adapter causes the ODBCCachedResultSet to be used.
+ *
+ * A couple other quirks exist: 
+ * 
+ * 1) Cannot get blobs to work correctly. If I try writing one to a 
+ *    LONGVARBINARY typed field, only the first few bytes are written.
+ *    This will cause the ResultSetTest::testGetBlob() test case to fail
+ *    when running tests for the driver.
+ *
+ * 2) For some reason the character count is off for the 
+ *    ResultSetTest::testSetClob() test case _only_ when running from the 
+ *    command line. If I run the same test through a web server it works fine.
+ *    Looks like it has something to do with line endings in Windows. The 
+ *    difference in file sizes is 9803 vs 10090.
+ *
+ * 3) Setting a clob field to null writes a space to the field in the table. 
+ *    This causes the PreparedStatementTest::testSetNull() test case to fail 
+ *    when running tests for the driver.
+ *
+ * @author    Dave Lawson &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">dlawson at masterytech.com</A>&gt;
+ * @version   $Revision: 1.3 $
+ * @package   creole.drivers.odbc
+ */
+class CodeBaseAdapter extends ODBCAdapter
+{
+    /**
+     * @see ODBCAdapter::createResultSet()
+     */
+    public function preservesColumnCase()
+    {
+        return false;
+    }
+
+    /**
+     * @see ODBCAdapter::createResultSet()
+     */
+    public function createResultSet($conn, $odbcresult, $fetchmode)
+    {
+        require_once 'creole/drivers/odbc/ODBCResultSet.php';
+        return new ODBCResultSet($conn, $odbcresult, $fetchmode, true);
+    }
+
+}
+
+?&gt;
\ No newline at end of file

Added: trunk/vendor/creole/drivers/odbc/adapters/MySQLAdapter.php
===================================================================
--- trunk/vendor/creole/drivers/odbc/adapters/MySQLAdapter.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/odbc/adapters/MySQLAdapter.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,78 @@
+&lt;?php
+/*
+ *  $Id: MySQLAdapter.php,v 1.1 2004/07/27 23:08:30 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+require_once 'creole/drivers/odbc/ODBCCachedResultSet.php';
+require_once 'creole/drivers/odbc/ODBCResultSet.php';
+require_once 'creole/drivers/odbc/adapters/ODBCAdapter.php';
+
+/**
+ * Implements MySQL driver-specific behavior.
+ *
+ * Obviously it would be much more efficient to simply use the Creole
+ * MySQL driver. This adapter was created for the sole purpose of testing
+ * the ODBC driver.
+ *
+ * @author    Dave Lawson &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">dlawson at masterytech.com</A>&gt;
+ * @version   $Revision: 1.1 $
+ * @package   creole.drivers.odbc
+ */
+class MySQLAdapter extends ODBCAdapter
+{
+    /**
+     * @see ODBCAdapter::hasLimitOffset()
+     */
+    public function hasLimitOffset()
+    {
+        return true;
+    }
+
+    /**
+     * @see ODBCAdapter::applyLimit()
+     */
+    public function applyLimit(&amp;$sql, $offset, $limit)
+    {
+        if ( $limit &gt; 0 ) {
+            $sql .= &quot; LIMIT &quot; . ($offset &gt; 0 ? $offset . &quot;, &quot; : &quot;&quot;) . $limit;
+        } else if ( $offset &gt; 0 ) {
+            $sql .= &quot; LIMIT &quot; . $offset . &quot;, 18446744073709551615&quot;;
+        }
+    }
+
+    /**
+     * @see ODBCAdapter::escape()
+     */
+    public function escape($str)
+    {
+        return addslashes($str);
+    }
+
+    /**
+     * @see ODBCAdapter::createResultSet()
+     */
+    public function createResultSet($conn, $odbcresult, $fetchmode)
+    {
+//        return new ODBCCachedResultSet($conn, $odbcresult, $fetchmode, true);
+        return new ODBCResultSet($conn, $odbcresult, $fetchmode);
+    }
+
+}
+
+?&gt;
\ No newline at end of file

Added: trunk/vendor/creole/drivers/odbc/adapters/ODBCAdapter.php
===================================================================
--- trunk/vendor/creole/drivers/odbc/adapters/ODBCAdapter.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/odbc/adapters/ODBCAdapter.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,115 @@
+&lt;?php
+/*
+ *  $Id: ODBCAdapter.php,v 1.3 2005/10/17 19:03:51 dlawson_mi Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+/**
+ * Default class for ODBC driver-specific behavior.
+ *
+ * @author    Dave Lawson &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">dlawson at masterytech.com</A>&gt;
+ * @version   $Revision: 1.3 $
+ * @package   creole.drivers.odbc
+ */
+class ODBCAdapter
+{
+    /**
+     * Returns true if column case is preserved in the database when a table
+     * is first created. Returns false if table does not preserve case (i.e.
+     * ProductID =&gt; PRODUCTID).
+     *
+     * @return boolean
+     */
+    public function preservesColumnCase()
+    {
+        return true;
+    }
+
+    /**
+     * Returns true if prepared statements should be emulated. This
+     * might be useful if your driver does not support (or has trouble with)
+     * prepared statements.
+     * 
+     * @return boolean
+     */
+    public function emulatePrepareStmt()
+    {
+        return false;
+    }
+    
+    /**
+     * Returns true if ODBC driver supports LIMIT/OFFSET via SQL.
+     *
+     * @return boolean
+     */
+    public function hasLimitOffset()
+    {
+        return false;
+    }
+
+    /**
+     * @see Connection::applyLimit()
+     */
+    public function applyLimit(&amp;$sql, $offset, $limit)
+    {
+    }
+
+    /**
+     * @see PreparedStatementCommon::escape()
+     */
+    public function escape($str)
+    {
+        // use this instead of magic_quotes_sybase + addslashes(),
+        // just in case multiple RDBMS being used at the same time
+        return str_replace(&quot;'&quot;, &quot;''&quot;, $str);
+    }
+
+    /**
+     * Returns an instance of the default resultset.
+     *
+     * @return boolean
+     */
+    public function createResultSet($conn, $odbcresult, $fetchmode)
+    {
+        require_once 'creole/drivers/odbc/ODBCResultSet.php';
+        return new ODBCResultSet($conn, $odbcresult, $fetchmode);
+    }
+
+    /**
+     * Returns the default ODBCIdGenerator for emulating sequences.
+     *
+     * @return ODBCIdGenerator
+     */
+    public function getIdGenerator($conn)
+    {
+        require_once 'creole/drivers/odbc/ODBCIdGenerator.php';
+        return new ODBCIdGenerator($conn);
+    }
+
+    /**
+     * Returns true if driver support transactions.
+     * 
+     * @return boolean
+     */
+    public function supportsTransactions()
+    {
+        return true;
+    }
+}
+
+?&gt;
\ No newline at end of file

Added: trunk/vendor/creole/drivers/odbc/metadata/ODBCDatabaseInfo.php
===================================================================
--- trunk/vendor/creole/drivers/odbc/metadata/ODBCDatabaseInfo.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/odbc/metadata/ODBCDatabaseInfo.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,66 @@
+&lt;?php
+/*
+ *  $Id: ODBCDatabaseInfo.php,v 1.1 2004/07/27 23:08:30 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+require_once 'creole/metadata/DatabaseInfo.php';
+
+/**
+ * ODBC implementation of DatabaseInfo.
+ *
+ * @todo Still need a way to obtain the database name. Not sure how to do this yet.
+ * @todo This might need to be an {@link ODBCAdapter} method.
+ *
+ * @author    Dave Lawson &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">dlawson at masterytech.com</A>&gt;
+ * @version   $Revision: 1.1 $
+ * @package   creole.drivers.odbc.metadata
+ */
+class ODBCDatabaseInfo extends DatabaseInfo {
+
+    /**
+     * @see DatabaseInfo::initTables()
+     */
+    protected function initTables()
+    {
+        include_once 'creole/drivers/odbc/metadata/ODBCTableInfo.php';
+
+        $result = @odbc_tables($this-&gt;dblink);
+
+        if (!$result)
+            throw new SQLException('Could not list tables', $this-&gt;conn-&gt;nativeError());
+
+        while (odbc_fetch_row($result))
+        {
+            $tablename = strtoupper(odbc_result($result, 'TABLE_NAME'));
+            $this-&gt;tables[$tablename] = new ODBCTableInfo($this, $tablename);
+        }
+
+        @odbc_free_result($result);
+    }
+
+    /**
+     * @return void
+     * @throws SQLException
+     */
+    protected function initSequences()
+    {
+        // Not sure how this is used yet.
+    }
+
+}
\ No newline at end of file

Added: trunk/vendor/creole/drivers/odbc/metadata/ODBCTableInfo.php
===================================================================
--- trunk/vendor/creole/drivers/odbc/metadata/ODBCTableInfo.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/odbc/metadata/ODBCTableInfo.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,140 @@
+&lt;?php
+/*
+ *  $Id: ODBCTableInfo.php,v 1.1 2004/07/27 23:08:30 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+ 
+require_once 'creole/metadata/TableInfo.php';
+
+/**
+ * ODBC implementation of TableInfo.
+ *
+ * @author    Dave Lawson &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">dlawson at masterytech.com</A>&gt;
+ * @version   $Revision: 1.1 $
+ * @package   creole.drivers.odbc.metadata
+ */
+class ODBCTableInfo extends TableInfo {
+
+    /**
+     * @see TableInfo::initColumns()
+     */
+    protected function initColumns()
+    {
+        include_once 'creole/metadata/ColumnInfo.php';
+        include_once 'creole/drivers/odbc/ODBCTypes.php';
+
+        ODBCTypes::loadTypeMap($this-&gt;conn);
+
+        $result = @odbc_columns($this-&gt;dblink, $this-&gt;dbname, '', $this-&gt;name);
+
+        if (!$result)
+            throw new SQLException('Could not get column names', $this-&gt;conn-&gt;nativeError());
+
+        while (odbc_fetch_row($result))
+        {
+            $name = odbc_result($result, 'COLUMN_NAME');
+            $type = odbc_result($result, 'TYPE_NAME');
+            $length = odbc_result($result, 'LENGTH');
+            $is_nullable = odbc_result($result, 'NULLABLE');
+            $default = '';
+            $precision = odbc_result($result, 'PRECISION');
+            $this-&gt;columns[$name] = new ColumnInfo($this, $name, ODBCTypes::getType($type), $type, $length, $precision, $is_nullable, $default);
+        }
+
+        @odbc_free_result($result);
+
+        $this-&gt;colsLoaded = true;
+    }
+
+    /**
+     * @see TableInfo::initPrimaryKey()
+     */
+    protected function initPrimaryKey()
+    {
+        include_once 'creole/metadata/PrimaryKeyInfo.php';
+
+        // columns have to be loaded first
+        if (!$this-&gt;colsLoaded) $this-&gt;initColumns();
+
+        $result = @odbc_primarykeys($this-&gt;dblink, $this-&gt;dbname, '', $this-&gt;name);
+
+        while (odbc_fetch_row($result))
+        {
+            $name = odbc_result($result, 'COLUMN_NAME');
+
+            if (!isset($this-&gt;primaryKey))
+                $this-&gt;primaryKey = new PrimaryKeyInfo($name);
+
+            $this-&gt;primaryKey-&gt;addColumn($this-&gt;columns[$name]);
+        }
+
+        @odbc_free_result($result);
+
+        $this-&gt;pkLoaded = true;
+    }
+
+    /**
+     * @see TableInfo::initIndexes()
+     */
+    protected function initIndexes()
+    {
+        // Not sure if this can be implemented in a driver-independent way.
+    }
+
+    /**
+     * @see TableInfo::initForeignKeys()
+     */
+    protected function initForeignKeys()
+    {
+        // columns have to be loaded first
+        if (!$this-&gt;colsLoaded) $this-&gt;initColumns();
+
+        $result = @odbc_foreignkeys($this-&gt;dblink, '', '', '', $this-&gt;dbname, '', $this-&gt;name);
+
+        while (odbc_fetch_row($result))
+        {
+            $name = odbc_result($result, 'COLUMN_NAME');
+            $ftbl = odbc_result($result, 'FKTABLE_NAME');
+            $fcol = odbc_result($result, 'FKCOLUMN_NAME');
+
+            if (!isset($this-&gt;foreignKeys[$name]))
+            {
+                $this-&gt;foreignKeys[$name] = new ForeignKeyInfo($name);
+
+                if (($foreignTable = $this-&gt;database-&gt;getTable($ftbl)) === null)
+                {
+                    $foreignTable = new TableInfo($ltbl);
+                    $this-&gt;database-&gt;addTable($foreignTable);
+                }
+
+                if (($foreignCol = $foreignTable-&gt;getColumn($name)) === null)
+                {
+                    $foreignCol = new ColumnInfo($foreignTable, $name);
+                    $foreignTable-&gt;addColumn($foreignCol);
+                }
+
+                $this-&gt;foreignKeys[$name]-&gt;addReference($this-&gt;columns[$name], $foreignCol);
+            }
+        }
+
+        @odbc_free_result($result);
+
+        $this-&gt;fksLoaded = true;
+    }
+
+}
\ No newline at end of file

Added: trunk/vendor/creole/drivers/oracle/OCI8Connection.php
===================================================================
--- trunk/vendor/creole/drivers/oracle/OCI8Connection.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/oracle/OCI8Connection.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,386 @@
+&lt;?php
+
+/**
+ *  $Id: OCI8Connection.php,v 1.18 2005/10/17 19:03:51 dlawson_mi Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES ( INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION ) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * ( INCLUDING NEGLIGENCE OR OTHERWISE ) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+ 
+require_once 'creole/Connection.php';
+require_once 'creole/common/ConnectionCommon.php';
+include_once 'creole/drivers/oracle/OCI8ResultSet.php';
+
+/**
+ * Oracle implementation of Connection.
+ * 
+ * @author    David Giffin &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">david at giffin.org</A>&gt;
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @author    Stig Bakken &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">ssb at fast.no</A>&gt; 
+ * @author    Lukas Smith
+ * @version   $Revision: 1.18 $
+ * @package   creole.drivers.oracle
+ */ 
+class OCI8Connection extends ConnectionCommon implements Connection
+{        
+    protected $lastStmt			= null;    
+
+    /**
+     * Auto commit mode for oci_execute
+     * @var int
+     */
+    protected $execMode			= OCI_COMMIT_ON_SUCCESS;
+
+    /**
+     * Connect to a database and log in as the specified user.
+     *
+     * @param array $dsn The data source hash.
+     * @param int $flags Any connection flags.
+     * @access public
+     * @throws SQLException
+     * @return void
+     */
+    function connect( $dsninfo, $flags = 0 )
+    {
+        if ( !extension_loaded( 'oci8' ) )
+		{
+            throw new SQLException( 'oci8 extension not loaded' );
+        }
+
+        $this-&gt;dsn				= $dsninfo;
+        $this-&gt;flags			= $flags;
+        
+        $persistent				=
+			( $flags &amp; Creole::PERSISTENT === Creole::PERSISTENT );
+        
+        $user					= $dsninfo[ 'username' ];
+        $pw						= $dsninfo[ 'password' ];
+        $hostspec				= $dsninfo[ 'hostspec' ];
+
+        $connect_function		= ( $persistent )
+									? 'oci_pconnect'
+									: 'oci_connect';
+
+		@ini_set( 'track_errors', true );
+
+        if ( $hostspec &amp;&amp; $user &amp;&amp; $pw )
+		{
+			$conn				= @$connect_function( $user, $pw, $hostspec );
+        }
+		
+		elseif ( $user || $pw )
+		{
+			$conn				= @$connect_function( $user, $pw );
+        }
+		
+		else
+		{
+			$conn				= false;
+        }
+
+        @ini_restore( 'track_errors' );
+        
+        if ( $conn == false )
+		{
+            $error				= oci_error();
+            $error				= ( is_array( $error ) )
+									? $error[ 'message' ]
+									: null;
+
+            throw new SQLException( 'connect failed', $error );
+        }
+
+        $this-&gt;dblink			= $conn;
+
+        //connected ok, need to set a few environment settings
+        //please note, if this is changed, the function setTimestamp and setDate in OCI8PreparedStatement.php
+        //must be changed to match
+        $sql = &quot;ALTER SESSION SET NLS_DATE_FORMAT='YYYY-MM-DD HH24:MI:SS'&quot;;
+        $this-&gt;executeQuery($sql);
+    }
+
+
+    /**
+     * @see Connection::disconnect()
+     */
+    function close()
+    {
+        $ret = @oci_close( $this-&gt;dblink );
+        $this-&gt;dblink = null;
+        return $ret;
+    }        
+    
+    /**
+     * @see Connection::executeQuery()
+     */
+    function executeQuery( $sql, $fetchmode = null )
+    {
+        $this-&gt;lastQuery		= $sql;
+
+        // $result = @oci_parse( $this-&gt;dblink, $sql );
+        $result					= oci_parse( $this-&gt;dblink, $sql );
+
+        if ( ! $result )
+		{
+            throw new SQLException( 'Unable to prepare query'
+				, $this-&gt;nativeError()
+				, $sql
+			);
+        }
+
+        $success				= oci_execute( $result, $this-&gt;execMode );
+
+        if ( ! $success )
+		{
+            throw new SQLException( 'Unable to execute query'
+				, $this-&gt;nativeError( $result )
+				, $sql
+			);
+        }
+        
+        return new OCI8ResultSet( $this, $result, $fetchmode );
+    }
+
+    
+    /**
+     * @see Connection::simpleUpdate()
+     */
+    
+    function executeUpdate( $sql )
+    {    
+        $this-&gt;lastQuery		= $sql;
+
+        $statement				= oci_parse( $this-&gt;dblink, $sql );
+		
+        if ( ! $statement )
+		{
+            throw new SQLException( 'Unable to prepare update'
+				, $this-&gt;nativeError()
+				, $sql
+			);
+        }
+                
+        $success				= oci_execute( $statement, $this-&gt;execMode );
+
+        if ( ! $success )
+		{
+            throw new SQLException( 'Unable to execute update'
+				, $this-&gt;nativeError( $statement )
+				, $sql
+			);
+        }
+
+        $this-&gt;lastStmt			= $statement;
+
+        return oci_num_rows( $statement );
+    }
+
+    /**
+     * Start a database transaction.
+     * @throws SQLException
+     * @return void
+     */
+    protected function beginTrans()
+    {
+        $this-&gt;execMode			= OCI_DEFAULT;
+    }
+        
+    /**
+     * Commit the current transaction.
+     * @throws SQLException
+     * @return void
+     */
+    protected function commitTrans()
+    {
+        $result					= oci_commit( $this-&gt;dblink );
+
+        if ( ! $result )
+		{
+            throw new SQLException( 'Unable to commit transaction'
+				, $this-&gt;nativeError()
+			);
+        }
+
+        $this-&gt;execMode			= OCI_COMMIT_ON_SUCCESS;
+    }
+
+    
+    /**
+     * Roll back ( undo ) the current transaction.
+     * @throws SQLException
+     * @return void
+     */
+    protected function rollbackTrans()
+    {
+        $result					= oci_rollback( $this-&gt;dblink );
+
+        if ( ! $result )
+		{
+            throw new SQLException( 'Unable to rollback transaction'
+				, $this-&gt;nativeError()
+			);
+        }
+
+        $this-&gt;execMode			= OCI_COMMIT_ON_SUCCESS;
+    }
+
+    
+    /**
+     * Gets the number of rows affected by the data manipulation
+     * query.
+     *
+     * @return int Number of rows affected by the last query.
+     * @todo -cOCI8Connection Figure out whether getUpdateCount() should throw exception on error or just return 0.
+     */
+    function getUpdateCount()
+    {
+        if ( ! $this-&gt;lastStmt )
+		{
+            return 0;
+        }
+
+        $result					= oci_num_rows( $this-&gt;lastStmt );
+
+        if ( $result === false )
+		{
+            throw new SQLException( 'Update count failed'
+				, $this-&gt;nativeError( $this-&gt;lastStmt )
+			);
+        }
+
+        return $result;
+    }
+
+
+   /**
+    * Build Oracle-style query with limit or offset.
+    * If the original SQL is in variable: query then the requlting
+    * SQL looks like this:
+    * &lt;pre&gt;
+    * SELECT B.* FROM ( 
+    *          SELECT A.*, rownum as TORQUE$ROWNUM FROM ( 
+    *                  query
+    *           ) A
+    *      ) B WHERE B.TORQUE$ROWNUM &gt; offset AND B.TORQUE$ROWNUM
+    *     &lt;= offset + limit
+    * &lt;/pre&gt;
+    *
+    * @param string &amp;$sql the query
+    * @param int $offset
+    * @param int $limit
+    * @return void ( $sql parameter is currently manipulated directly )
+    */
+   public function applyLimit( &amp;$sql, $offset, $limit )
+   {
+        $sql					=
+			'SELECT B.* FROM (  '
+			.  'SELECT A.*, rownum AS CREOLE$ROWNUM FROM (  '
+			. $sql
+			. '  ) A '
+			.  ' ) B WHERE ';
+
+        if ( $offset &gt; 0 )
+		{
+            $sql				.= ' B.CREOLE$ROWNUM &gt; ' . $offset;            
+
+            if ( $limit &gt; 0 )
+			{
+                $sql			.= ' AND B.CREOLE$ROWNUM &lt;= '
+									. ( $offset + $limit );
+            }
+        }
+
+		else
+		{
+			$sql				.= ' B.CREOLE$ROWNUM &lt;= ' . $limit;
+		}
+   } 
+
+    /**
+     * Get the native Oracle Error Message as a string.
+     *
+     * @param string $msg The Internal Error Message
+     * @param mixed $errno The Oracle Error resource
+     */
+    public function nativeError( $result = null )
+	{
+		if ( $result !== null )
+		{
+			$error				= oci_error( $result );
+		}
+	
+		else
+		{
+			$error				= oci_error( $this-&gt;dblink );
+		}         
+
+		return $error[ 'code' ] . ': ' . $error[ 'message' ];
+	}
+    
+    
+    /**
+     * @see Connection::getDatabaseInfo()
+     */
+    public function getDatabaseInfo()
+    {
+        require_once 'creole/drivers/oracle/metadata/OCI8DatabaseInfo.php';
+
+        return new OCI8DatabaseInfo( $this );
+    }
+    
+    /**
+     * @see Connection::getIdGenerator()
+     */
+    public function getIdGenerator()
+    {
+        require_once 'creole/drivers/oracle/OCI8IdGenerator.php';
+
+        return new OCI8IdGenerator( $this );
+    }
+    
+    /**
+     * Oracle supports native prepared statements, but the oci_parse call
+     * is actually called by the OCI8PreparedStatement class because
+     * some additional SQL processing may be necessary ( e.g. to apply limit ).
+     * @see OCI8PreparedStatement::executeQuery()
+     * @see OCI8PreparedStatement::executeUpdate()
+     * @see Connection::prepareStatement()
+     */
+    public function prepareStatement( $sql ) 
+    {
+        require_once 'creole/drivers/oracle/OCI8PreparedStatement.php';
+
+        return new OCI8PreparedStatement( $this, $sql );
+    }
+    
+    /**
+     * @see Connection::prepareCall()
+     */
+    public function prepareCall( $sql )
+	{
+        throw new SQLException( 'Oracle driver does not yet support stored procedures using CallableStatement.' );
+    }
+    
+    /**
+     * @see Connection::createStatement()
+     */
+    public function createStatement()
+    {
+        require_once 'creole/drivers/oracle/OCI8Statement.php';
+
+        return new OCI8Statement( $this );
+    }
+}

Added: trunk/vendor/creole/drivers/oracle/OCI8IdGenerator.php
===================================================================
--- trunk/vendor/creole/drivers/oracle/OCI8IdGenerator.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/oracle/OCI8IdGenerator.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,65 @@
+&lt;?php
+
+require_once 'creole/IdGenerator.php';
+
+/**
+ * Oracle (OCI8) IdGenerator implimenation.
+ *
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.5 $
+ * @package   creole.drivers.oracle
+ */
+class OCI8IdGenerator implements IdGenerator {
+    
+    /** Connection object that instantiated this class */
+    private $conn;
+
+    /**
+     * Creates a new IdGenerator class, saves passed connection for use
+     * later by getId() method.
+     * @param Connection $conn
+     */
+    public function __construct(Connection $conn)
+    {
+        $this-&gt;conn = $conn;
+    }
+    
+    /**
+     * @see IdGenerator::isBeforeInsert()
+     */
+    public function isBeforeInsert()
+    {
+        return true;
+    }    
+    
+    /**
+     * @see IdGenerator::isAfterInsert()
+     */
+    public function isAfterInsert()
+    {
+        return false;
+    }
+        
+    /**
+     * @see IdGenerator::getIdMethod()
+     */
+    public function getIdMethod()
+    {
+        return self::SEQUENCE;
+    }
+    
+    /**
+     * @see IdGenerator::getId()
+     */
+    public function getId($name = null)
+    {
+        if ($name === null) {
+            throw new SQLException(&quot;You must specify the sequence name when calling getId() method.&quot;);
+        }
+        $rs = $this-&gt;conn-&gt;executeQuery(&quot;select &quot; . $name . &quot;.nextval from dual&quot;, ResultSet::FETCHMODE_NUM);
+        $rs-&gt;next();
+        return $rs-&gt;getInt(1);
+    }
+    
+}
+

Added: trunk/vendor/creole/drivers/oracle/OCI8PreparedStatement.php
===================================================================
--- trunk/vendor/creole/drivers/oracle/OCI8PreparedStatement.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/oracle/OCI8PreparedStatement.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,413 @@
+&lt;?php
+/*
+ *  $Id: OCI8PreparedStatement.php,v 1.23 2005/10/06 20:42:52 sethr Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+ 
+require_once 'creole/PreparedStatement.php';
+require_once 'creole/common/PreparedStatementCommon.php';
+
+/**
+ * Oracle (OCI8) implementation of PreparedStatement.
+ * 
+ * @author    David Giffin &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">david at giffin.org</A>&gt;
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.23 $
+ * @package   creole.drivers.oracle
+ */
+class OCI8PreparedStatement extends PreparedStatementCommon implements PreparedStatement {
+
+    /**
+     * Descriptor holders for LOB values.
+     * There are other types of descriptors, but we need to keep
+     * them separate, because we need to execute the save()/savefile() method
+     * on lob descriptors.
+     * @var array object from oci_new_descriptor
+     */
+    private $lobDescriptors = array();
+    
+    /**
+     * Hold any Blob/Clob data.
+     * These can be matched (by key) to descriptors in $lobDescriptors.
+     * @var array Lob[]
+     */
+    private $lobs = array();        
+
+    /**
+     * Array to store the columns in an insert or update statement.
+     * This is necessary for the proper handling of lob variables
+     * @var arrary columns[]
+     */
+    private $columns = array();
+    
+    /**
+     * If the statement is set, free it.
+     * @see PreparedStatement::close()
+     */
+    function close()
+    {
+         if (isset($this-&gt;stmt))
+              @oci_free_statement($this-&gt;stmt);
+    }
+    
+    /**
+     * ' -&gt; ''
+     * @param string $str
+     * @return string
+     */
+    protected function escape($str)
+    {
+        return str_replace(&quot;'&quot;,&quot;''&quot;, $str);
+    }
+
+    /**
+     * Executes the SQL query in this PreparedStatement object and returns the resultset generated by the query.
+     * @param mixed $p1 Either (array) Parameters that will be set using PreparedStatement::set() before query is executed or (int) fetchmode.
+     * @param int $fetchmode The mode to use when fetching the results (e.g. ResultSet::FETCHMODE_NUM, ResultSet::FETCHMODE_ASSOC).
+     * @return ResultSet
+     * @throws SQLException if a database access error occurs.
+     */
+    public function executeQuery($p1 = null, $fetchmode = null)
+    {
+        $params = null;
+        if ($fetchmode !== null) {
+            $params = $p1;
+        } elseif ($p1 !== null) {
+            if (is_array($p1)) $params = $p1;
+            else $fetchmode = $p1;
+        }
+        
+        if ($params) {
+            for($i=0,$cnt=count($params); $i &lt; $cnt; $i++) {
+                $this-&gt;set($i+1, $params[$i]);
+            }
+        }
+
+        $this-&gt;updateCount = null; // reset        
+                
+        $sql = $this-&gt;sqlToOracleBindVars($this-&gt;sql);
+        
+        if ($this-&gt;limit &gt; 0 || $this-&gt;offset &gt; 0) {
+            $this-&gt;conn-&gt;applyLimit($sql, $this-&gt;offset, $this-&gt;limit);
+        }
+        
+        $result = oci_parse($this-&gt;conn-&gt;getResource(), $sql);
+        if (!$result) {
+            throw new SQLException(&quot;Unable to prepare query&quot;, $this-&gt;conn-&gt;nativeError(), $this-&gt;sqlToOracleBindVars($this-&gt;sql));
+        }
+        
+        // bind all variables
+        $this-&gt;bindVars($result);
+        
+        $success = oci_execute($result, OCI_DEFAULT);
+        if (!$success) {
+            throw new SQLException(&quot;Unable to execute query&quot;, $this-&gt;conn-&gt;nativeError($result), $this-&gt;sqlToOracleBindVars($this-&gt;sql));
+        }
+        
+        $this-&gt;resultSet = new OCI8ResultSet($this-&gt;conn, $result, $fetchmode);
+        
+        return $this-&gt;resultSet;
+    }
+    
+    /**
+     * Executes the SQL INSERT, UPDATE, or DELETE statement in this PreparedStatement object.
+     * 
+     * @param array $params Parameters that will be set using PreparedStatement::set() before query is executed.
+     * @return int Number of affected rows (or 0 for drivers that return nothing).
+     * @throws SQLException if a database access error occurs.
+     */
+    public function executeUpdate($params = null) 
+    {
+        if ($params) {
+            for($i=0,$cnt=count($params); $i &lt; $cnt; $i++) {
+                $this-&gt;set($i+1, $params[$i]);
+            }
+        }
+
+        if($this-&gt;resultSet) $this-&gt;resultSet-&gt;close();
+        $this-&gt;resultSet = null; // reset
+        
+        $stmt = oci_parse($this-&gt;conn-&gt;getResource(), $this-&gt;sqlToOracleBindVars($this-&gt;sql));
+        if (!$stmt) {
+            throw new SQLException(&quot;Unable to prepare update&quot;, $this-&gt;conn-&gt;nativeError(), $this-&gt;sqlToOracleBindVars($this-&gt;sql));
+        }
+        
+        // bind all variables
+        $this-&gt;bindVars($stmt); 
+
+        // Even if autocommit is on, delay commit until after LOBS have been saved
+        $success = oci_execute($stmt, OCI_DEFAULT);
+        if (!$success) {
+            throw new SQLException(&quot;Unable to execute update&quot;, $this-&gt;conn-&gt;nativeError($stmt), $this-&gt;sqlToOracleBindVars($this-&gt;sql));
+        }        
+
+        // save data in any LOB descriptors, then free them
+        foreach($this-&gt;lobDescriptors as $paramIndex =&gt; $lobster) {
+            $lob = $this-&gt;lobs[$paramIndex]; // corresponding Blob/Clob
+            if ($lob-&gt;isFromFile()) {
+                $success = $lobster-&gt;savefile($lob-&gt;getInputFile());
+            } else {
+                $success = $lobster-&gt;save($lob-&gt;getContents());
+            }
+            if (!$success) {                
+                $lobster-&gt;free();
+                throw new SQLException(&quot;Error saving lob bound to &quot; . $paramIndex);
+            }
+            $lobster-&gt;free();
+        }
+
+        if ($this-&gt;conn-&gt;getAutoCommit()) {
+            oci_commit($this-&gt;conn-&gt;getResource()); // perform deferred commit
+        }
+        
+        $this-&gt;updateCount = @oci_num_rows($stmt);
+
+        return $this-&gt;updateCount;
+    }
+
+    /**
+     * Performs the actual binding of variables using oci_bind_by_name().
+     * 
+     * This may seem like useless overhead, but the reason why calls to oci_bind_by_name() 
+     * are not performed in the set*() methods is that it is possible that the SQL will
+     * need to be modified -- e.g. by a setLimit() call -- and re-prepared.  We cannot assume
+     * that the statement has been prepared when the set*() calls are invoked.  This also means,
+     * therefore, that the set*() calls will not throw exceptions; all exceptions will be thrown
+     * when the statement is prepared.
+     * 
+     * @param resource $stmt The statement result of oci_parse to use for binding.
+     * @return void
+     */
+    private function bindVars($stmt)
+    {
+        foreach ($this-&gt;boundInVars as $idx =&gt; $val) {
+            $idxName = &quot;:var&quot; . $idx;
+            if (!oci_bind_by_name($stmt, $idxName, $this-&gt;boundInVars[$idx], -1)) {
+                throw new SQLException(&quot;Erorr binding value to placeholder &quot; . $idx);
+            }            
+        } // foreach
+
+        foreach ($this-&gt;lobs as $idx =&gt; $val) {
+            $idxName = &quot;:var&quot; . $idx;
+            if (class_exists('Blob') &amp;&amp; $val instanceof Blob){
+                if (!oci_bind_by_name($stmt, $idxName, $this-&gt;lobDescriptors[$idx], -1, OCI_B_BLOB))
+                    throw new SQLException(&quot;Erorr binding blob to placeholder &quot; . $idx);
+            } elseif (class_exists('Clob') &amp;&amp; $val instanceof Clob){
+                if (!oci_bind_by_name($stmt, $idxName, $this-&gt;lobDescriptors[$idx], -1, OCI_B_CLOB))
+                    throw new SQLException(&quot;Erorr binding clob to placeholder &quot; . $idx);
+            }
+        } // foreach
+    }
+
+
+    /**
+     * Convert a Propel SQL into Oracle SQL
+     *
+     * Look for all of the '?' and replace with &quot;:varX&quot;
+     *
+     * @param string $sql SQL in Propel native format
+     * @return string SQL in Oracle Bind Var format
+     * @todo -cOCI8PreparedStatement Consider changing this implementation to use the fact that we
+     *                               already know where all the '?' chars are (in $positions array).
+     */
+    private function sqlToOracleBindVars($sql)
+    {
+        $out = &quot;&quot;;
+        $in_literal = 0;
+        $idxNum = 1;
+        for ($i = 0; $i &lt; strlen($sql); $i++) {
+            $char = $sql[$i];
+            if (strcmp($char,&quot;'&quot;)==0) {
+                $in_literal = ~$in_literal;
+            }
+            if (strcmp($char,&quot;?&quot;)==0 &amp;&amp; !$in_literal) {
+                if (array_key_exists($idxNum, $this-&gt;lobs)){
+                    if (class_exists('Blob') &amp;&amp; ($this-&gt;lobs[$idxNum] instanceof Blob))
+                        $out .= &quot;empty_blob()&quot;;
+                    if (class_exists('Clob') &amp;&amp; ($this-&gt;lobs[$idxNum] instanceof Clob))
+                        $out .= &quot;empty_clob()&quot;;
+                } else
+                    $out .= &quot;:var&quot; . $idxNum;
+                $idxNum++;
+            } else {
+                $out .= $char;
+            }
+        }
+
+        if (isset($this-&gt;lobs) &amp;&amp; !empty($this-&gt;lobs)) {
+            $this-&gt;setColumnArray();
+
+            $retstmt = &quot; Returning &quot;;
+            $collist = &quot;&quot;;
+            $bindlist = &quot;&quot;;
+            foreach ($this-&gt;lobs as $idx=&gt;$val) {
+                $idxName = &quot;:var&quot; . $idx;
+                if ((class_exists('Blob') &amp;&amp; $val instanceof Blob) || (class_exists('Clob') &amp;&amp; $val instanceof Clob)) {
+                    //the columns array starts at zero instead of 1 like the lobs array
+                    $collist .= $this-&gt;columns[$idx-1] . &quot;,&quot;;
+                    $bindlist .= $idxName . &quot;,&quot;;
+                }
+            }
+
+            if (!empty($collist))
+                $out .= $retstmt . rtrim($collist, &quot;,&quot;) . &quot; into &quot; . rtrim($bindlist, &quot;,&quot;);
+        }
+
+        return $out;
+    }
+
+    /**
+     * @param string $paramIndex
+     * @param mixed $blob Blob object or string containing data.
+     * @return void
+     */
+    function setBlob($paramIndex, $blob) 
+    {
+        require_once 'creole/util/Blob.php';
+        if (!($blob instanceof Blob)) {
+            $b = new Blob();
+            $b-&gt;setContents($blob);
+            $blob = $b;
+        }
+        $this-&gt;lobDescriptors[$paramIndex] = oci_new_descriptor($this-&gt;conn-&gt;getResource(), OCI_D_LOB);
+        $this-&gt;lobs[$paramIndex] = $blob;        
+    }
+
+    /**
+     * @param string $paramIndex
+     * @param mixed $clob Clob object or string containing data.
+     * @return void
+     */
+    function setClob($paramIndex, $clob) 
+    {
+        require_once 'creole/util/Clob.php';
+        if (!($clob instanceof Clob)) {
+            $c = new Clob();
+            $c-&gt;setContents($clob);
+            $clob = $c;
+        }
+        $this-&gt;lobDescriptors[$paramIndex] = oci_new_descriptor($this-&gt;conn-&gt;getResource(), OCI_D_LOB);
+        $this-&gt;lobs[$paramIndex] = $clob;        
+    }
+
+    /**
+     * Since bind variables in oracle have no special characters, this setString method differs from the
+     * common one in that it does not single quote strings.
+     *
+     * @param int $paramIndex
+     * @param string $value
+     * @return void
+     */
+    function setString($paramIndex, $value)
+    {
+        if ($value === null) {
+            $this-&gt;setNull($paramIndex);
+        } else {
+            // it's ok to have a fatal error here, IMO, if object doesn't have
+            // __toString() and is being passed to this method.
+            if ( is_object ( $value ) ) {
+                $this-&gt;boundInVars[$paramIndex] = $this-&gt;escape($value-&gt;__toString());
+            } else {
+                $this-&gt;boundInVars[$paramIndex] = $this-&gt;escape((string)$value);
+            }
+        }
+    }
+
+    /**
+     * Copied this function from common/PreparedStatement.php and modified to work with Oracle
+     * Please note the format used with date() matches that of NLS_DATE_FORMAT set in
+     * OCI8Connection.php
+     *
+     * @param int $paramIndex
+     * @param string $value
+     * @return void
+     */
+    function setTimestamp($paramIndex, $value)
+    {
+        if ($value === null) {
+            $this-&gt;setNull($paramIndex);
+        } else {
+            if (is_numeric($value)) $value = date('Y-m-d H:i:s', $value);
+            elseif (is_object($value)) $value = date('Y-m-d H:i:s', $value-&gt;getTime());
+            $this-&gt;boundInVars[$paramIndex] = $this-&gt;escape($value);
+        }
+    }
+
+    /**
+     * Please note the format used with date() matches that of NLS_DATE_FORMAT set in
+     * OCI8Connection.php
+     *
+     * @param int $paramIndex
+     * @param string $value
+     * @return void
+     */
+    function setDate($paramIndex, $value)
+    {
+        if ($value === null) {
+            $this-&gt;setNull($paramIndex);
+        } else {
+            if (is_numeric($value)) $value = date(&quot;Y-m-d&quot;, $value);
+            elseif (is_object($value)) $value = date(&quot;Y-m-d&quot;, $value-&gt;getTime());
+            $this-&gt;boundInVars[$paramIndex] = $this-&gt;escape($value);
+        }
+    }
+
+    /**
+     * In order to send lob data (clob/blob) to the Oracle data base, the 
+     * sqlToOracleBindVars function needs to have an ordered list of the
+     * columns being addressed in the sql statement.
+     * Since only insert and update statements require special handling,
+     * there are two ways to find the columns:
+     *  1) find the first set of () and parse out the columns names based on
+     *     the token ','
+     *  2) find all the text strings to the left of the equal signs.
+     *
+     * @param void
+     * @return void
+     */
+    private function setColumnArray()
+    {
+        $this-&gt;columns = array();
+
+        //handle the simple insert case first
+        if(strtoupper(substr($this-&gt;sql, 0, 6)) == 'INSERT') {
+            $firstPos = strpos($this-&gt;sql, '(');
+            $secPos = strpos($this-&gt;sql, ')');
+            $collist = substr($this-&gt;sql, $firstPos + 1, $secPos - $firstPos - 1);
+            $this-&gt;columns = explode(',', $collist);
+        }
+        if (strtoupper(substr($this-&gt;sql, 0, 6)) == 'UPDATE') {
+            //handle more complex update case
+            //first get the string setup so we can explode based on '=?'
+            //second split results from previous action based on ' '
+            // the last token from this should be a column name
+            $tmp = $this-&gt;sql;
+            $tmp = str_replace(&quot; =&quot;, &quot;=&quot;, $this-&gt;sql);
+            $tmp = str_replace(&quot;= &quot;, &quot;=&quot;, $tmp);
+            $tmp = str_replace(&quot;,&quot;, &quot; &quot;, $tmp);
+            $stage1 = explode(&quot;=?&quot;,$tmp);
+            
+            foreach($stage1 as $chunk) {
+                $stage2 = explode(' ', $chunk);
+                $this-&gt;columns[count($this-&gt;columns)] = $stage2[count($stage2) - 1];
+            }
+        }
+   }
+
+}
+

Added: trunk/vendor/creole/drivers/oracle/OCI8ResultSet.php
===================================================================
--- trunk/vendor/creole/drivers/oracle/OCI8ResultSet.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/oracle/OCI8ResultSet.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,133 @@
+&lt;?php
+/*
+ *  $Id: OCI8ResultSet.php,v 1.12 2004/11/02 23:31:49 comprock Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+ 
+require_once 'creole/ResultSet.php';
+require_once 'creole/common/ResultSetCommon.php';
+
+/**
+ * Oracle (OCI8) implementation of ResultSet class.
+ *
+ * @author    David Giffin &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">david at giffin.org</A>&gt;
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.12 $
+ * @package   creole.drivers.oracle
+ */
+class OCI8ResultSet extends ResultSetCommon implements ResultSet
+{
+    /**
+     * @see ResultSet::seek()
+     */ 
+    function seek($rownum)
+    {
+        if ( $rownum &lt; $this-&gt;cursorPos )
+		{
+            // this will effectively disable previous(), first() and some calls to relative() or absolute()
+            throw new SQLException( 'Oracle ResultSet is FORWARD-ONLY' );
+        }
+        
+        // Oracle has no seek function imulate it here
+        while ( $this-&gt;cursorPos &lt; $rownum )
+		{
+            $this-&gt;next();
+        }
+
+        $this-&gt;cursorPos		= $rownum;
+
+        return true;
+    }
+    
+    /**
+     * @see ResultSet::next()
+     */ 
+    function next()
+    {   
+		// no specific result position available
+
+		// Returns an array, which corresponds to the next result row or FALSE
+		// in case of error or there is no more rows in the result.
+        $this-&gt;fields			= oci_fetch_array( $this-&gt;result
+									, $this-&gt;fetchmode
+										+ OCI_RETURN_NULLS
+										+ OCI_RETURN_LOBS
+								);
+
+		if ( ! $this-&gt;fields )
+		{
+			// grab error via array
+			$error				= oci_error( $this-&gt;result );
+
+			if ( ! $error )
+			{
+				// end of recordset
+				$this-&gt;afterLast();
+
+				return false;
+			}
+
+			else
+			{
+				throw new SQLException( 'Error fetching result'
+					, $error[ 'code' ] . ': ' . $error[ 'message' ]
+				);
+			}
+		}
+
+		// Oracle returns all field names in uppercase and associative indices
+		// in the result array will be uppercased too.
+        if ( ! $this-&gt;ignoreAssocCase )
+		{
+			$this-&gt;fields		= array_change_key_case( $this-&gt;fields
+									, CASE_LOWER
+								);
+        }
+        
+        // Advance cursor position
+        $this-&gt;cursorPos++;
+
+        return true;
+    }
+
+    /**
+     * @see ResultSet::getRecordCount()
+     */
+    function getRecordCount()
+    {
+        $rows					= oci_num_rows( $this-&gt;result );
+
+        if ( $rows === false )
+		{
+            throw new SQLException( 'Error fetching num rows'
+				, $this-&gt;conn-&gt;nativeError( $this-&gt;result )
+			);
+        }
+
+        return ( int ) $rows;
+    }
+
+    /**
+     * @see ResultSet::close()
+     */ 
+    function close()
+    {
+		$this-&gt;fields			= array();
+        @oci_free_statement( $this-&gt;result );
+    }
+}

Added: trunk/vendor/creole/drivers/oracle/OCI8Statement.php
===================================================================
--- trunk/vendor/creole/drivers/oracle/OCI8Statement.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/oracle/OCI8Statement.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,34 @@
+&lt;?php
+/*
+ *  $Id: OCI8Statement.php,v 1.2 2004/03/05 15:46:12 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+ 
+require_once 'creole/Statement.php';
+require_once 'creole/common/StatementCommon.php';
+
+/**
+ * Oracle (OCI8) Statement implementation.
+ * 
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.2 $
+ * @package   creole.drivers.oracle
+ */ 
+class OCI8Statement extends StatementCommon implements Statement {
+    
+}

Added: trunk/vendor/creole/drivers/oracle/OCI8Types.php
===================================================================
--- trunk/vendor/creole/drivers/oracle/OCI8Types.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/oracle/OCI8Types.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,88 @@
+&lt;?php
+
+/*
+ *  $Id: OCI8Types.php,v 1.8 2004/03/20 04:16:50 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+ 
+require_once 'creole/CreoleTypes.php';
+
+/**
+ * Oracle types / type map.
+ *
+ * @author    David Giffin &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">david at giffin.org</A>&gt;
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.8 $
+ * @package   creole.drivers.oracle
+ */
+class OCI8Types extends CreoleTypes {
+
+    /** Map Oracle native types to Creole (JDBC) types. */
+    private static $typeMap = array(
+                                'char' =&gt; CreoleTypes::CHAR,
+                                'varchar2' =&gt; CreoleTypes::VARCHAR,
+                                'long' =&gt; CreoleTypes::LONGVARCHAR,
+                                'number' =&gt; CreoleTypes::NUMERIC,
+                                'float' =&gt; CreoleTypes::FLOAT,
+                                'integer' =&gt; CreoleTypes::INTEGER,
+                                'smallint' =&gt; CreoleTypes::SMALLINT,
+                                'double' =&gt; CreoleTypes::DOUBLE,
+                                'raw' =&gt; CreoleTypes::VARBINARY,
+                                'longraw' =&gt; CreoleTypes::LONGVARBINARY,
+                                'date' =&gt; CreoleTypes::TIMESTAMP,
+                                'blob' =&gt; CreoleTypes::BLOB,
+                                'clob' =&gt; CreoleTypes::CLOB,
+                                'varray' =&gt; CreoleTypes::ARR,
+                                );
+    
+    /** Reverse mapping, created on demand. */
+    private static $reverseMap = null;
+    
+    /**
+     * This method returns the generic Creole (JDBC-like) type
+     * when given the native db type.
+     * @param string $nativeType DB native type (e.g. 'TEXT', 'byetea', etc.).
+     * @return int Creole native type (e.g. CreoleTypes::LONGVARCHAR, CreoleTypes::BINARY, etc.).
+     */
+    public static function getType($nativeType)
+    {
+        $t = strtolower($nativeType);
+        if (isset(self::$typeMap[$t])) {
+            return self::$typeMap[$t];
+        } else {
+            return CreoleTypes::OTHER;
+        }
+    }
+            
+    /**
+     * This method will return a native type that corresponds to the specified
+     * Creole (JDBC-like) type.
+     * If there is more than one matching native type, then the LAST defined 
+     * native type will be returned.
+     * @param int $creoleType
+     * @return string Native type string.
+     */
+    public static function getNativeType($creoleType)
+    {
+        if (self::$reverseMap === null) {
+            self::$reverseMap = array_flip(self::$typeMap);
+        }
+        return @self::$reverseMap[$creoleType];
+    }
+                                
+}

Added: trunk/vendor/creole/drivers/oracle/metadata/OCI8DatabaseInfo.php
===================================================================
--- trunk/vendor/creole/drivers/oracle/metadata/OCI8DatabaseInfo.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/oracle/metadata/OCI8DatabaseInfo.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,90 @@
+&lt;?php
+/*
+ *  $Id: OCI8DatabaseInfo.php,v 1.10 2004/11/02 23:31:50 comprock Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+ 
+require_once 'creole/metadata/DatabaseInfo.php';
+
+/**
+ * Oracle (OCI8) implementation of DatabaseInfo.
+ * 
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.10 $
+ * @package   creole.drivers.oracle.metadata
+ */ 
+class OCI8DatabaseInfo extends DatabaseInfo {
+    
+    private $schema;
+           
+    public function __construct(Connection $conn) {
+        parent::__construct($conn);
+        
+        $dsn = $conn-&gt;getDSN();
+        
+        // For Changing DB/Schema in Meta Data Interface
+        $this-&gt;schema = $dsn['database'];
+        // For Oracle Type DBs
+        if (!$this-&gt;schema) {
+            $this-&gt;schema = $dsn['username'];
+        }
+            
+		$this-&gt;schema = strtoupper( $this-&gt;schema );
+    }
+    
+    public function getSchema() {
+        return $this-&gt;schema;
+    }
+    
+    /**
+     * @throws SQLException
+     * @return void
+     */
+    protected function initTables()
+    {
+        include_once 'creole/drivers/oracle/metadata/OCI8TableInfo.php';
+        
+        $sql = &quot;SELECT table_name
+            FROM all_tables
+            WHERE owner = '{$this-&gt;schema}'&quot;;
+
+        $statement = @oci_parse($this-&gt;dblink,$sql);
+
+        $success = @oci_execute($statement,OCI_DEFAULT);        
+        if (!$success) {
+            throw new SQLException(&quot;Could not get tables&quot;, $this-&gt;dblink-&gt;nativeError($statement));
+        }
+        while ( $statement &amp;&amp; $row = oci_fetch_assoc( $statement ) )
+		{
+            $row = array_change_key_case($row,CASE_LOWER);
+            $this-&gt;tables[strtoupper($row['table_name'])] = new OCI8TableInfo($this,$row['table_name']);
+        }
+    }            
+    
+    /**
+     * Oracle supports sequences.
+     *
+     * @return void 
+     * @throws SQLException
+     */
+    protected function initSequences()
+    {
+        // throw new SQLException(&quot;MySQL does not support sequences natively.&quot;);
+    }
+        
+}

Added: trunk/vendor/creole/drivers/oracle/metadata/OCI8TableInfo.php
===================================================================
--- trunk/vendor/creole/drivers/oracle/metadata/OCI8TableInfo.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/oracle/metadata/OCI8TableInfo.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,266 @@
+&lt;?php
+/*
+ *  $Id: OCI8TableInfo.php,v 1.12 2004/11/03 21:49:56 comprock Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+ 
+require_once 'creole/metadata/TableInfo.php';
+
+/**
+ * Oracle (OCI8) implementation of TableInfo.
+ * 
+ * @author    David Giffin &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">david at giffin.org</A>&gt;
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.12 $
+ * @package   creole.drivers.oracle.metadata
+ */
+class OCI8TableInfo extends TableInfo {
+    
+    private $schema;
+        
+    public function __construct(OCI8DatabaseInfo $database, $name)
+    {
+        $this-&gt;schema = strtoupper( $database-&gt;getSchema() );
+        parent::__construct($database, $name);
+		$this-&gt;name = strtoupper( $this-&gt;name );
+    }
+    
+    /** Loads the columns for this table. */
+    protected function initColumns() 
+    {
+        
+        include_once 'creole/metadata/ColumnInfo.php';
+        include_once 'creole/drivers/oracle/OCI8Types.php';
+        
+
+        // To get all of the attributes we need, we'll actually do 
+        // two separate queries.  The first gets names and default values
+        // the second will fill in some more details.
+        
+        $sql = &quot;
+			SELECT column_name
+				, data_type
+				, data_precision
+				, data_length
+				, data_default
+				, nullable 
+				, data_scale
+            FROM  all_tab_columns
+            WHERE table_name = '{$this-&gt;name}'
+                AND OWNER = '{$this-&gt;schema}'&quot;;
+
+        $statement = @oci_parse($this-&gt;dblink,$sql);
+        $success = @oci_execute($statement,OCI_DEFAULT);
+		if (!$success) {
+            throw new SQLException(&quot;Could Not Get Columns&quot;);
+        }
+
+        while ( $statement &amp;&amp; $row = oci_fetch_array( $statement
+			, OCI_ASSOC + OCI_RETURN_NULLS ) ) {
+            $row = array_change_key_case($row, CASE_LOWER);
+            $this-&gt;columns[$row['column_name']] = new ColumnInfo( $this
+				, $row['column_name']
+				, OCI8Types::getType($row['data_type'])
+				, $row['data_type']
+				, $row['data_length']
+				, $row['data_scale']
+				, $row['nullable']
+				, $row['data_default']
+			);
+        }
+                
+        $this-&gt;colsLoaded = true;
+    }
+    
+    /** Loads the primary key information for this table. */
+    protected function initPrimaryKey()
+    {
+        include_once 'creole/metadata/PrimaryKeyInfo.php';
+        
+        // columns have to be loaded first
+        if (!$this-&gt;colsLoaded) $this-&gt;initColumns();
+        
+
+        // Primary Keys Query
+        $sql = &quot;SELECT a.owner, a.table_name,
+                            a.constraint_name, a.column_name
+                        FROM all_cons_columns a, all_constraints b
+                        WHERE b.constraint_type = 'P'
+                        AND a.constraint_name = b.constraint_name
+                        AND b.table_name = '{$this-&gt;name}'
+            AND b.owner = '{$this-&gt;schema}'
+            &quot;;
+
+
+        $statement = @oci_parse($this-&gt;dblink,$sql);
+        $success = @oci_execute($statement,OCI_DEFAULT);
+        if (!$success) {
+            throw new SQLException(&quot;Could Not Get Primary Keys&quot;);
+        }
+
+        while ( $statement &amp;&amp; $row = oci_fetch_assoc( $statement )) {
+            $row = array_change_key_case($row,CASE_LOWER);
+
+            $name = $row['column_name'];
+
+            if (!isset($this-&gt;primaryKey)) {
+                $this-&gt;primaryKey = new PrimaryKeyInfo($name);
+            }
+
+            $this-&gt;primaryKey-&gt;addColumn($this-&gt;columns[$name]);
+        }
+        
+        $this-&gt;pkLoaded = true;
+    }
+    
+    /** Loads the indexes for this table. */
+    protected function initIndexes() {
+    
+        include_once 'creole/metadata/IndexInfo.php';    
+
+        // columns have to be loaded first
+        if (!$this-&gt;colsLoaded) $this-&gt;initColumns();        
+
+        // Indexes
+        $sql = &quot;SELECT
+            index_name,
+            table_name,
+            index_type,
+            uniqueness
+            FROM all_indexes
+            WHERE table_owner = '{$this-&gt;schema}'
+            AND table_name = '{$this-&gt;name}'
+            AND index_name NOT IN (SELECT
+                    constraint_name
+                    FROM all_constraints
+                    WHERE constraint_type = 'P')&quot;;
+
+        $statement = @oci_parse($this-&gt;dblink,$sql);
+        $success = @oci_execute($statement,OCI_DEFAULT);
+        if (!$success) {
+            throw new SQLException(&quot;Could Not Get Primary Keys&quot;);
+        }
+
+
+        // Loop through the returned results, grouping the same key_name together
+        // adding each column for that key.
+
+        while ( $statement &amp;&amp; $row = oci_fetch_assoc( $statement )) {
+            $row = array_change_key_case($row,CASE_LOWER);
+
+            $name = $row['index_name'];            
+
+            if (!isset($this-&gt;indexes[$name])) {
+                $this-&gt;indexes[$name] = new IndexInfo($name);
+            }
+
+            $this-&gt;indexes[$name]-&gt;addColumn($this-&gt;columns[ $name ]);
+        }
+        
+                
+        $this-&gt;indexesLoaded = true;
+    }
+    
+    /** Load foreign keys */
+    protected function initForeignKeys() {
+        
+        include_once 'creole/metadata/ForeignKeyInfo.php';    
+
+        // columns have to be loaded first
+        if (!$this-&gt;colsLoaded) $this-&gt;initColumns();        
+        
+        // Foreign keys
+		// TODO resolve cross schema references
+		// use all_cons... to do so, however, very slow queries then
+		// optimizations are very ugly
+        $sql					= &quot;
+			SELECT a.owner AS local_owner
+				, a.table_name AS local_table
+				, c.column_name AS local_column
+				, a.constraint_name AS foreign_key_name
+				, b.owner AS foreign_owner
+				, b.table_name AS foreign_table
+				, d.column_name AS foreign_column
+				, b.constraint_name AS foreign_constraint_name
+				, a.delete_rule AS on_delete
+            FROM user_constraints a
+				, user_constraints b
+				, user_cons_columns c
+				, user_cons_columns d
+            WHERE a.r_constraint_name = b.constraint_name
+                AND c.constraint_name = a.constraint_name
+                AND d.constraint_name = b.constraint_name
+                AND a.r_owner = b.owner
+                AND a.constraint_type='R'
+				AND a.table_name = '{$this-&gt;name}'
+				AND a.owner = '{$this-&gt;schema}'
+		&quot;;
+
+        $statement = @oci_parse($this-&gt;dblink,$sql);
+        $success = @oci_execute($statement,OCI_DEFAULT);
+        if (!$success) {
+            throw new SQLException(&quot;Could Not Get Primary Keys&quot;);
+        }
+
+        // Loop through the returned results, grouping the same key_name
+		// together adding each column for that key.
+
+        while ( $statement &amp;&amp; $row = oci_fetch_assoc( $statement )) {
+            $row = array_change_key_case($row,CASE_LOWER);
+
+            $name = $row['foreign_key_name'];            
+
+            $foreignTable = $this-&gt;database-&gt;getTable($row['foreign_table']);
+            $foreignColumn = $foreignTable-&gt;getColumn($row['foreign_column']);
+
+            $localTable   = $this-&gt;database-&gt;getTable($row['local_table']);    
+            $localColumn   = $localTable-&gt;getColumn($row['local_column']);
+
+            if (!isset($this-&gt;foreignKeys[$name])) {
+                $this-&gt;foreignKeys[$name] = new ForeignKeyInfo($name);
+            }
+
+			switch ( $row[ 'on_delete' ] )
+			{
+				case 'CASCADE':
+					$onDelete	= ForeignKeyInfo::CASCADE;
+					break;
+
+				case 'SET NULL':
+					$onDelete	= ForeignKeyInfo::SETNULL;
+					break;
+
+				default:
+				case 'NO ACTION':
+					$onDelete	= ForeignKeyInfo::NONE;
+					break;
+			}
+
+			// addReference( local, foreign, onDelete, onUpdate )
+			// Oracle doesn't support 'on update'
+            $this-&gt;foreignKeys[ $name ]-&gt;addReference(
+				$localColumn
+				, $foreignColumn
+				, $onDelete
+			);
+        }
+        
+        $this-&gt;fksLoaded = true;
+    }
+    
+}

Added: trunk/vendor/creole/drivers/pgsql/PgSQLConnection.php
===================================================================
--- trunk/vendor/creole/drivers/pgsql/PgSQLConnection.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/pgsql/PgSQLConnection.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,260 @@
+&lt;?php
+/*
+ *  $Id: PgSQLConnection.php,v 1.21 2005/08/03 17:56:22 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+ 
+require_once 'creole/Connection.php';
+require_once 'creole/common/ConnectionCommon.php';
+include_once 'creole/drivers/pgsql/PgSQLResultSet.php';
+
+/**
+ * PgSQL implementation of Connection.
+ * 
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt; (Creole)
+ * @author    Stig Bakken &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">ssb at fast.no</A>&gt; (PEAR::DB)
+ * @author    Lukas Smith (PEAR::MDB)
+ * @version   $Revision: 1.21 $
+ * @package   creole.drivers.pgsql
+ */ 
+class PgSQLConnection extends ConnectionCommon implements Connection {        
+                
+    /** 
+     * Affected Rows of last executed query.
+     * Postgres needs this for getUpdateCount()
+     * We used to store the entire result set
+     * instead but that can be a large dataset.
+     * @var int
+     */
+    private $result_affected_rows;
+    
+    /**
+     * Connect to a database and log in as the specified user.
+     *
+     * @param array $dsn The datasource hash.
+     * @param $flags Any connection flags.
+     * @access public
+     * @throws SQLException
+     * @return void
+     */
+    function connect($dsninfo, $flags = 0)
+    {    
+        global $php_errormsg;
+                
+        if (!extension_loaded('pgsql')) {
+            throw new SQLException('pgsql extension not loaded');
+        }
+
+        $this-&gt;dsn = $dsninfo;
+        $this-&gt;flags = $flags;
+        
+        $persistent = ($flags &amp; Creole::PERSISTENT === Creole::PERSISTENT);
+                
+        $protocol = (isset($dsninfo['protocol'])) ? $dsninfo['protocol'] : 'tcp';
+        $connstr = '';
+
+        if ($protocol == 'tcp') {
+            if (!empty($dsninfo['hostspec'])) {
+                $connstr = 'host=' . $dsninfo['hostspec'];
+            }
+            if (!empty($dsninfo['port'])) {
+                $connstr .= ' port=' . $dsninfo['port'];
+            }
+        }
+
+        if (isset($dsninfo['database'])) {
+            $connstr .= ' dbname=\'' . addslashes($dsninfo['database']) . '\'';
+        }
+        if (!empty($dsninfo['username'])) {
+            $connstr .= ' user=\'' . addslashes($dsninfo['username']) . '\'';
+        }
+        if (!empty($dsninfo['password'])) {
+            $connstr .= ' password=\'' . addslashes($dsninfo['password']) . '\'';
+        }
+        if (!empty($dsninfo['options'])) {
+            $connstr .= ' options=' . $dsninfo['options'];
+        }
+        if (!empty($dsninfo['tty'])) {
+            $connstr .= ' tty=' . $dsninfo['tty'];
+        }
+        
+        if ($persistent) {
+            $conn = @pg_pconnect($connstr);
+        } else {
+            $conn = @pg_connect($connstr);
+        }
+        
+        if (!$conn) {
+			// hide the password from connstr
+			$cleanconnstr = preg_replace('/password=\'.*?\'($|\s)/', 'password=\'*********\'', $connstr);
+            throw new SQLException('Could not connect', $php_errormsg, $cleanconnstr);
+        }
+        
+        $this-&gt;dblink = $conn;        
+    }
+    
+    /**
+     * @see Connection::applyLimit()
+     */
+    public function applyLimit(&amp;$sql, $offset, $limit)
+    {
+        if ( $limit &gt; 0 ) {
+            $sql .= &quot; LIMIT &quot;.$limit;
+        }
+        if ( $offset &gt; 0 ) {
+            $sql .= &quot; OFFSET &quot;.$offset;
+        }
+    }
+    
+    /**
+     * @see Connection::disconnect()
+     */
+    function close()
+    {
+        $ret = @pg_close($this-&gt;dblink);
+	$this-&gt;result_affected_rows = null;
+        $this-&gt;dblink = null;
+        return $ret;
+    }
+    
+    /**
+     * @see Connection::simpleQuery()
+     */
+    function executeQuery($sql, $fetchmode = null)
+    {
+        $result = @pg_query($this-&gt;dblink, $sql);
+        if (!$result) {
+            throw new SQLException('Could not execute query', pg_last_error($this-&gt;dblink), $sql);
+        }
+	$this-&gt;result_affected_rows = @pg_affected_rows($result);
+
+        return new PgSQLResultSet($this, $result, $fetchmode);
+    }        
+
+    /**
+     * @see Connection::simpleUpdate()
+     */
+    function executeUpdate($sql)
+    {            
+        $result = @pg_query($this-&gt;dblink, $sql);
+        if (!$result) {
+            throw new SQLException('Could not execute update', pg_last_error($this-&gt;dblink), $sql);
+        }
+	$this-&gt;result_affected_rows = (int) @pg_affected_rows($result);
+
+	return $this-&gt;result_affected_rows;
+    }
+
+    /**
+     * Start a database transaction.
+     * @throws SQLException
+     * @return void
+     */
+    protected function beginTrans()
+    {
+        $result = @pg_query($this-&gt;dblink, &quot;begin&quot;);
+        if (!$result) {
+            throw new SQLException('Could not begin transaction', pg_last_error($this-&gt;dblink));
+        }
+    }
+        
+    /**
+     * Commit the current transaction.
+     * @throws SQLException
+     * @return void
+     */
+    protected function commitTrans()
+    {
+        $result = @pg_query($this-&gt;dblink, &quot;end&quot;);
+        if (!$result) {
+            throw new SQLException('Could not commit transaction', pg_last_error($this-&gt;dblink));
+        }
+    }
+
+    /**
+     * Roll back (undo) the current transaction.
+     * @throws SQLException
+     * @return void
+     */
+    protected function rollbackTrans()
+    {
+        $result = @pg_query($this-&gt;dblink, &quot;abort&quot;);
+        if (!$result) {
+            throw new SQLException('Could not rollback transaction', pg_last_error($this-&gt;dblink));
+        }
+    }
+
+    /**
+     * Gets the number of rows affected by the data manipulation
+     * query.
+     * @see Statement::getUpdateCount()
+     * @return int Number of rows affected by the last query.
+     */
+    function getUpdateCount()
+    {
+	if ( $this-&gt;result_affected_rows === null ) {
+		throw new SQLException('getUpdateCount called before any sql queries were executed');
+	}
+	return $this-&gt;result_affected_rows;
+    }    
+
+    
+    /**
+     * @see Connection::getDatabaseInfo()
+     */
+    public function getDatabaseInfo()
+    {
+        require_once 'creole/drivers/pgsql/metadata/PgSQLDatabaseInfo.php';
+        return new PgSQLDatabaseInfo($this);
+    }
+    
+    /**
+     * @see Connection::getIdGenerator()
+     */
+    public function getIdGenerator()
+    {
+        require_once 'creole/drivers/pgsql/PgSQLIdGenerator.php';
+        return new PgSQLIdGenerator($this);
+    }
+    
+    /**
+     * @see Connection::prepareStatement()
+     */
+    public function prepareStatement($sql) 
+    {
+        require_once 'creole/drivers/pgsql/PgSQLPreparedStatement.php';
+        return new PgSQLPreparedStatement($this, $sql);
+    }
+    
+    /**
+     * @see Connection::prepareCall()
+     */
+    public function prepareCall($sql) {
+        throw new SQLException('PostgreSQL does not support stored procedures.');
+    }
+    
+    /**
+     * @see Connection::createStatement()
+     */
+    public function createStatement()
+    {
+        require_once 'creole/drivers/pgsql/PgSQLStatement.php';
+        return new PgSQLStatement($this);
+    }
+    
+}

Added: trunk/vendor/creole/drivers/pgsql/PgSQLIdGenerator.php
===================================================================
--- trunk/vendor/creole/drivers/pgsql/PgSQLIdGenerator.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/pgsql/PgSQLIdGenerator.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,84 @@
+&lt;?php
+/*
+ *  $Id: PgSQLIdGenerator.php,v 1.5 2004/03/19 14:19:50 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+ 
+require_once 'creole/IdGenerator.php';
+
+/**
+ * PostgreSQL IdGenerator implemenation.
+ *
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.5 $
+ * @package   creole.drivers.pgsql
+ */
+class PgSQLIdGenerator implements IdGenerator {
+    
+    /** Connection object that instantiated this class */
+    private $conn;
+
+    /**
+     * Creates a new IdGenerator class, saves passed connection for use
+     * later by getId() method.
+     * @param Connection $conn
+     */
+    public function __construct(Connection $conn)
+    {
+        $this-&gt;conn = $conn;
+    }
+    
+    /**
+     * @see IdGenerator::isBeforeInsert()
+     */
+    public function isBeforeInsert()
+    {
+        return true;
+    }    
+    
+    /**
+     * @see IdGenerator::isAfterInsert()
+     */
+    public function isAfterInsert()
+    {
+        return false;
+    }
+        
+    /**
+     * @see IdGenerator::getIdMethod()
+     */
+    public function getIdMethod()
+    {
+        return self::SEQUENCE;
+    }
+    
+    /**
+     * @see IdGenerator::getId()
+     */
+    public function getId($name = null)
+    {
+        if ($name === null) {
+            throw new SQLException(&quot;You must specify the sequence name when calling getId() method.&quot;);
+        }
+        $rs = $this-&gt;conn-&gt;executeQuery(&quot;select nextval('&quot; . $name . &quot;')&quot;, ResultSet::FETCHMODE_NUM);
+        $rs-&gt;next();
+        return $rs-&gt;getInt(1);
+    }
+    
+}
+

Added: trunk/vendor/creole/drivers/pgsql/PgSQLPreparedStatement.php
===================================================================
--- trunk/vendor/creole/drivers/pgsql/PgSQLPreparedStatement.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/pgsql/PgSQLPreparedStatement.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,157 @@
+&lt;?php
+/*
+ *  $Id: PgSQLPreparedStatement.php,v 1.14 2005/04/16 18:55:28 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+ 
+require_once 'creole/PreparedStatement.php';
+require_once 'creole/common/PreparedStatementCommon.php';
+
+/**
+ * PgSQL subclass for prepared statements.
+ * 
+ * @author Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version $Revision: 1.14 $
+ * @package creole.drivers.pgsql
+ */
+class PgSQLPreparedStatement extends PreparedStatementCommon implements PreparedStatement {
+    
+    /**
+     * Quotes string using native pgsql function (pg_escape_string).
+     * @param string $str
+     * @return string
+     */
+    protected function escape($str)
+    {
+        return pg_escape_string($str);
+    }
+    
+    /**
+     * Recursive function to turn multi-dim array into str representation.
+     * @param array $arr
+     * @return string Array in pgsql-friendly string notation: {val1, val2} or {{sub1,sub2}, {sub3, sub4}}
+     */
+    private function arrayToStr($arr)
+    {
+        $parts = array();
+        foreach((array)$arr as $el) {
+            if (is_array($el)) {
+                $parts[] = $this-&gt;arrayToStr($el);
+            } else {
+                if (is_string($el)) {
+                    $parts[] = '&quot;' . pg_escape_string($el) . '&quot;';
+                } else {
+                    $parts[] = $el;
+                }                
+            }
+        }        
+        return '{' . implode(',', $parts) . '}';
+    }
+    
+    /**
+     * Sets an array.
+     * Unless a driver-specific method is used, this means simply serializing
+     * the passed parameter and storing it as a string.
+     * @param int $paramIndex
+     * @param array $value
+     * @return void
+     * @see PreparedStatement::setArray()
+     */
+    function setArray($paramIndex, $value) 
+    {
+        if( $paramIndex &gt; $this-&gt;positionsCount || $paramIndex &lt; 1) {
+            throw new SQLException('Cannot bind to invalid param index: '.$paramIndex);
+        }
+        if ($value === null)
+            $this-&gt;setNull($paramIndex);
+        else
+            $this-&gt;boundInVars[$paramIndex] = &quot;'&quot; . $this-&gt;arrayToStr($value) . &quot;'&quot;;        
+    }
+
+    /**
+     * For setting value of Postgres BOOLEAN column.
+     * @param int $paramIndex
+     * @param boolean $value
+     * @return void
+     */
+    function setBoolean($paramIndex, $value) 
+    {
+        if( $paramIndex &gt; $this-&gt;positionsCount || $paramIndex &lt; 1) {
+            throw new SQLException('Cannot bind to invalid param index: '.$paramIndex);
+        }        
+        if ($value === null)
+            $this-&gt;setNull($paramIndex);
+        else
+            $this-&gt;boundInVars[$paramIndex] = ($value ? &quot;'t'&quot; : &quot;'f'&quot;);
+    }
+
+    /**
+     * Applies sqlite_udf_encode_binary() to ensure that binary contents will be handled correctly by sqlite.
+     * @param int $paramIndex
+     * @param mixed $blob Blob object or string containing data.
+     * @return void
+     */
+    function setBlob($paramIndex, $blob) 
+    {    
+        if ($blob === null) {
+            $this-&gt;setNull($paramIndex);
+        } else {
+            // they took magic __toString() out of PHP5.0.0; this sucks
+            if (is_object($blob)) {
+                $blob = $blob-&gt;__toString();
+            }            
+            $this-&gt;boundInVars[$paramIndex] = &quot;'&quot; . pg_escape_bytea( $blob ) . &quot;'&quot;;
+        }    
+        
+    }
+	
+	/**
+     * @param int $paramIndex
+     * @param string $value
+     * @return void
+     */
+    function setTime($paramIndex, $value) 
+    {        
+        if ($value === null) {
+            $this-&gt;setNull($paramIndex);
+        } else {
+            if ( is_numeric ( $value ) ) {
+	    	$value = date ( &quot;H:i:s O&quot;, $value );
+	    } elseif ( is_object ( $value ) ) {
+	    	$value = date ( &quot;H:i:s O&quot;, $value-&gt;getTime ( ) );
+	    }
+            $this-&gt;boundInVars [ $paramIndex ] = &quot;'&quot; . $this-&gt;escape ( $value ) . &quot;'&quot;;
+        }
+    }
+    
+    /**
+     * @param int $paramIndex
+     * @param string $value
+     * @return void
+     */
+    function setTimestamp($paramIndex, $value) 
+    {        
+        if ($value === null) {
+            $this-&gt;setNull($paramIndex);
+        } else {
+       	    if (is_numeric($value)) $value = date('Y-m-d H:i:s O', $value);
+       	    elseif (is_object($value)) $value = date(&quot;Y-m-d H:i:s O&quot;, $value-&gt;getTime());
+            $this-&gt;boundInVars[$paramIndex] = &quot;'&quot;.$this-&gt;escape($value).&quot;'&quot;;
+        }
+    }
+}

Added: trunk/vendor/creole/drivers/pgsql/PgSQLResultSet.php
===================================================================
--- trunk/vendor/creole/drivers/pgsql/PgSQLResultSet.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/pgsql/PgSQLResultSet.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,200 @@
+&lt;?php
+/*
+ *  $Id: PgSQLResultSet.php,v 1.27 2005/01/07 19:04:46 micha Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+ 
+require_once 'creole/ResultSet.php';
+require_once 'creole/common/ResultSetCommon.php';
+
+/**
+ * PostgreSQL implementation of ResultSet.
+ *
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.27 $
+ * @package   creole.drivers.pgsql
+ */
+class PgSQLResultSet extends ResultSetCommon implements ResultSet {
+
+
+    /**
+     * Gets optimized PgSQLResultSetIterator.
+     * @return PgSQLResultSetIterator
+     */
+    public function getIterator()
+    {   
+        require_once 'creole/drivers/pgsql/PgSQLResultSetIterator.php';
+        return new PgSQLResultSetIterator($this);
+    }
+
+    /**
+     * Postgres doesn't actually move the db pointer.  The specific row
+     * is fetched by call to pg_fetch_array() rather than by a seek and
+     * then an unspecified pg_fetch_array() call.
+     * 
+     * The only side-effect of this situation is that we don't really know 
+     * if the seek will fail or succeed until we have called next().  This
+     * behavior is acceptible - and explicitly documented in 
+     * ResultSet::seek() phpdoc.
+     * 
+     * @see ResultSet::seek()
+     */ 
+    public function seek($rownum)
+    {
+        if ($rownum &lt; 0) {
+            return false;
+        }
+        
+        // PostgreSQL rows start w/ 0, but this works, because we are
+        // looking to move the position _before_ the next desired position
+        $this-&gt;cursorPos = $rownum;
+        return true;
+    }
+    
+    /**
+     * @see ResultSet::next()
+     */ 
+    public function next()
+    {
+        // must suppress errors here because we are jumping to rownum that may not exist w/ fetch_array command
+        $this-&gt;fields = @pg_fetch_array($this-&gt;result, $this-&gt;cursorPos, $this-&gt;fetchmode);
+
+           if (!$this-&gt;fields) {
+            $err = @pg_result_error($this-&gt;result);
+            if (!$err) {
+                // We've advanced beyond end of recordset.
+                $this-&gt;afterLast();
+                return false;
+            } else {
+                throw new SQLException(&quot;Error fetching result&quot;, $err);                
+            }
+        }
+        
+        // Advance cursor position
+        $this-&gt;cursorPos++;    
+        return true;
+    }
+
+    /**
+     * @see ResultSet::getRecordCount()
+     */
+    public function getRecordCount()
+    {
+        $rows = @pg_num_rows($this-&gt;result);
+        if ($rows === null) {
+            throw new SQLException(&quot;Error fetching num rows&quot;, pg_result_error($this-&gt;result));
+        }
+        return (int) $rows;
+    }    
+
+    /**
+     * @see ResultSet::close()
+     */
+    public function close()
+    {
+        $this-&gt;fields = array();
+        @pg_free_result($this-&gt;result);
+    }
+        
+    /**
+     * Convert Postgres string representation of array into native PHP array.
+     * @param string $str Postgres string array rep: {1223, 2343} or {{&quot;welcome&quot;, &quot;home&quot;}, {&quot;test2&quot;, &quot;&quot;}}
+     * @return array
+     */
+    private function strToArray($str)
+    {
+        $str = substr($str, 1, -1); // remove { }
+        $res = array();
+        
+        $subarr = array();
+        $in_subarr = 0;
+        
+        $toks = explode(',', $str);
+        foreach($toks as $tok) {                    
+            if ($in_subarr &gt; 0) { // already in sub-array?
+                $subarr[$in_subarr][] = $tok;
+                if ('}' === substr($tok, -1, 1)) { // check to see if we just added last component                    
+                    $res[] = $this-&gt;strToArray(implode(',', $subarr[$in_subarr]));
+                    $in_subarr--;
+                }
+            } elseif ($tok{0} === '{') { // we're inside a new sub-array                               
+                if ('}' !== substr($tok, -1, 1)) {
+                    $in_subarr++;
+                    // if sub-array has more than one element
+                    $subarr[$in_subarr] = array();
+                    $subarr[$in_subarr][] = $tok;                    
+                } else {
+                    $res[] = $this-&gt;strToArray($tok);
+                }
+            } else { // not sub-array
+                $val = trim($tok, '&quot;'); // remove &quot; (surrounding strings)
+                // perform type castng here?
+                $res[] = $val;
+            }
+        }
+        
+        return $res;
+    }
+
+    /**
+     * Reads a column as an array.
+     * The value of the column is unserialized &amp; returned as an array.
+     * @param mixed $column Column name (string) or index (int) starting with 1.
+     * @return array
+     * @throws SQLException - If the column specified is not a valid key in current field array.
+     */
+    public function getArray($column) 
+    {
+        if (is_int($column)) { $column--; } // because Java convention is to start at 1 
+        if (!array_key_exists($column, $this-&gt;fields)) { throw new SQLException(&quot;Invalid resultset column: &quot; . (is_int($column) ? $column + 1 : $column)); }
+        if ($this-&gt;fields[$column] === null) { return null; }
+        return $this-&gt;strToArray($this-&gt;fields[$column]);
+    } 
+    
+    /**
+     * Returns Blob with contents of column value.
+     * 
+     * @param mixed $column Column name (string) or index (int) starting with 1 (if ResultSet::FETCHMODE_NUM was used).
+     * @return Blob New Blob with data from column.
+     * @throws SQLException - If the column specified is not a valid key in current field array.
+     */
+    public function getBlob($column) 
+    {
+        if (is_int($column)) { $column--; } // because Java convention is to start at 1 
+        if (!array_key_exists($column, $this-&gt;fields)) { throw new SQLException(&quot;Invalid resultset column: &quot; . (is_int($column) ? $column + 1 : $column)); }
+        if ($this-&gt;fields[$column] === null) { return null; }
+        require_once 'creole/util/Blob.php';
+        $b = new Blob();
+        $b-&gt;setContents(pg_unescape_bytea($this-&gt;fields[$column]));
+        return $b;
+    }     
+
+    /**
+     * @param mixed $column Column name (string) or index (int) starting with 1.
+     * @return boolean
+     * @throws SQLException - If the column specified is not a valid key in current field array.
+     */
+    public function getBoolean($column) 
+    {
+        if (is_int($column)) { $column--; } // because Java convention is to start at 1 
+        if (!array_key_exists($column, $this-&gt;fields)) { throw new SQLException(&quot;Invalid resultset column: &quot; . (is_int($column) ? $column + 1 : $column)); }
+        if ($this-&gt;fields[$column] === null) { return null; }
+        return ($this-&gt;fields[$column] === 't');
+    }
+            
+}

Added: trunk/vendor/creole/drivers/pgsql/PgSQLResultSetIterator.php
===================================================================
--- trunk/vendor/creole/drivers/pgsql/PgSQLResultSetIterator.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/pgsql/PgSQLResultSetIterator.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,101 @@
+&lt;?php
+/*
+ *  $Id: PgSQLResultSetIterator.php,v 1.1 2004/12/04 05:58:53 gamr Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+/**
+ * Optimized iterator for PostgreSQL, based off of SQLite iterator.
+ * Testing with SeekableIterator, no idea if it will keep this
+ * functionality or what uses it or even how to use it as yet.
+ * 
+ * @author    Cameron Brunner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">webmaster at animetorrents.com</A>&gt;
+ * @version   $Revision: 1.1 $
+ * @package   creole.drivers.pgsql
+ */
+class PgSQLResultSetIterator implements SeekableIterator {
+
+    private $result;
+    private $pos = 0;
+    private $fetchmode;
+    private $row;
+    private $row_count;
+    
+    /**
+     * Construct the iterator.
+     * @param PgSQLResultSet $rs
+     */
+    public function __construct(PgSQLResultSet $rs)
+    {
+        $this-&gt;result = $rs-&gt;getResource();
+        $this-&gt;fetchmode = $rs-&gt;getFetchmode();
+	$this-&gt;row_count = $rs-&gt;getRecordCount();
+    }
+    
+    /**
+     * This method actually has no effect, since we do not rewind ResultSet for iteration.
+     */
+    function rewind()
+    {        
+        $this-&gt;pos = 0;
+    }
+    
+    function valid()
+    {
+	return ( $this-&gt;pos &lt; $this-&gt;row_count );
+    }
+    
+    /**
+     * Returns the cursor position.  Note that this will not necessarily
+     * be 1 for the first row, since no rewind is performed at beginning
+     * of iteration.
+     * @return int
+     */
+    function key()
+    {
+        return $this-&gt;pos;
+    }
+    
+    /**
+     * Returns the row (assoc array) at current cursor pos.
+     * @return array
+     */
+    function current()
+    {
+       return pg_fetch_array($this-&gt;result, $this-&gt;pos, $this-&gt;fetchmode);
+    }
+    
+    /**
+     * Advances internal cursor pos.
+     */
+    function next()
+    {
+        $this-&gt;pos++;
+    }
+
+    /**
+     * Sets cursor to specific value.
+     */
+    function seek ( $index )
+    {
+	if ( $index &lt; 0 || $index &gt; $this-&gt;row_count ) {
+		throw new Exception('Seeking to an unavailable index.');
+	}
+	$this-&gt;pos = $index;
+    }
+}

Added: trunk/vendor/creole/drivers/pgsql/PgSQLStatement.php
===================================================================
--- trunk/vendor/creole/drivers/pgsql/PgSQLStatement.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/pgsql/PgSQLStatement.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,34 @@
+&lt;?php
+/*
+ *  $Id: PgSQLStatement.php,v 1.1 2004/02/19 02:49:42 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+ 
+require_once 'creole/Statement.php';
+require_once 'creole/common/StatementCommon.php';
+
+/**
+ * PostgreSQL Statement implementation.
+ * 
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.1 $
+ * @package   creole.drivers.pgsql
+ */ 
+class PgSQLStatement extends StatementCommon implements Statement {
+    
+}

Added: trunk/vendor/creole/drivers/pgsql/PgSQLTypes.php
===================================================================
--- trunk/vendor/creole/drivers/pgsql/PgSQLTypes.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/pgsql/PgSQLTypes.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,101 @@
+&lt;?php
+
+/*
+ *  $Id: PgSQLTypes.php,v 1.8 2004/04/09 19:16:05 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+ 
+require_once 'creole/CreoleTypes.php';
+
+/**
+ * PostgreSQL types / type map.
+ *
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.8 $
+ * @package   creole.drivers.pgsql
+ */
+class PgSQLTypes extends CreoleTypes {
+
+    /** Map PostgreSQL native types to Creole (JDBC) types. */
+    private static $typeMap = array (
+                &quot;int2&quot; =&gt; CreoleTypes::SMALLINT,
+                &quot;int4&quot; =&gt; CreoleTypes::INTEGER, 
+                &quot;oid&quot; =&gt; CreoleTypes::INTEGER,
+                &quot;int8&quot; =&gt; CreoleTypes::BIGINT,
+                &quot;cash&quot;  =&gt; CreoleTypes::DOUBLE,
+                &quot;money&quot;  =&gt; CreoleTypes::DOUBLE,
+                &quot;numeric&quot; =&gt; CreoleTypes::NUMERIC,
+                &quot;float4&quot; =&gt; CreoleTypes::REAL,
+                &quot;float8&quot; =&gt; CreoleTypes::DOUBLE,
+                &quot;bpchar&quot; =&gt; CreoleTypes::CHAR, 
+                &quot;char&quot; =&gt; CreoleTypes::CHAR, 
+                &quot;char2&quot; =&gt; CreoleTypes::CHAR, 
+                &quot;char4&quot; =&gt; CreoleTypes::CHAR, 
+                &quot;char8&quot; =&gt; CreoleTypes::CHAR, 
+                &quot;char16&quot; =&gt; CreoleTypes::CHAR,
+                &quot;varchar&quot; =&gt; CreoleTypes::VARCHAR, 
+                &quot;text&quot; =&gt; CreoleTypes::VARCHAR, 
+                &quot;name&quot; =&gt; CreoleTypes::VARCHAR, 
+                &quot;filename&quot; =&gt; CreoleTypes::VARCHAR,
+                &quot;bytea&quot; =&gt; CreoleTypes::BINARY,
+                &quot;bool&quot; =&gt; CreoleTypes::BOOLEAN,
+                &quot;date&quot; =&gt; CreoleTypes::DATE,
+                &quot;time&quot; =&gt; CreoleTypes::TIME,
+                &quot;abstime&quot; =&gt; CreoleTypes::TIMESTAMP, 
+                &quot;timestamp&quot; =&gt; CreoleTypes::TIMESTAMP, 
+                &quot;timestamptz&quot; =&gt; CreoleTypes::TIMESTAMP,
+                &quot;_bool&quot; =&gt; CreoleTypes::ARR,     
+                &quot;_char&quot; =&gt; CreoleTypes::ARR, 
+                &quot;_int2&quot; =&gt; CreoleTypes::ARR, 
+                &quot;_int4&quot; =&gt; CreoleTypes::ARR, 
+                &quot;_text&quot; =&gt; CreoleTypes::ARR,
+                &quot;_oid&quot; =&gt; CreoleTypes::ARR, 
+                &quot;_varchar&quot; =&gt; CreoleTypes::ARR, 
+                &quot;_int8&quot; =&gt; CreoleTypes::ARR, 
+                &quot;_float4&quot; =&gt; CreoleTypes::ARR, 
+                &quot;_float8&quot; =&gt; CreoleTypes::ARR,
+                &quot;_abstime&quot; =&gt; CreoleTypes::ARR, 
+                &quot;_date&quot; =&gt; CreoleTypes::ARR, 
+                &quot;_time&quot; =&gt; CreoleTypes::ARR, 
+                &quot;_timestamp&quot; =&gt; CreoleTypes::ARR, 
+                &quot;_numeric&quot; =&gt; CreoleTypes::ARR,
+                &quot;_bytea&quot; =&gt; CreoleTypes::ARR,
+            );
+                
+    /** Reverse lookup map, created on demand. */
+    private static $reverseMap = null;
+    
+    public static function getType($pgsqlType)
+    {
+        $t = strtolower($pgsqlType);
+        if (isset(self::$typeMap[$t])) {
+            return self::$typeMap[$t];
+        } else {
+            return CreoleTypes::OTHER;
+        }
+    }
+    
+    public static function getNativeType($creoleType)
+    {
+        if (self::$reverseMap === null) {
+            self::$reverseMap = array_flip(self::$typeMap);
+        }
+        return @self::$reverseMap[$creoleType];
+    }
+    
+}
\ No newline at end of file

Added: trunk/vendor/creole/drivers/pgsql/metadata/PgSQLDatabaseInfo.php
===================================================================
--- trunk/vendor/creole/drivers/pgsql/metadata/PgSQLDatabaseInfo.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/pgsql/metadata/PgSQLDatabaseInfo.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,88 @@
+&lt;?php
+/*
+ *  $Id: PgSQLDatabaseInfo.php,v 1.9 2005/03/30 11:45:26 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+require_once 'creole/metadata/DatabaseInfo.php';
+
+/**
+ * MySQL implementation of DatabaseInfo.
+ *
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.9 $
+ * @package   creole.drivers.pgsql.metadata
+ */
+class PgSQLDatabaseInfo extends DatabaseInfo {
+
+    /**
+     * @throws SQLException
+     * @return void
+     */
+    protected function initTables()
+    {
+        include_once 'creole/drivers/pgsql/metadata/PgSQLTableInfo.php';
+        
+        // Get Database Version
+        $result = pg_exec ($this-&gt;dblink, &quot;SELECT version() as ver&quot;);
+        
+        if (!$result)
+        {
+        	throw new SQLException (&quot;Failed to select database version&quot;);
+        } // if (!$result)
+        $row = pg_fetch_assoc ($result, 0);
+        $arrVersion = sscanf ($row['ver'], '%*s %d.%d');
+        $version = sprintf (&quot;%d.%d&quot;, $arrVersion[0], $arrVersion[1]);
+        // Clean up
+        $arrVersion = null;
+        $row = null;
+        pg_free_result ($result);
+        $result = null;
+
+        $result = pg_exec($this-&gt;dblink, &quot;SELECT oid, relname FROM pg_class
+										WHERE relkind = 'r' AND relnamespace = (SELECT oid
+										FROM pg_namespace
+										WHERE
+										     nspname NOT IN ('information_schema','pg_catalog')
+										     AND nspname NOT LIKE 'pg_temp%'
+										     AND nspname NOT LIKE 'pg_toast%'
+										LIMIT 1)
+										ORDER BY relname&quot;);
+
+        if (!$result) {
+            throw new SQLException(&quot;Could not list tables&quot;, pg_last_error($this-&gt;dblink));
+        }
+
+        while ($row = pg_fetch_assoc($result)) {
+            $this-&gt;tables[strtoupper($row['relname'])] = new PgSQLTableInfo($this, $row['relname'], $version, $row['oid']);
+        }
+    }
+
+    /**
+     * PgSQL sequences.
+     *
+     * @return void
+     * @throws SQLException
+     */
+    protected function initSequences()
+    {
+        throw new SQLException(&quot;Sequences are currently unsupported.&quot;);
+    }
+
+}
+

Added: trunk/vendor/creole/drivers/pgsql/metadata/PgSQLTableInfo.php
===================================================================
--- trunk/vendor/creole/drivers/pgsql/metadata/PgSQLTableInfo.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/pgsql/metadata/PgSQLTableInfo.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,416 @@
+&lt;?php
+/*
+ *  $Id: PgSQLTableInfo.php,v 1.30 2005/04/21 14:48:44 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+require_once 'creole/metadata/TableInfo.php';
+
+/**
+ * PgSQL implementation of TableInfo.
+ *
+ * See this Python code by David M. Cook for some good reference on Pgsql metadata
+ * functions:
+ * @link <A HREF="http://www.sandpyt.org/pipermail/sandpyt/2003-March/000008.html">http://www.sandpyt.org/pipermail/sandpyt/2003-March/000008.html</A>
+ *
+ * Here's some more information from postgresql:
+ * @link <A HREF="http://developer.postgresql.org/docs/pgsql/src/backend/catalog/information_schema.sql">http://developer.postgresql.org/docs/pgsql/src/backend/catalog/information_schema.sql</A>
+ *
+ * @todo -c Eventually move to supporting only Postgres &gt;= 7.4, which has the information_schema
+ *
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.30 $
+ * @package   creole.drivers.pgsql.metadata
+ */
+class PgSQLTableInfo extends TableInfo {
+	
+    /**
+     * Database Version.
+     * @var String
+     */
+    private $version;
+	
+    /**
+     * Table OID
+     * @var Integer
+     */
+    private $oid;
+
+    /**
+     * @param string $table The table name.
+     * @param string $database The database name.
+     * @param resource $dblink The db connection resource.
+     */
+    function __construct(DatabaseInfo $database, $name, $version, $intOID) {
+        parent::__construct ($database, $name);
+        $this-&gt;version = $version;
+        $this-&gt;oid = $intOID;
+    } // function __construct(DatabaseInfo $database, $name) {
+
+    /** Load the columns for this table */
+    protected function initColumns () {
+    	// Include dependencies
+    	include_once ('creole/metadata/ColumnInfo.php');
+    	include_once ('creole/drivers/pgsql/PgSQLTypes.php');
+
+    	// Get the columns, types, etc.
+    	// Based on code from pgAdmin3 (<A HREF="http://www.pgadmin.org/">http://www.pgadmin.org/</A>)
+    	$result = pg_query ($this-&gt;dblink, sprintf (&quot;SELECT 
+    								att.attname,
+    								att.atttypmod,
+    								att.atthasdef,
+    								att.attnotnull,
+    								def.adsrc, 
+    								CASE WHEN att.attndims &gt; 0 THEN 1 ELSE 0 END AS isarray, 
+    								CASE 
+    									WHEN ty.typname = 'bpchar' 
+    										THEN 'char' 
+    									WHEN ty.typname = '_bpchar' 
+	    									THEN '_char' 
+    									ELSE 
+	    									ty.typname 
+    								END AS typname,
+    								ty.typtype
+								FROM pg_attribute att
+									JOIN pg_type ty ON ty.oid=att.atttypid
+									LEFT OUTER JOIN pg_attrdef def ON adrelid=att.attrelid AND adnum=att.attnum
+								WHERE att.attrelid = %d AND att.attnum &gt; 0
+									AND att.attisdropped IS FALSE
+								ORDER BY att.attnum&quot;, $this-&gt;oid));
+
+        if (!$result) {
+            throw new SQLException(&quot;Could not list fields for table: &quot; . $this-&gt;name, pg_last_error($this-&gt;dblink));
+        }
+        while($row = pg_fetch_assoc($result)) {
+        	// Check to ensure that this column isn't an array data type
+        	if (((int) $row['isarray']) === 1)
+        	{
+        		throw new SQLException (sprintf (&quot;Array datatypes are not currently supported [%s.%s]&quot;, $this-&gt;name, $row['attname']));
+        	} // if (((int) $row['isarray']) === 1)
+            $name = $row['attname'];
+            // If they type is a domain, Process it
+            if (strtolower ($row['typtype']) == 'd')
+            {
+            	$arrDomain = $this-&gt;processDomain ($row['typname']);
+            	$type = $arrDomain['type'];
+            	$size = $arrDomain['length'];
+            	$scale = $arrDomain['precision'];
+            	$boolHasDefault = (strlen (trim ($row['atthasdef'])) &gt; 0) ? $row['atthasdef'] : $arrDomain['hasdefault'];
+            	$default = (strlen (trim ($row['adsrc'])) &gt; 0) ? $row['adsrc'] : $arrDomain['default'];
+            	$is_nullable = (strlen (trim ($row['attnotnull'])) &gt; 0) ? $row['attnotnull'] : $arrDomain['notnull'];
+            	$is_nullable = (($is_nullable == 't') ? false : true);
+            } // if (strtolower ($row['typtype']) == 'd')
+            else
+            {
+	            $type = $row['typname'];
+	            $arrLengthPrecision = $this-&gt;processLengthPrecision ($row['atttypmod'], $type);
+	            $size = $arrLengthPrecision['length'];
+	            $scale = $arrLengthPrecision['precision'];
+	            $boolHasDefault = $row['atthasdef'];
+	            $default = $row['adsrc'];
+	            $is_nullable = (($row['attnotnull'] == 't') ? false : true);
+            } // else (strtolower ($row['typtype']) == 'd')
+
+            $autoincrement = null;
+                       
+            // if column has a default
+            if (($boolHasDefault == 't') &amp;&amp; (strlen (trim ($default)) &gt; 0))
+            {
+	            if (!preg_match('/^nextval\(/', $default))
+	            {
+	            	$strDefault= preg_replace ('/::[\W\D]*/', '', $default);
+	            	$default = str_replace (&quot;'&quot;, '', $strDefault);
+	            } // if (!preg_match('/^nextval\(/', $row['atthasdef']))
+	            else
+	            {
+	            	$autoincrement = true;
+	            	$default = null;
+	            } // else
+            } // if (($boolHasDefault == 't') &amp;&amp; (strlen (trim ($default)) &gt; 0))
+            else
+            {
+            	$default = null;
+            } // else (($boolHasDefault == 't') &amp;&amp; (strlen (trim ($default)) &gt; 0))
+
+            $this-&gt;columns[$name] = new ColumnInfo($this, $name, PgSQLTypes::getType($type), $type, $size, $scale, $is_nullable, $default, $autoincrement);
+        }
+
+        $this-&gt;colsLoaded = true;
+    } // protected function initColumns ()
+
+    private function processLengthPrecision ($intTypmod, $strName)
+    {
+    	// Define the return array
+    	$arrRetVal = array ('length'=&gt;null, 'precision'=&gt;null);
+
+    	// Some datatypes don't have a Typmod
+    	if ($intTypmod == -1)
+    	{
+    		return $arrRetVal;
+    	} // if ($intTypmod == -1)
+
+    	// Numeric Datatype?
+    	if ($strName == PgSQLTypes::getNativeType (CreoleTypes::NUMERIC))
+    	{
+    		$intLen = ($intTypmod - 4) &gt;&gt; 16;
+    		$intPrec = ($intTypmod - 4) &amp; 0xffff;
+    		$intLen = sprintf (&quot;%ld&quot;, $intLen);
+    		if ($intPrec)
+    		{
+    			$intPrec = sprintf (&quot;%ld&quot;, $intPrec);
+    		} // if ($intPrec)
+    		$arrRetVal['length'] = $intLen;
+    		$arrRetVal['precision'] = $intPrec;
+    	} // if ($strName == PgSQLTypes::getNativeType (CreoleTypes::NUMERIC))
+    	elseif ($strName == PgSQLTypes::getNativeType (CreoleTypes::TIME) || $strName == 'timetz'
+    		|| $strName == PgSQLTypes::getNativeType (CreoleTypes::TIMESTAMP) || $strName == 'timestamptz'
+    		|| $strName == 'interval' || $strName == 'bit')
+    	{
+    		$arrRetVal['length'] = sprintf (&quot;%ld&quot;, $intTypmod);
+    	} // elseif (TIME, TIMESTAMP, INTERVAL, BIT)
+    	else
+    	{
+    		$arrRetVal['length'] = sprintf (&quot;%ld&quot;, ($intTypmod - 4));
+    	} // else
+    	return $arrRetVal;
+    } // private function processLengthPrecision ($intTypmod, $strName)
+
+    private function processDomain ($strDomain)
+    {
+    	if (strlen (trim ($strDomain)) &lt; 1)
+    	{
+    		throw new SQLException (&quot;Invalid domain name [&quot; . $strDomain . &quot;]&quot;);
+    	} // if (strlen (trim ($strDomain)) &lt; 1)
+    	$result = pg_query ($this-&gt;dblink, sprintf (&quot;SELECT
+														d.typname as domname,
+														b.typname as basetype,
+														d.typlen,
+														d.typtypmod,
+														d.typnotnull,
+														d.typdefault
+													FROM pg_type d
+														INNER JOIN pg_type b ON b.oid = CASE WHEN d.typndims &gt; 0 then d.typelem ELSE d.typbasetype END
+													WHERE
+														d.typtype = 'd'
+														AND d.typname = '%s'
+													ORDER BY d.typname&quot;, $strDomain));
+
+        if (!$result) {
+            throw new SQLException(&quot;Query for domain [&quot; . $strDomain . &quot;] failed.&quot;, pg_last_error($this-&gt;dblink));
+        }
+
+        $row = pg_fetch_assoc ($result);
+        if (!$row)
+        {
+        	throw new SQLException (&quot;Domain [&quot; . $strDomain . &quot;] not found.&quot;);
+        } // if (!$row)
+        $arrDomain = array ();
+        $arrDomain['type'] = $row['basetype'];
+	    $arrLengthPrecision = $this-&gt;processLengthPrecision ($row['typtypmod'], $row['basetype']);
+	    $arrDomain['length'] = $arrLengthPrecision['length'];
+	    $arrDomain['precision'] = $arrLengthPrecision['precision'];
+	    $arrDomain['notnull'] = $row['typnotnull'];
+	    $arrDomain['default'] = $row['typdefault'];
+	    $arrDomain['hasdefault'] = (strlen (trim ($row['typdefault'])) &gt; 0) ? 't' : 'f';
+
+	    pg_free_result ($result);
+	    return $arrDomain;
+    } // private function processDomain ($strDomain)
+
+    /** Load foreign keys for this table. */
+    protected function initForeignKeys()
+    {
+        include_once 'creole/metadata/ForeignKeyInfo.php';
+
+        $result = pg_query ($this-&gt;dblink, sprintf (&quot;SELECT
+						      conname,
+						      confupdtype,
+						      confdeltype,
+						      cl.relname as fktab,
+						      a2.attname as fkcol,
+						      cr.relname as reftab,
+						      a1.attname as refcol
+						FROM pg_constraint ct
+						     JOIN pg_class cl ON cl.oid=conrelid
+						     JOIN pg_class cr ON cr.oid=confrelid
+						     LEFT JOIN pg_catalog.pg_attribute a1 ON a1.attrelid = ct.confrelid
+						     LEFT JOIN pg_catalog.pg_attribute a2 ON a2.attrelid = ct.conrelid
+						WHERE
+						     contype='f'
+						     AND conrelid = %d
+						     AND a2.attnum = ct.conkey[1]
+						     AND a1.attnum = ct.confkey[1]
+						ORDER BY conname&quot;, $this-&gt;oid));
+        if (!$result) {
+            throw new SQLException(&quot;Could not list foreign keys for table: &quot; . $this-&gt;name, pg_last_error($this-&gt;dblink));
+        }
+
+        while($row = pg_fetch_assoc($result)) {
+            $name = $row['conname'];
+            $local_table = $row['fktab'];
+            $local_column = $row['fkcol'];
+            $foreign_table = $row['reftab'];
+            $foreign_column = $row['refcol'];
+
+            // On Update
+            switch ($row['confupdtype']) {
+              case 'c':
+                $onupdate = ForeignKeyInfo::CASCADE; break;
+              case 'd':
+                $onupdate = ForeignKeyInfo::SETDEFAULT; break;
+              case 'n':
+                $onupdate = ForeignKeyInfo::SETNULL; break;
+              case 'r':
+                $onupdate = ForeignKeyInfo::RESTRICT; break;
+              default:
+              case 'a':
+                //NOACTION is the postgresql default
+                $onupdate = ForeignKeyInfo::NONE; break;
+            }
+            // On Delete
+            switch ($row['confdeltype']) {
+              case 'c':
+                $ondelete = ForeignKeyInfo::CASCADE; break;
+              case 'd':
+                $ondelete = ForeignKeyInfo::SETDEFAULT; break;
+              case 'n':
+                $ondelete = ForeignKeyInfo::SETNULL; break;
+              case 'r':
+                $ondelete = ForeignKeyInfo::RESTRICT; break;
+              default:
+              case 'a':
+                //NOACTION is the postgresql default
+                $ondelete = ForeignKeyInfo::NONE; break;
+            }
+
+
+            $foreignTable = $this-&gt;database-&gt;getTable($foreign_table);
+            $foreignColumn = $foreignTable-&gt;getColumn($foreign_column);
+
+            $localTable   = $this-&gt;database-&gt;getTable($local_table);
+            $localColumn   = $localTable-&gt;getColumn($local_column);
+
+            if (!isset($this-&gt;foreignKeys[$name])) {
+                $this-&gt;foreignKeys[$name] = new ForeignKeyInfo($name);
+            }
+            $this-&gt;foreignKeys[$name]-&gt;addReference($localColumn, $foreignColumn, $ondelete, $onupdate);
+        }
+
+        $this-&gt;fksLoaded = true;
+    }
+
+    /** Load indexes for this table */
+    protected function initIndexes()
+    {
+        include_once 'creole/metadata/IndexInfo.php';
+
+        // columns have to be loaded first
+        if (!$this-&gt;colsLoaded) $this-&gt;initColumns();
+
+		$result = pg_query ($this-&gt;dblink, sprintf (&quot;SELECT
+													      DISTINCT ON(cls.relname)
+													      cls.relname as idxname,
+													      indkey,
+													      indisunique
+													FROM pg_index idx
+													     JOIN pg_class cls ON cls.oid=indexrelid
+													WHERE indrelid = %d AND NOT indisprimary
+													ORDER BY cls.relname&quot;, $this-&gt;oid));
+
+
+        if (!$result) {
+            throw new SQLException(&quot;Could not list indexes keys for table: &quot; . $this-&gt;name, pg_last_error($this-&gt;dblink));
+        }
+
+        while($row = pg_fetch_assoc($result)) {
+            $name = $row[&quot;idxname&quot;];
+            $unique = ($row[&quot;indisunique&quot;] == 't') ? true : false;
+            if (!isset($this-&gt;indexes[$name])) {
+                $this-&gt;indexes[$name] = new IndexInfo($name, $unique);
+            }
+            $arrColumns = explode (' ', $row['indkey']);
+            foreach ($arrColumns as $intColNum)
+            {
+	            $result2 = pg_query ($this-&gt;dblink, sprintf (&quot;SELECT a.attname
+															FROM pg_catalog.pg_class c JOIN pg_catalog.pg_attribute a ON a.attrelid = c.oid
+															WHERE c.oid = '%s' AND a.attnum = %d AND NOT a.attisdropped
+															ORDER BY a.attnum&quot;, $this-&gt;oid, $intColNum));
+				if (!$result2)
+				{
+            		throw new SQLException(&quot;Could not list indexes keys for table: &quot; . $this-&gt;name, pg_last_error($this-&gt;dblink));
+				}
+				$row2 = pg_fetch_assoc($result2);
+	            $this-&gt;indexes[$name]-&gt;addColumn($this-&gt;columns[ $row2['attname'] ]);
+			} // foreach ($arrColumns as $intColNum)
+        }
+
+        $this-&gt;indexesLoaded = true;
+    }
+
+    /** Loads the primary keys for this table. */
+    protected function initPrimaryKey() {
+
+        include_once 'creole/metadata/PrimaryKeyInfo.php';
+
+
+        // columns have to be loaded first
+        if (!$this-&gt;colsLoaded) $this-&gt;initColumns();
+
+        // Primary Keys
+        
+        $result = pg_query($this-&gt;dblink, sprintf (&quot;SELECT
+													      DISTINCT ON(cls.relname)
+													      cls.relname as idxname,
+													      indkey,
+													      indisunique
+													FROM pg_index idx
+													     JOIN pg_class cls ON cls.oid=indexrelid
+													WHERE indrelid = %s AND indisprimary
+													ORDER BY cls.relname&quot;, $this-&gt;oid));
+        if (!$result) {
+            throw new SQLException(&quot;Could not list primary keys for table: &quot; . $this-&gt;name, pg_last_error($this-&gt;dblink));
+        }
+
+        // Loop through the returned results, grouping the same key_name together
+        // adding each column for that key.
+
+        while($row = pg_fetch_assoc($result)) {
+            $arrColumns = explode (' ', $row['indkey']);
+            foreach ($arrColumns as $intColNum)
+            {
+	            $result2 = pg_query ($this-&gt;dblink, sprintf (&quot;SELECT a.attname
+															FROM pg_catalog.pg_class c JOIN pg_catalog.pg_attribute a ON a.attrelid = c.oid
+															WHERE c.oid = '%s' AND a.attnum = %d AND NOT a.attisdropped
+															ORDER BY a.attnum&quot;, $this-&gt;oid, $intColNum));
+				if (!$result2)
+				{
+            		throw new SQLException(&quot;Could not list indexes keys for table: &quot; . $this-&gt;name, pg_last_error($this-&gt;dblink));
+				}
+				$row2 = pg_fetch_assoc($result2);
+				if (!isset($this-&gt;primaryKey)) {
+					$this-&gt;primaryKey = new PrimaryKeyInfo($row2['attname']);
+				}
+	            $this-&gt;primaryKey-&gt;addColumn($this-&gt;columns[ $row2['attname'] ]);
+			} // foreach ($arrColumns as $intColNum)
+        }
+        $this-&gt;pkLoaded = true;
+    }
+
+    
+
+}
\ No newline at end of file

Added: trunk/vendor/creole/drivers/sqlite/SQLiteConnection.php
===================================================================
--- trunk/vendor/creole/drivers/sqlite/SQLiteConnection.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/sqlite/SQLiteConnection.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,245 @@
+&lt;?php
+/*
+ *  $Id: SQLiteConnection.php,v 1.14 2005/10/18 11:26:28 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+ 
+require_once 'creole/Connection.php';
+require_once 'creole/common/ConnectionCommon.php';
+
+/**
+ * SQLite implementation of Connection.
+ * 
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @author    Stig Bakken &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">ssb at fast.no</A>&gt; 
+ * @author    Lukas Smith
+ * @version   $Revision: 1.14 $
+ * @package   creole.drivers.sqlite
+ */ 
+class SQLiteConnection extends ConnectionCommon implements Connection {   
+    
+    /**
+     * The case to use for SQLite results.
+     * (0=nochange, 1=upper, 2=lower) 
+     * This is set in each call to executeQuery() in order to ensure that different
+     * Connections do not overwrite each other's settings
+     */
+    private $sqliteAssocCase;
+    
+    /**
+     * @see Connection::connect()
+     */
+    function connect($dsninfo, $flags = 0)
+    {        
+        if (!extension_loaded('sqlite')) {
+            throw new SQLException('sqlite extension not loaded');
+        }
+
+        $file = $dsninfo['database'];
+        
+        $this-&gt;dsn = $dsninfo;
+        $this-&gt;flags = $flags;
+        
+        $persistent = ($flags &amp; Creole::PERSISTENT === Creole::PERSISTENT);
+        
+        if (PHP_VERSION == '5.0.4' || PHP_VERSION == '5.0.5') {
+            $nochange = TRUE;
+        } else {
+            $nochange = (($flags &amp; Creole::NO_ASSOC_LOWER) === Creole::NO_ASSOC_LOWER);
+        }
+        
+        if ($nochange) {     
+            $this-&gt;sqliteAssocCase = 0;
+        } else {
+            $this-&gt;sqliteAssocCase = 2;
+        }
+        
+        if ($file === null) {
+            throw new SQLException(&quot;No SQLite database specified.&quot;);
+        }
+        
+        $mode = (isset($dsninfo['mode']) &amp;&amp; is_numeric($dsninfo['mode'])) ? $dsninfo['mode'] : 0644;
+        
+        if ($file != ':memory:') {
+            if (!file_exists($file)) {
+                touch($file);
+                chmod($file, $mode);
+                if (!file_exists($file)) {
+                    throw new SQLException(&quot;Unable to create SQLite database.&quot;);
+                }
+            }
+            if (!is_file($file)) {
+                throw new SQLException(&quot;Unable to open SQLite database: not a valid file.&quot;);
+            }
+            if (!is_readable($file)) {
+                throw new SQLException(&quot;Unable to read SQLite database.&quot;);
+            }
+        }
+
+        $connect_function = $persistent ? 'sqlite_popen' : 'sqlite_open';
+        if (!($conn = @$connect_function($file, $mode, $errmsg) )) {
+            throw new SQLException(&quot;Unable to connect to SQLite database&quot;, $errmsg);
+        }
+        
+        $this-&gt;dblink = $conn;
+    }   
+
+    /**
+     * @see Connection::getDatabaseInfo()
+     */
+    public function getDatabaseInfo()
+    {
+        require_once 'creole/drivers/sqlite/metadata/SQLiteDatabaseInfo.php';
+        return new SQLiteDatabaseInfo($this);
+    }
+    
+     /**
+     * @see Connection::getIdGenerator()
+     */
+    public function getIdGenerator()
+    {
+        require_once 'creole/drivers/sqlite/SQLiteIdGenerator.php';
+        return new SQLiteIdGenerator($this);
+    }
+    
+    /**
+     * @see Connection::prepareStatement()
+     */
+    public function prepareStatement($sql) 
+    {
+        require_once 'creole/drivers/sqlite/SQLitePreparedStatement.php';
+        return new SQLitePreparedStatement($this, $sql);
+    }
+    
+    /**
+     * @see Connection::prepareCall()
+     */
+    public function prepareCall($sql) {
+        throw new SQLException('SQLite does not support stored procedures using CallableStatement.');        
+    }
+    
+    /**
+     * @see Connection::createStatement()
+     */
+    public function createStatement()
+    {
+        require_once 'creole/drivers/sqlite/SQLiteStatement.php';
+        return new SQLiteStatement($this);
+    }
+        
+    /**
+     * @see Connection::close()
+     */
+    function close()
+    {
+        $ret = @sqlite_close($this-&gt;dblink);
+        $this-&gt;dblink = null;
+        return $ret;
+    }
+    
+    /**
+     * @see Connection::applyLimit()
+     */
+    public function applyLimit(&amp;$sql, $offset, $limit)
+    {
+        if ( $limit &gt; 0 ) {
+            $sql .= &quot; LIMIT &quot; . $limit . ($offset &gt; 0 ? &quot; OFFSET &quot; . $offset : &quot;&quot;);
+        } elseif ( $offset &gt; 0 ) {
+            $sql .= &quot; LIMIT -1 OFFSET &quot; . $offset;
+        }
+    } 
+
+    /**
+     * @see Connection::executeQuery()
+     */
+    public function executeQuery($sql, $fetchmode = null)
+    {    
+        ini_set('sqlite.assoc_case', $this-&gt;sqliteAssocCase);
+        $this-&gt;lastQuery = $sql;
+        $result = @sqlite_query($this-&gt;dblink, $this-&gt;lastQuery);
+        if (!$result) {
+            throw new SQLException('Could not execute query', $php_errormsg, $this-&gt;lastQuery); //sqlite_error_string(sqlite_last_error($this-&gt;dblink))
+        }
+        require_once 'creole/drivers/sqlite/SQLiteResultSet.php';
+        return new SQLiteResultSet($this, $result, $fetchmode);    
+    }    
+    
+    /**
+     * @see Connection::executeUpdate()
+     */
+    function executeUpdate($sql)
+    {
+        $this-&gt;lastQuery = $sql;
+        $result = @sqlite_query($this-&gt;dblink, $this-&gt;lastQuery);
+        if (!$result) {            
+            throw new SQLException('Could not execute update', $php_errormsg, $this-&gt;lastQuery); //sqlite_error_string(sqlite_last_error($this-&gt;dblink))
+        }
+        return (int) @sqlite_changes($this-&gt;dblink);
+    }
+    
+    /**
+     * Start a database transaction.
+     * @throws SQLException
+     * @return void
+     */
+    protected function beginTrans()
+    {
+        $result = @sqlite_query($this-&gt;dblink, 'BEGIN');
+        if (!$result) {
+            throw new SQLException('Could not begin transaction', $php_errormsg); //sqlite_error_string(sqlite_last_error($this-&gt;dblink))
+        }
+    }
+    
+    /**
+     * Commit the current transaction.
+     * @throws SQLException
+     * @return void
+     */
+    protected function commitTrans()
+    {
+        $result = @sqlite_query($this-&gt;dblink, 'COMMIT');
+        if (!$result) {
+            throw new SQLException('Can not commit transaction', $php_errormsg); // sqlite_error_string(sqlite_last_error($this-&gt;dblink))
+        }
+    }
+
+    /**
+     * Roll back (undo) the current transaction.
+     * @throws SQLException
+     * @return void
+     */
+    protected function rollbackTrans()
+    {
+        $result = @sqlite_query($this-&gt;dblink, 'ROLLBACK');
+        if (!$result) {
+            throw new SQLException('Could not rollback transaction', $php_errormsg); // sqlite_error_string(sqlite_last_error($this-&gt;dblink))
+        }
+    }
+
+    /**
+     * Gets the number of rows affected by the data manipulation
+     * query.
+     *
+     * @return int Number of rows affected by the last query.
+     */
+    function getUpdateCount()
+    {
+        return (int) @sqlite_changes($this-&gt;dblink);
+    }
+    
+}

Added: trunk/vendor/creole/drivers/sqlite/SQLiteIdGenerator.php
===================================================================
--- trunk/vendor/creole/drivers/sqlite/SQLiteIdGenerator.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/sqlite/SQLiteIdGenerator.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,60 @@
+&lt;?php
+
+require_once 'creole/IdGenerator.php';
+
+/**
+ * SQLite IdGenerator implimenation.
+ *
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.4 $
+ * @package   creole.drivers.sqlite
+ */
+class SQLiteIdGenerator implements IdGenerator {
+    
+    /** Connection object that instantiated this class */
+    private $conn;
+
+    /**
+     * Creates a new IdGenerator class, saves passed connection for use
+     * later by getId() method.
+     * @param Connection $conn
+     */
+    public function __construct(Connection $conn)
+    {
+        $this-&gt;conn = $conn;
+    }
+    
+    /**
+     * @see IdGenerator::isBeforeInsert()
+     */
+    public function isBeforeInsert()
+    {
+        return false;
+    }    
+    
+    /**
+     * @see IdGenerator::isAfterInsert()
+     */
+    public function isAfterInsert()
+    {
+        return true;
+    }
+       
+    /**
+     * @see IdGenerator::getIdMethod()
+     */
+    public function getIdMethod()
+    {
+        return self::AUTOINCREMENT;
+    }
+    
+    /**
+     * @see IdGenerator::getId()
+     */
+    public function getId($unused = null)
+    {
+        return sqlite_last_insert_rowid($this-&gt;conn-&gt;getResource());
+    }
+    
+}
+

Added: trunk/vendor/creole/drivers/sqlite/SQLitePreparedStatement.php
===================================================================
--- trunk/vendor/creole/drivers/sqlite/SQLitePreparedStatement.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/sqlite/SQLitePreparedStatement.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,61 @@
+&lt;?php
+/*
+ *  $Id: SQLitePreparedStatement.php,v 1.7 2004/03/20 04:16:50 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+ 
+require_once 'creole/PreparedStatement.php';
+require_once 'creole/common/PreparedStatementCommon.php';
+
+/**
+ * MySQL subclass for prepared statements.
+ * 
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.7 $
+ * @package   creole.drivers.sqlite
+ */
+class SQLitePreparedStatement extends PreparedStatementCommon implements PreparedStatement {
+    
+    /**
+     * Quotes string using native sqlite_escape_string() function.
+     * @see ResultSetCommon::escape()
+     */
+    protected function escape($str)
+    {
+        return sqlite_escape_string($str);
+    }
+    
+    /**
+     * Applies sqlite_udf_encode_binary() to ensure that binary contents will be handled correctly by sqlite.
+     * @see PreparedStatement::setBlob()
+     * @see ResultSet::getBlob()
+     */
+    function setBlob($paramIndex, $blob) 
+    {    
+        if ($blob === null) {
+            $this-&gt;setNull($paramIndex);
+        } else {
+            // they took magic __toString() out of PHP5.0.0; this sucks
+            if (is_object($blob)) {
+                $blob = $blob-&gt;__toString();
+            }
+            $this-&gt;boundInVars[$paramIndex] = &quot;'&quot; . sqlite_udf_encode_binary( $blob ) . &quot;'&quot;;
+        }
+    }
+    
+}

Added: trunk/vendor/creole/drivers/sqlite/SQLiteResultSet.php
===================================================================
--- trunk/vendor/creole/drivers/sqlite/SQLiteResultSet.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/sqlite/SQLiteResultSet.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,119 @@
+&lt;?php
+/*
+ *  $Id: SQLiteResultSet.php,v 1.9 2004/11/29 13:41:24 micha Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+ 
+require_once 'creole/ResultSet.php';
+require_once 'creole/common/ResultSetCommon.php';
+
+/**
+ * SQLite implementation of ResultSet class.
+ *
+ * SQLite supports OFFSET / LIMIT natively; this means that no adjustments or checking
+ * are performed.  We will assume that if the lmitSQL() operation failed that an
+ * exception was thrown, and that OFFSET/LIMIT will never be emulated for SQLite.
+ * 
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.9 $
+ * @package   creole.drivers.sqlite
+ */
+class SQLiteResultSet extends ResultSetCommon implements ResultSet {
+    
+    /**
+     * Gets optimized SQLiteResultSetIterator.
+     * @return SQLiteResultSetIterator
+     */
+    public function getIterator()
+    {
+        require_once 'creole/drivers/sqlite/SQLiteResultSetIterator.php';
+        return new SQLiteResultSetIterator($this);
+    }
+           
+    /**
+     * @see ResultSet::seek()
+     */ 
+    public function seek($rownum)
+    {
+        // MySQL rows start w/ 0, but this works, because we are
+        // looking to move the position _before_ the next desired position
+         if (!@sqlite_seek($this-&gt;result, $rownum)) {
+                return false;
+        }
+        $this-&gt;cursorPos = $rownum;
+        return true;
+    }
+    
+    /**
+     * @see ResultSet::next()
+     */ 
+    function next()
+    {
+        $this-&gt;fields = sqlite_fetch_array($this-&gt;result, $this-&gt;fetchmode); // (ResultSet::FETCHMODE_NUM = SQLITE_NUM, etc.)
+           if (!$this-&gt;fields) {
+            $errno = sqlite_last_error($this-&gt;conn-&gt;getResource());
+            if (!$errno) {
+                // We've advanced beyond end of recordset.
+                $this-&gt;afterLast();
+                return false;
+            } else {
+                throw new SQLException(&quot;Error fetching result&quot;, sqlite_error_string($errno));
+            }
+        }
+        
+        // Advance cursor position
+        $this-&gt;cursorPos++;
+        return true;
+    }
+
+    /**
+     * @see ResultSet::getRecordCount()
+     */
+    public function getRecordCount()
+    {
+        $rows = @sqlite_num_rows($this-&gt;result);
+        if ($rows === null) {
+            throw new SQLException(&quot;Error fetching num rows&quot;, sqlite_error_string(sqlite_last_error($this-&gt;conn-&gt;getResource())));
+        }
+        return (int) $rows;
+    }    
+
+    /**
+     * Performs sqlite_udf_decode_binary on binary data.
+     * @see ResultSet::getBlob()
+     */
+    public function getBlob($column) 
+    {
+        $idx = (is_int($column) ? $column - 1 : $column);
+        if (!array_key_exists($idx, $this-&gt;fields)) { throw new SQLException(&quot;Invalid resultset column: &quot; . $column); }
+        if ($this-&gt;fields[$idx] === null) { return null; }
+        require_once 'creole/util/Blob.php';
+        $b = new Blob();
+        $b-&gt;setContents(sqlite_udf_decode_binary($this-&gt;fields[$idx]));
+        return $b;
+    }    
+    
+    /**
+     * Simply empties array as there is no result free method for sqlite.
+     * @see ResultSet::close()
+     */
+    public function close()
+    {
+        $this-&gt;fields = array();
+    }
+}

Added: trunk/vendor/creole/drivers/sqlite/SQLiteResultSetIterator.php
===================================================================
--- trunk/vendor/creole/drivers/sqlite/SQLiteResultSetIterator.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/sqlite/SQLiteResultSetIterator.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,89 @@
+&lt;?php
+/*
+ *  $Id: SQLiteResultSetIterator.php,v 1.6 2004/12/03 16:57:54 gamr Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+/**
+ * Optimized iterator for SQLite.
+ * 
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.6 $
+ * @package   creole.drivers.sqlite
+ */
+class SQLiteResultSetIterator implements Iterator {
+
+    private $result;
+    private $pos = 0;
+    private $fetchmode;
+    private $row;
+    private $row_count;
+    
+    /**
+     * Construct the iterator.
+     * @param SQLiteResultSet $rs
+     */
+    public function __construct(SQLiteResultSet $rs)
+    {
+        $this-&gt;result = $rs-&gt;getResource();
+        $this-&gt;fetchmode = $rs-&gt;getFetchmode();
+	$this-&gt;row_count = $rs-&gt;getRecordCount();
+    }
+    
+    /**
+     * This method actually has no effect, since we do not rewind ResultSet for iteration.
+     */
+    function rewind()
+    {        
+        sqlite_rewind($this-&gt;result);
+    }
+    
+    function valid()
+    {
+	return ( $this-&gt;pos &lt; $this-&gt;row_count );
+    }
+    
+    /**
+     * Returns the cursor position.  Note that this will not necessarily
+     * be 1 for the first row, since no rewind is performed at beginning
+     * of iteration.
+     * @return int
+     */
+    function key()
+    {
+        return $this-&gt;pos;
+    }
+    
+    /**
+     * Returns the row (assoc array) at current cursor pos.
+     * @return array
+     */
+    function current()
+    {
+       return sqlite_fetch_array($this-&gt;result, $this-&gt;fetchmode);
+    }
+    
+    /**
+     * Advances internal cursor pos.
+     */
+    function next()
+    {
+        $this-&gt;pos++;
+    }
+
+}

Added: trunk/vendor/creole/drivers/sqlite/SQLiteStatement.php
===================================================================
--- trunk/vendor/creole/drivers/sqlite/SQLiteStatement.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/sqlite/SQLiteStatement.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,34 @@
+&lt;?php
+/*
+ *  $Id: SQLiteStatement.php,v 1.1 2004/02/19 02:49:43 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+ 
+require_once 'creole/Statement.php';
+require_once 'creole/common/StatementCommon.php';
+
+/**
+ * SQLite Statement
+ * 
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.1 $
+ * @package   creole.drivers.sqlite
+ */ 
+class SQLiteStatement extends StatementCommon implements Statement {   
+    
+}

Added: trunk/vendor/creole/drivers/sqlite/SQLiteTypes.php
===================================================================
--- trunk/vendor/creole/drivers/sqlite/SQLiteTypes.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/sqlite/SQLiteTypes.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,108 @@
+&lt;?php
+
+/*
+ *  $Id: SQLiteTypes.php,v 1.3 2004/03/20 04:16:50 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+ 
+require_once 'creole/CreoleTypes.php';
+
+/**
+ * MySQL types / type map.
+ *
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.3 $
+ * @package   creole.drivers.sqlite
+ */
+class SQLiteTypes extends CreoleTypes {
+
+    /** 
+     * Map some fake SQLite types CreoleTypes. 
+     * SQLite is typeless so this is really only for &quot;hint&quot; / readability
+     * purposes.    
+     * @var array
+     */
+    private static $typeMap = array(
+                                'tinyint' =&gt; CreoleTypes::TINYINT,
+                                'smallint' =&gt; CreoleTypes::SMALLINT,
+                                'mediumint' =&gt; CreoleTypes::SMALLINT,
+                                'int' =&gt; CreoleTypes::INTEGER,
+                                'integer' =&gt; CreoleTypes::INTEGER,
+                                'bigint' =&gt; CreoleTypes::BIGINT,
+                                'int24' =&gt; CreoleTypes::BIGINT,
+                                'real' =&gt; CreoleTypes::REAL,
+                                'float' =&gt; CreoleTypes::FLOAT,
+                                'decimal' =&gt; CreoleTypes::DECIMAL,
+                                'numeric' =&gt; CreoleTypes::NUMERIC,
+                                'double' =&gt; CreoleTypes::DOUBLE,
+                                'char' =&gt; CreoleTypes::CHAR,
+                                'varchar' =&gt; CreoleTypes::VARCHAR,
+                                'date' =&gt; CreoleTypes::DATE,
+                                'time' =&gt; CreoleTypes::TIME,
+                                'year' =&gt; CreoleTypes::YEAR,
+                                'datetime' =&gt; CreoleTypes::TIMESTAMP,
+                                'timestamp' =&gt; CreoleTypes::TIMESTAMP,                                
+                                'tinyblob' =&gt; CreoleTypes::BINARY,
+                                'blob' =&gt; CreoleTypes::VARBINARY,
+                                'mediumblob' =&gt; CreoleTypes::VARBINARY,
+                                'longblob' =&gt; CreoleTypes::VARBINARY,
+                                'tinytext' =&gt; CreoleTypes::VARCHAR,
+                                'mediumtext' =&gt; CreoleTypes::LONGVARCHAR,
+                                'text' =&gt; CreoleTypes::LONGVARCHAR,
+                                );
+    
+    /** Reverse mapping, created on demand. */
+    private static $reverseMap = null;
+    
+    /**
+     * This method returns the generic Creole (JDBC-like) type
+     * when given the native db type.  If no match is found then we just
+     * return CreoleTypes::TEXT because SQLite is typeless.
+     * @param string $nativeType DB native type (e.g. 'TEXT', 'byetea', etc.).
+     * @return int Creole native type (e.g. CreoleTypes::LONGVARCHAR, CreoleTypes::BINARY, etc.).
+     */
+    public static function getType($nativeType)
+    {
+        $t = strtolower($nativeType);
+        if (isset(self::$typeMap[$t])) {
+            return self::$typeMap[$t];
+        } else {
+            return CreoleTypes::TEXT; // because SQLite is typeless
+        }
+    }
+            
+    /**
+     * This method will return a native type that corresponds to the specified
+     * Creole (JDBC-like) type.  Remember that this is really only for &quot;hint&quot; purposes
+     * as SQLite is typeless.
+     * 
+     * If there is more than one matching native type, then the LAST defined 
+     * native type will be returned.
+     * 
+     * @param int $creoleType
+     * @return string Native type string.
+     */
+    public static function getNativeType($creoleType)
+    {
+        if (self::$reverseMap === null) {
+            self::$reverseMap = array_flip(self::$typeMap);
+        }
+        return @self::$reverseMap[$creoleType];
+    }
+                                
+}
\ No newline at end of file

Added: trunk/vendor/creole/drivers/sqlite/metadata/SQLiteDatabaseInfo.php
===================================================================
--- trunk/vendor/creole/drivers/sqlite/metadata/SQLiteDatabaseInfo.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/sqlite/metadata/SQLiteDatabaseInfo.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,64 @@
+&lt;?php
+/*
+ *  $Id: SQLiteDatabaseInfo.php,v 1.3 2004/03/20 04:16:50 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+ 
+require_once 'creole/metadata/DatabaseInfo.php';
+
+/**
+ * SQLite implementation of DatabaseInfo.
+ * 
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.3 $
+ * @package   creole.drivers.sqlite.metadata
+ */ 
+class SQLiteDatabaseInfo extends DatabaseInfo {
+    
+    /**
+     * @throws SQLException
+     * @return void
+     */
+    protected function initTables()
+    {
+        include_once 'creole/drivers/sqlite/metadata/SQLiteTableInfo.php';        
+        
+        $sql = &quot;SELECT name FROM sqlite_master WHERE type='table' UNION ALL SELECT name FROM sqlite_temp_master WHERE type='table' ORDER BY name;&quot;;
+        $result = sqlite_query($this-&gt;dblink, $sql);
+            
+        if (!$result) {
+            throw new SQLException(&quot;Could not list tables&quot;, sqlite_error_string(sqlite_last_error($this-&gt;dblink)));
+        }
+        
+        while ($row = sqlite_fetch_array($result)) {
+            $this-&gt;tables[strtoupper($row[0])] = new SQLiteTableInfo($this, $row[0]);
+        }
+    }
+    
+    /**
+     * SQLite does not support sequences.
+     *
+     * @return void 
+     * @throws SQLException
+     */
+    protected function initSequences()
+    {
+        // throw new SQLException(&quot;MySQL does not support sequences natively.&quot;);
+    }
+        
+}

Added: trunk/vendor/creole/drivers/sqlite/metadata/SQLiteTableInfo.php
===================================================================
--- trunk/vendor/creole/drivers/sqlite/metadata/SQLiteTableInfo.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/drivers/sqlite/metadata/SQLiteTableInfo.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,133 @@
+&lt;?php
+/*
+ *  $Id: SQLiteTableInfo.php,v 1.8 2005/10/18 02:27:50 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+ 
+require_once 'creole/metadata/TableInfo.php';
+
+/**
+ * MySQL implementation of TableInfo.
+ * 
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.8 $
+ * @package   creole.drivers.sqlite.metadata
+ */
+class SQLiteTableInfo extends TableInfo {
+    
+    /** Loads the columns for this table. */
+    protected function initColumns() 
+    {
+        
+        include_once 'creole/metadata/ColumnInfo.php';
+        include_once 'creole/metadata/PrimaryKeyInfo.php';
+        include_once 'creole/drivers/sqlite/SQLiteTypes.php';                
+        
+        // To get all of the attributes we need, we'll actually do 
+        // two separate queries.  The first gets names and default values
+        // the second will fill in some more details.
+        
+        $sql = 'PRAGMA table_info('.$this-&gt;name.')';
+                
+        $res = sqlite_query($this-&gt;conn-&gt;getResource(), $sql);
+        
+        
+        while($row = sqlite_fetch_array($res, SQLITE_ASSOC)) {
+        
+            $name = $row['name'];
+            
+            $fulltype = $row['type'];            
+            $size = null;
+            $scale = null;
+            if (preg_match('/^([^\(]+)\(\s*(\d+)\s*,\s*(\d+)\s*\)$/', $fulltype, $matches)) {
+                $type = $matches[1];
+                $size = $matches[2];
+                $scale = $matches[3]; // aka precision    
+            } elseif (preg_match('/^([^\(]+)\(\s*(\d+)\s*\)$/', $fulltype, $matches)) {
+                $type = $matches[1];
+                $size = $matches[2];
+            } else {
+                $type = $fulltype;
+            }
+            
+            $not_null = $row['notnull'];
+            $is_nullable = !$not_null;
+            
+            $default_val = $row['dflt_value'];
+            
+            $this-&gt;columns[$name] = new ColumnInfo($this, $name, SQLiteTypes::getType($type), $type, $size, $scale, $is_nullable, $default_val);
+            
+            if (($row['pk'] == 1) || (strtolower($type) == 'integer primary key')) {
+                if ($this-&gt;primaryKey === null) {
+                    $this-&gt;primaryKey = new PrimaryKeyInfo($name);
+                }
+                $this-&gt;primaryKey-&gt;addColumn($this-&gt;columns[ $name ]);
+            }
+            
+        }        
+                
+        $this-&gt;colsLoaded = true;
+    }
+    
+    /** Loads the primary key information for this table. */
+    protected function initPrimaryKey()
+    {        
+        // columns have to be loaded first
+        if (!$this-&gt;colsLoaded) $this-&gt;initColumns();                        
+        // keys are loaded by initColumns() in this class.
+        $this-&gt;pkLoaded = true;
+    }
+    
+    /** Loads the indexes for this table. */
+    protected function initIndexes() {
+    
+        include_once 'creole/metadata/IndexInfo.php';        
+
+        // columns have to be loaded first
+        if (!$this-&gt;colsLoaded) $this-&gt;initColumns();        
+
+        $sql = 'PRAGMA index_list('.$this-&gt;name.')';
+        $res = sqlite_query($this-&gt;conn-&gt;getResource(), $sql);
+        
+        while($row = sqlite_fetch_array($res, SQLITE_ASSOC)) {        
+            $name = $row['name'];
+            $this-&gt;indexes[$name] = new IndexInfo($name);
+            
+            // get columns for that index
+            $res2 = sqlite_query($this-&gt;conn-&gt;getResource(), 'PRAGMA index_info('.$name.')');
+            while($row2 = sqlite_fetch_array($res2, SQLITE_ASSOC)) {
+                $colname = $row2['name'];
+                $this-&gt;indexes[$name]-&gt;addColumn($this-&gt;columns[ $colname ]);
+            }
+        }        
+                
+        $this-&gt;indexesLoaded = true;
+    }
+    
+    /** Load foreign keys (unsupported in SQLite). */
+    protected function initForeignKeys() {
+        
+        // columns have to be loaded first
+        if (!$this-&gt;colsLoaded) $this-&gt;initColumns();        
+        
+        // No fkeys in SQLite
+        
+        $this-&gt;fksLoaded = true;
+    }
+    
+}

Added: trunk/vendor/creole/metadata/ColumnInfo.php
===================================================================
--- trunk/vendor/creole/metadata/ColumnInfo.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/metadata/ColumnInfo.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,218 @@
+&lt;?php
+
+/*
+ *  $Id: ColumnInfo.php,v 1.13 2005/02/25 15:47:02 pachanga Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+/**
+ * Represents a Column.
+ *
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.13 $
+ * @package   creole.metadata
+ */
+class ColumnInfo {
+
+     // FIXME
+     //    - Currently all member attributes are public.  This should be fixed
+     // when PHP's magic __sleep() and __wakeup() functions &amp; serialization support
+     // handles protected/private members. (if ever)
+
+    /** Column name */
+    public $name;
+
+    /** Column Creole type. */
+    public $type;
+
+    /** Column native type */
+    public $nativeType;
+
+    /** Column length */
+    public $size;
+
+    /** Column scale (number of digits after decimal ) */
+    public $scale;
+
+    /** Is nullable? */
+    public $isNullable;
+
+    /** Default value */
+    public $defaultValue;
+
+    /** Is autoincrement? */
+    public $isAutoIncrement;
+
+    /** Table */
+    public $table;
+
+    /**
+     * Additional and optional vendor specific information.
+     * @var vendorSpecificInfo
+     */
+    protected $vendorSpecificInfo = array();
+
+    /**
+     * Construct a new ColumnInfo object.
+     *
+     * @param TableInfo $table The table that owns this column.
+     * @param string $name Column name.
+     * @param int $type Creole type.
+     * @param string $nativeType Native type name.
+     * @param int $size Column length.
+     * @param int $scale Column scale (number of digits after decimal).
+     * @param boolean $is_nullable Whether col is nullable.
+     * @param mixed $default Default value.
+     * @param boolean $is_auto_increment Whether col is of autoIncrement type.
+     */
+    function __construct(TableInfo
+                         $table,
+                         $name,
+                         $type = null,
+                         $nativeType = null,
+                         $size = null,
+                         $scale = null,
+                         $is_nullable = null,
+                         $default = null,
+                         $is_auto_increment = null,
+                         $vendorInfo = array())
+    {
+        $this-&gt;table = $table;
+        $this-&gt;name = $name;
+        $this-&gt;type = $type;
+        $this-&gt;nativeType = $nativeType;
+        $this-&gt;size = $size;
+        $this-&gt;scale = $scale;
+        $this-&gt;isNullable = $is_nullable;
+        $this-&gt;defaultValue = $default;
+        $this-&gt;isAutoIncrement = $is_auto_increment;
+        $this-&gt;vendorSpecificInfo = $vendorInfo;
+    }
+
+    /**
+     * This &quot;magic&quot; method is invoked upon serialize().
+     * Because the Info class hierarchy is recursive, we must handle
+     * the serialization and unserialization of this object.
+     * @return array The class variables that should be serialized (all must be public!).
+     */
+    function __sleep()
+    {
+        return array('name', 'type', 'nativeType', 'size', 'precision', 'isNullable', 'defaultValue');
+    }
+
+    /**
+     * Get column name.
+     * @return string
+     */
+    public function getName()
+    {
+        return $this-&gt;name;
+    }
+
+    /**
+     * Get column type.
+     * @return int
+     */
+    public function getType()
+    {
+        return $this-&gt;type;
+    }
+
+    /**
+     * Gets the native type name.
+     * @return string
+     */
+    public function getNativeType()
+    {
+        return $this-&gt;nativeType;
+    }
+
+    /**
+     * Get column size.
+     * @return int
+     */
+    public function getSize()
+    {
+        return $this-&gt;size;
+    }
+
+    /**
+     * Get column scale.
+     * Scale refers to number of digits after the decimal.  Sometimes this is referred
+     * to as precision, but precision is the total number of digits (i.e. length).
+     * @return int
+     */
+    public function getScale()
+    {
+        return $this-&gt;scale;
+    }
+
+    /**
+     * Get the default value.
+     * @return mixed
+     */
+    public function getDefaultValue()
+    {
+        return $this-&gt;defaultValue;
+    }
+
+    /**
+     * Is column nullable?
+     * @return boolean
+     */
+    public function isNullable()
+    {
+        return $this-&gt;isNullable;
+    }
+
+    /**
+     * Is column of autoincrement type?
+     * @return boolean
+     */
+    public function isAutoIncrement()
+    {
+        return $this-&gt;isAutoIncrement === true;
+    }
+
+    /**
+     * Get vendor specific optional information for this column.
+     * @return array vendorSpecificInfo[]
+     */
+    public function getVendorSpecificInfo()
+    {
+        return $this-&gt;vendorSpecificInfo;
+    }
+
+    /**
+     * @return string
+     */
+    public function toString()
+    {
+        return $this-&gt;name;
+    }
+
+    /**
+     * Get parent table.
+     * @return TableInfo
+     */
+    public function getTable()
+    {
+        return $this-&gt;table;
+    }
+
+}

Added: trunk/vendor/creole/metadata/DatabaseInfo.php
===================================================================
--- trunk/vendor/creole/metadata/DatabaseInfo.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/metadata/DatabaseInfo.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,212 @@
+&lt;?php
+
+/*
+ *  $Id: DatabaseInfo.php,v 1.14 2005/10/26 10:30:47 gamr Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+/**
+ * &quot;Info&quot; metadata class for a database.
+ *
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.14 $
+ * @package   creole.metadata
+ */
+abstract class DatabaseInfo {
+
+    protected $tables = array();
+
+    protected $sequences = array();
+
+    /** have tables been loaded */
+    protected $tablesLoaded = false;
+
+    /** have sequences been loaded */
+    protected $seqsLoaded = false;
+
+    /** additional vendor specific information */
+    private $vendorSpecificInfo = array();
+
+    /**
+     * The database Connection.
+     * @var Connection
+     */
+    protected $conn;
+
+    /** Database name. */
+    protected $dbname;
+
+    /**
+     * Database link
+     * @var resource
+     */
+    protected $dblink;
+
+    /**
+     * @param Connection $dbh
+     */
+    public function __construct(Connection $conn, $vendorInfo = array())
+    {
+        $this-&gt;conn = $conn;
+        $this-&gt;dblink = $conn-&gt;getResource();
+        $dsn = $conn-&gt;getDSN();
+        $this-&gt;dbname = $dsn['database'];
+        $this-&gt;vendorSpecificInfo = $vendorInfo;
+    }
+
+    /**
+     * Get name of database.
+     * @return string
+     */
+    public function getName()
+    {
+        return $this-&gt;dbname;
+    }
+
+    /**
+     * This method is invoked upon serialize().
+     * Because the Info class hierarchy is recursive, we must handle
+     * the serialization and unserialization of this object.
+     * @return array The class variables that should be serialized (all must be public!).
+     */
+    function __sleep()
+    {
+        return array('tables','conn');
+    }
+
+    /**
+     * This method is invoked upon unserialize().
+     * This method re-hydrates the object and restores the recursive hierarchy.
+     */
+    function __wakeup()
+    {
+        // Re-init vars from serialized connection
+        $this-&gt;dbname = $conn-&gt;database;
+        $this-&gt;dblink = $conn-&gt;connection;
+
+        // restore chaining
+        foreach($this-&gt;tables as $tbl) {
+            $tbl-&gt;database = $this;
+            $tbl-&gt;dbname = $this-&gt;dbname;
+            $tbl-&gt;dblink = $this-&gt;dblink;
+            $tbl-&gt;schema = $this-&gt;schema;
+        }
+    }
+
+    /**
+     * Returns Connection being used.
+     * @return Connection
+     */
+    public function getConnection()
+    {
+        return $this-&gt;conn;
+    }
+
+    /**
+     * Get the TableInfo object for specified table name.
+     * @param string $name The name of the table to retrieve.
+     * @return TableInfo
+     * @throws SQLException - if table does not exist in this db.
+     */
+    public function getTable($name)
+    {
+        if(!$this-&gt;tablesLoaded) $this-&gt;initTables();
+        if (!isset($this-&gt;tables[strtoupper($name)])) {
+            throw new SQLException(&quot;Database `&quot;.$this-&gt;dbname.&quot;` has no table `&quot;.$name.&quot;`&quot;);
+        }
+        return $this-&gt;tables[ strtoupper($name) ];
+    }
+
+  /**
+   * Return whether database contains specified table.
+   * @param string $name The table name.
+   * @return boolean
+   */
+  public function hasTable($name)
+  {
+    return isset($this-&gt;tables[strtoupper($name)]);
+  }
+
+    /**
+     * Gets array of TableInfo objects.
+     * @return array TableInfo[]
+     */
+    public function getTables()
+    {
+        if(!$this-&gt;tablesLoaded) $this-&gt;initTables();
+        return array_values($this-&gt;tables); //re-key [numerically]
+    }
+
+    /**
+     * Adds a table to this db.
+     * Table name is case-insensitive.
+     * @param TableInfo $table
+     */
+    public function addTable(TableInfo $table)
+    {
+        $this-&gt;tables[strtoupper($table-&gt;getName())] = $table;
+    }
+
+    /**
+     * @return void
+     * @throws SQLException
+     */
+    abstract protected function initTables();
+
+    // FIXME
+    // Figure out sequences.  What are they exactly?  Simply columns?
+    // Should this logic really be at the db level (yes &amp; no, i think).  Maybe
+    // also a Column::isSequence() method ?  PosgreSQL supports sequences obviously,
+    // but currently this part of dbinfo classes is not being used.
+
+    /**
+     * @return void
+     * @throws SQLException
+     */
+    abstract protected function initSequences();
+
+    /**
+     * @return boolean
+     * @throws SQLException
+     */
+    public function isSequence($key)
+    {
+        if(!$this-&gt;seqsLoaded) $this-&gt;initSequences();
+        return isset($this-&gt;sequences[ strtoupper($key) ]);
+    }
+
+    /**
+     * Gets array of ? objects.
+     * @return array ?[]
+     */
+    public function getSequences()
+    {
+        if(!$this-&gt;seqsLoaded) $this-&gt;initSequences();
+        return array_values($this-&gt;sequences); //re-key [numerically]
+    }
+
+    /**
+     * Get vendor specific optional information for this primary key.
+     * @return array vendorSpecificInfo[]
+     */
+    public function getVendorSpecificInfo()
+    {
+        return $this-&gt;vendorSpecificInfo;
+    }
+}
+

Added: trunk/vendor/creole/metadata/ForeignKeyInfo.php
===================================================================
--- trunk/vendor/creole/metadata/ForeignKeyInfo.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/metadata/ForeignKeyInfo.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,103 @@
+&lt;?php
+
+/*
+ *  $Id: ForeignKeyInfo.php,v 1.9 2005/08/02 14:42:36 sethr Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+/**
+ * Represents a foreign key.
+ *
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.9 $
+ * @package   creole.metadata
+ */
+class ForeignKeyInfo {
+
+    private $name;
+    private $references = array();
+
+    /**
+     * Additional and optional vendor specific information.
+     * @var vendorSpecificInfo
+     */
+    protected $vendorSpecificInfo = array();
+
+
+    const NONE       = &quot;&quot;;            // No &quot;ON [ DELETE | UPDATE]&quot; behaviour specified.
+    const NOACTION   = &quot;NO ACTION&quot;;
+    const CASCADE    = &quot;CASCADE&quot;;
+    const RESTRICT   = &quot;RESTRICT&quot;;
+    const SETDEFAULT = &quot;SET DEFAULT&quot;;
+    const SETNULL    = &quot;SET NULL&quot;;
+
+    /**
+     * @param string $name The name of the foreign key.
+     */
+    function __construct($name, $vendorInfo = array())
+    {
+        $this-&gt;name = $name;
+        $this-&gt;vendorSpecificInfo = $vendorInfo;
+    }
+
+    /**
+     * Get foreign key name.
+     * @return string
+     */
+    public function getName()
+    {
+        return $this-&gt;name;
+    }
+
+    /**
+     * Adds a foreign-local mapping.
+     * @param ColumnInfo $local
+     * @param ColumnInfo $foreign
+     */
+    public function addReference(ColumnInfo $local, ColumnInfo $foreign, $onDelete = self::NONE, $onUpdate = self::NONE)
+    {
+        $this-&gt;references[] = array($local, $foreign, $onDelete, $onUpdate);
+    }
+
+    /**
+     * Gets the local-foreign column mapping.
+     * @return array array( [0] =&gt; array([0] =&gt; local ColumnInfo object, [1] =&gt; foreign ColumnInfo object, [2] =&gt; onDelete, [3] =&gt; onUpdate) )
+     */
+    public function getReferences()
+    {
+        return $this-&gt;references;
+    }
+
+    /**
+     * Get vendor specific optional information for this primary key.
+     * @return array vendorSpecificInfo[]
+     */
+    public function getVendorSpecificInfo()
+    {
+        return $this-&gt;vendorSpecificInfo;
+    }
+
+    /**
+     * @return string
+     */
+    public function toString()
+    {
+        return $this-&gt;name;
+    }
+
+}

Added: trunk/vendor/creole/metadata/IndexInfo.php
===================================================================
--- trunk/vendor/creole/metadata/IndexInfo.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/metadata/IndexInfo.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,84 @@
+&lt;?php
+/*
+ *  $Id: IndexInfo.php,v 1.7 2005/02/25 15:47:02 pachanga Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+/**
+ * Represents an index.
+ *
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.7 $
+ * @package   creole.metadata
+ */
+class IndexInfo {
+
+    /** name of the index */
+    private $name;
+
+    /** columns in this index */
+    private $columns = array();
+
+    /** uniqueness flag */
+    private $isUnique = false;
+
+    /** additional vendor specific information */
+    private $vendorSpecificInfo = array();
+
+    function __construct($name, $isUnique = false, $vendorInfo = array())
+    {
+        $this-&gt;name = $name;
+        $this-&gt;isUnique = $isUnique;
+        $this-&gt;vendorSpecificInfo = $vendorInfo;
+    }
+
+    public function isUnique()
+    {
+        return $this-&gt;isUnique;
+    }
+
+    public function getName()
+    {
+        return $this-&gt;name;
+    }
+
+    /**
+     * Get vendor specific optional information for this index.
+     * @return array vendorSpecificInfo[]
+     */
+    public function getVendorSpecificInfo()
+    {
+        return $this-&gt;vendorSpecificInfo;
+    }
+
+    public function addColumn($column)
+    {
+        $this-&gt;columns[] = $column;
+    }
+
+    public function getColumns()
+    {
+        return $this-&gt;columns;
+    }
+
+    public function toString()
+    {
+        return $this-&gt;name;
+    }
+
+}

Added: trunk/vendor/creole/metadata/PrimaryKeyInfo.php
===================================================================
--- trunk/vendor/creole/metadata/PrimaryKeyInfo.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/metadata/PrimaryKeyInfo.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,91 @@
+&lt;?php
+/*
+ *  $Id: PrimaryKeyInfo.php,v 1.6 2005/02/25 15:47:02 pachanga Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+/**
+ * Represents a PrimaryKey
+ *
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.6 $
+ * @package   creole.metadata
+ */
+class PrimaryKeyInfo {
+
+    /** name of the primary key */
+    private $name;
+
+    /** columns in the primary key */
+    private $columns = array();
+
+    /** additional vendor specific information */
+    private $vendorSpecificInfo = array();
+
+    /**
+     * @param string $name The name of the foreign key.
+     */
+    function __construct($name, $vendorInfo = array())
+    {
+        $this-&gt;name = $name;
+        $this-&gt;vendorSpecificInfo = $vendorInfo;
+    }
+
+    /**
+     * Get foreign key name.
+     * @return string
+     */
+    public function getName()
+    {
+        return $this-&gt;name;
+    }
+
+    /**
+     * @param Column $column
+     * @return void
+     */
+    public function addColumn($column)
+    {
+        $this-&gt;columns[] = $column;
+    }
+
+    /**
+     * @return array Column[]
+     */
+    public function getColumns()
+    {
+        return $this-&gt;columns;
+    }
+
+    /**
+     * Get vendor specific optional information for this primary key.
+     * @return array vendorSpecificInfo[]
+     */
+    public function getVendorSpecificInfo()
+    {
+        return $this-&gt;vendorSpecificInfo;
+    }
+
+    /**
+     * @return string
+     */
+    public function toString()
+    {
+        return $this-&gt;name;
+    }
+}

Added: trunk/vendor/creole/metadata/TableInfo.php
===================================================================
--- trunk/vendor/creole/metadata/TableInfo.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/metadata/TableInfo.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,305 @@
+&lt;?php
+
+/*
+ *  $Id: TableInfo.php,v 1.16 2005/10/17 19:05:10 dlawson_mi Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+/**
+ * Represents a table.
+ *
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.16 $
+ * @package   creole.metadata
+ */
+abstract class TableInfo {
+
+    protected $name;
+    protected $columns = array();
+    protected $foreignKeys = array();
+    protected $indexes = array();
+    protected $primaryKey;
+
+    protected $pkLoaded = false;
+    protected $fksLoaded = false;
+    protected $indexesLoaded = false;
+    protected $colsLoaded = false;
+    protected $vendorLoaded = false;
+
+    /**
+     * Additional and optional vendor specific information.
+     * @var vendorSpecificInfo
+     */
+    protected $vendorSpecificInfo = array();
+
+    /**
+     * Database Connection.
+     * @var Connection
+     */
+    protected $conn;
+
+    /**
+     * The parent DatabaseInfo object.
+     * @var DatabaseInfo
+     */
+    protected $database;
+
+    /** Shortcut to db resource link id (needed by drivers for queries). */
+    protected $dblink;
+
+    /** Shortcut to db name (needed by many drivers for queries). */
+    protected $dbname;
+
+    /**
+     * @param string $table The table name.
+     * @param string $database The database name.
+     * @param resource $dblink The db connection resource.
+     */
+    function __construct(DatabaseInfo $database, $name) {
+        $this-&gt;database = $database;
+        $this-&gt;name = $name;
+        $this-&gt;conn = $database-&gt;getConnection(); // shortcut because all drivers need this for the queries
+        $this-&gt;dblink = $this-&gt;conn-&gt;getResource();
+        $this-&gt;dbname = $database-&gt;getName();
+    }
+
+    /**
+     * This &quot;magic&quot; method is invoked upon serialize().
+     * Because the Info class hierarchy is recursive, we must handle
+     * the serialization and unserialization of this object.
+     * @return array The class variables that should be serialized (all must be public!).
+     */
+    function __sleep()
+    {
+        return array('name', 'columns', 'foreignKeys', 'indexes', 'primaryKey');
+    }
+
+    /**
+     * This &quot;magic&quot; method is invoked upon unserialize().
+     * This method re-hydrates the object and restores the recursive hierarchy.
+     */
+    function __wakeup()
+    {
+        // restore chaining
+        foreach($this-&gt;columns as $col) {
+            $col-&gt;table = $this;
+        }
+    }
+
+    /**
+     * Loads the columns.
+     * @return void
+     */
+    abstract protected function initColumns();
+
+    /**
+     * Loads the primary key information for this table.
+     * @return void
+     */
+    abstract protected function initPrimaryKey();
+
+    /**
+     * Loads the foreign keys for this table.
+     * @return void
+     */
+    abstract protected function initForeignKeys();
+
+    /**
+     * Loads the indexes information for this table.
+     * @return void
+     */
+    abstract protected function initIndexes();
+
+    /**
+     * Loads the vendor specific information for this table.
+     * @return void
+     */
+    //it must be asbtract and be implemented in every vendor specific driver,
+    //however since it's an experimental stuff it has an empty body in order
+    //not to break BC
+    /*abstract*/ protected function initVendorSpecificInfo(){}
+
+    /**
+     * Get parimary key in this table.
+     * @throws Exception - if foreign keys are unsupported by DB.
+     * @return array ForeignKeyInfo[]
+     */
+    public function getPrimaryKey()
+    {
+        if(!$this-&gt;pkLoaded) $this-&gt;initPrimaryKey();
+        return $this-&gt;primaryKey;
+    }
+
+    /**
+     * Get the ColumnInfo object for specified column.
+     * @param string $name The column name.
+     * @return ColumnInfo
+     * @throws SQLException - if column does not exist for this table.
+     */
+    public function getColumn($name)
+    {
+        if(!$this-&gt;colsLoaded) $this-&gt;initColumns();
+        if (!isset($this-&gt;columns[$name])) {
+            throw new SQLException(&quot;Table `&quot;.$this-&gt;name.&quot;` has no column `&quot;.$name.&quot;`&quot;);
+        }
+        return $this-&gt;columns[$name];
+    }
+
+    /**
+     * Return whether table contains specified column.
+     * @param string $name The column name.
+     * @return boolean
+     */
+    public function hasColumn($name)
+    {
+        if(!$this-&gt;colsLoaded) $this-&gt;initColumns();
+        return isset($this-&gt;columns[$name]);
+    }
+
+    /**
+     * Get array of columns for this table.
+     * @return array ColumnInfo[]
+     */
+    public function getColumns()
+    {
+        if(!$this-&gt;colsLoaded) $this-&gt;initColumns();
+        return array_values($this-&gt;columns); // re-key numerically
+    }
+
+    /**
+     * Get specified fk for this table.
+     * @param string $name The foreign key name to retrieve.
+     * @return ForeignKeyInfo
+     * @throws SQLException - if fkey does not exist for this table.
+     */
+    public function getForeignKey($name)
+    {
+        if(!$this-&gt;fksLoaded) $this-&gt;initForeignKeys();
+        if (!isset($this-&gt;foreignKeys[$name])) {
+            throw new SQLException(&quot;Table `&quot;.$this-&gt;name.&quot;` has no foreign key `&quot;.$name.&quot;`&quot;);
+        }
+        return $this-&gt;foreignKeys[$name];
+    }
+
+    /**
+     * Get all foreign keys.
+     * @return array ForeignKeyInfo[]
+     */
+    public function getForeignKeys()
+    {
+        if(!$this-&gt;fksLoaded) $this-&gt;initForeignKeys();
+        return array_values($this-&gt;foreignKeys);
+    }
+
+    /**
+     * Gets the IndexInfo object for a specified index.
+     * @param string $name The index name to retrieve.
+     * @return IndexInfo
+     * @throws SQLException - if index does not exist for this table.
+     */
+    public function getIndex($name)
+    {
+        if(!$this-&gt;indexesLoaded) $this-&gt;initIndexes();
+        if (!isset($this-&gt;indexes[$name])) {
+            throw new SQLException(&quot;Table `&quot;.$this-&gt;name.&quot;` has no index `&quot;.$name.&quot;`&quot;);
+        }
+        return $this-&gt;indexes[$name];
+    }
+
+    /**
+     * Get array of IndexInfo objects for this table.
+     * @return array IndexInfo[]
+     */
+    public function getIndexes()
+    {
+        if(!$this-&gt;indexesLoaded) $this-&gt;initIndexes();
+        return array_values($this-&gt;indexes);
+    }
+
+    /**
+     * Alias for getIndexes() method.
+     * @return array
+     */
+    public function getIndices()
+    {
+        return $this-&gt;getIndexes();
+    }
+
+    /**
+     * Get table name.
+     * @return string
+     */
+    public function getName()
+    {
+        return $this-&gt;name;
+    }
+
+    /**
+     * @return string
+     */
+    public function toString()
+    {
+        return $this-&gt;name;
+    }
+
+    /** Have foreign keys been loaded? */
+    public function foreignKeysLoaded()
+    {
+        return $this-&gt;fksLoaded;
+    }
+
+    /** Has primary key info been loaded? */
+    public function primaryKeyLoaded()
+    {
+        return $this-&gt;pkLoaded;
+    }
+
+    /** Have columns been loaded? */
+    public function columnsLoaded()
+    {
+        return $this-&gt;colsLoaded;
+    }
+
+    /** Has index information been loaded? */
+    public function indexesLoaded()
+    {
+        return $this-&gt;indexesLoaded;
+    }
+
+    /**
+     * Get vendor specific optional information for this table.
+     * @return array vendorSpecificInfo[]
+     */
+    public function getVendorSpecificInfo()
+    {
+        if(!$this-&gt;vendorLoaded) $this-&gt;initVendorSpecificInfo();
+        return $this-&gt;vendorSpecificInfo;
+    }
+
+    /** Adds a column to this table. */
+    public function addColumn(ColumnInfo $column)
+    {
+        $this-&gt;columns[$column-&gt;getName()] = $column;
+    }
+
+    /** Get the parent DatabaseInfo object. */
+    public function getDatabase()
+    {
+        return $this-&gt;database;
+    }
+}

Added: trunk/vendor/creole/util/Blob.php
===================================================================
--- trunk/vendor/creole/util/Blob.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/util/Blob.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,62 @@
+&lt;?php
+/*
+ *  $Id: Blob.php,v 1.5 2004/03/20 04:16:50 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+require_once 'creole/util/Lob.php';
+
+/**
+ * A class for handling binary LOBs.
+ * 
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.5 $
+ * @package   creole.util
+ */
+class Blob extends Lob {            
+    
+    /**
+     * Dump the contents of the file using fpassthru().
+     *
+     * @return void
+     * @throws Exception if no file or contents.
+     */
+    function dump()
+    {
+        if (!$this-&gt;data) {            
+            // hmmm .. must be a file that needs to read in
+            if ($this-&gt;inFile) {
+                $fp = @fopen($this-&gt;inFile, &quot;rb&quot;);
+                if (!$fp) {
+                    throw new Exception('Unable to open file: '.$this-&gt;inFile);
+                }
+                fpassthru($fp);
+                @fclose($fp);
+            } else {
+                throw new Exception('No data to dump');
+            }
+        
+        } else {            
+            echo $this-&gt;data;
+        }        
+        
+    }
+    
+    
+
+}
\ No newline at end of file

Added: trunk/vendor/creole/util/Clob.php
===================================================================
--- trunk/vendor/creole/util/Clob.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/util/Clob.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,112 @@
+&lt;?php
+/*
+ *  $Id: Clob.php,v 1.6 2004/07/27 23:15:13 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+require_once 'creole/util/Lob.php';
+
+/**
+ * A class for handling character (ASCII) LOBs.
+ *
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.6 $
+ * @package   creole.util
+ */
+class Clob extends Lob {
+
+    /**
+     * Read LOB data from file.
+     * @param string $file Filename may also be specified here (if not specified using setInputFile()).
+     * @return void
+     * @throws Exception - if no file specified or error on read.
+     * @see setInputFile()
+     */
+    public function readFromFile($file = null)
+    {
+        if ($file !== null) {
+            $this-&gt;setInputFile($file);
+        }
+        if (!$this-&gt;inFile) {
+            throw Exception('No file specified for read.');
+        }
+        $data = null;
+        $file = fopen($this-&gt;inFile, &quot;rt&quot;);
+        while (!feof($file)) $data .= fgets($file, 4096);
+        fclose($file);
+        if ($data === false) {
+            throw new Exception('Unable to read from file: '.$this-&gt;inFile);
+        }
+        $this-&gt;setContents($data);
+    }
+
+
+    /**
+     * Write LOB data to file.
+     * @param string $file Filename may also be specified here (if not set using setOutputFile()).
+     * @throws Exception - if no file specified, no contents to write, or error on write.
+     * @see setOutputFile()
+     */
+    public function writeToFile($file = null)
+    {
+        if ($file !== null) {
+            $this-&gt;setOutputFile($file);
+        }
+        if (!$this-&gt;outFile) {
+            throw new Exception('No file specified for write');
+        }
+        if ($this-&gt;data === null) {
+            throw new Exception('No data to write to file');
+        }
+        $file = fopen($this-&gt;inFile, &quot;wt&quot;);
+        if (fputs($file, $data) === false)
+            throw new Exception('Unable to write to file: '.$this-&gt;outFile);
+        fclose($file);
+    }
+
+    /**
+     * Dump the contents of the file using fpassthru().
+     *
+     * @return void
+     * @throws Exception if no file or contents.
+     */
+    function dump()
+    {
+        if (!$this-&gt;data) {
+
+            // is there a file name set?
+            if ($this-&gt;inFile) {
+                $fp = @fopen($this-&gt;inFile, &quot;r&quot;);
+                if (!$fp) {
+                    throw new Exception('Unable to open file: '.$this-&gt;inFile);
+                }
+                fpassthru($fp);
+                @fclose($fp);
+            } else {
+                throw new Exception('No data to dump');
+            }
+
+        } else {
+            echo $this-&gt;data;
+        }
+
+    }
+
+
+
+}
\ No newline at end of file

Added: trunk/vendor/creole/util/Lob.php
===================================================================
--- trunk/vendor/creole/util/Lob.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/util/Lob.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,243 @@
+&lt;?php
+/*
+ *  $Id: Lob.php,v 1.10 2004/03/20 04:16:50 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+
+/**
+ * An abstract class for handling LOB (Locator Object) columns.
+ * 
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.10 $
+ * @package   creole.util
+ */
+abstract class Lob {
+
+    /** 
+     * The contents of the Lob.
+     * DO NOT SET DIRECTLY (or you will disrupt the
+     * ability of isModified() to give accurate results).
+     * @var string
+     */
+    protected $data;
+    
+    /** 
+     * File that blob should be written out to.
+     * @var string
+     */
+    protected $outFile;
+    
+    /** 
+     * File that blob should be read in from 
+     * @var string
+     */
+    protected $inFile;
+    
+    /**
+     * This is a 3-state value indicating whether column has been
+     * modified.
+     * Initially it is NULL.  Once first call to setContents() is made
+     * it is FALSE, because this will be initial state of Lob.  Once
+     * a subsequent call to setContents() is made it is TRUE.
+     * @var boolean
+     */
+    private $modified = null;
+    
+    /**
+     * Construct a new Lob.
+     * @param sttring $data The data contents of the Lob.
+     * @see setContents()
+     */
+    public function __construct($data = null)
+    {
+        if ($data !== null) {
+            $this-&gt;setContents($data);
+        }
+    }
+    
+    /**
+     * Get the contents of the LOB.
+     * @return string The characters in this LOB.
+     * @throws Exception
+     */
+    public function getContents()
+    {
+        if ($this-&gt;data === null &amp;&amp; $this-&gt;isFromFile()) {
+            $this-&gt;readFromFile();
+        }
+        return $this-&gt;data;
+    }
+    
+    /**
+     * Set the contents of this LOB.
+     * Sets the modified flag to FALSE if this is the first call
+     * to setContents() for this object.  Sets the bit to TRUE if
+     * this any subsequent call to setContents().
+     * @param string $bytes
+     */
+    public function setContents($data)
+    {
+        $this-&gt;data = $data;
+               
+        if ($this-&gt;modified === null) {
+             // if modified bit hasn't been set yet,
+            // then it should now be set to FALSE, since
+            // we just did inital population
+            $this-&gt;modified = false;
+        } elseif ($this-&gt;modified === false) {
+            // if it was already FALSE, then it should
+            // now be set to TRUE, since this is a subsequent
+            // modfiication.
+            $this-&gt;modified = true;
+        }
+    }
+        
+    /**
+     * Dump the contents of the file to stdout.
+     * Must be implemented by subclasses so that binary status is handled
+     * correctly. (i.e. ignored for Clob, handled for Blob)
+     * @return void
+     * @throws Exception if no file or contents.
+     */
+    abstract public function dump();
+    
+    /**
+     * Specify the file that we want this LOB read from.
+     * @param string $filePath The location of the file.
+     * @return void
+     */
+    public function setInputFile($filePath)
+    {
+        $this-&gt;inFile = $filePath;
+    }    
+
+    /**
+     * Get the file that we want this LOB read from.
+     * @return string The location of the file.
+     */
+    public function getInputFile()
+    {
+        return $this-&gt;inFile;
+    }    
+    
+    /**
+     * Specify the file that we want this LOB saved to.
+     * @param string $filePath The location of the file.
+     * @return void
+     */
+    public function setOutputFile($filePath)
+    {
+        $this-&gt;outFile = $filePath;        
+    }
+    
+    /**
+     * Get the file that we want this LOB saved to.
+     * @return string $filePath The location of the file.
+     */
+    public function getOutputFile()
+    {
+        return $this-&gt;outFile;
+    }
+
+    /**
+     * Returns whether this Lob is loaded from file.
+     * This is useful for bypassing need to read in the contents of the Lob.
+     * @return boolean Whether this LOB is to be read from a file.
+     */
+    public function isFromFile()
+    {
+        return ($this-&gt;inFile !== null);
+    }
+    
+    /**
+     * Read LOB data from file (binary safe).
+     * (Implementation may need to be moved into Clob / Blob subclasses, but 
+     * since file_get_contents() is binary-safe, it hasn't been necessary so far.)
+     * @param string $file Filename may also be specified here (if not specified using setInputFile()).
+     * @return void
+     * @throws Exception - if no file specified or error on read.
+     * @see setInputFile()
+     */
+    public function readFromFile($file = null)
+    {
+        if ($file !== null) {
+            $this-&gt;setInputFile($file);
+        }
+        if (!$this-&gt;inFile) {
+            throw Exception('No file specified for read.');
+        }        
+        $data = @file_get_contents($this-&gt;inFile);
+        if ($data === false) {
+            throw new Exception('Unable to read from file: '.$this-&gt;inFile);
+        }        
+        $this-&gt;setContents($data);                
+    }
+    
+    
+    /**
+     * Write LOB data to file (binary safe).
+     * (Impl may need to move into subclasses, but so far not necessary.)
+     * @param string $file Filename may also be specified here (if not set using setOutputFile()).
+     * @throws Exception - if no file specified, no contents to write, or error on write.
+     * @see setOutputFile()
+     */
+    public function writeToFile($file = null)
+    {
+        if ($file !== null) {
+            $this-&gt;setOutputFile($file);
+        }        
+        if (!$this-&gt;outFile) {
+            throw new Exception('No file specified for write');
+        }
+        if ($this-&gt;data === null) {
+            throw new Exception('No data to write to file');
+        }        
+        if (false === @file_put_contents($this-&gt;outFile, $this-&gt;data)) {
+            throw new Exception('Unable to write to file: '.$this-&gt;outFile);
+        }
+    }
+    
+    /**
+     * Convenience method to get contents of LOB as string.
+     * @return string
+     */
+    public function __toString()
+    {
+        return $this-&gt;getContents();
+    }
+    
+    /**
+     * Set whether LOB contents have been modified after initial setting.
+     * @param boolean $b
+     */
+    public function setModified($b)
+    {
+        $this-&gt;modified = $b;
+    }
+    
+    /**
+     * Whether LOB contents have been modified after initial setting.
+     * @return boolean TRUE if the contents have been modified after initial setting. 
+     *                  FALSE if contents have not been modified or if no contents have bene set.
+     */
+    public function isModified()
+    {
+        // cast it so that NULL will also eval to false
+        return (boolean) $this-&gt;modified;
+    }
+}

Added: trunk/vendor/creole/util/sql/SQLStatementExtractor.php
===================================================================
--- trunk/vendor/creole/util/sql/SQLStatementExtractor.php	2005-10-29 09:54:10 UTC (rev 242)
+++ trunk/vendor/creole/util/sql/SQLStatementExtractor.php	2005-10-29 09:55:23 UTC (rev 243)
@@ -0,0 +1,164 @@
+&lt;?php
+/*
+ *  $Id: SQLStatementExtractor.php,v 1.5 2004/07/27 23:13:46 hlellelid Exp $
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+ * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ *
+ * This software consists of voluntary contributions made by many individuals
+ * and is licensed under the LGPL. For more information please see
+ * &lt;<A HREF="http://creole.phpdb.org">http://creole.phpdb.org</A>&gt;.
+ */
+ 
+/**
+ * Static class for extracting SQL statements from a string or file.
+ *
+ * @author    Hans Lellelid &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/medick-svn">hans at xmpl.org</A>&gt;
+ * @version   $Revision: 1.5 $
+ * @package   creole.util.sql
+ */
+class SQLStatementExtractor {
+    
+    protected static $delimiter = ';';
+    
+    /**
+     * Get SQL statements from file.
+     * 
+     * @param string $filename Path to file to read.
+     * @return array SQL statements
+     */
+    public static function extractFile($filename) {
+        $buffer = file_get_contents($filename);
+        if ($buffer === false) {
+           throw new Exception(&quot;Unable to read file: &quot; . $filename);
+        }
+        return self::extractStatements(self::getLines($buffer));
+    }
+    
+    /**
+     * Extract statements from string.
+     * 
+     * @param string $txt
+     * @return array
+     */
+    public static function extract($buffer) {
+        return self::extractStatements(self::getLines($buffer));
+    }
+    
+    /**
+     * Extract SQL statements from array of lines.
+     *
+     * @param array $lines Lines of the read-in file.
+     * @return string
+     */
+    protected static function extractStatements($lines) {
+        
+        $statements = array();
+        $sql = &quot;&quot;;
+               
+        foreach($lines as $line) {
+        
+                $line = trim($line);
+                
+                if (self::startsWith(&quot;//&quot;, $line) || 
+                    self::startsWith(&quot;--&quot;, $line) ||
+                    self::startsWith(&quot;#&quot;, $line)) {
+                    continue;
+                }
+                
+                if (strlen($line) &gt; 4 &amp;&amp; strtoupper(substr($line,0, 4)) == &quot;REM &quot;) {
+                    continue;
+                }
+
+                $sql .= &quot; &quot; . $line;
+                $sql = trim($sql);
+
+                // SQL defines &quot;--&quot; as a comment to EOL
+                // and in Oracle it may contain a hint
+                // so we cannot just remove it, instead we must end it
+                if (strpos($line, &quot;--&quot;) !== false) {
+                    $sql .= &quot;\n&quot;;
+                }
+    
+                if (self::endsWith(self::$delimiter, $sql)) {
+                    $statements[] = self::substring($sql, 0, strlen($sql)-1 - strlen(self::$delimiter));
+                    $sql = &quot;&quot;;
+                }
+            }
+        return $statements;           
+    }
+    
+    //
+    // Some string helper methods
+    // 
+    
+    /**
+     * Tests if a string starts with a given string.
+     * @param string $check The substring to check.
+     * @param string $string The string to check in (haystack).
+     * @return boolean True if $string starts with $check, or they are equal, or $check is empty.
+     */
+    protected static function startsWith($check, $string) {
+        if ($check === &quot;&quot; || $check === $string) {
+            return true;
+        } else {
+            return (strpos($string, $check) === 0) ? true : false;
+        }
+    }
+    
+    /**
+     * Tests if a string ends with a given string.
+     * @param string $check The substring to check.
+     * @param string $string The string to check in (haystack).
+     * @return boolean True if $string ends with $check, or they are equal, or $check is empty.
+     */
+    protected static function endsWith($check, $string) {
+        if ($check === &quot;&quot; || $check === $string) {
+            return true;
+        } else {
+            return (strpos(strrev($string), strrev($check)) === 0) ? true : false;
+        }
+    } 
+
+    /**
+     * a natural way of getting a subtring, php's circular string buffer and strange
+     * return values suck if you want to program strict as of C or friends 
+     */
+    protected static function substring($string, $startpos, $endpos = -1) {
+        $len    = strlen($string);
+        $endpos = (int) (($endpos === -1) ? $len-1 : $endpos);
+        if ($startpos &gt; $len-1 || $startpos &lt; 0) {
+            trigger_error(&quot;substring(), Startindex out of bounds must be 0&lt;n&lt;$len&quot;, E_USER_ERROR);
+        }
+        if ($endpos &gt; $len-1 || $endpos &lt; $startpos) {
+            trigger_error(&quot;substring(), Endindex out of bounds must be $startpos&lt;n&lt;&quot;.($len-1), E_USER_ERROR);
+        }
+        if ($startpos === $endpos) {
+            return (string) $string{$startpos};
+        } else {
+            $len = $endpos-$startpos;
+        }
+        return substr($string, $startpos, $len+1);
+    }
+    
+    /**
+     * Convert string buffer into array of lines.
+     * 
+     * @param string $filename
+     * @return array string[] lines of file.
+     */
+    protected static function getLines($buffer) {       
+       $lines = preg_split(&quot;/\r?\n|\r/&quot;, $buffer);
+       return $lines;
+    }
+    
+}
\ No newline at end of file


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000046.html">[Medick-svn] r242 - in trunk: libs/action/controller libs/action/controller/templates libs/active/record libs/medick libs/medick/io test test/test/active/record
</A></li>
	<LI>Next message: <A HREF="000048.html">[Medick-svn] r244 - trunk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47">[ date ]</a>
              <a href="thread.html#47">[ thread ]</a>
              <a href="subject.html#47">[ subject ]</a>
              <a href="author.html#47">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/medick-svn">More information about the Medick-svn
mailing list</a><br>
</body></html>
